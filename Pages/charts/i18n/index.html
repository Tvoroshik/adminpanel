<!DOCTYPE html>
<HTML>

<HEAD>
    <script src="./moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.3.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.27.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0"></script>
    <link rel="stylesheet" href="./Styleiframe.css" type="text/css">



    <link rel="stylesheet" href="https://snipp.ru/cdn/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="https://snipp.ru/cdn/jQuery-Timepicker-Addon/dist/jquery-ui-timepicker-addon.min.css">
    <style type="text/css">
        #datepicker {
            width: 266px;
            display: inline-block;
            padding: 5px;
        }
    </style>

    <script src="https://snipp.ru/cdn/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://snipp.ru/cdn/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://snipp.ru/cdn/jQuery-Timepicker-Addon/dist/jquery-ui-timepicker-addon.min.js"></script>

    <script>
        /* Локализация datepicker */
        $.datepicker.regional['ru'] = {
            closeText: 'Закрыть',
            prevText: 'Предыдущий',
            nextText: 'Следующий',
            currentText: 'Сегодня',
            monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
            monthNamesShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
            dayNames: ['воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота'],
            dayNamesShort: ['вск', 'пнд', 'втр', 'срд', 'чтв', 'птн', 'сбт'],
            dayNamesMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
            weekHeader: 'Не',
            dateFormat: 'dd.mm.yy',
            firstDay: 1,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: ''
        };
        $.datepicker.setDefaults($.datepicker.regional['ru']);

        /* Локализация timepicker */
        $.timepicker.regional['ru'] = {
            timeOnlyTitle: 'Выберите время',
            timeText: 'Время',
            hourText: 'Часы',
            minuteText: 'Минуты',
            secondText: 'Секунды',
            millisecText: 'Миллисекунды',
            timezoneText: 'Часовой пояс',
            currentText: 'Сейчас',
            closeText: 'Закрыть',
            timeFormat: 'HH:mm:ss',
            amNames: ['AM', 'A'],
            pmNames: ['PM', 'P'],
            isRTL: false
        };
        $.timepicker.setDefaults($.timepicker.regional['ru']);
    </script>
    <style>
        .custom-btn {
            width: 130px;
            height: 20px;
            color: #fff;
            border-radius: 5px;
            padding: 10px 25px;
            font-family: 'Lato', sans-serif;
            font-weight: 500;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: inline-block;
            box-shadow: inset 2px 2px 2px 0px rgba(255, 255, 255, .5), 7px 7px 20px 0px rgba(0, 0, 0, .1), 4px 4px 5px 0px rgba(0, 0, 0, .1);
            outline: none;
        }

        .btn-7 {
            background: linear-gradient(0deg, rgba(255, 151, 0, 1) 0%, rgba(251, 75, 2, 1) 100%);
            line-height: 12px;
            padding: 0;
            border: none;
        }

        .btn-7 span {
            position: relative;
            display: block;
            width: 100%;
            height: 100%;
        }

        .btn-7:before,
        .btn-7:after {
            position: absolute;
            content: "";
            right: 0;
            bottom: 0;
            background: rgba(251, 75, 2, 1);
            box-shadow: -7px -7px 20px 0px rgba(255, 255, 255, .9), -4px -4px 5px 0px rgba(255, 255, 255, .9), 7px 7px 20px 0px rgba(0, 0, 0, .2), 4px 4px 5px 0px rgba(0, 0, 0, .3);
            transition: all 0.3s ease;
        }

        .btn-7:before {
            height: 0%;
            width: 2px;
        }

        .btn-7:after {
            width: 0%;
            height: 2px;
        }

        .btn-7:hover {
            color: rgba(251, 75, 2, 1);
            background: transparent;
        }

        .btn-7:hover:before {
            height: 100%;
        }

        .btn-7:hover:after {
            width: 100%;
        }

        .btn-7 span:before,
        .btn-7 span:after {
            position: absolute;
            content: "";
            left: 0;
            top: 0;
            background: rgba(251, 75, 2, 1);
            box-shadow: -7px -7px 20px 0px rgba(255, 255, 255, .9), -4px -4px 5px 0px rgba(255, 255, 255, .9), 7px 7px 20px 0px rgba(0, 0, 0, .2), 4px 4px 5px 0px rgba(0, 0, 0, .3);
            transition: all 0.3s ease;
        }

        .btn-7 span:before {
            width: 2px;
            height: 0%;
        }

        .btn-7 span:after {
            height: 2px;
            width: 0%;
        }

        .btn-7 span:hover:before {
            height: 100%;
        }

        .btn-7 span:hover:after {
            width: 100%;
        }
    </style>
</HEAD>

<BODY>
    <div class="first">
        <div id="Iframename" class="Iframename"></div>
        <div class="container">
            <div>
                <button id="btn4" class="custom-btn btn-7">
                    Значения сейчас
                </button>

                <button id="btn1" class="custom-btn btn-7">
                    Значения за День
                </button>
                <button id="btn2" class="custom-btn btn-7">
                    Значения за Месяц
                </button>
                <button id="btn3" class="custom-btn btn-7">
                    Значения за Год
                </button>

            </div>
            <div>
                <input type="text" id="range_example_1_start" placeholder="Начало измерения">
                <input type="text" id="range_example_1_end" placeholder="Конец измерения">
                <button id="btn5" class="custom-btn btn-7">
                    Отправить
                </button>

            </div>
        </div>





    </div>
    <div class="block_chart">
        <canvas id="myChart" class="chart"></canvas>
    </div>

    <script>

        var color = (sessionStorage.getItem('color'));
        color = color.split(';');
        var chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: String(color[3]),
            grey: String(color[4]),
        };
        var data;
        var cfg = sessionStorage.getItem('cfg_tree_node');
        var cfg_data = cfg.split(';');
        var label_graf_name;
        var Iframename;
        var alarm;
        label_graf_name = cfg_data[1];
        Iframename = cfg_data[1];
        document.getElementById("Iframename").innerHTML = Iframename;
        var color = Chart.helpers.color;

        const context5 = document.getElementById('myChart').getContext('2d');
        var myBarChart = new Chart(context5, {
            type: 'line',
            data: {
                datasets: [{
                    label: label_graf_name,
                    backgroundColor: color(chartColors.purple).alpha(0.5).rgbString(),
                    borderColor: chartColors.purple,
                    fill: false,
                    lineTension: 0,
                    borderDash: [],
                    data: []

                }, {

                    label: label_graf_name,
                    backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                    borderColor: chartColors.grey,
                    fill: false,
                    lineTension: 0,
                    borderDash: [],
                    data: [],

                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'realtime',
                        title: {
                            display: true,
                            text: 'Время',
                            color: '#FFFFFF',
                            font: {
                                family: 'Times',
                                size: 16,
                            }
                        },
                        ticks: {
                            color: '#FFFFFF',
                        },
                        grid: {
                            display: true,
                            drawBorder: true,
                            drawOnChartArea: true,
                            drawTicks: true,
                            color: '#FFFFFF',
                        },

                        realtime: {
                            duration: 20000,
                            refresh: 1000,
                            delay: 2000,
                            onRefresh:
                                chart => {
                                    var data = sessionStorage.getItem('data_from_server');
                                    data = data.split(';');
                                    //console.log(data);
                                    chart.data.datasets[0].data.push({
                                        x: Date.now(),
                                        y: Number(data[1]),
                                    });
                                    chart.data.datasets[1].data.push({
                                        x: Date.now(),
                                        y: Number(data[2]),
                                    });
                                },
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Значение',
                            color: '#FFFFFF',
                            font: {
                                family: 'Times',
                                size: 16,


                            }
                        },
                        ticks: {
                            color: '#FFFFFF',
                        },
                        grid: {
                            display: true,
                            drawBorder: true,
                            drawOnChartArea: true,
                            drawTicks: true,
                            color: '#FFFFFF',
                        },
                    }
                },
                interaction: {
                    intersect: false
                },
            }
        });





        //day
        $("#btn1").on("click", function () {
            sessionStorage.setItem('dmy', '0000-00-00' + ';' + '0000-00-00' + ';' + '00.00.00' + ';' + '00.00.00' + ';' + 'day');
            console.log('dmy', '0000-00-00' + ';' + '0000-00-00' + ';' + '00.00.00' + ';' + '00.00.00' + ';' + 'day');

            if (myBarChart != null) {
                myBarChart.destroy();
            }
            var length = [];
            var new1;
            var new2;

            const data = [];
            var prev = 0;
            var timeline = [];
            var start = 0;
            var datetime = 0;
            var datagraph = [];
            var length1 = [];

            window.onstorage = event => {
                if (event.key == 'db-answer') {

                    new1 = event.newValue;
                    new2 = new1.split(';');
                    console.log('new2', new2);
                    sessionStorage.removeItem('db-answer');

                    prev = new2[3];
                    time = new2[2];
                    datetime = String(new2[1]);
                    endtitle = new2[7];
                    length = Number(new2[6]);
                    datagraph += prev + ';';
                    timeline += datetime + ';';
                    length1 += length + ';';

                    if (endtitle != 'end') {
                        Graph(prev, time, datagraph, timeline, length1);
                    }
                }
            }
            function Graph(prev, time, datagraph, timeline, length1) {



                datagraph = datagraph.split(';');
                timeline = timeline.split(';');
                length1 = length1.split(';');
                console.log('length = ', length);
                console.log('timeline = ', timeline);
                console.log('datagraph = ', datagraph);
                for (let i = 0; i < length1; i++) {
                    data.push({ x: timeline, y: datagraph });
                    /* if (myBarChart != null) {
                         myBarChart.destroy();
                     }*/
                }
            }
            const totalDuration = 10000;
            const delayBetweenPoints = totalDuration / data.length;
            const previousY = (context1) => context1.index === 0 ? context1.chart.scales.y.getPixelForValue(100) : context1.chart.getDatasetMeta(context1.datasetIndex).data[context1.index - 1].getProps(['y'], true).y;

            const context1 = document.getElementById('myChart').getContext('2d');
            myBarChart = new Chart(context1, {

                type: 'line',
                data:
                {
                    datasets:
                        [{
                            backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                            borderColor: chartColors.grey,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data,
                        }]
                },
                options:
                {
                    animation: {
                        x: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: NaN, // the point is initially skipped
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.xStarted) {
                                    return 0;
                                }
                                ctx.xStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        },
                        y: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: previousY,
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.yStarted) {
                                    return 0;
                                }
                                ctx.yStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        legend: false
                    },
                    scales: {
                        x: {
                            type: 'linear',

                            title: {
                                display: true,
                                text: 'Время',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,
                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },

                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Значение',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,


                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },
                            type: 'linear'
                        },
                    }
                }

            });

        });





        //month
        $("#btn2").on("click", function () {
            sessionStorage.setItem('dmy', '0000-00-00' + ';' + '0000-00-00' + ';' + '00.00.00' + ';' + '00.00.00' + ';' + 'month');
            console.log('dmy', '0000-00-00' + ';' + '0000-00-00' + ';' + '00.00.00' + ';' + '00.00.00' + ';' + 'month');

            if (myBarChart != null) {
                myBarChart.destroy();
            }
            var length = [];
            var new1;
            var new2;

            const data = [];
            var prev = 0;
            var timeline = [];
            var start = 0;
            var datetime = 0;
            var datagraph = [];
            var length1 = [];

            window.onstorage = event => {
                if (event.key == 'db-answer') {

                    new1 = event.newValue;
                    new2 = new1.split(';');
                    console.log('new2', new2);
                    sessionStorage.removeItem('db-answer');

                    prev = new2[3];
                    time = new2[2];
                    datetime = String(new2[1]);
                    endtitle = new2[7];
                    length = Number(new2[6]);
                    datagraph += prev + ';';
                    timeline += datetime + ';';
                    length1 += length + ';';
                    start++
                    if (start < 2678400) {
                        Graph(prev, time, start, datagraph, timeline, endtitle);
                    }
                }
            }
            function Graph(prev, time, start, datagraph) {



                datagraph = datagraph.split(';');
                timeline = timeline.split(';');
                length1 = length1.split(';');
                console.log('length = ', length);
                console.log('timeline = ', timeline);
                console.log('datagraph = ', datagraph);

                for (let i = 0; i < 2678400; i++) {

                    data.push({ x: i, y: datagraph });

                    //if (myBarChart) myBarChart.destroy();

                }
            }
            const totalDuration = 10000;
            const delayBetweenPoints = totalDuration / data.length;
            const previousY = (context2) => context2.index === 0 ? context2.chart.scales.y.getPixelForValue(100) : context2.chart.getDatasetMeta(context2.datasetIndex).data[context2.index - 1].getProps(['y'], true).y;

            const context2 = document.getElementById('myChart').getContext('2d');
            myBarChart = new Chart(context2, {

                type: 'line',
                data:
                {
                    datasets:
                        [{
                            backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                            borderColor: chartColors.grey,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data,
                        }]
                },
                options:
                {
                    animation: {
                        x: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: NaN, // the point is initially skipped
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.xStarted) {
                                    return 0;
                                }
                                ctx.xStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        },
                        y: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: previousY,
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.yStarted) {
                                    return 0;
                                }
                                ctx.yStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        legend: false
                    },
                    scales: {
                        x: {
                            type: 'linear',

                            title: {
                                display: true,
                                text: 'Время',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,
                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },

                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Значение',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,


                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },
                            type: 'linear'
                        },
                    }
                }

            });
        });




        //year
        $("#btn3").on("click", function () {

            sessionStorage.setItem('dmy', '0000-00-00' + ';' + '0000-00-00' + ';' + '00.00.00' + ';' + '00.00.00' + ';' + 'year');
            console.log('dmy', '0000-00-00' + ';' + '0000-00-00' + ';' + '00.00.00' + ';' + '00.00.00' + ';' + 'year');

            if (myBarChart != null) {
                myBarChart.destroy();
            }
            var length = [];
            var new1;
            var new2;

            const data = [];
            var prev = 0;
            var timeline = [];
            var start = 0;
            var datetime = 0;
            var datagraph = [];
            var length1 = [];

            window.onstorage = event => {
                if (event.key == 'db-answer') {

                    new1 = event.newValue;
                    new2 = new1.split(';');
                    console.log('new2', new2);
                    sessionStorage.removeItem('db-answer');

                    prev = new2[3];
                    time = new2[2];
                    datetime = String(new2[1]);
                    endtitle = new2[7];
                    length = Number(new2[6]);
                    datagraph += prev + ';';
                    timeline += datetime + ';';
                    length1 += length + ';';
                    start++
                    if (start < 1000) {
                        Graph(prev, time, start, datagraph, timeline, endtitle);
                    }
                }
            }
            function Graph(prev, time, start, datagraph) {



                datagraph = datagraph.split(';');
                timeline = timeline.split(';');
                length1 = length1.split(';');
                console.log('length = ', length);
                console.log('datagraph = ', datagraph);

                for (let i = 0; i < 1000; i++) {

                    data.push({ x: i, y: datagraph });

                    //if (myBarChart) myBarChart.destroy();

                }
            }
            const totalDuration = 1000;
            const delayBetweenPoints = totalDuration / 1000

            const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;

            const context3 = document.getElementById('myChart').getContext('2d');
            myBarChart = new Chart(context3, {

                type: 'line',
                data:
                {
                    datasets:
                        [{
                            backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                            borderColor: chartColors.grey,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data,
                        }]
                },
                options:
                {
                    animation: {
                        x: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: NaN, // the point is initially skipped
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.xStarted) {
                                    return 0;
                                }
                                ctx.xStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        },
                        y: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: previousY,
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.yStarted) {
                                    return 0;
                                }
                                ctx.yStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        legend: false
                    },
                    scales: {
                        x: {
                            type: 'linear',

                            title: {
                                display: true,
                                text: 'Время',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,
                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },

                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Значение',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,


                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },
                            type: 'linear'
                        },
                    }
                }

            });




        });




        //Now
        $("#btn4").on("click", function () {

            if (myBarChart != null) {
                myBarChart.destroy();
            }


            var color = (sessionStorage.getItem('color'));
            color = color.split(';');
            var chartColors = {
                red: 'rgb(255, 99, 132)',
                orange: 'rgb(255, 159, 64)',
                yellow: 'rgb(255, 205, 86)',
                green: 'rgb(75, 192, 192)',
                blue: 'rgb(54, 162, 235)',
                purple: String(color[3]),
                grey: String(color[4]),
            };
            var data;
            var cfg = sessionStorage.getItem('cfg_tree_node');
            var cfg_data = cfg.split(';');
            var label_graf_name;
            var Iframename;
            var alarm;
            label_graf_name = cfg_data[1];
            Iframename = cfg_data[1];
            document.getElementById("Iframename").innerHTML = Iframename;
            var color = Chart.helpers.color;


            const context10 = document.getElementById('myChart').getContext('2d');
            myBarChart = new Chart(context10, {
                type: 'line',
                data: {
                    datasets: [{
                        label: label_graf_name,
                        backgroundColor: color(chartColors.purple).alpha(0.5).rgbString(),
                        borderColor: chartColors.purple,
                        fill: false,
                        lineTension: 0,
                        borderDash: [],
                        data: []

                    }, {

                        label: label_graf_name,
                        backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                        borderColor: chartColors.grey,
                        fill: false,
                        lineTension: 0,
                        borderDash: [],
                        data: [],

                    }]
                },
                options: {
                    scales: {
                        x: {
                            type: 'realtime',
                            title: {
                                display: true,
                                text: 'Время',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,
                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },

                            realtime: {
                                duration: 20000,
                                refresh: 1000,
                                delay: 2000,
                                onRefresh:
                                    chart => {
                                        var data = sessionStorage.getItem('data_from_server');
                                        data = data.split(';');
                                        //console.log(data);
                                        chart.data.datasets[0].data.push({
                                            x: Date.now(),
                                            y: Number(data[1]),
                                        });
                                        chart.data.datasets[1].data.push({
                                            x: Date.now(),
                                            y: Number(data[2]),
                                        });
                                    },
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Значение',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Times',
                                    size: 16,


                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },
                        }
                    },
                    interaction: {
                        intersect: false
                    },
                }
            });
        });

        //range
        $("#btn5").on("click", function () {

            //console.log('start', document.getElementById("range_example_1_start").value);
            //console.log('end', document.getElementById("range_example_1_end").value);
            first = document.getElementById("range_example_1_start").value;
            var first_cfg = first.split(' ');
            second = document.getElementById("range_example_1_end").value;
            var second_cfg = second.split(' ');
            sessionStorage.setItem('dmy', (String(first_cfg[0]) + ';' + String(first_cfg[1]) + ';' + String(second_cfg[0]) + ';' + String(second_cfg[1]) + ';' + "range"));

            //var context1 = document.getElementById('myChart').getContext('2d');
            var ctx = document.getElementById('myChart').getContext('2d');


            if (myBarChart != null) {
                myBarChart.destroy();
            }
            var length = [];
            var new1;
            var new2;

            const data = [];
            var prev = 0;
            var timeline = [];
            var start = 0;
            var datetime = 0;
            var datagraph = [];
            var length1 = [];
            var time2 = [];
            var datetime2 = [];
            window.onstorage = event => {
                if (event.key == 'db-answer') {

                    new1 = event.newValue;
                    new2 = new1.split(';');
                    console.log('new2', new2);
                    sessionStorage.removeItem('db-answer');

                    prev = new2[3];
                    time = new2[2];
                    datetime = String(new2[1]);
                    endtitle = new2[7];
                    length = Number(new2[6]);
                    datagraph += prev + ';';
                    timeline += datetime + ' ' + time + ';';
                    datetime2 += datetime + ';';
                    time2 += time + ';';

                    if (endtitle != 'end') {
                        Graph(prev, time, datagraph, timeline, length, time2, datetime2);
                    }
                }
            }
            function Graph(prev, time, datagraph, timeline, length, time2, datetime2) {



                datagraph = datagraph.split(';');
                timeline = timeline.split(';');
                time2 = time2.split(';');
                datetime2 = datetime2.split(';');
                console.log('length = ', length);
                // console.log('datetime2 = ', datetime2);
                // console.log('time = ', time);
                console.log('time2 = ', time2);
                console.log('timeline = ', timeline);
                console.log('datagraph = ', datagraph);

                if (length != 0) {
                    data.push({ x: timeline, y: datagraph });
                    //if (myBarChart) myBarChart.destroy();
                }
            }
            const totalDuration = 1000;
            const delayBetweenPoints = totalDuration / 1000

            const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;

            myBarChart = new Chart(ctx, {

                type: 'line',
                data:
                {
                    datasets:
                        [{
                            backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                            borderColor: chartColors.grey,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data,
                        }]
                },
                options:
                {
                    animation: {
                        x: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: NaN, // the point is initially skipped
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.xStarted) {
                                    return 0;
                                }
                                ctx.xStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        },
                        y: {
                            type: 'number',
                            easing: 'linear',
                            duration: delayBetweenPoints,
                            from: previousY,
                            delay(ctx) {
                                if (ctx.type !== 'data' || ctx.yStarted) {
                                    return 0;
                                }
                                ctx.yStarted = true;
                                return ctx.index * delayBetweenPoints;
                            }
                        }
                    },
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        legend: false
                    },
                    scales: {
                        x: {
                            type: 'time',
                            ticks: {
                                time: {
                                    unit: 'minute',
                                    parser: 'HH:mm',
                                    displayFormats: {
                                        minute: 'HH:mm'
                                    },
                                }
                            },
                                title: {
                                    display: true,
                                    text: 'Время',
                                    color: '#FFFFFF',
                                    font: {
                                        family: 'Times',
                                        size: 16,
                                    }
                                },
                                ticks: {
                                    color: '#FFFFFF',
                                },
                                grid: {
                                    display: true,
                                    drawBorder: true,
                                    drawOnChartArea: true,
                                    drawTicks: true,
                                    color: '#FFFFFF',
                                },

                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Значение',
                                    color: '#FFFFFF',
                                    font: {
                                        family: 'Times',
                                        size: 16,


                                    }
                                },
                                ticks: {
                                    color: '#FFFFFF',
                                },
                                grid: {
                                    display: true,
                                    drawBorder: true,
                                    drawOnChartArea: true,
                                    drawTicks: true,
                                    color: '#FFFFFF',
                                },
                                type: 'linear'
                            },
                        }
                    }

                });





        });


    </script>


    <script>
        //Script range choice
        var startDateTextBox = $('#range_example_1_start').text(JSON.stringify(
            $.datepicker.parseTime('HH:mm:ss:l z', "14:36:21:765 +2000", {})
        ));;
        var endDateTextBox = $('#range_example_1_end').text(JSON.stringify(
            $.datepicker.parseTime('HH:mm:ss:l z', "14:36:21:765 +2000", {})
        ));;

        startDateTextBox.datetimepicker({
            format: 'D/M/YYYY H:m:s',
            showTimezone: false,
            maxDate: 0,
            changeMonth: true,
            changeYear: true,
            onClose: function (dateText, inst) {
                if (endDateTextBox.val() != '') {
                    var testStartDate = startDateTextBox.datetimepicker('getDate');
                    var testEndDate = endDateTextBox.datetimepicker('getDate');
                    if (testStartDate > testEndDate)
                        endDateTextBox.datetimepicker('setDate', testStartDate);

                }
                else {
                    endDateTextBox.val(dateText);

                }
            },
            onSelect: function (selectedDateTime) {
                endDateTextBox.datetimepicker('option', 'minDate', startDateTextBox.datetimepicker('getDate'));
            }

        });

        $('#utility_example_1').click(function () {
            alert(startDateTextBox.datetimepicker('getDate'));
        });
        endDateTextBox.datetimepicker({
            format: 'DD/MM/YYYY HH:mm:ss',
            maxDate: 0,
            showTimezone: false,
            changeMonth: true,
            changeYear: true,
            onClose: function (dateText, inst) {
                if (startDateTextBox.val() != '') {
                    var testStartDate = startDateTextBox.datetimepicker('getDate');
                    var testEndDate = endDateTextBox.datetimepicker('getDate');

                    if (testStartDate > testEndDate)
                        startDateTextBox.datetimepicker('setDate', testEndDate);
                }
                else {
                    startDateTextBox.val(dateText);

                }
            },
            onSelect: function (selectedDateTime) {
                startDateTextBox.datetimepicker('option', 'maxDate', endDateTextBox.datetimepicker('getDate'));
            }
        });
        $('#utility_example_2').click(function () {
            alert(endDateTextBox.datetimepicker('getDate'));
        });
    </script>


</BODY>

</HTML>