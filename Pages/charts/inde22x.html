
<!DOCTYPE html>
<HTML>

<HEAD>
    <script src="./moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.3.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.27.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0"></script>

    <script src="./hammer.js"></script>
    <script src="./chartjs-plugin-zoom.min.js"></script>


    <link rel="stylesheet" href="./iframe.css" type="text/css">
    <link rel="stylesheet" href="https://snipp.ru/cdn/jqueryui/1.12.1/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="https://snipp.ru/cdn/jQuery-Timepicker-Addon/dist/jquery-ui-timepicker-addon.min.css"
        type="text/css">
    <link rel="stylesheet" href="./styleButton1.css" type="text/css">

    <script src="https://snipp.ru/cdn/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://snipp.ru/cdn/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://snipp.ru/cdn/jQuery-Timepicker-Addon/dist/jquery-ui-timepicker-addon.min.js"></script>
    <script src="./localeDatepicker.js"></script>

    <style>
        .item {
            flex-grow: 0.5;
            /* default 0 */


        }
    </style>
    <script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
    <script src="./sevenSeg.js"></script>

</HEAD>

<BODY>



    <div class="first">

        <div class="container">
            <div>

                <div id="Iframename" class="Iframename"></div>

            </div>
            <div class="item">
            </div>

            Р”Р°РЅРЅС‹Рµ Р·Р°:
            <input type="text" id="DateTextBox" placeholder=" Р’С‹Р±СЂР°С‚СЊ Р”РµРЅСЊ"
                style="font-size:14px; font-family: 'Lato', sans-serif;">
            <button id="btn1" class="custom-btn btn-7">
                РџРѕР»СѓС‡РёС‚СЊ
            </button>


            <button id="btn4" class="custom-btn btn-7">
                РўРµРєСѓС‰РµРµ Р·РЅР°С‡РµРЅРёРµ
            </button>

        </div>


        <div id="overlay">
            <div class="cv-spinner">
                <span class="spinner"></span>
            </div>
        </div>


    </div>
    </div>
    <style type="text/css">
        #maket {
            font-size: 16px;
            font-family: 'Lato', sans-serif;
            width: 100%;
            /* РЁРёСЂРёРЅР° РІСЃРµР№ С‚Р°Р±Р»РёС†С‹ */
            height: 100%;
            background: #373737;
        }

        TD {
            font-size: 16px;
            font-family: 'Lato', sans-serif;
            padding: 5px;
            background: #373737;
            /* РџРѕР»СЏ РІРѕРєСЂСѓРі СЏС‡РµРµРє */
        }

        TD#leftcol {
            font-size: 16px;
            font-family: 'Lato', sans-serif;
            width: 100px;
            /* РЁРёСЂРёРЅР° Р»РµРІРѕР№ РєРѕР»РѕРЅРєРё */
            background: #373737;
            /* Р¦РІРµС‚ С„РѕРЅР° Р»РµРІРѕР№ РєРѕР»РѕРЅРєРё */
            border: 1px dashed #000;
            /* РџР°СЂР°РјРµС‚СЂС‹ Р»РёРЅРёРё */
        }

        TD#rightcol {
            font-size: 16px;
            font-family: 'Lato', sans-serif;
            background: #373737;
            border: 1px dashed #000;
            /* Р¦РІРµС‚ С„РѕРЅР° РїСЂР°РІРѕР№ РєРѕР»РѕРЅРєРё */
        }
    </style>

<div class="tt"></div>


    <div class="contain">

        <table cellspacing="0" id="maket">
            <tr>
                <td id="leftcol">
                    <div id="label1"></div>
                </td>
                <td id="rightcol">
                    <div id="variable11"></div>
                </td>
            </tr>
            <tr>
                <td id="leftcol">
                    <div id="label2"></div>
                </td>

                <td id="rightcol">
                    <div id="variable22"></div>
                </td>
            </tr>
            <tr>
                <td id="leftcol">
                    <div id="label3"></div>
                </td>

                <td id="rightcol">
                    <div id="variable33"></div>
                </td>
            </tr>
        </table>
    </div>


    <style>
        #overlay {
            position: fixed;
            top: 0;
            z-index: 100;
            width: 100%;
            height: 100%;
            display: none;
            background: #373737;
        }

        .cv-spinner {
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px #ddd solid;
            border-top: 4px rgba(251, 75, 2, 1) solid;
            border-radius: 50%;
            animation: sp-anime 0.8s infinite linear;
        }

        @keyframes sp-anime {
            100% {
                transform: rotate(360deg);
            }
        }

        .is-hide {
            display: none;
        }
    </style>

    <div class="block_chart">
        <canvas id="myChart" class="chart"></canvas>
    </div>


    <script>

        sessionStorage.removeItem('data_from_server2');
        function onRefresh(chart) {


            var msg1 = (sessionStorage.getItem('data_from_server2'));
            var msg2 = msg1.split(';');
            //console.log(' label_graf_name1', label_graf_name1)
            //console.log(' label_graf_name1', label_graf_name2)
            //console.log(' label_graf_name1', label_graf_name3)
            //console.log(data);

            chart.data.datasets[0].data.push({
                x: Date.now(),
                y: Number(msg2[1]),
            });

            chart.data.datasets[1].data.push({
                x: Date.now(),
                y: Number(msg2[3]),
            });
            chart.data.datasets[2].data.push({
                x: Date.now(),
                y: Number(msg2[5]),
            });

            function TIMEOUT_CHART() {
                document.getElementById("label1").innerHTML = '';
                document.getElementById("label2").innerHTML = '';
                document.getElementById("label3").innerHTML = '';
                document.getElementById("variable22").innerHTML = '';
                document.getElementById("variable11").innerHTML = '';
                document.getElementById("variable33").innerHTML = '';


                chart.data.datasets[0].label.pop();
                chart.data.datasets[1].label.pop();
                chart.data.datasets[2].label.pop();


                label_graf_name1 = String(msg2[2]);
                label_graf_name2 = msg2[4];
                label_graf_name3 = msg2[6];
                console.log('label_graf_name2 ', label_graf_name2)
                console.log('label_graf_name3 ', label_graf_name3)
                if (label_graf_name1 != 'РўРµРјРїРµСЂР°С‚СѓСЂР°') {
                    label_graf_name1 = 'РџСѓСЃС‚Рѕ';
                }
                if (label_graf_name2 != 'Р’Р»Р°Р¶РЅРѕСЃС‚СЊ') {
                    label_graf_name2 = 'РџСѓСЃС‚Рѕ';
                }
                if (label_graf_name3 != 'WiFi dBm') {
                    label_graf_name3 = 'РџСѓСЃС‚Рѕ';
                }

                chart.data.datasets[0].label.push(label_graf_name1);
                chart.data.datasets[1].label.push(label_graf_name2);
                chart.data.datasets[2].label.push(label_graf_name3);

                if (chart.data.datasets[0].label.length != 1) {
                    chart.data.datasets[0].label.pop()
                }

                if (chart.data.datasets[1].label.length != 1) {
                    chart.data.datasets[1].label.pop()
                }

                if (chart.data.datasets[2].label.length != 1) {
                    chart.data.datasets[2].label.pop()
                }

                document.getElementById("label1").innerHTML = label_graf_name1;
                document.getElementById("label2").innerHTML = label_graf_name2;
                document.getElementById("label3").innerHTML = label_graf_name3;

                variable1 = msg2[1];
                if (variable1 == "undefined") {
                    variable1 = "РџСѓСЃС‚Рѕ"
                }
              
                variable2 = msg2[3];
                if (variable2 == "undefined") {
                    variable2 = "РџСѓСЃС‚Рѕ"
                }
               

                variable3 = msg2[5];
                if (variable3 == "undefined") {
                    variable3 = "РџСѓСЃС‚Рѕ"
                }

                document.getElementById("variable22").innerHTML = variable2;
                document.getElementById("variable11").innerHTML = variable1;
                document.getElementById("variable33").innerHTML = variable3;

            }
            setTimeout(TIMEOUT_CHART, 1);




        }


        const context5 = document.getElementById('myChart').getContext('2d');
        var color = (sessionStorage.getItem('color'));
        color = color.split(';');
        var chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: String(color[3]),
            grey: String(color[4]),
        };
        var data;
        var cfg = sessionStorage.getItem('cfg_tree_node');
        var cfg_data = cfg.split(';');
        var label_graf_name;
        var label_graf_name1;
        var label_graf_name2;
        var label_graf_name3;
        var variable1;
        var variable2;
        var Iframename;
        var alarm;
        label_graf_name = cfg_data[1];
        Iframename = cfg_data[1];
        document.getElementById("Iframename").innerHTML = Iframename;
        var color = Chart.helpers.color;


        var myBarChart = new Chart(context5, {
            type: 'line',
            data: {
                datasets: [{
                    label: [],
                    backgroundColor: color(chartColors.purple).alpha(0.5).rgbString(),
                    borderColor: chartColors.purple,
                    fill: false,
                    lineTension: 0,
                    borderDash: [],
                    data: []

                }, {

                    label: [],
                    backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                    borderColor: chartColors.grey,
                    fill: false,
                    lineTension: 0,
                    borderDash: [],
                    data: [],

                },
                {
                    label: [],
                    backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                    borderColor: chartColors.red,
                    fill: false,
                    lineTension: 0,
                    borderDash: [],
                    data: [],

                }]
            },
            options: {
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: 'rgb(255, 255, 255)',
                        }
                    },
                },
                scales: {
                    x: {
                        type: 'realtime',
                        title: {
                            display: true,
                            text: 'Р’СЂРµРјСЏ',
                            color: '#FFFFFF',
                            font: {
                                family: 'Lato',
                                size: 18,

                            }
                        },
                        ticks: {
                            color: '#FFFFFF',
                        },
                        grid: {
                            display: true,
                            drawBorder: true,
                            drawOnChartArea: true,
                            drawTicks: true,
                            color: '#FFFFFF',
                        },

                        realtime: {
                            duration: 20000,
                            refresh: 1000,
                            delay: 2000,
                            onRefresh: onRefresh
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Р—РЅР°С‡РµРЅРёРµ',
                            color: '#FFFFFF',
                            font: {
                                family: 'Lato',
                                size: 18,


                            }
                        },
                        ticks: {
                            color: '#FFFFFF',
                        },
                        grid: {
                            display: true,
                            drawBorder: true,
                            drawOnChartArea: true,
                            drawTicks: true,
                            color: '#FFFFFF',
                        },
                    }
                },
                interaction: {
                    intersect: false
                },
            }

        });


        //day
        $("#btn1").on("click", function () {

            first = document.getElementById("DateTextBox").value;
            var first_cfg = first.split(' ');
            sessionStorage.setItem('dmy', ("day" + ';' + String(first_cfg[0]) + ';' + String(first_cfg[1]) + ';' + '00.00.00' + ';' + '00.00.00'));
            jQuery(function ($) {
                $(document).ajaxSend(function () {
                    $("#overlay").fadeIn(6200);
                });
                $.ajax({
                    type: 'GET',

                }).done(function () {
                    setTimeout(function () {
                        $("#overlay").fadeOut(!1);
                    }, 0.000000001);
                });

                if (myBarChart != null) {
                    myBarChart.destroy();
                }

                sessionStorage.removeItem('data_from_server2');
        function onRefresh(chart) {


            var msg1 = (sessionStorage.getItem('data_from_server2'));
            var msg2 = msg1.split(';');
            //console.log(' label_graf_name1', label_graf_name1)
            //console.log(' label_graf_name1', label_graf_name2)
            //console.log(' label_graf_name1', label_graf_name3)
            //console.log(data);

            chart.data.datasets[0].data.push({
                x: Date.now(),
                y: Number(msg2[1]),
            });

            chart.data.datasets[1].data.push({
                x: Date.now(),
                y: Number(msg2[3]),
            });
            chart.data.datasets[2].data.push({
                x: Date.now(),
                y: Number(msg2[5]),
            });

            function TIMEOUT_CHART() {

                document.getElementById("label1").innerHTML = '';
                document.getElementById("label2").innerHTML = '';
                document.getElementById("label3").innerHTML = '';
                document.getElementById("variable22").innerHTML = '';
                document.getElementById("variable11").innerHTML = '';
                document.getElementById("variable33").innerHTML = '';

                chart.data.datasets[0].label.pop();
                chart.data.datasets[1].label.pop();
                chart.data.datasets[2].label.pop();


                label_graf_name1 = String(msg2[2]);
                label_graf_name2 = msg2[4];
                label_graf_name3 = msg2[6];
                console.log('label_graf_name2 ', label_graf_name2)
                console.log('label_graf_name3 ', label_graf_name3)
                if (label_graf_name1 != 'РўРµРјРїРµСЂР°С‚СѓСЂР°') {
                    label_graf_name1 = 'РџСѓСЃС‚Рѕ';
                }
                if (label_graf_name2 != 'Р’Р»Р°Р¶РЅРѕСЃС‚СЊ') {
                    label_graf_name2 = 'РџСѓСЃС‚Рѕ';
                }
                if (label_graf_name3 != 'WiFi dBm') {
                    label_graf_name3 = 'РџСѓСЃС‚Рѕ';
                }

                chart.data.datasets[0].label.push(label_graf_name1);
                chart.data.datasets[1].label.push(label_graf_name2);
                chart.data.datasets[2].label.push(label_graf_name3);

                if (chart.data.datasets[0].label.length != 1) {
                    chart.data.datasets[0].label.pop()
                }

                if (chart.data.datasets[1].label.length != 1) {
                    chart.data.datasets[1].label.pop()
                }

                if (chart.data.datasets[2].label.length != 1) {
                    chart.data.datasets[2].label.pop()
                }

                document.getElementById("label1").innerHTML = label_graf_name1;
                document.getElementById("label2").innerHTML = label_graf_name2;
                document.getElementById("label3").innerHTML = label_graf_name3;

                variable1 = msg2[1];
                if (variable1 == "undefined") {
                    variable1 = "РџСѓСЃС‚Рѕ"
                }
              
                variable2 = msg2[3];
                if (variable2 == "undefined") {
                    variable2 = "РџСѓСЃС‚Рѕ"
                }
               

                variable3 = msg2[5];
                if (variable3 == "undefined") {
                    variable3 = "РџСѓСЃС‚Рѕ"
                }

                document.getElementById("variable22").innerHTML = variable2;
                document.getElementById("variable11").innerHTML = variable1;
                document.getElementById("variable33").innerHTML = variable3;

            }
            setTimeout(TIMEOUT_CHART, 1);




        }


                var ctx = document.getElementById('myChart').getContext('2d');
                var length = 0;
                var new1;
                var new2;
                var i = 0;
                const data = [];
                const data2 = [];
                const data3 = [];
                const data4 = [];
                const data5 = [];
                const data6 = [];
                const data7 = [];
                const data8 = [];
                const data9 = [];
                const data10 = [];
                var label1 = "";
                var prev = 0;
                var timeline = [];
                var start = 0;
                var datetime = 0;
                var endtitle2;
                var datagraph = [];
                var length1 = [];
                var time2 = [];
                var datetime2 = [];
                var num_graph;
                var label_name1;
                var label_name2;
                var label_name3;
                var labels;
                window.onstorage = event => {
                    if (event.key == 'db-answer') {

                        new1 = event.newValue;
                        new2 = new1.split(';');
                        // console.log('new2', new2);
                        sessionStorage.removeItem('db-answer');

                        prev = new2[3];

                        datetime = String(new2[1]);
                        time = datetime + ' ' + new2[2];
                        endtitle = new2[7];
                        endtitle2 = new2[9];
                        num_graph = new2[5];

                        datagraph += prev + ';';
                        timeline += datetime + ' ' + time + ';';
                        datetime2 += datetime + ';';
                        time2 += time + ';';

                        start++
                        length = Number(new2[6]);
                        if (endtitle2 == 'fist') {
                            labels = new2[8] + ';';
                        }
                        else if (endtitle != 'end') {
                            Graph(prev, time, datagraph, timeline, length, num_graph);
                        }


                    }
                }
                function Graph(prev, time, datagraph, timeline, length, num_graph) {

                    datagraph = datagraph.split(';');
                    timeline = timeline.split(';');
                    time2 = time2.split(';');
                    datetime2 = datetime2.split(';');
                    //console.log('label1s = ', labels_all);
                    // console.log('length = ', length);
                    // console.log('datetime2 = ', datetime2);
                    // console.log('time = ', time);
                    // console.log('time = ', time);
                    //console.log('timeline = ', timeline);

                    if (length > 0 & num_graph == 0) {

                        data.push({ x: time, y: prev });

                        //console.log('prev = ', prev);
                        //if (myBarChart) myBarChart.destroy();
                    }
                    else if (length > 0 & num_graph == 1) {
                        data2.push({ x: time, y: prev });

                    }
                    else if (length > 0 & num_graph == 2) {
                        data3.push({ x: time, y: prev });
                    }


                }

                myBarChart = new Chart(ctx, {

                    type: 'line',
                    data:
                    {
                        datasets:
                            [{
                                label: 'РўРµРјРїРµСЂР°С‚СѓСЂР°',
                                backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                                borderColor: chartColors.grey,
                                fill: false,
                                lineTension: 0,
                                radius: 0,
                                data: data,
                            },
                            {
                                label: 'Р’Р»Р°Р¶РЅРѕСЃС‚СЊ',
                                backgroundColor: color(chartColors.purple).alpha(0.5).rgbString(),
                                borderColor: chartColors.purple,
                                fill: false,
                                lineTension: 0,
                                radius: 0,
                                data: data2,
                            },
                            {
                                label: 'WiFi dBm',
                                backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                                borderColor: chartColors.red,
                                fill: false,
                                lineTension: 0,
                                radius: 0,
                                data: data3,
                            },

                            ]
                    },
                    options:
                    {
                        interaction: {
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: 'rgb(255, 255, 255)'
                                }
                            },
                            zoom: {
                                pan: {
                                    enabled: true,
                                    mode: 'x',
                                    modifierKey: 'ctrl',
                                },
                                zoom: {
                                    drag: {
                                        enabled: true
                                    },
                                    mode: 'x',
                                },
                            }
                        },
                        scales: {
                            x: {
                                x: {
                                    min: '2021-11-07 00:00:00',
                                },
                                title: {
                                    display: true,
                                    text: 'Р’СЂРµРјСЏ',
                                    color: '#FFFFFF',
                                    font: {
                                        family: 'Lato',
                                        size: 18,
                                    }
                                },
                                ticks: {
                                    color: '#FFFFFF',
                                },
                                grid: {
                                    display: true,
                                    drawBorder: true,
                                    drawOnChartArea: true,
                                    drawTicks: true,
                                    color: '#FFFFFF',
                                },

                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Р—РЅР°С‡РµРЅРёРµ',
                                    color: '#FFFFFF',
                                    font: {
                                        family: 'Lato',
                                        size: 18,


                                    }
                                },
                                ticks: {
                                    color: '#FFFFFF',
                                },
                                grid: {
                                    display: true,
                                    drawBorder: true,
                                    drawOnChartArea: true,
                                    drawTicks: true,
                                    color: '#FFFFFF',
                                },
                                type: 'linear'
                            },
                        }
                    }

                });
                setTimeout(function () { myBarChart.update(); }, 6000);

            });
            // document.getElementById("DateTextBox").value = '';

        });

        //Now
        $("#btn4").on("click", function () {
            if (myBarChart != null) {
                myBarChart.destroy();
            }

            sessionStorage.removeItem('data_from_server2');
        function onRefresh(chart) {


            var msg1 = (sessionStorage.getItem('data_from_server2'));
            var msg2 = msg1.split(';');
            //console.log(' label_graf_name1', label_graf_name1)
            //console.log(' label_graf_name1', label_graf_name2)
            //console.log(' label_graf_name1', label_graf_name3)
            //console.log(data);

            chart.data.datasets[0].data.push({
                x: Date.now(),
                y: Number(msg2[1]),
            });

            chart.data.datasets[1].data.push({
                x: Date.now(),
                y: Number(msg2[3]),
            });
            chart.data.datasets[2].data.push({
                x: Date.now(),
                y: Number(msg2[5]),
            });
        }




            var context15 = document.getElementById('myChart').getContext('2d');
            myBarChart = new Chart(context15, {
                type: 'line',
                data: {
                    datasets: [{
                        label: label_graf_name1,
                        backgroundColor: color(chartColors.purple).alpha(0.5).rgbString(),
                        borderColor: chartColors.purple,
                        fill: false,
                        lineTension: 0,
                        borderDash: [],
                        data: []

                    }, {

                        label: label_graf_name2,
                        backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                        borderColor: chartColors.grey,
                        fill: false,
                        lineTension: 0,
                        borderDash: [],
                        data: [],

                    },
                    {

                        label: label_graf_name3,
                        backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                        borderColor: chartColors.red,
                        fill: false,
                        lineTension: 0,
                        borderDash: [],
                        data: [],

                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: 'rgb(255, 255, 255)'
                            }
                        },
                    },
                    scales: {
                        x: {
                            type: 'realtime',
                            title: {
                                display: true,
                                text: 'Р’СЂРµРјСЏ',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Lato',
                                    size: 18,
                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },

                            realtime: {
                                duration: 20000,
                                refresh: 1000,
                                delay: 2000,
                                onRefresh: onRefresh,

                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Р—РЅР°С‡РµРЅРёРµ',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Lato',
                                    size: 18,


                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },
                        }
                    },
                    interaction: {
                        intersect: false
                    },
                }
            });

        });


        //range
        $("#btn5").on("click", function () {
            if (myBarChart != null) {
                myBarChart.destroy();
            }
            //console.log('start', document.getElementById("range_example_1_start").value);
            //console.log('end', document.getElementById("range_example_1_end").value);
            first = document.getElementById("range_example_1_start").value;
            var first_cfg = first.split(' ');
            second = document.getElementById("range_example_1_end").value;
            var second_cfg = second.split(' ');
            sessionStorage.setItem('dmy', ("range" + ';' + String(first_cfg[0]) + ';' + String(second_cfg[0]) + ';' + String(first_cfg[1]) + ';' + String(second_cfg[1])));

            //var context1 = document.getElementById('myChart').getContext('2d');
            var ctx = document.getElementById('myChart').getContext('2d');
            var length = 0;
            var new1;
            var new2;
            var i = 0;
            const data = [];
            const data2 = [];
            const data3 = [];
            const data4 = [];
            const data5 = [];
            const data6 = [];
            const data7 = [];
            const data8 = [];
            const data9 = [];
            const data10 = [];
            var prev = 0;
            var timeline = [];
            var start = 0;
            var datetime = 0;
            var datagraph = [];
            var length1 = [];
            var time2 = [];
            var datetime2 = [];
            var num_graph;
            window.onstorage = event => {
                if (event.key == 'db-answer') {

                    new1 = event.newValue;
                    new2 = new1.split(';');
                    //console.log('new2', new2);
                    sessionStorage.removeItem('db-answer');

                    prev = new2[3];

                    datetime = String(new2[1]);
                    time = datetime + ' ' + new2[2];
                    endtitle = new2[7];
                    num_graph = new2[5];

                    datagraph += prev + ';';
                    timeline += datetime + ' ' + time + ';';
                    datetime2 += datetime + ';';
                    time2 += time + ';';

                    start++
                    length = Number(new2[6]);


                    if (endtitle != 'end') {
                        Graph(prev, time, datagraph, timeline, length, num_graph);
                    }


                }
            }
            function Graph(prev, time, datagraph, timeline, length, num_graph) {
                datagraph = datagraph.split(';');
                timeline = timeline.split(';');
                time2 = time2.split(';');
                datetime2 = datetime2.split(';');
                console.log('length = ', length);
                // console.log('datetime2 = ', datetime2);
                // console.log('time = ', time);
                console.log('time = ', time);
                //console.log('timeline = ', timeline);


                if (length > 0 & num_graph == 0) {

                    data.push({ x: time, y: prev });

                    //console.log('prev = ', prev);
                    //if (myBarChart) myBarChart.destroy();
                }
                else if (length > 0 & num_graph == 1) {
                    data2.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 2) {
                    data3.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 3) {
                    data4.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 4) {
                    data5.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 5) {
                    data6.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 6) {
                    data7.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 7) {
                    data8.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 7) {
                    data9.push({ x: time, y: prev });
                }
                else if (length > 0 & num_graph == 7) {
                    data10.push({ x: time, y: prev });
                }
            }


            myBarChart = new Chart(ctx, {

                type: 'line',
                data:
                {
                    datasets:
                        [{
                            label: 'Data1',
                            backgroundColor: color(chartColors.grey).alpha(0.5).rgbString(),
                            borderColor: chartColors.grey,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data,
                        },
                        {
                            label: 'Data2',
                            backgroundColor: color(chartColors.purple).alpha(0.5).rgbString(),
                            borderColor: chartColors.purple,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data2,
                        },
                        {
                            label: 'Data3',
                            backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                            borderColor: chartColors.red,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data3,
                        },
                        {
                            label: 'Data4',
                            backgroundColor: color(chartColors.yellow).alpha(0.5).rgbString(),
                            borderColor: chartColors.yellow,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data4,
                        },
                        {
                            label: 'Data5',
                            backgroundColor: color(chartColors.green).alpha(0.5).rgbString(),
                            borderColor: chartColors.green,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data5,
                        },
                        {
                            label: 'Data6',
                            backgroundColor: color(chartColors.blue).alpha(0.5).rgbString(),
                            borderColor: chartColors.blue,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data6,
                        },
                        {
                            label: 'Data7',
                            backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                            borderColor: chartColors.red,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data7,
                        },
                        {
                            label: 'Data8',
                            backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                            borderColor: chartColors.red,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data8,
                        },
                        {
                            label: 'Data9',
                            backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                            borderColor: chartColors.red,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data9,
                        },
                        {
                            label: 'Data10',
                            backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
                            borderColor: chartColors.red,
                            fill: false,
                            lineTension: 0,
                            radius: 0,
                            data: data10,
                        }]
                },
                options:
                {
                    interaction: {
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: 'rgb(255, 255, 255)'
                            }
                        },
                        zoom: {
                            pan: {
                                enabled: true,
                                mode: 'x',
                                modifierKey: 'ctrl',
                            },
                            zoom: {
                                drag: {
                                    enabled: true
                                },
                                mode: 'x',
                            },
                        }
                    },
                    scales: {
                        x: {
                            x: {
                                min: '2021-11-07 00:00:00',
                            },
                            title: {
                                display: true,
                                text: 'Р’СЂРµРјСЏ',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Lato',
                                    size: 18,
                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },

                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Р—РЅР°С‡РµРЅРёРµ',
                                color: '#FFFFFF',
                                font: {
                                    family: 'Lato',
                                    size: 18,


                                }
                            },
                            ticks: {
                                color: '#FFFFFF',
                            },
                            grid: {
                                display: true,
                                drawBorder: true,
                                drawOnChartArea: true,
                                drawTicks: true,
                                color: '#FFFFFF',
                            },
                            type: 'linear'
                        },
                    }
                }

            });
            setTimeout(function () { myBarChart.update(); }, 6000);

            document.getElementById("range_example_1_start").value = '';
            document.getElementById("range_example_1_end").value = '';
        });

    </script>

    <script src="./datepicker.js"></script>

</BODY>

</HTML>