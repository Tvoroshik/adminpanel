/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/@xeokit/xeokit-sdk@2.2.5-performance-textures-beta-2/dist/xeokit-sdk.es.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
 class Map$1{constructor(e,t){this.items=e||[],this._lastUniqueId=(t||0)+1}addItem(){let e;if(2===arguments.length){const t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(e=arguments[0]||{};;){const t=this._lastUniqueId++;if(!this.items[t])return this.items[t]=e,t}}removeItem(e){const t=this.items[e];return delete this.items[e],t}}const idMap$1=new Map$1;class Menu{constructor(e){this.id=e,this.parentItem=null,this.groups=[],this.menuElement=null,this.shown=!1,this.mouseOver=0}}class Group{constructor(){this.items=[]}}class Item{constructor(e,t,i,s,r){this.id=e,this.getTitle=t,this.doAction=i,this.getEnabled=s,this.getShown=r,this.itemElement=null,this.subMenu=null,this.enabled=!0}}class ContextMenu{constructor(e={}){this._id=idMap$1.addItem(),this._context=null,this._enabled=!1,this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={},this._shown=!1,this._nextId=0,this._eventSubs={},!1!==e.hideOnMouseDown&&(document.addEventListener("mousedown",(e=>{e.target.classList.contains("xeokit-context-menu-item")||this.hide()})),document.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{e.target.classList.contains("xeokit-context-menu-item")||this.hide()})),e.items&&(this.items=e.items),this.context=e.context,this.enabled=!1!==e.enabled,this.hide()}on(e,t){let i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}fire(e,t){const i=this._eventSubs[e];if(i)for(let e=0,s=i.length;e<s;e++)i[e](t)}set items(e){this._clear(),this._itemsCfg=e||[],this._parseItems(e),this._createUI()}get items(){return this._itemsCfg}set enabled(e){(e=!!e)!==this._enabled&&(this._enabled=e,this._enabled||this.hide())}get enabled(){return this._enabled}set context(e){this._context=e}get context(){return this._context}show(e,t){this._context?this._enabled&&(this._shown||(this._hideAllMenus(),this._updateItemsTitles(),this._updateItemsEnabledStatus(),this._showMenu(this._rootMenu.id,e,t),this._shown=!0,this.fire("shown",{}))):console.error("ContextMenu cannot be shown without a context - set context first")}get shown(){return this._shown}hide(){this._enabled&&this._shown&&(this._hideAllMenus(),this._shown=!1,this.fire("hidden",{}))}destroy(){this._context=null,this._clear(),null!==this._id&&(idMap$1.removeItem(this._id),this._id=null)}_clear(){for(let e=0,t=this._menuList.length;e<t;e++){const t=this._menuList[e].menuElement;t.parentElement.removeChild(t)}this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={}}_parseItems(e){const t=e=>{const i=this._getNextId(),s=new Menu(i);for(let i=0,r=e.length;i<r;i++){const r=e[i],o=new Group;s.groups.push(o);for(let e=0,i=r.length;e<i;e++){const i=r[e],a=i.items,n=a&&a.length>0,h=this._getNextId(),l=i.getTitle||(()=>i.title||""),c=i.doAction||i.callback||(()=>{}),u=i.getEnabled||(()=>!0),p=i.getShown||(()=>!0),d=new Item(h,l,c,u,p);if(d.parentMenu=s,o.items.push(d),n){const e=t(a);d.subMenu=e,e.parentItem=d}this._itemList.push(d),this._itemMap[d.id]=d}}return this._menuList.push(s),this._menuMap[s.id]=s,s};this._rootMenu=t(e)}_getNextId(){return"ContextMenu_"+this._id+this._nextId++}_createUI(){const e=t=>{this._createMenuUI(t);const i=t.groups;for(let t=0,s=i.length;t<s;t++){const s=i[t].items;for(let t=0,i=s.length;t<i;t++){const i=s[t].subMenu;i&&e(i)}}};e(this._rootMenu)}_createMenuUI(e){const t=e.groups,i=[];if(i.push('<div class="xeokit-context-menu '+e.id+'" style="z-index:300000; position: absolute;">'),i.push("<ul>"),t)for(let e=0,s=t.length;e<s;e++){const r=e,o=s,a=t[e].items;if(a)for(let e=0,t=a.length;e<t;e++){const s=a[e],n=s.subMenu,h=s.title||"";n?i.push('<li id="'+s.id+'" class="xeokit-context-menu-item" style="'+(r===o-1||e<t-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+h+" [MORE]</li>"):i.push('<li id="'+s.id+'" class="xeokit-context-menu-item" style="'+(r===o-1||e<t-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+h+"</li>")}}i.push("</ul>"),i.push("</div>");const s=i.join("");document.body.insertAdjacentHTML("beforeend",s);const r=document.querySelector("."+e.id);e.menuElement=r,r.style["border-radius"]="4px",r.style.display="none",r.style["z-index"]=3e5,r.style.background="white",r.style.border="1px solid black",r.style["box-shadow"]="0 4px 5px 0 gray",r.oncontextmenu=e=>{e.preventDefault()};const o=this;let a=null;if(t)for(let e=0,i=t.length;e<i;e++){const i=t[e].items;if(i)for(let e=0,t=i.length;e<t;e++){const t=i[e],s=t.subMenu;t.itemElement=document.getElementById(t.id),t.itemElement?(t.itemElement.addEventListener("mouseenter",(e=>{if(e.preventDefault(),!1===t.enabled)return;const i=t.subMenu;if(!i)return void(a&&(o._hideMenu(a.id),a=null));a&&a.id!==i.id&&(o._hideMenu(a.id),a=null);const s=t.itemElement,r=i.menuElement,n=s.getBoundingClientRect();r.getBoundingClientRect();n.right+200>window.innerWidth?o._showMenu(i.id,n.left-200,n.top-1):o._showMenu(i.id,n.right-5,n.top-1),a=i})),s||(t.itemElement.addEventListener("click",(e=>{e.preventDefault(),o.hide(),o._context&&!1!==t.enabled&&t.doAction&&t.doAction(o._context)})),t.itemElement.addEventListener("mouseenter",(e=>{e.preventDefault(),!1!==t.enabled&&t.doHover&&t.doHover(o._context)})))):console.error("ContextMenu item element not found: "+t.id)}}}_updateItemsTitles(){if(this._context)for(let e=0,t=this._itemList.length;e<t;e++){const t=this._itemList[e],i=t.itemElement;if(!i)continue;const s=t.getShown;if(!s||!s(this._context))continue;const r=t.getTitle(this._context);t.subMenu,i.innerText=r}}_updateItemsEnabledStatus(){if(this._context)for(let e=0,t=this._itemList.length;e<t;e++){const t=this._itemList[e],i=t.itemElement;if(!i)continue;const s=t.getEnabled;if(!s)continue;const r=t.getShown;if(!r)continue;const o=r(this._context);if(t.shown=o,!o){i.style.visibility="hidden",i.style.height="0",i.style.padding="0";continue}i.style.visibility="visible",i.style.height="auto",i.style.padding=null;const a=s(this._context);t.enabled=a,a?i.classList.remove("disabled"):i.classList.add("disabled")}}_showMenu(e,t,i){const s=this._menuMap[e];if(!s)return void console.error("Menu not found: "+e);if(s.shown)return;const r=s.menuElement;r&&(this._showMenuElement(r,t,i),s.shown=!0)}_hideMenu(e){const t=this._menuMap[e];if(!t)return void console.error("Menu not found: "+e);if(!t.shown)return;const i=t.menuElement;i&&(this._hideMenuElement(i),t.shown=!1)}_hideAllMenus(){for(let e=0,t=this._menuList.length;e<t;e++){const t=this._menuList[e];this._hideMenu(t.id)}}_showMenuElement(e,t,i){e.style.display="block";const s=e.offsetHeight,r=e.offsetWidth;i+s>window.innerHeight&&(i=window.innerHeight-s),t+r>window.innerWidth&&(t=window.innerWidth-r),e.style.left=t+"px",e.style.top=i+"px"}_hideMenuElement(e){e.style.display="none"}}class Plugin{constructor(e,t,i){this.id=i&&i.id?i.id:e,this.viewer=t,this._eventSubs={},t.addPlugin(this)}on(e,t){let i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}fire(e,t){const i=this._eventSubs[e];if(i)for(let e=0,s=i.length;e<s;e++)i[e](t)}log(e){console.log(`[xeokit plugin ${this.id}]: ${e}`)}warn(e){console.warn(`[xeokit plugin ${this.id}]: ${e}`)}error(e){console.error(`[xeokit plugin ${this.id}]: ${e}`)}send(e,t){}destroy(){this.viewer.removePlugin(this)}}let doublePrecision=!0,FloatArrayType=doublePrecision?Float64Array:Float32Array;const tempMat1=new FloatArrayType(16),tempMat2=new FloatArrayType(16),tempVec4$8=new FloatArrayType(4),math={setDoublePrecisionEnabled(e){doublePrecision=e,FloatArrayType=doublePrecision?Float64Array:Float32Array},getDoublePrecisionEnabled:()=>doublePrecision,MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId(e,t){const i=t.indexOf("#");return i===e.length&&t.startsWith(e)?t.substring(i+1):t},globalizeObjectId:(e,t)=>e+"#"+t,vec2:e=>new FloatArrayType(e||2),vec3:e=>new FloatArrayType(e||3),vec4:e=>new FloatArrayType(e||4),mat3:e=>new FloatArrayType(e||9),mat3ToMat4:(e,t=new FloatArrayType(16))=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),mat4:e=>new FloatArrayType(e||16),mat4ToMat3(e,t){},doublesToFloats(e,t,i){const s=new FloatArrayType(2);for(let r=0,o=e.length;r<o;r++)math.splitDouble(e[r],s),t[r]=s[0],i[r]=s[1]},splitDouble(e,t){const i=FloatArrayType.from([e])[0],s=e-i;t[0]=i,t[1]=s},createUUID:(()=>{const e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return()=>{const t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return`${e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]}-${e[255&i]}${e[i>>8&255]}-${e[i>>16&15|64]}${e[i>>24&255]}-${e[63&s|128]}${e[s>>8&255]}-${e[s>>16&255]}${e[s>>24&255]}${e[255&r]}${e[r>>8&255]}${e[r>>16&255]}${e[r>>24&255]}`}})(),clamp:(e,t,i)=>Math.max(t,Math.min(i,e)),fmod(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},compareVec3:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2],negateVec3:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t),negateVec4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t),addVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i),addVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i),addVec3:(e,t,i)=>(i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i),addVec3Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i),subVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i),subVec3:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i),subVec2:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i),geometricMeanVec2(...e){const t=new FloatArrayType(e[0]);for(let i=1;i<e.length;i++)t[0]+=e[i][0],t[1]+=e[i][1];return t[0]/=e.length,t[1]/=e.length,t},subVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i),subScalarVec4:(e,t,i)=>(i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i),mulVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i),mulVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i),mulVec3Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i),mulVec2Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i),divVec3:(e,t,i)=>(i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i),divVec4:(e,t,i)=>(i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i),divScalarVec3:(e,t,i)=>(i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i),divVec3Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i),divVec4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i),divScalarVec4:(e,t,i)=>(i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i),dotVec4:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],cross3Vec4(e,t){const i=e[0],s=e[1],r=e[2],o=t[0],a=t[1],n=t[2];return[s*n-r*a,r*o-i*n,i*a-s*o,0]},cross3Vec3(e,t,i){i||(i=e);const s=e[0],r=e[1],o=e[2],a=t[0],n=t[1],h=t[2];return i[0]=r*h-o*n,i[1]=o*a-s*h,i[2]=s*n-r*a,i},sqLenVec4:e=>math.dotVec4(e,e),lenVec4:e=>Math.sqrt(math.sqLenVec4(e)),dotVec3:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],dotVec2:(e,t)=>e[0]*t[0]+e[1]*t[1],sqLenVec3:e=>math.dotVec3(e,e),sqLenVec2:e=>math.dotVec2(e,e),lenVec3:e=>Math.sqrt(math.sqLenVec3(e)),distVec3:(()=>{const e=new FloatArrayType(3);return(t,i)=>math.lenVec3(math.subVec3(t,i,e))})(),lenVec2:e=>Math.sqrt(math.sqLenVec2(e)),distVec2:(()=>{const e=new FloatArrayType(2);return(t,i)=>math.lenVec2(math.subVec2(t,i,e))})(),rcpVec3:(e,t)=>math.divScalarVec3(1,e,t),normalizeVec4(e,t){const i=1/math.lenVec4(e);return math.mulVec4Scalar(e,i,t)},normalizeVec3(e,t){const i=1/math.lenVec3(e);return math.mulVec3Scalar(e,i,t)},normalizeVec2(e,t){const i=1/math.lenVec2(e);return math.mulVec2Scalar(e,i,t)},angleVec3(e,t){let i=math.dotVec3(e,t)/Math.sqrt(math.sqLenVec3(e)*math.sqLenVec3(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:(()=>{const e=new FloatArrayType(3);return(t,i)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=math.lenVec3(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=math.lenVec3(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=math.lenVec3(e),i)})(),vecToArray:(()=>{function e(e){return Math.round(1e5*e)/1e5}return t=>{for(let i=0,s=(t=Array.prototype.slice.call(t)).length;i<s;i++)t[i]=e(t[i]);return t}})(),xyzArrayToObject:e=>({x:e[0],y:e[1],z:e[2]}),xyzObjectToArray:(e,t)=>((t=t||math.vec3())[0]=e.x,t[1]=e.y,t[2]=e.z,t),dupMat4:e=>e.slice(0,16),mat4To3:e=>[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]],m4s:e=>[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],setMat4ToZeroes:()=>math.m4s(0),setMat4ToOnes:()=>math.m4s(1),diagonalMat4v:e=>new FloatArrayType([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]]),diagonalMat4c:(e,t,i,s)=>math.diagonalMat4v([e,t,i,s]),diagonalMat4s:e=>math.diagonalMat4c(e,e,e,e),identityMat4:(e=new FloatArrayType(16))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e),identityMat3:(e=new FloatArrayType(9))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e),isIdentityMat4:e=>1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15],negateMat4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t),addMat4:(e,t,i)=>(i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i[4]=e[4]+t[4],i[5]=e[5]+t[5],i[6]=e[6]+t[6],i[7]=e[7]+t[7],i[8]=e[8]+t[8],i[9]=e[9]+t[9],i[10]=e[10]+t[10],i[11]=e[11]+t[11],i[12]=e[12]+t[12],i[13]=e[13]+t[13],i[14]=e[14]+t[14],i[15]=e[15]+t[15],i),addMat4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i[4]=e[4]+t,i[5]=e[5]+t,i[6]=e[6]+t,i[7]=e[7]+t,i[8]=e[8]+t,i[9]=e[9]+t,i[10]=e[10]+t,i[11]=e[11]+t,i[12]=e[12]+t,i[13]=e[13]+t,i[14]=e[14]+t,i[15]=e[15]+t,i),addScalarMat4:(e,t,i)=>math.addMat4Scalar(t,e,i),subMat4:(e,t,i)=>(i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i[4]=e[4]-t[4],i[5]=e[5]-t[5],i[6]=e[6]-t[6],i[7]=e[7]-t[7],i[8]=e[8]-t[8],i[9]=e[9]-t[9],i[10]=e[10]-t[10],i[11]=e[11]-t[11],i[12]=e[12]-t[12],i[13]=e[13]-t[13],i[14]=e[14]-t[14],i[15]=e[15]-t[15],i),subMat4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i[4]=e[4]-t,i[5]=e[5]-t,i[6]=e[6]-t,i[7]=e[7]-t,i[8]=e[8]-t,i[9]=e[9]-t,i[10]=e[10]-t,i[11]=e[11]-t,i[12]=e[12]-t,i[13]=e[13]-t,i[14]=e[14]-t,i[15]=e[15]-t,i),subScalarMat4:(e,t,i)=>(i||(i=t),i[0]=e-t[0],i[1]=e-t[1],i[2]=e-t[2],i[3]=e-t[3],i[4]=e-t[4],i[5]=e-t[5],i[6]=e-t[6],i[7]=e-t[7],i[8]=e-t[8],i[9]=e-t[9],i[10]=e-t[10],i[11]=e-t[11],i[12]=e-t[12],i[13]=e-t[13],i[14]=e-t[14],i[15]=e-t[15],i),mulMat4(e,t,i){i||(i=e);const s=e[0],r=e[1],o=e[2],a=e[3],n=e[4],h=e[5],l=e[6],c=e[7],u=e[8],p=e[9],d=e[10],m=e[11],f=e[12],g=e[13],_=e[14],y=e[15],T=t[0],v=t[1],I=t[2],E=t[3],P=t[4],b=t[5],D=t[6],w=t[7],C=t[8],R=t[9],F=t[10],S=t[11],x=t[12],M=t[13],A=t[14],L=t[15];return i[0]=T*s+v*n+I*u+E*f,i[1]=T*r+v*h+I*p+E*g,i[2]=T*o+v*l+I*d+E*_,i[3]=T*a+v*c+I*m+E*y,i[4]=P*s+b*n+D*u+w*f,i[5]=P*r+b*h+D*p+w*g,i[6]=P*o+b*l+D*d+w*_,i[7]=P*a+b*c+D*m+w*y,i[8]=C*s+R*n+F*u+S*f,i[9]=C*r+R*h+F*p+S*g,i[10]=C*o+R*l+F*d+S*_,i[11]=C*a+R*c+F*m+S*y,i[12]=x*s+M*n+A*u+L*f,i[13]=x*r+M*h+A*p+L*g,i[14]=x*o+M*l+A*d+L*_,i[15]=x*a+M*c+A*m+L*y,i},mulMat3(e,t,i){i||(i=new FloatArrayType(9));const s=e[0],r=e[3],o=e[6],a=e[1],n=e[4],h=e[7],l=e[2],c=e[5],u=e[8],p=t[0],d=t[3],m=t[6],f=t[1],g=t[4],_=t[7],y=t[2],T=t[5],v=t[8];return i[0]=s*p+r*f+o*y,i[3]=s*d+r*g+o*T,i[6]=s*m+r*_+o*v,i[1]=a*p+n*f+h*y,i[4]=a*d+n*g+h*T,i[7]=a*m+n*_+h*v,i[2]=l*p+c*f+u*y,i[5]=l*d+c*g+u*T,i[8]=l*m+c*_+u*v,i},mulMat4Scalar:(e,t,i)=>(i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i),mulMat4v4(e,t,i=math.vec4()){const s=t[0],r=t[1],o=t[2],a=t[3];return i[0]=e[0]*s+e[4]*r+e[8]*o+e[12]*a,i[1]=e[1]*s+e[5]*r+e[9]*o+e[13]*a,i[2]=e[2]*s+e[6]*r+e[10]*o+e[14]*a,i[3]=e[3]*s+e[7]*r+e[11]*o+e[15]*a,i},transposeMat4(e,t){const i=e[4],s=e[14],r=e[8],o=e[13],a=e[12],n=e[9];if(!t||e===t){const t=e[1],h=e[2],l=e[3],c=e[6],u=e[7],p=e[11];return e[1]=i,e[2]=r,e[3]=a,e[4]=t,e[6]=n,e[7]=o,e[8]=h,e[9]=c,e[11]=s,e[12]=l,e[13]=u,e[14]=p,e}return t[0]=e[0],t[1]=i,t[2]=r,t[3]=a,t[4]=e[1],t[5]=e[5],t[6]=n,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=s,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3(e,t){if(t===e){const i=e[1],s=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4(e){const t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],n=e[6],h=e[7],l=e[8],c=e[9],u=e[10],p=e[11],d=e[12],m=e[13],f=e[14],g=e[15];return d*c*n*r-l*m*n*r-d*a*u*r+o*m*u*r+l*a*f*r-o*c*f*r-d*c*s*h+l*m*s*h+d*i*u*h-t*m*u*h-l*i*f*h+t*c*f*h+d*a*s*p-o*m*s*p-d*i*n*p+t*m*n*p+o*i*f*p-t*a*f*p-l*a*s*g+o*c*s*g+l*i*n*g-t*c*n*g-o*i*u*g+t*a*u*g},inverseMat4(e,t){t||(t=e);const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],n=e[5],h=e[6],l=e[7],c=e[8],u=e[9],p=e[10],d=e[11],m=e[12],f=e[13],g=e[14],_=e[15],y=i*n-s*a,T=i*h-r*a,v=i*l-o*a,I=s*h-r*n,E=s*l-o*n,P=r*l-o*h,b=c*f-u*m,D=c*g-p*m,w=c*_-d*m,C=u*g-p*f,R=u*_-d*f,F=p*_-d*g,S=1/(y*F-T*R+v*C+I*w-E*D+P*b);return t[0]=(n*F-h*R+l*C)*S,t[1]=(-s*F+r*R-o*C)*S,t[2]=(f*P-g*E+_*I)*S,t[3]=(-u*P+p*E-d*I)*S,t[4]=(-a*F+h*w-l*D)*S,t[5]=(i*F-r*w+o*D)*S,t[6]=(-m*P+g*v-_*T)*S,t[7]=(c*P-p*v+d*T)*S,t[8]=(a*R-n*w+l*b)*S,t[9]=(-i*R+s*w-o*b)*S,t[10]=(m*E-f*v+_*y)*S,t[11]=(-c*E+u*v-d*y)*S,t[12]=(-a*C+n*D-h*b)*S,t[13]=(i*C-s*D+r*b)*S,t[14]=(-m*I+f*T-g*y)*S,t[15]=(c*I-u*T+p*y)*S,t},traceMat4:e=>e[0]+e[5]+e[10]+e[15],translationMat4v(e,t){const i=t||math.identityMat4();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i},translationMat3v(e,t){const i=t||math.identityMat3();return i[6]=e[0],i[7]=e[1],i},translationMat4c:(()=>{const e=new FloatArrayType(3);return(t,i,s,r)=>(e[0]=t,e[1]=i,e[2]=s,math.translationMat4v(e,r))})(),translationMat4s:(e,t)=>math.translationMat4c(e,e,e,t),translateMat4v:(e,t)=>math.translateMat4c(e[0],e[1],e[2],t),translateMat4c(e,t,i,s){const r=s[3];s[0]+=r*e,s[1]+=r*t,s[2]+=r*i;const o=s[7];s[4]+=o*e,s[5]+=o*t,s[6]+=o*i;const a=s[11];s[8]+=a*e,s[9]+=a*t,s[10]+=a*i;const n=s[15];return s[12]+=n*e,s[13]+=n*t,s[14]+=n*i,s},setMat4Translation:(e,t,i)=>(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i),rotationMat4v(e,t,i){const s=math.normalizeVec4([t[0],t[1],t[2],0],[]),r=Math.sin(e),o=Math.cos(e),a=1-o,n=s[0],h=s[1],l=s[2];let c,u,p,d,m,f;return c=n*h,u=h*l,p=l*n,d=n*r,m=h*r,f=l*r,(i=i||math.mat4())[0]=a*n*n+o,i[1]=a*c+f,i[2]=a*p-m,i[3]=0,i[4]=a*c-f,i[5]=a*h*h+o,i[6]=a*u+d,i[7]=0,i[8]=a*p+m,i[9]=a*u-d,i[10]=a*l*l+o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},rotationMat4c:(e,t,i,s,r)=>math.rotationMat4v(e,[t,i,s],r),scalingMat4v:(e,t=math.identityMat4())=>(t[0]=e[0],t[5]=e[1],t[10]=e[2],t),scalingMat3v:(e,t=math.identityMat3())=>(t[0]=e[0],t[4]=e[1],t),scalingMat4c:(()=>{const e=new FloatArrayType(3);return(t,i,s,r)=>(e[0]=t,e[1]=i,e[2]=s,math.scalingMat4v(e,r))})(),scaleMat4c:(e,t,i,s)=>(s[0]*=e,s[4]*=t,s[8]*=i,s[1]*=e,s[5]*=t,s[9]*=i,s[2]*=e,s[6]*=t,s[10]*=i,s[3]*=e,s[7]*=t,s[11]*=i,s),scaleMat4v(e,t){const i=e[0],s=e[1],r=e[2];return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,t},scalingMat4s:e=>math.scalingMat4c(e,e,e),rotationTranslationMat4(e,t,i=math.mat4()){const s=e[0],r=e[1],o=e[2],a=e[3],n=s+s,h=r+r,l=o+o,c=s*n,u=s*h,p=s*l,d=r*h,m=r*l,f=o*l,g=a*n,_=a*h,y=a*l;return i[0]=1-(d+f),i[1]=u+y,i[2]=p-_,i[3]=0,i[4]=u-y,i[5]=1-(c+f),i[6]=m+g,i[7]=0,i[8]=p+_,i[9]=m-g,i[10]=1-(c+d),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},mat4ToEuler(e,t,i=math.vec4()){const s=math.clamp,r=e[0],o=e[4],a=e[8],n=e[1],h=e[5],l=e[9],c=e[2],u=e[6],p=e[10];return"XYZ"===t?(i[1]=Math.asin(s(a,-1,1)),Math.abs(a)<.99999?(i[0]=Math.atan2(-l,p),i[2]=Math.atan2(-o,r)):(i[0]=Math.atan2(u,h),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-s(l,-1,1)),Math.abs(l)<.99999?(i[1]=Math.atan2(a,p),i[2]=Math.atan2(n,h)):(i[1]=Math.atan2(-c,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(s(u,-1,1)),Math.abs(u)<.99999?(i[1]=Math.atan2(-c,p),i[2]=Math.atan2(-o,h)):(i[1]=0,i[2]=Math.atan2(n,r))):"ZYX"===t?(i[1]=Math.asin(-s(c,-1,1)),Math.abs(c)<.99999?(i[0]=Math.atan2(u,p),i[2]=Math.atan2(n,r)):(i[0]=0,i[2]=Math.atan2(-o,h))):"YZX"===t?(i[2]=Math.asin(s(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(-l,h),i[1]=Math.atan2(-c,r)):(i[0]=0,i[1]=Math.atan2(a,p))):"XZY"===t&&(i[2]=Math.asin(-s(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(u,h),i[1]=Math.atan2(a,r)):(i[0]=Math.atan2(-l,p),i[1]=0)),i},composeMat4:(e,t,i,s=math.mat4())=>(math.quaternionToRotationMat4(t,s),math.scaleMat4v(i,s),math.translateMat4v(e,s),s),decomposeMat4:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(16);return function(i,s,r,o){e[0]=i[0],e[1]=i[1],e[2]=i[2];let a=math.lenVec3(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];const n=math.lenVec3(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];const h=math.lenVec3(e);math.determinantMat4(i)<0&&(a=-a),s[0]=i[12],s[1]=i[13],s[2]=i[14],t.set(i);const l=1/a,c=1/n,u=1/h;return t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=c,t[5]*=c,t[6]*=c,t[8]*=u,t[9]*=u,t[10]*=u,math.mat4ToQuaternion(t,r),o[0]=a,o[1]=n,o[2]=h,this}})(),getColMat4(e,t){const i=4*t;return[e[i],e[i+1],e[i+2],e[i+3]]},setRowMat4(e,t,i){e[t]=i[0],e[t+4]=i[1],e[t+8]=i[2],e[t+12]=i[3]},lookAtMat4v(e,t,i,s){s||(s=math.mat4());const r=e[0],o=e[1],a=e[2],n=i[0],h=i[1],l=i[2],c=t[0],u=t[1],p=t[2];if(r===c&&o===u&&a===p)return math.identityMat4();let d,m,f,g,_,y,T,v,I,E;return d=r-c,m=o-u,f=a-p,E=1/Math.sqrt(d*d+m*m+f*f),d*=E,m*=E,f*=E,g=h*f-l*m,_=l*d-n*f,y=n*m-h*d,E=Math.sqrt(g*g+_*_+y*y),E?(E=1/E,g*=E,_*=E,y*=E):(g=0,_=0,y=0),T=m*y-f*_,v=f*g-d*y,I=d*_-m*g,E=Math.sqrt(T*T+v*v+I*I),E?(E=1/E,T*=E,v*=E,I*=E):(T=0,v=0,I=0),s[0]=g,s[1]=T,s[2]=d,s[3]=0,s[4]=_,s[5]=v,s[6]=m,s[7]=0,s[8]=y,s[9]=I,s[10]=f,s[11]=0,s[12]=-(g*r+_*o+y*a),s[13]=-(T*r+v*o+I*a),s[14]=-(d*r+m*o+f*a),s[15]=1,s},lookAtMat4c:(e,t,i,s,r,o,a,n,h)=>math.lookAtMat4v([e,t,i],[s,r,o],[a,n,h],[]),orthoMat4c(e,t,i,s,r,o,a){a||(a=math.mat4());const n=t-e,h=s-i,l=o-r;return a[0]=2/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/h,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/l,a[11]=0,a[12]=-(e+t)/n,a[13]=-(s+i)/h,a[14]=-(o+r)/l,a[15]=1,a},frustumMat4v(e,t,i){i||(i=math.mat4());const s=[e[0],e[1],e[2],0],r=[t[0],t[1],t[2],0];math.addVec4(r,s,tempMat1),math.subVec4(r,s,tempMat2);const o=2*s[2],a=tempMat2[0],n=tempMat2[1],h=tempMat2[2];return i[0]=o/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o/n,i[6]=0,i[7]=0,i[8]=tempMat1[0]/a,i[9]=tempMat1[1]/n,i[10]=-tempMat1[2]/h,i[11]=-1,i[12]=0,i[13]=0,i[14]=-o*r[2]/h,i[15]=0,i},frustumMat4(e,t,i,s,r,o,a){a||(a=math.mat4());const n=t-e,h=s-i,l=o-r;return a[0]=2*r/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/h,a[6]=0,a[7]=0,a[8]=(t+e)/n,a[9]=(s+i)/h,a[10]=-(o+r)/l,a[11]=-1,a[12]=0,a[13]=0,a[14]=-o*r*2/l,a[15]=0,a},perspectiveMat4(e,t,i,s,r){const o=[],a=[];return o[2]=i,a[2]=s,a[1]=o[2]*Math.tan(e/2),o[1]=-a[1],a[0]=a[1]*t,o[0]=-a[0],math.frustumMat4v(o,a,r)},compareMat4:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15],transformPoint3(e,t,i=math.vec3()){const s=t[0],r=t[1],o=t[2];return i[0]=e[0]*s+e[4]*r+e[8]*o+e[12],i[1]=e[1]*s+e[5]*r+e[9]*o+e[13],i[2]=e[2]*s+e[6]*r+e[10]*o+e[14],i},transformPoint4:(e,t,i=math.vec4())=>(i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i),transformPoints3(e,t,i){const s=i||[],r=t.length;let o,a,n,h;const l=e[0],c=e[1],u=e[2],p=e[3],d=e[4],m=e[5],f=e[6],g=e[7],_=e[8],y=e[9],T=e[10],v=e[11],I=e[12],E=e[13],P=e[14],b=e[15];let D;for(let e=0;e<r;++e)h=t[e],o=h[0],a=h[1],n=h[2],D=s[e]||(s[e]=[0,0,0]),D[0]=l*o+d*a+_*n+I,D[1]=c*o+m*a+y*n+E,D[2]=u*o+f*a+T*n+P,D[3]=p*o+g*a+v*n+b;return s.length=r,s},transformPositions3(e,t,i=t){let s;const r=t.length;let o,a,n;const h=e[0],l=e[1],c=e[2];e[3];const u=e[4],p=e[5],d=e[6];e[7];const m=e[8],f=e[9],g=e[10];e[11];const _=e[12],y=e[13],T=e[14];for(e[15],s=0;s<r;s+=3)o=t[s+0],a=t[s+1],n=t[s+2],i[s+0]=h*o+u*a+m*n+_,i[s+1]=l*o+p*a+f*n+y,i[s+2]=c*o+d*a+g*n+T;return i},transformPositions4(e,t,i=t){let s;const r=t.length;let o,a,n;const h=e[0],l=e[1],c=e[2],u=e[3],p=e[4],d=e[5],m=e[6],f=e[7],g=e[8],_=e[9],y=e[10],T=e[11],v=e[12],I=e[13],E=e[14],P=e[15];for(s=0;s<r;s+=4)o=t[s+0],a=t[s+1],n=t[s+2],i[s+0]=h*o+p*a+g*n+v,i[s+1]=l*o+d*a+_*n+I,i[s+2]=c*o+m*a+y*n+E,i[s+3]=u*o+f*a+T*n+P;return i},transformVec3(e,t,i){const s=t[0],r=t[1],o=t[2];return(i=i||this.vec3())[0]=e[0]*s+e[4]*r+e[8]*o,i[1]=e[1]*s+e[5]*r+e[9]*o,i[2]=e[2]*s+e[6]*r+e[10]*o,i},transformVec4(e,t,i){const s=t[0],r=t[1],o=t[2],a=t[3];return(i=i||math.vec4())[0]=e[0]*s+e[4]*r+e[8]*o+e[12]*a,i[1]=e[1]*s+e[5]*r+e[9]*o+e[13]*a,i[2]=e[2]*s+e[6]*r+e[10]*o+e[14]*a,i[3]=e[3]*s+e[7]*r+e[11]*o+e[15]*a,i},rotateVec2(e,t,i,s=e){const r=Math.cos(i),o=Math.sin(i),a=e[0]-t[0],n=e[1]-t[1];return s[0]=a*r-n*o+t[0],s[1]=a*o+n*r+t[1],e},rotateVec3X(e,t,i,s){const r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),s[0]=o[0]+t[0],s[1]=o[1]+t[1],s[2]=o[2]+t[2],s},rotateVec3Y(e,t,i,s){const r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),s[0]=o[0]+t[0],s[1]=o[1]+t[1],s[2]=o[2]+t[2],s},rotateVec3Z(e,t,i,s){const r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],s[0]=o[0]+t[0],s[1]=o[1]+t[1],s[2]=o[2]+t[2],s},projectVec4(e,t){const i=1/e[3];return(t=t||math.vec2())[0]=e[0]*i,t[1]=e[1]*i,t},unprojectVec3:(()=>{const e=new FloatArrayType(16),t=new FloatArrayType(16),i=new FloatArrayType(16);return function(s,r,o,a){return this.transformVec3(this.mulMat4(this.inverseMat4(r,e),this.inverseMat4(o,t),i),s,a)}})(),lerpVec3(e,t,i,s,r,o){const a=o||math.vec3(),n=(e-t)/(i-t);return a[0]=s[0]+n*(r[0]-s[0]),a[1]=s[1]+n*(r[1]-s[1]),a[2]=s[2]+n*(r[2]-s[2]),a},lerpMat4(e,t,i,s,r,o){const a=o||math.mat4(),n=(e-t)/(i-t);return a[0]=s[0]+n*(r[0]-s[0]),a[1]=s[1]+n*(r[1]-s[1]),a[2]=s[2]+n*(r[2]-s[2]),a[3]=s[3]+n*(r[3]-s[3]),a[4]=s[4]+n*(r[4]-s[4]),a[5]=s[5]+n*(r[5]-s[5]),a[6]=s[6]+n*(r[6]-s[6]),a[7]=s[7]+n*(r[7]-s[7]),a[8]=s[8]+n*(r[8]-s[8]),a[9]=s[9]+n*(r[9]-s[9]),a[10]=s[10]+n*(r[10]-s[10]),a[11]=s[11]+n*(r[11]-s[11]),a[12]=s[12]+n*(r[12]-s[12]),a[13]=s[13]+n*(r[13]-s[13]),a[14]=s[14]+n*(r[14]-s[14]),a[15]=s[15]+n*(r[15]-s[15]),a},flatten(e){const t=[];let i,s,r,o,a;for(i=0,s=e.length;i<s;i++)for(a=e[i],r=0,o=a.length;r<o;r++)t.push(a[r]);return t},identityQuaternion:(e=math.vec4())=>(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e),eulerToQuaternion(e,t,i=math.vec4()){const s=e[0]*math.DEGTORAD/2,r=e[1]*math.DEGTORAD/2,o=e[2]*math.DEGTORAD/2,a=Math.cos(s),n=Math.cos(r),h=Math.cos(o),l=Math.sin(s),c=Math.sin(r),u=Math.sin(o);return"XYZ"===t?(i[0]=l*n*h+a*c*u,i[1]=a*c*h-l*n*u,i[2]=a*n*u+l*c*h,i[3]=a*n*h-l*c*u):"YXZ"===t?(i[0]=l*n*h+a*c*u,i[1]=a*c*h-l*n*u,i[2]=a*n*u-l*c*h,i[3]=a*n*h+l*c*u):"ZXY"===t?(i[0]=l*n*h-a*c*u,i[1]=a*c*h+l*n*u,i[2]=a*n*u+l*c*h,i[3]=a*n*h-l*c*u):"ZYX"===t?(i[0]=l*n*h-a*c*u,i[1]=a*c*h+l*n*u,i[2]=a*n*u-l*c*h,i[3]=a*n*h+l*c*u):"YZX"===t?(i[0]=l*n*h+a*c*u,i[1]=a*c*h+l*n*u,i[2]=a*n*u-l*c*h,i[3]=a*n*h-l*c*u):"XZY"===t&&(i[0]=l*n*h-a*c*u,i[1]=a*c*h-l*n*u,i[2]=a*n*u+l*c*h,i[3]=a*n*h+l*c*u),i},mat4ToQuaternion(e,t=math.vec4()){const i=e[0],s=e[4],r=e[8],o=e[1],a=e[5],n=e[9],h=e[2],l=e[6],c=e[10];let u;const p=i+a+c;return p>0?(u=.5/Math.sqrt(p+1),t[3]=.25/u,t[0]=(l-n)*u,t[1]=(r-h)*u,t[2]=(o-s)*u):i>a&&i>c?(u=2*Math.sqrt(1+i-a-c),t[3]=(l-n)/u,t[0]=.25*u,t[1]=(s+o)/u,t[2]=(r+h)/u):a>c?(u=2*Math.sqrt(1+a-i-c),t[3]=(r-h)/u,t[0]=(s+o)/u,t[1]=.25*u,t[2]=(n+l)/u):(u=2*Math.sqrt(1+c-i-a),t[3]=(o-s)/u,t[0]=(r+h)/u,t[1]=(n+l)/u,t[2]=.25*u),t},vec3PairToQuaternion(e,t,i=math.vec4()){const s=Math.sqrt(math.dotVec3(e,e)*math.dotVec3(t,t));let r=s+math.dotVec3(e,t);return r<1e-8*s?(r=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):math.cross3Vec3(e,t,i),i[3]=r,math.normalizeQuaternion(i)},angleAxisToQuaternion(e,t=math.vec4()){const i=e[3]/2,s=Math.sin(i);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i),t},quaternionToEuler:(()=>{const e=new FloatArrayType(16);return(t,i,s)=>(s=s||math.vec3(),math.quaternionToRotationMat4(t,e),math.mat4ToEuler(e,i,s),s)})(),mulQuaternions(e,t,i=math.vec4()){const s=e[0],r=e[1],o=e[2],a=e[3],n=t[0],h=t[1],l=t[2],c=t[3];return i[0]=a*n+s*c+r*l-o*h,i[1]=a*h+r*c+o*n-s*l,i[2]=a*l+o*c+s*h-r*n,i[3]=a*c-s*n-r*h-o*l,i},vec3ApplyQuaternion(e,t,i=math.vec3()){const s=t[0],r=t[1],o=t[2],a=e[0],n=e[1],h=e[2],l=e[3],c=l*s+n*o-h*r,u=l*r+h*s-a*o,p=l*o+a*r-n*s,d=-a*s-n*r-h*o;return i[0]=c*l+d*-a+u*-h-p*-n,i[1]=u*l+d*-n+p*-a-c*-h,i[2]=p*l+d*-h+c*-n-u*-a,i},quaternionToMat4(e,t){t=math.identityMat4(t);const i=e[0],s=e[1],r=e[2],o=e[3],a=2*i,n=2*s,h=2*r,l=a*o,c=n*o,u=h*o,p=a*i,d=n*i,m=h*i,f=n*s,g=h*s,_=h*r;return t[0]=1-(f+_),t[1]=d+u,t[2]=m-c,t[4]=d-u,t[5]=1-(p+_),t[6]=g+l,t[8]=m+c,t[9]=g-l,t[10]=1-(p+f),t},quaternionToRotationMat4(e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=i+i,n=s+s,h=r+r,l=i*a,c=i*n,u=i*h,p=s*n,d=s*h,m=r*h,f=o*a,g=o*n,_=o*h;return t[0]=1-(p+m),t[4]=c-_,t[8]=u+g,t[1]=c+_,t[5]=1-(l+m),t[9]=d-f,t[2]=u-g,t[6]=d+f,t[10]=1-(l+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion(e,t=e){const i=math.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t},conjugateQuaternion:(e,t=e)=>(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t),inverseQuaternion:(e,t)=>math.normalizeQuaternion(math.conjugateQuaternion(e,t)),quaternionToAngleAxis(e,t=math.vec4()){const i=(e=math.normalizeQuaternion(e,tempVec4$8))[3],s=2*Math.acos(i),r=Math.sqrt(1-i*i);return r<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r),t[3]=s,t},AABB3:e=>new FloatArrayType(e||6),AABB2:e=>new FloatArrayType(e||4),OBB3:e=>new FloatArrayType(e||32),OBB2:e=>new FloatArrayType(e||16),Sphere3:(e,t,i,s)=>new FloatArrayType([e,t,i,s]),transformOBB3(e,t,i=t){let s;const r=t.length;let o,a,n;const h=e[0],l=e[1],c=e[2],u=e[3],p=e[4],d=e[5],m=e[6],f=e[7],g=e[8],_=e[9],y=e[10],T=e[11],v=e[12],I=e[13],E=e[14],P=e[15];for(s=0;s<r;s+=4)o=t[s+0],a=t[s+1],n=t[s+2],i[s+0]=h*o+p*a+g*n+v,i[s+1]=l*o+d*a+_*n+I,i[s+2]=c*o+m*a+y*n+E,i[s+3]=u*o+f*a+T*n+P;return i},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3);return s=>(e[0]=s[0],e[1]=s[1],e[2]=s[2],t[0]=s[3],t[1]=s[4],t[2]=s[5],math.subVec3(t,e,i),Math.abs(math.lenVec3(i)))})(),getAABB3DiagPoint:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3);return(s,r)=>{e[0]=s[0],e[1]=s[1],e[2]=s[2],t[0]=s[3],t[1]=s[4],t[2]=s[5];const o=math.subVec3(t,e,i),a=r[0]-s[0],n=s[3]-r[0],h=r[1]-s[1],l=s[4]-r[1],c=r[2]-s[2],u=s[5]-r[2];return o[0]+=a>n?a:n,o[1]+=h>l?h:l,o[2]+=c>u?c:u,Math.abs(math.lenVec3(o))}})(),getAABB3Area:e=>(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2]),getAABB3Center(e,t){const i=t||math.vec3();return i[0]=(e[0]+e[3])/2,i[1]=(e[1]+e[4])/2,i[2]=(e[2]+e[5])/2,i},getAABB2Center(e,t){const i=t||math.vec2();return i[0]=(e[2]+e[0])/2,i[1]=(e[3]+e[1])/2,i},collapseAABB3:(e=math.AABB3())=>(e[0]=math.MAX_DOUBLE,e[1]=math.MAX_DOUBLE,e[2]=math.MAX_DOUBLE,e[3]=math.MIN_DOUBLE,e[4]=math.MIN_DOUBLE,e[5]=math.MIN_DOUBLE,e),AABB3ToOBB3:(e,t=math.OBB3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t),positions3ToAABB3:(()=>{const e=new FloatArrayType(3);return(t,i,s)=>{i=i||math.AABB3();let r,o,a,n=math.MAX_DOUBLE,h=math.MAX_DOUBLE,l=math.MAX_DOUBLE,c=math.MIN_DOUBLE,u=math.MIN_DOUBLE,p=math.MIN_DOUBLE;for(let i=0,d=t.length;i<d;i+=3)s?(e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2],math.decompressPosition(e,s,e),r=e[0],o=e[1],a=e[2]):(r=t[i+0],o=t[i+1],a=t[i+2]),r<n&&(n=r),o<h&&(h=o),a<l&&(l=a),r>c&&(c=r),o>u&&(u=o),a>p&&(p=a);return i[0]=n,i[1]=h,i[2]=l,i[3]=c,i[4]=u,i[5]=p,i}})(),OBB3ToAABB3(e,t=math.AABB3()){let i,s,r,o=math.MAX_DOUBLE,a=math.MAX_DOUBLE,n=math.MAX_DOUBLE,h=math.MIN_DOUBLE,l=math.MIN_DOUBLE,c=math.MIN_DOUBLE;for(let t=0,u=e.length;t<u;t+=4)i=e[t+0],s=e[t+1],r=e[t+2],i<o&&(o=i),s<a&&(a=s),r<n&&(n=r),i>h&&(h=i),s>l&&(l=s),r>c&&(c=r);return t[0]=o,t[1]=a,t[2]=n,t[3]=h,t[4]=l,t[5]=c,t},points3ToAABB3(e,t=math.AABB3()){let i,s,r,o=math.MAX_DOUBLE,a=math.MAX_DOUBLE,n=math.MAX_DOUBLE,h=math.MIN_DOUBLE,l=math.MIN_DOUBLE,c=math.MIN_DOUBLE;for(let t=0,u=e.length;t<u;t++)i=e[t][0],s=e[t][1],r=e[t][2],i<o&&(o=i),s<a&&(a=s),r<n&&(n=r),i>h&&(h=i),s>l&&(l=s),r>c&&(c=r);return t[0]=o,t[1]=a,t[2]=n,t[3]=h,t[4]=l,t[5]=c,t},points3ToSphere3:(()=>{const e=new FloatArrayType(3);return(t,i)=>{i=i||math.vec4();let s,r=0,o=0,a=0;const n=t.length;for(s=0;s<n;s++)r+=t[s][0],o+=t[s][1],a+=t[s][2];i[0]=r/n,i[1]=o/n,i[2]=a/n;let h,l=0;for(s=0;s<n;s++)h=Math.abs(math.lenVec3(math.subVec3(t[s],i,e))),h>l&&(l=h);return i[3]=l,i}})(),positions3ToSphere3:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3);return(i,s)=>{s=s||math.vec4();let r,o=0,a=0,n=0;const h=i.length;let l=0;for(r=0;r<h;r+=3)o+=i[r],a+=i[r+1],n+=i[r+2];const c=h/3;let u;for(s[0]=o/c,s[1]=a/c,s[2]=n/c,r=0;r<h;r+=3)e[0]=i[r],e[1]=i[r+1],e[2]=i[r+2],u=Math.abs(math.lenVec3(math.subVec3(e,s,t))),u>l&&(l=u);return s[3]=l,s}})(),OBB3ToSphere3:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3);return(i,s)=>{s=s||math.vec4();let r,o=0,a=0,n=0;const h=i.length,l=h/4;for(r=0;r<h;r+=4)o+=i[r+0],a+=i[r+1],n+=i[r+2];s[0]=o/l,s[1]=a/l,s[2]=n/l;let c,u=0;for(r=0;r<h;r+=4)e[0]=i[r+0],e[1]=i[r+1],e[2]=i[r+2],c=Math.abs(math.lenVec3(math.subVec3(e,s,t))),c>u&&(u=c);return s[3]=u,s}})(),getSphere3Center:(e,t=math.vec3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t),getPositionsCenter(e,t=math.vec3()){let i=0,s=0,r=0;for(var o=0,a=e.length;o<a;o+=3)i+=e[o+0],s+=e[o+1],r+=e[o+2];const n=e.length/3;return t[0]=i/n,t[1]=s/n,t[2]=r/n,t},expandAABB3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e),expandAABB3Point3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e),expandAABB3Points3(e,t){for(var i,s,r,o=0,a=t.length;o<a;o+=3)i=t[o],s=t[o+1],r=t[o+2],e[0]>i&&(e[0]=i),e[1]>s&&(e[1]=s),e[2]>r&&(e[2]=r),e[3]<i&&(e[3]=i),e[4]<s&&(e[4]=s),e[5]<r&&(e[5]=r);return e},collapseAABB2:(e=math.AABB2())=>(e[0]=math.MAX_DOUBLE,e[1]=math.MAX_DOUBLE,e[2]=math.MIN_DOUBLE,e[3]=math.MIN_DOUBLE,e),point3AABB3Intersect:(e,t)=>e[0]>t[0]||e[3]<t[0]||e[1]>t[1]||e[4]<t[1]||e[2]>t[2]||e[5]<t[2],planeAABB3Intersect(e,t,i){let s,r;e[0]>0?(s=e[0]*i[0],r=e[0]*i[3]):(s=e[0]*i[3],r=e[0]*i[0]),e[1]>0?(s+=e[1]*i[1],r+=e[1]*i[4]):(s+=e[1]*i[4],r+=e[1]*i[1]),e[2]>0?(s+=e[2]*i[2],r+=e[2]*i[5]):(s+=e[2]*i[5],r+=e[2]*i[2]);if(s<=-t&&r<=-t)return-1;return s>=-t&&r>=-t?1:0},OBB3ToAABB2(e,t=math.AABB2()){let i,s,r,o,a=math.MAX_DOUBLE,n=math.MAX_DOUBLE,h=math.MIN_DOUBLE,l=math.MIN_DOUBLE;for(let t=0,c=e.length;t<c;t+=4)i=e[t+0],s=e[t+1],r=e[t+3]||1,o=1/r,i*=o,s*=o,i<a&&(a=i),s<n&&(n=s),i>h&&(h=i),s>l&&(l=s);return t[0]=a,t[1]=n,t[2]=h,t[3]=l,t},expandAABB2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e),expandAABB2Point2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1]),e),AABB2ToCanvas(e,t,i,s=e){const r=.5*(e[0]+1),o=.5*(e[1]+1),a=.5*(e[2]+1),n=.5*(e[3]+1);return s[0]=Math.floor(r*t),s[1]=i-Math.floor(n*i),s[2]=Math.floor(a*t),s[3]=i-Math.floor(o*i),s},tangentQuadraticBezier:(e,t,i,s)=>2*(1-e)*(i-t)+2*e*(s-i),tangentQuadraticBezier3:(e,t,i,s,r)=>-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*s*(1-e)-3*e*e*s+3*e*e*r,tangentSpline:e=>6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e),catmullRomInterpolate(e,t,i,s,r){const o=.5*(i-e),a=.5*(s-t),n=r*r;return(2*t-2*i+o+a)*(r*n)+(-3*t+3*i-2*o-a)*n+o*r+t},b2p0(e,t){const i=1-e;return i*i*t},b2p1:(e,t)=>2*(1-e)*e*t,b2p2:(e,t)=>e*e*t,b2(e,t,i,s){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,s)},b3p0(e,t){const i=1-e;return i*i*i*t},b3p1(e,t){const i=1-e;return 3*i*i*e*t},b3p2:(e,t)=>3*(1-e)*e*e*t,b3p3:(e,t)=>e*e*e*t,b3(e,t,i,s,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,s)+this.b3p3(e,r)},triangleNormal(e,t,i,s=math.vec3()){const r=t[0]-e[0],o=t[1]-e[1],a=t[2]-e[2],n=i[0]-e[0],h=i[1]-e[1],l=i[2]-e[2],c=o*l-a*h,u=a*n-r*l,p=r*h-o*n,d=Math.sqrt(c*c+u*u+p*p);return 0===d?(s[0]=0,s[1]=0,s[2]=0):(s[0]=c/d,s[1]=u/d,s[2]=p/d),s},rayTriangleIntersect:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3),s=new FloatArrayType(3),r=new FloatArrayType(3);return(o,a,n,h,l,c)=>{c=c||math.vec3();const u=math.subVec3(h,n,e),p=math.subVec3(l,n,t),d=math.cross3Vec3(a,p,i),m=math.dotVec3(u,d);if(m<1e-6)return null;const f=math.subVec3(o,n,s),g=math.dotVec3(f,d);if(g<0||g>m)return null;const _=math.cross3Vec3(f,u,r),y=math.dotVec3(a,_);if(y<0||g+y>m)return null;const T=math.dotVec3(p,_)/m;return c[0]=o[0]+T*a[0],c[1]=o[1]+T*a[1],c[2]=o[2]+T*a[2],c}})(),rayPlaneIntersect:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3),s=new FloatArrayType(3);return(r,o,a,n,h,l)=>{l=l||math.vec3(),o=math.normalizeVec3(o,e);const c=math.subVec3(n,a,t),u=math.subVec3(h,a,i),p=math.cross3Vec3(c,u,s);math.normalizeVec3(p,p);const d=-math.dotVec3(a,p),m=-(math.dotVec3(r,p)+d)/math.dotVec3(o,p);return l[0]=r[0]+m*o[0],l[1]=r[1]+m*o[1],l[2]=r[2]+m*o[2],l}})(),cartesianToBarycentric:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3);return(s,r,o,a,n)=>{const h=math.subVec3(a,r,e),l=math.subVec3(o,r,t),c=math.subVec3(s,r,i),u=math.dotVec3(h,h),p=math.dotVec3(h,l),d=math.dotVec3(h,c),m=math.dotVec3(l,l),f=math.dotVec3(l,c),g=u*m-p*p;if(0===g)return null;const _=1/g,y=(m*d-p*f)*_,T=(u*f-p*d)*_;return n[0]=1-y-T,n[1]=T,n[2]=y,n}})(),barycentricInsideTriangle(e){const t=e[1],i=e[2];return i>=0&&t>=0&&i+t<1},barycentricToCartesian(e,t,i,s,r=math.vec3()){const o=e[0],a=e[1],n=e[2];return r[0]=t[0]*o+i[0]*a+s[0]*n,r[1]=t[1]*o+i[1]*a+s[1]*n,r[2]=t[2]*o+i[2]*a+s[2]*n,r},mergeVertices(e,t,i,s){const r={},o=[],a=[],n=t?[]:null,h=i?[]:null,l=[];let c,u,p,d;const m=1e4;let f,g,_=0;for(f=0,g=e.length;f<g;f+=3)c=e[f],u=e[f+1],p=e[f+2],d=`${Math.round(c*m)}_${Math.round(u*m)}_${Math.round(p*m)}`,void 0===r[d]&&(r[d]=a.length/3,a.push(c),a.push(u),a.push(p),t&&(n.push(t[f]),n.push(t[f+1]),n.push(t[f+2])),i&&(h.push(i[_]),h.push(i[_+1]))),o[f/3]=r[d],_+=2;for(f=0,g=s.length;f<g;f++)l[f]=o[s[f]];const y={positions:a,indices:l};return n&&(y.normals=n),h&&(y.uv=h),y},buildNormals:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3),s=new FloatArrayType(3),r=new FloatArrayType(3),o=new FloatArrayType(3);return(a,n,h)=>{let l,c;const u=new Array(a.length/3);let p,d,m,f,g,_,y;for(l=0,c=n.length;l<c;l+=3){p=n[l],d=n[l+1],m=n[l+2],e[0]=a[3*p],e[1]=a[3*p+1],e[2]=a[3*p+2],t[0]=a[3*d],t[1]=a[3*d+1],t[2]=a[3*d+2],i[0]=a[3*m],i[1]=a[3*m+1],i[2]=a[3*m+2],math.subVec3(t,e,s),math.subVec3(i,e,r);const h=math.vec3();math.normalizeVec3(math.cross3Vec3(s,r,o),h),u[p]||(u[p]=[]),u[d]||(u[d]=[]),u[m]||(u[m]=[]),u[p].push(h),u[d].push(h),u[m].push(h)}for(h=h&&h.length===a.length?h:new Float32Array(a.length),l=0,c=u.length;l<c;l++){f=u[l].length,g=0,_=0,y=0;for(let e=0;e<f;e++)g+=u[l][e][0],_+=u[l][e][1],y+=u[l][e][2];h[3*l]=g/f,h[3*l+1]=_/f,h[3*l+2]=y/f}return h}})(),buildTangents:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3),i=new FloatArrayType(3),s=new FloatArrayType(3),r=new FloatArrayType(3),o=new FloatArrayType(3),a=new FloatArrayType(3);return(n,h,l)=>{const c=new Float32Array(n.length);for(let u=0;u<h.length;u+=3){let p=h[u];const d=n.subarray(3*p,3*p+3),m=l.subarray(2*p,2*p+2);p=h[u+1];const f=n.subarray(3*p,3*p+3),g=l.subarray(2*p,2*p+2);p=h[u+2];const _=n.subarray(3*p,3*p+3),y=l.subarray(2*p,2*p+2),T=math.subVec3(f,d,e),v=math.subVec3(_,d,t),I=math.subVec2(g,m,i),E=math.subVec2(y,m,s),P=1/(I[0]*E[1]-I[1]*E[0]),b=math.mulVec3Scalar(math.subVec3(math.mulVec3Scalar(T,E[1],r),math.mulVec3Scalar(v,I[1],o),a),P,o);let D;for(let e=0;e<3;e++)D=3*h[u+e],c[D]+=b[0],c[D+1]+=b[1],c[D+2]+=b[2]}return c}})(),buildPickTriangles(e,t,i){const s=t.length,r=i?new Uint16Array(9*s):new Float32Array(9*s),o=new Uint8Array(12*s);let a,n,h,l,c,u,p=0,d=0,m=0;for(let i=0;i<s;i+=3)u=p>>24&255,c=p>>16&255,l=p>>8&255,h=255&p,n=t[i],a=3*n,r[d++]=e[a],r[d++]=e[a+1],r[d++]=e[a+2],o[m++]=h,o[m++]=l,o[m++]=c,o[m++]=u,n=t[i+1],a=3*n,r[d++]=e[a],r[d++]=e[a+1],r[d++]=e[a+2],o[m++]=h,o[m++]=l,o[m++]=c,o[m++]=u,n=t[i+2],a=3*n,r[d++]=e[a],r[d++]=e[a+1],r[d++]=e[a+2],o[m++]=h,o[m++]=l,o[m++]=c,o[m++]=u,p++;return{positions:r,colors:o}},faceToVertexNormals(e,t,i={}){const s=i.smoothNormalsAngleThreshold||20,r={},o=[],a={};let n,h,l,c,u;const p=1e4;let d,m,f,g,_,y;for(m=0,g=e.length;m<g;m+=3){d=m/3,h=e[m],l=e[m+1],c=e[m+2],u=`${Math.round(h*p)}_${Math.round(l*p)}_${Math.round(c*p)}`,void 0===r[u]?r[u]=[d]:r[u].push(d);const i=math.normalizeVec3([t[m],t[m+1],t[m+2]]);o[d]=i,n=math.vec4([i[0],i[1],i[2],1]),a[d]=n}for(u in r)if(r.hasOwnProperty(u)){const e=r[u],t=e.length;for(m=0;m<t;m++){const i=e[m];for(n=a[i],f=0;f<t;f++){if(m===f)continue;const t=e[f];_=o[i],y=o[t];Math.abs(math.angleVec3(_,y)/math.DEGTORAD)<s&&(n[0]+=y[0],n[1]+=y[1],n[2]+=y[2],n[3]+=1)}}}for(m=0,g=t.length;m<g;m+=3)n=a[m/3],t[m+0]=n[0]/n[3],t[m+1]=n[1]/n[3],t[m+2]=n[2]/n[3]},transformRay:(()=>{const e=new FloatArrayType(4),t=new FloatArrayType(4);return(i,s,r,o,a)=>{e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=1,math.transformVec4(i,e,t),o[0]=t[0],o[1]=t[1],o[2]=t[2],e[0]=r[0],e[1]=r[1],e[2]=r[2],math.transformVec3(i,e,t),math.normalizeVec3(t),a[0]=t[0],a[1]=t[1],a[2]=t[2]}})(),canvasPosToWorldRay:(()=>{const e=new FloatArrayType(16),t=new FloatArrayType(16),i=new FloatArrayType(4),s=new FloatArrayType(4),r=new FloatArrayType(4),o=new FloatArrayType(4);return(a,n,h,l,c,u)=>{const p=math.mulMat4(h,n,e),d=math.inverseMat4(p,t),m=a.width,f=a.height,g=(l[0]-m/2)/(m/2),_=-(l[1]-f/2)/(f/2);i[0]=g,i[1]=_,i[2]=-1,i[3]=1,math.transformVec4(d,i,s),math.mulVec4Scalar(s,1/s[3]),r[0]=g,r[1]=_,r[2]=1,r[3]=1,math.transformVec4(d,r,o),math.mulVec4Scalar(o,1/o[3]),c[0]=o[0],c[1]=o[1],c[2]=o[2],math.subVec3(o,s,u),math.normalizeVec3(u)}})(),canvasPosToLocalRay:(()=>{const e=new FloatArrayType(3),t=new FloatArrayType(3);return(i,s,r,o,a,n,h)=>{math.canvasPosToWorldRay(i,s,r,a,e,t),math.worldRayToLocalRay(o,e,t,n,h)}})(),worldRayToLocalRay:(()=>{const e=new FloatArrayType(16),t=new FloatArrayType(4),i=new FloatArrayType(4);return(s,r,o,a,n)=>{const h=math.inverseMat4(s,e);t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,math.transformVec4(h,t,i),a[0]=i[0],a[1]=i[1],a[2]=i[2],math.transformVec3(h,o,n)}})(),buildKDTree:(()=>{const e=new Float32Array;function t(i,s,r,o){const a=new FloatArrayType(6),n={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:a};let h,l;for(a[0]=a[1]=a[2]=Number.POSITIVE_INFINITY,a[3]=a[4]=a[5]=Number.NEGATIVE_INFINITY,h=0,l=i.length;h<l;++h){var c=3*i[h];for(let e=0;e<3;++e){const t=3*s[c+e];r[t]<a[0]&&(a[0]=r[t]),r[t]>a[3]&&(a[3]=r[t]),r[t+1]<a[1]&&(a[1]=r[t+1]),r[t+1]>a[4]&&(a[4]=r[t+1]),r[t+2]<a[2]&&(a[2]=r[t+2]),r[t+2]>a[5]&&(a[5]=r[t+2])}}if(i.length<20||o>10)return n.triangles=i,n.leaf=!0,n;e[0]=a[3]-a[0],e[1]=a[4]-a[1],e[2]=a[5]-a[2];let u=0;e[1]>e[u]&&(u=1),e[2]>e[u]&&(u=2),n.splitDim=u;const p=(a[u]+a[u+3])/2,d=new Array(i.length);let m=0;const f=new Array(i.length);let g=0;for(h=0,l=i.length;h<l;++h){const e=s[c=3*i[h]],t=3*s[c+1],o=3*s[c+2];r[3*e+u]<=p||r[t+u]<=p||r[o+u]<=p?d[m++]=i[h]:f[g++]=i[h]}return d.length=m,f.length=g,n.left=t(d,s,r,o+1),n.right=t(f,s,r,o+1),n}return(e,i)=>{const s=e.length/3,r=new Array(s);for(let e=0;e<s;++e)r[e]=e;return t(r,e,i,0)}})(),decompressPosition(e,t,i){(i=i||e)[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14]},decompressPositions(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[12],i[s+1]=e[s+1]*t[5]+t[13],i[s+2]=e[s+2]*t[10]+t[14];return i},decompressUV(e,t,i){i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[6],i[s+1]=e[s+1]*t[4]+t[7];return i},octDecodeVec2(e,t){let i=e[0],s=e[1];i=(2*i+1)/255,s=(2*s+1)/255;const r=1-Math.abs(i)-Math.abs(s);r<0&&(i=(1-Math.abs(s))*(i>=0?1:-1),s=(1-Math.abs(i))*(s>=0?1:-1));const o=Math.sqrt(i*i+s*s+r*r);return t[0]=i/o,t[1]=s/o,t[2]=r/o,t},octDecodeVec2s(e,t){for(let i=0,s=0,r=e.length;i<r;i+=2){let r=e[i+0],o=e[i+1];r=(2*r+1)/255,o=(2*o+1)/255;const a=1-Math.abs(r)-Math.abs(o);a<0&&(r=(1-Math.abs(o))*(r>=0?1:-1),o=(1-Math.abs(r))*(o>=0?1:-1));const n=Math.sqrt(r*r+o*o+a*a);t[s+0]=r/n,t[s+1]=o/n,t[s+2]=a/n,s+=3}return t}};math.buildEdgeIndices=function(){const e=[],t=[],i=[],s=[],r=[];let o=0;const a=new Uint16Array(3),n=new Uint16Array(3),h=new Uint16Array(3),l=math.vec3(),c=math.vec3(),u=math.vec3(),p=math.vec3(),d=math.vec3(),m=math.vec3(),f=math.vec3();return function(g,_,y,T){!function(r,o){const a={};let n,h,l,c;const u=Math.pow(10,4);let p,d,m=0;for(p=0,d=r.length;p<d;p+=3)n=r[p],h=r[p+1],l=r[p+2],c=Math.round(n*u)+"_"+Math.round(h*u)+"_"+Math.round(l*u),void 0===a[c]&&(a[c]=m/3,e[m++]=n,e[m++]=h,e[m++]=l),t[p/3]=a[c];for(p=0,d=o.length;p<d;p++)s[p]=t[o[p]],i[s[p]]=o[p]}(g,_),function(t,i){o=0;for(let g=0,_=t;g<_;g+=3){const t=3*s[g],_=3*s[g+1],y=3*s[g+2];i?(a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],n[0]=e[_],n[1]=e[_+1],n[2]=e[_+2],h[0]=e[y],h[1]=e[y+1],h[2]=e[y+2],math.decompressPosition(a,i,l),math.decompressPosition(n,i,c),math.decompressPosition(h,i,u)):(l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],c[0]=e[_],c[1]=e[_+1],c[2]=e[_+2],u[0]=e[y],u[1]=e[y+1],u[2]=e[y+2]),math.subVec3(u,c,p),math.subVec3(l,c,d),math.cross3Vec3(p,d,m),math.normalizeVec3(m,f);const T=r[o]||(r[o]={normal:math.vec3()});T.normal[0]=f[0],T.normal[1]=f[1],T.normal[2]=f[2],o++}}(_.length,y);const v=[],I=Math.cos(math.DEGTORAD*T),E={};let P,b,D,w,C,R,F,S,x,M,A,L=!1;for(let e=0,t=_.length;e<t;e+=3){const t=e/3;for(let i=0;i<3;i++)P=s[e+i],b=s[e+(i+1)%3],D=Math.min(P,b),w=Math.max(P,b),C=D+","+w,void 0===E[C]?E[C]={index1:D,index2:w,face1:t,face2:void 0}:E[C].face2=t}for(C in E)R=E[C],void 0!==R.face2&&(F=r[R.face1].normal,S=r[R.face2].normal,x=math.dotVec3(F,S),x>I)||(M=i[R.index1],A=i[R.index2],(!L&&M>65535||A>65535)&&(L=!0),v.push(M),v.push(A));return L?new Uint32Array(v):new Uint16Array(v)}}();class Queue{constructor(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}get length(){return this._length}shift(){if(this._index>=this._headLength){const e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}const e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e}push(e){return this._length++,this._tail.push(e),this}unshift(e){return this._head[--this._index]=e,this._length++,this}}const stats={build:{version:"0.8"},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};function xmlToJson(e,t){if(e.nodeType===e.TEXT_NODE){var i=e.nodeValue;if(null===i.match(/^\s+$/))return i}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var s={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var r=0;r<e.attributes.length;r++){var o=e.attributes[r];s[t[o.nodeName]||o.nodeName]=o.nodeValue}for(var a=0;a<e.childNodes.length;a++){(r=xmlToJson(e.childNodes[a],t))&&s.children.push(r)}return s}}function clone(e){return JSON.parse(JSON.stringify(e))}var guidChars=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],i=e[0].charCodeAt(0),s=i+e[1],r=i;r<s;++r)t.push(r);return String.fromCharCode.apply(null,t)})).join("");function b64(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map((function(t){return guidChars.substr(parseInt(e/(1<<t))%64,1)})).reverse().join("")}function compressGuid(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return b64(t[0],2)+[1,4,7,10,13].map((function(e){return b64((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")}function findNodeOfType(e,t){var i=[],s=function(e){e.type===t&&i.push(e),(e.children||[]).forEach((function(e){s(e)}))};return s(e),i}function timeout(e){return new Promise((function(t,i){setTimeout(t,e)}))}function httpRequest(e){return new Promise((function(t,i){var s=new XMLHttpRequest;s.open(e.method||"GET",e.url,!0),s.onload=function(r){console.log(e.url,s.readyState,s.status),4===s.readyState&&(200===s.status?t(s.responseXML):i(s.statusText))},s.send(null)}))}const queryString=function(){for(var e={},t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var s=t[i].split("=");if(void 0===e[s[0]])e[s[0]]=decodeURIComponent(s[1]);else if("string"==typeof e[s[0]]){var r=[e[s[0]],decodeURIComponent(s[1])];e[s[0]]=r}else e[s[0]].push(decodeURIComponent(s[1]))}return e}();function loadJSON(e,t,i){var s=e=>{};t=t||s,i=i||s;var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.addEventListener("load",(function(e){var s=e.target.response;if(200===this.status){var r;try{r=JSON.parse(s)}catch(e){i(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}t(r)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(s))}catch(e){i(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}}else i(e)}),!1),r.addEventListener("error",(function(e){i(e)}),!1),r.send(null)}function loadArraybuffer$1(e,t,i){var s=e=>{};t=t||s,i=i||s;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),i=new Uint8Array(e);for(var a=0;a<o.length;a++)i[a]=o.charCodeAt(a);window.setTimeout((function(){t(e)}),0)}catch(e){window.setTimeout((function(){i(e)}),0)}}else{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i("loadArrayBuffer error : "+s.response))},s.send(null)}}function isArray(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length}function isString(e){return"string"==typeof e||e instanceof String}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}function isID(e){return utils.isString(e)||utils.isNumeric(e)}function isSameComponent(e,t){if(!e||!t)return!1;return(utils.isNumeric(e)||utils.isString(e)?`${e}`:e.id)===(utils.isNumeric(t)||utils.isString(t)?`${t}`:t.id)}function isFunction$1(e){return"function"==typeof e}function isObject$1(e){const t={}.constructor;return!!e&&e.constructor===t}function copy(e){return utils.apply(e,{})}function apply(e,t){for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function apply2(e,t){for(const i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&null!==e[i]&&(t[i]=e[i]);return t}function applyIf(e,t){for(const i in e)e.hasOwnProperty(i)&&(void 0!==t[i]&&null!==t[i]||(t[i]=e[i]));return t}function isEmptyObject(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function inQuotes(e){return utils.isNumeric(e)?`${e}`:`'${e}'`}function concat(e,t){const i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i}function flattenParentChildHierarchy(e){var t=[];return function e(i){i.id=i.uuid,delete i.oid,t.push(i);var s=i.children;if(s)for(var r=0,o=s.length;r<o;r++){s[r].parent=i.id,e(s[r])}i.children=[]}(e),t}const utils={xmlToJson:xmlToJson,clone:clone,compressGuid:compressGuid,findNodeOfType:findNodeOfType,timeout:timeout,httpRequest:httpRequest,loadJSON:loadJSON,loadArraybuffer:loadArraybuffer$1,queryString:queryString,isArray:isArray,isString:isString,isNumeric:isNumeric,isID:isID,isSameComponent:isSameComponent,isFunction:isFunction$1,isObject:isObject$1,copy:copy,apply:apply,apply2:apply2,applyIf:applyIf,isEmptyObject:isEmptyObject,inQuotes:inQuotes,concat:concat,flattenParentChildHierarchy:flattenParentChildHierarchy},scenesRenderInfo={},sceneIDMap=new Map$1,taskQueue=new Queue,tickEvent={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},taskBudget=10,fpsSamples=[],numFPSSamples=30;let elapsedTime,lastTime=0,totalFPS=0;function Core(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(e){if(e.id){if(core.scenes[e.id])return void console.error(`[ERROR] Scene ${utils.inQuotes(e.id)} already exists`)}else e.id=sceneIDMap.addItem({});core.scenes[e.id]=e;const t=e.ticksPerOcclusionTest,i=e.ticksPerRender;scenesRenderInfo[e.id]={ticksPerOcclusionTest:t,ticksPerRender:i,renderCountdown:i},stats.components.scenes++,e.once("destroyed",(()=>{sceneIDMap.removeItem(e.id),delete core.scenes[e.id],delete scenesRenderInfo[e.id],stats.components.scenes--}))},this.clear=function(){let e;for(const t in core.scenes)core.scenes.hasOwnProperty(t)&&(e=core.scenes[t],"default.scene"===t?e.clear():(e.destroy(),delete core.scenes[e.id]))},this.scheduleTask=function(e,t){taskQueue.push(e),taskQueue.push(t)},this.runTasks=function(e=-1){let t,i,s=(new Date).getTime(),r=0;for(;taskQueue.length>0&&(e<0||s<e);)t=taskQueue.shift(),i=taskQueue.shift(),i?t.call(i):t(),s=(new Date).getTime(),r++;return r},this.getNumTasks=function(){return taskQueue.length}}const core=new Core,frame=function(){let e=Date.now();if(lastTime>0){elapsedTime=e-lastTime;var t=1e3/elapsedTime;totalFPS+=t,fpsSamples.push(t),fpsSamples.length>=30&&(totalFPS-=fpsSamples.shift()),stats.frame.fps=Math.round(totalFPS/fpsSamples.length)}runTasks(e),fireTickEvents(e),renderScenes(),lastTime=e,void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(frame):requestAnimationFrame(frame)};function runTasks(e){const t=core.runTasks(e+10),i=core.getNumTasks();stats.frame.tasksRun=t,stats.frame.tasksScheduled=i,stats.frame.tasksBudget=10}function fireTickEvents(e){for(var t in tickEvent.time=e,core.scenes)if(core.scenes.hasOwnProperty(t)){var i=core.scenes[t];tickEvent.sceneId=t,tickEvent.startTime=i.startTime,tickEvent.deltaTime=null!=tickEvent.prevTime?tickEvent.time-tickEvent.prevTime:0,i.fire("tick",tickEvent,!0)}tickEvent.prevTime=e}function renderScenes(){const e=core.scenes;let t,i,s,r,o;for(o in e)e.hasOwnProperty(o)&&(t=e[o],i=scenesRenderInfo[o],i||(i=scenesRenderInfo[o]={}),s=t.ticksPerOcclusionTest,i.ticksPerOcclusionTest!==s&&(i.ticksPerOcclusionTest=s,i.renderCountdown=s),--t.occlusionTestCountdown<=0&&(t.doOcclusionTest(),t.occlusionTestCountdown=s),r=t.ticksPerRender,i.ticksPerRender!==r&&(i.ticksPerRender=r,i.renderCountdown=r),0==--i.renderCountdown&&(t.render(false),i.renderCountdown=r))}void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(frame):requestAnimationFrame(frame);class Component{get type(){return"Component"}get isComponent(){return!0}constructor(e=null,t={}){if(this.scene=null,"Scene"===this.type)this.scene=this,this.viewer=t.viewer;else{if("Scene"===e.type)this.scene=e;else{if(!(e instanceof Component))throw"Invalid param: owner must be a Component";this.scene=e.scene}this._owner=e,this._renderer=this.scene._renderer}this._dontClear=!!t.dontClear,this._renderer=this.scene._renderer,this.meta=t.meta||{},this.id=t.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this!==this.scene&&this.scene._addComponent(this),this._updateScheduled=!1,e&&e._own(this)}glRedraw(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}glResort(){this._renderer&&this._renderer.needStateSort()}get owner(){return this._owner}isType(e){return this.type===e}fire(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==i&&(this._events[e]=t||!0);const s=this._eventSubs[e];let r;if(s)for(const i in s)s.hasOwnProperty(i)&&(r=s[i],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(e,t,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new Map$1),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let s=this._eventSubs[e];s?this._eventSubsNum[e]++:(s={},this._eventSubs[e]=s,this._eventSubsNum[e]=1);const r=this._subIdMap.addItem();s[r]={callback:t,scope:i||this},this._subIdEvents[r]=e;const o=this._events[e];return void 0!==o&&t.call(i||this,o),r}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const i=this._eventSubs[t];i&&(delete i[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,i){const s=this,r=this.on(e,(function(e){s.off(r),t.call(i||this,e)}),i)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){e="[LOG]"+this._message(e),window.console.log(e),this.scene.fire("log",e)}_message(e){return" ["+this.type+" "+utils.inQuotes(this.id)+"]: "+e}warn(e){e="[WARN]"+this._message(e),window.console.warn(e),this.scene.fire("warn",e)}error(e){e="[ERROR]"+this._message(e),window.console.error(e),this.scene.fire("error",e)}_attach(e){const t=e.name;if(!t)return void this.error("Component 'name' expected");let i=e.component;const s=e.sceneDefault,r=e.sceneSingleton,o=e.type,a=e.on,n=!1!==e.recompiles;if(i&&(utils.isNumeric(i)||utils.isString(i))){const e=i;if(i=this.scene.components[e],!i)return void this.error("Component not found: "+utils.inQuotes(e))}if(!i)if(!0===r){const e=this.scene.types[o];for(const t in e)if(e.hasOwnProperty){i=e[t];break}if(!i)return this.error("Scene has no default component for '"+t+"'"),null}else if(!0===s&&(i=this.scene[t],!i))return this.error("Scene has no default component for '"+t+"'"),null;if(i){if(i.scene.id!==this.scene.id)return void this.error("Not in same scene: "+i.type+" "+utils.inQuotes(i.id));if(o&&!i.isType(o))return void this.error("Expected a "+o+" type or subtype: "+i.type+" "+utils.inQuotes(i.id))}this._attachments||(this._attachments={});const h=this._attached[t];let l,c,u;if(h){if(i&&h.id===i.id)return;const e=this._attachments[h.id];for(l=e.subs,c=0,u=l.length;c<u;c++)h.off(l[c]);delete this._attached[t],delete this._attachments[h.id];const s=e.params.onDetached;s&&(utils.isFunction(s)?s(h):s.scope?s.callback.call(s.scope,h):s.callback(h)),e.managingLifecycle&&h.destroy()}if(i){const s={params:e,component:i,subs:[],managingLifecycle:false};s.subs.push(i.once("destroyed",(function(){s.params.component=null,this._attach(s.params)}),this)),n&&s.subs.push(i.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[t]=i,this._attachments[i.id]=s;const r=e.onAttached;if(r&&(utils.isFunction(r)?r(i):r.scope?r.callback.call(r.scope,i):r.callback(i)),a){let e,t,r,o;for(e in a)if(a.hasOwnProperty(e)){if(t=a[e],utils.isFunction(t)?(r=t,o=null):(r=t.callback,o=t.scope),!r)continue;s.subs.push(i.on(e,r,o))}}}return n&&this.fire("dirty",this),this.fire(t,i),i}_checkComponent(e,t){if(!t.isComponent){if(!utils.isID(t))return void this.error("Expected a Component or ID");{const e=t;if(!(t=this.scene.components[e]))return void this.error("Component not found: "+e)}}if(e===t.type){if(t.scene.id===this.scene.id)return t;this.error("Not in same scene: "+t.type)}else this.error("Expected a "+e+" Component")}_checkComponent2(e,t){if(!t.isComponent){if(!utils.isID(t))return void this.error("Expected a Component or ID");{const e=t;if(!(t=this.scene.components[e]))return void this.error("Component not found: "+e)}}if(t.scene.id===this.scene.id){for(var i=0,s=e.length;i<s;i++)if(e[i]===t.type)return t;return this.error("Expected component types: "+e),null}this.error("Not in same scene: "+t.type)}_own(e){this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[e.id]||(this._ownedComponents[e.id]=e),e.once("destroyed",(()=>{delete this._ownedComponents[e.id]}),this)}_needUpdate(e){this._updateScheduled||(this._updateScheduled=!0,0===e?this._doUpdate():core.scheduleTask(this._doUpdate,this))}_doUpdate(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}_update(){}clear(){if(this._ownedComponents)for(var e in this._ownedComponents)if(this._ownedComponents.hasOwnProperty(e)){this._ownedComponents[e].destroy(),delete this._ownedComponents[e]}}destroy(){if(this.destroyed)return;let e,t,i,s,r,o;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){for(t=this._attachments[e],i=t.component,s=t.subs,r=0,o=s.length;r<o;r++)i.off(s[r]);t.managingLifecycle&&i.destroy()}if(this._ownedComponents)for(e in this._ownedComponents)this._ownedComponents.hasOwnProperty(e)&&(i=this._ownedComponents[e],i.destroy(),delete this._ownedComponents[e]);this.scene._removeComponent(this),this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}}const ENTITY_FLAGS={VISIBLE:1,CULLED:4,PICKABLE:8,CLIPPABLE:16,COLLIDABLE:32,CAST_SHADOW:64,RECEIVE_SHADOW:128,XRAYED:256,HIGHLIGHTED:512,SELECTED:1024,EDGES:2048,BACKFACES:4096,TRANSPARENT:8192},tempFloatRGB=new Float32Array([0,0,0]),tempIntRGB=new Uint16Array([0,0,0]);class PerformanceNode{constructor(e,t,i,s,r,o){this._isObject=t,this.scene=e.scene,this.model=e,this.meshes=s,this._numTriangles=0;for(var a=0,n=this.meshes.length;a<n;a++){const e=this.meshes[a];e.parent=this,this._numTriangles+=e.numTriangles}this.id=i,this.originalSystemId=math.unglobalizeObjectId(e.id,i),this._flags=r,this._aabb=o,this._offsetAABB=math.AABB3(o),this._offset=math.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._isObject&&e.scene._registerObject(this)}get isEntity(){return!0}get isModel(){return!1}get isObject(){return this._isObject}get aabb(){return this._offsetAABB}get numTriangles(){return this._numTriangles}get visible(){return this._getFlag(ENTITY_FLAGS.VISIBLE)}set visible(e){if(!!(this._flags&ENTITY_FLAGS.VISIBLE)!==e){this._flags=e?this._flags|ENTITY_FLAGS.VISIBLE:this._flags&~ENTITY_FLAGS.VISIBLE;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}get highlighted(){return this._getFlag(ENTITY_FLAGS.HIGHLIGHTED)}set highlighted(e){if(!!(this._flags&ENTITY_FLAGS.HIGHLIGHTED)!==e){this._flags=e?this._flags|ENTITY_FLAGS.HIGHLIGHTED:this._flags&~ENTITY_FLAGS.HIGHLIGHTED;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}get xrayed(){return this._getFlag(ENTITY_FLAGS.XRAYED)}set xrayed(e){if(!!(this._flags&ENTITY_FLAGS.XRAYED)!==e){this._flags=e?this._flags|ENTITY_FLAGS.XRAYED:this._flags&~ENTITY_FLAGS.XRAYED;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}get selected(){return this._getFlag(ENTITY_FLAGS.SELECTED)}set selected(e){if(!!(this._flags&ENTITY_FLAGS.SELECTED)!==e){this._flags=e?this._flags|ENTITY_FLAGS.SELECTED:this._flags&~ENTITY_FLAGS.SELECTED;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}get edges(){return this._getFlag(ENTITY_FLAGS.EDGES)}set edges(e){if(!!(this._flags&ENTITY_FLAGS.EDGES)!==e){this._flags=e?this._flags|ENTITY_FLAGS.EDGES:this._flags&~ENTITY_FLAGS.EDGES;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}get culled(){return this._getFlag(ENTITY_FLAGS.CULLED)}set culled(e){if(!!(this._flags&ENTITY_FLAGS.CULLED)!==e){this._flags=e?this._flags|ENTITY_FLAGS.CULLED:this._flags&~ENTITY_FLAGS.CULLED;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}get clippable(){return this._getFlag(ENTITY_FLAGS.CLIPPABLE)}set clippable(e){if(!!(this._flags&ENTITY_FLAGS.CLIPPABLE)!==e){this._flags=e?this._flags|ENTITY_FLAGS.CLIPPABLE:this._flags&~ENTITY_FLAGS.CLIPPABLE;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}get collidable(){return this._getFlag(ENTITY_FLAGS.COLLIDABLE)}set collidable(e){if(!!(this._flags&ENTITY_FLAGS.COLLIDABLE)!==e){this._flags=e?this._flags|ENTITY_FLAGS.COLLIDABLE:this._flags&~ENTITY_FLAGS.COLLIDABLE;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCollidable(this._flags)}}get pickable(){return this._getFlag(ENTITY_FLAGS.PICKABLE)}set pickable(e){if(!!(this._flags&ENTITY_FLAGS.PICKABLE)!==e){this._flags=e?this._flags|ENTITY_FLAGS.PICKABLE:this._flags&~ENTITY_FLAGS.PICKABLE;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setPickable(this._flags)}}get colorize(){if(0===this.meshes.length)return null;const e=this.meshes[0]._colorize;return tempFloatRGB[0]=e[0]/255,tempFloatRGB[1]=e[1]/255,tempFloatRGB[2]=e[2]/255,tempFloatRGB}set colorize(e){if(e){tempIntRGB[0]=Math.floor(255*e[0]),tempIntRGB[1]=Math.floor(255*e[1]),tempIntRGB[2]=Math.floor(255*e[2]);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(tempIntRGB)}else for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(null);if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t),this._colorizeUpdated=t}this.model.glRedraw()}get opacity(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1}set opacity(e){if(0===this.meshes.length)return;const t=null!=e,i=this.meshes[0]._colorize[3];let s=255;if(t){if(e<0?e=0:e>1&&(e=1),s=Math.floor(255*e),i===s)return}else if(s=255,i===s)return;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOpacity(s,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}get offset(){return this._offset}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOffset(this._offset);this._offsetAABB[0]=this._aabb[0]+this._offset[0],this._offsetAABB[1]=this._aabb[1]+this._offset[1],this._offsetAABB[2]=this._aabb[2]+this._offset[2],this._offsetAABB[3]=this._aabb[3]+this._offset[0],this._offsetAABB[4]=this._aabb[4]+this._offset[1],this._offsetAABB[5]=this._aabb[5]+this._offset[2],this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model._aabbDirty=!0,this.model.glRedraw()}get castsShadow(){return!1}set castsShadow(e){}get receivesShadow(){return!1}set receivesShadow(e){}get saoEnabled(){return this.model.saoEnabled}_getFlag(e){return!!(this._flags&e)}_finalize(){const e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize(this._flags)}_finalize2(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}_destroy(){const e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._objectVisibilityUpdated(this,!1),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this._opacityUpdated&&this.scene._objectColorizeUpdated(this,!1),this._opacityUpdated&&this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._destroy();e._aabbDirty=!0}}const tempVec3a$13=math.vec3(),createRTCViewMat=function(){const e=new Float32Array(16),t=new Float64Array(4),i=new Float64Array(4);return function(s,r,o=e){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,math.transformVec4(s,t,i),math.setMat4Translation(s,i,o),o}}();function worldToRTCPos(e,t,i){const s=Float32Array.from([e[0]])[0],r=e[0]-s,o=Float32Array.from([e[1]])[0],a=e[1]-o,n=Float32Array.from([e[2]])[0],h=e[2]-n;t[0]=s,t[1]=o,t[2]=n,i[0]=r,i[1]=a,i[2]=h}function worldToRTCPositions(e,t,i,s=1e6){const r=math.getPositionsCenter(e,tempVec3a$13),o=Math.round(r[0]/s)*s,a=Math.round(r[1]/s)*s,n=Math.round(r[2]/s)*s;i[0]=o,i[1]=a,i[2]=n;const h=0!==i[0]||0!==i[1]||0!==i[2];if(h)for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]-o,t[i+1]=e[i+1]-a,t[i+2]=e[i+2]-n;return h}function getPlaneRTCPos(e,t,i,s){const r=math.dotVec3(t,i)+e,o=math.normalizeVec3(t,tempVec3a$13);return math.mulVec3Scalar(o,-r,s),s}const tempVec4a$a=math.vec4(),tempVec4b$a=math.vec4();class Marker extends Component{constructor(e,t){super(e,t),this._entity=null,this._visible=null,this._worldPos=math.vec3(),this._origin=math.vec3(),this._rtcPos=math.vec3(),this._viewPos=math.vec3(),this._canvasPos=math.vec2(),this._occludable=!1,this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewPosDirty=!0,this._needUpdate()})),this._onCameraProjMatrix=this.scene.camera.on("projMatrix",(()=>{this._canvasPosDirty=!0,this._needUpdate()})),this._onEntityDestroyed=null,this._onEntityModelDestroyed=null,this._renderer.addMarker(this),this.entity=t.entity,this.worldPos=t.worldPos,this.occludable=t.occludable}_update(){if(this._viewPosDirty&&(math.transformPoint3(this.scene.camera.viewMatrix,this._worldPos,this._viewPos),this._viewPosDirty=!1,this._canvasPosDirty=!0,this.fire("viewPos",this._viewPos)),this._canvasPosDirty){tempVec4a$a.set(this._viewPos),tempVec4a$a[3]=1,math.transformPoint4(this.scene.camera.projMatrix,tempVec4a$a,tempVec4b$a);const e=this.scene.canvas.boundary;this._canvasPos[0]=Math.floor((1+tempVec4b$a[0]/tempVec4b$a[3])*e[2]/2),this._canvasPos[1]=Math.floor((1-tempVec4b$a[1]/tempVec4b$a[3])*e[3]/2),this._canvasPosDirty=!1,this.fire("canvasPos",this._canvasPos)}}_setVisible(e){this._visible,this._visible=e,this.fire("visible",this._visible)}set entity(e){if(this._entity){if(this._entity===e)return;null!==this._onEntityDestroyed&&(this._entity.off(this._onEntityDestroyed),this._onEntityDestroyed=null),null!==this._onEntityModelDestroyed&&(this._entity.model.off(this._onEntityModelDestroyed),this._onEntityModelDestroyed=null)}this._entity=e,this._entity&&(this._entity instanceof PerformanceNode?this._onEntityModelDestroyed=this._entity.model.on("destroyed",(()=>{this._entity=null,this._onEntityModelDestroyed=null})):this._onEntityDestroyed=this._entity.on("destroyed",(()=>{this._entity=null,this._onEntityDestroyed=null}))),this.fire("entity",this._entity,!0)}get entity(){return this._entity}set occludable(e){(e=!!e)!==this._occludable&&(this._occludable=e)}get occludable(){return this._occludable}set worldPos(e){this._worldPos.set(e||[0,0,0]),worldToRTCPos(this._worldPos,this._origin,this._rtcPos),this._occludable&&this._renderer.markerWorldPosUpdated(this),this._viewPosDirty=!0,this.fire("worldPos",this._worldPos)}get worldPos(){return this._worldPos}get origin(){return this._origin}get rtcPos(){return this._rtcPos}get viewPos(){return this._update(),this._viewPos}get canvasPos(){return this._update(),this._canvasPos}get visible(){return!!this._visible}destroy(){this.fire("destroyed",!0),this.scene.camera.off(this._onCameraViewMatrix),this.scene.camera.off(this._onCameraProjMatrix),this._entity&&(null!==this._onEntityDestroyed&&this._entity.off(this._onEntityDestroyed),null!==this._onEntityModelDestroyed&&this._entity.model.off(this._onEntityModelDestroyed)),this._renderer.removeMarker(this),super.destroy()}}class Wire{constructor(e,t={}){this._wire=document.createElement("div"),this._wire.className+=this._wire.className?" viewer-ruler-wire":"viewer-ruler-wire";var i=this._wire,s=i.style;this._thickness=t.thickness||1,s.border="solid "+this._thickness+"px "+(t.color||"black"),s.position="absolute",s["z-index"]=void 0===t.zIndex?"2000001":t.zIndex,s.width="0px",s.height="0px",s.visibility="visible",s.top="0px",s.left="0px",s["pointer-events"]="none",s["-webkit-transform-origin"]="0 0",s["-moz-transform-origin"]="0 0",s["-ms-transform-origin"]="0 0",s["-o-transform-origin"]="0 0",s["transform-origin"]="0 0",s["-webkit-transform"]="rotate(0deg)",s["-moz-transform"]="rotate(0deg)",s["-ms-transform"]="rotate(0deg)",s["-o-transform"]="rotate(0deg)",s.transform="rotate(0deg)",s.opacity=1,e.appendChild(i),this._x1=0,this._y1=0,this._x2=0,this._y2=0,this._update()}get _visible(){return"visible"===this._wire.style.visibility}_update(){var e=Math.abs(Math.sqrt((this._x1-this._x2)*(this._x1-this._x2)+(this._y1-this._y2)*(this._y1-this._y2))),t=180*Math.atan2(this._y2-this._y1,this._x2-this._x1)/Math.PI,i=this._wire.style;i.width=Math.round(e)+"px",i.left=Math.round(this._x1)+"px",i.top=Math.round(this._y1)+"px",i["-webkit-transform"]="rotate("+t+"deg)",i["-moz-transform"]="rotate("+t+"deg)",i["-ms-transform"]="rotate("+t+"deg)",i["-o-transform"]="rotate("+t+"deg)",i.transform="rotate("+t+"deg)",i["pointer-events"]="none"}setStartAndEnd(e,t,i,s){this._x1=e,this._y1=t,this._x2=i,this._y2=s,this._update()}setColor(e){this._wire.style.border="solid "+this._thickness+"px "+(e||"black")}setOpacity(e){this._wire.style.opacity=e}setVisible(e){e=!!e,this._visible!==e&&(this._wire.style.visibility=e?"visible":"hidden")}destroy(e){this._wire.parentElement.removeChild(this._wire)}}class Dot{constructor(e,t={}){this._x=0,this._y=0,this._visible=!0,this._dot=document.createElement("div"),this._dot.className+=this._dot.className?" viewer-ruler-dot":"viewer-ruler-dot";var i=this._dot,s=i.style;s["border-radius"]="25px",s.border="solid 2px white",s.background="lightgreen",s.position="absolute",s["z-index"]=void 0===t.zIndex?"40000005":t.zIndex,s.width="8px",s.height="8px",s.visibility="visible",s.top="0px",s.left="0px",s["box-shadow"]="0 2px 5px 0 #182A3D;",s["pointer-events"]="none",s.opacity=1,e.appendChild(i),this.setPos(t.x||0,t.y||0),this.setFillColor(t.fillColor),this.setBorderColor(t.borderColor),this.setClickable(!1)}setPos(e,t){this._x=e,this._y=t;var i=this._dot.style;i.left=Math.round(e)-5+"px",i.top=Math.round(t)-5+"px"}setFillColor(e){this._dot.style.background=e||"lightgreen"}setBorderColor(e){this._dot.style.border="solid 2px"+(e||"black")}setOpacity(e){this._dot.style.opacity=e}setVisible(e){this._visible!==e&&(this._visible=!!e,this._dot.style.visibility=this._visible?"visible":"hidden")}setClickable(e){this._dot.style["pointer-events"]=e?"all":"none"}destroy(){this.setVisible(!1),this._dot.parentElement.removeChild(this._dot)}}class Label{constructor(e,t={}){this._prefix=t.prefix||"",this._x=0,this._y=0,this._visible=!0,this._label=document.createElement("div"),this._label.className+=this._label.className?" viewer-ruler-label":"viewer-ruler-label";var i=this._label,s=i.style;s["border-radius"]="5px",s.color="white",s.padding="4px",s.border="solid 0px white",s.background="lightgreen",s.position="absolute",s["z-index"]=void 0===t.zIndex?"5000005":t.zIndex,s.width="auto",s.height="auto",s.visibility="visible",s.top="0px",s.left="0px",s["pointer-events"]="none",s.opacity=1,i.innerText="",e.appendChild(i),this.setPos(t.x||0,t.y||0),this.setFillColor(t.fillColor),this.setBorderColor(t.borderColor),this.setText(t.text)}setPos(e,t){this._x=e,this._y=t;var i=this._label.style;i.left=Math.round(e)-20+"px",i.top=Math.round(t)-12+"px"}setPosOnWire(e,t,i,s){var r=e+.5*(i-e),o=t+.5*(s-t),a=this._label.style;a.left=Math.round(r)-20+"px",a.top=Math.round(o)-12+"px"}setPosBetweenWires(e,t,i,s,r,o){var a=(e+i+r)/3,n=(t+s+o)/3,h=this._label.style;h.left=Math.round(a)-20+"px",h.top=Math.round(n)-12+"px"}setText(e){this._label.innerHTML=this._prefix+(e||"")}setFillColor(e){this._label.style.background=e||"lightgreen"}setBorderColor(e){this._label.style.border="solid 2px"+(e||"black")}setOpacity(e){this._label.style.opacity=e}setVisible(e){this._visible!==e&&(this._visible=!!e,this._label.style.visibility=this._visible?"visible":"hidden")}destroy(){this._label.parentElement.removeChild(this._label)}}var originVec=math.vec3(),targetVec=math.vec3();class AngleMeasurement extends Component{constructor(e,t={}){if(super(e.viewer.scene,t),this.plugin=e,this._container=t.container,!this._container)throw"config missing: container";this._color=t.color||e.defaultColor;var i=this.plugin.viewer.scene;this._originMarker=new Marker(i,t.origin),this._cornerMarker=new Marker(i,t.corner),this._targetMarker=new Marker(i,t.target),this._originWorld=math.vec3(),this._cornerWorld=math.vec3(),this._targetWorld=math.vec3(),this._wp=new Float64Array(12),this._vp=new Float64Array(12),this._pp=new Float64Array(12),this._cp=new Int16Array(6),this._originDot=new Dot(this._container,{fillColor:this._color,zIndex:e.zIndex+1}),this._cornerDot=new Dot(this._container,{fillColor:this._color,zIndex:e.zIndex+1}),this._targetDot=new Dot(this._container,{fillColor:this._color,zIndex:e.zIndex+1}),this._originWire=new Wire(this._container,{color:this._color||"blue",thickness:1,zIndex:e.zIndex}),this._targetWire=new Wire(this._container,{color:this._color||"red",thickness:1,zIndex:e.zIndex}),this._angleLabel=new Label(this._container,{fillColor:this._color||"#00BBFF",prefix:"",text:"",zIndex:e.zIndex+2}),this._wpDirty=!1,this._vpDirty=!1,this._cpDirty=!1,this._visible=!1,this._originVisible=!1,this._cornerVisible=!1,this._targetVisible=!1,this._originWireVisible=!1,this._targetWireVisible=!1,this._angleVisible=!1,this._originMarker.on("worldPos",(e=>{this._originWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._cornerMarker.on("worldPos",(e=>{this._cornerWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._targetMarker.on("worldPos",(e=>{this._targetWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._onViewMatrix=i.camera.on("viewMatrix",(()=>{this._vpDirty=!0,this._needUpdate(0)})),this._onProjMatrix=i.camera.on("projMatrix",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onCanvasBoundary=i.canvas.on("boundary",(()=>{this._cpDirty=!0,this._needUpdate(0)})),this.approximate=t.approximate,this.visible=t.visible,this.originVisible=t.originVisible,this.cornerVisible=t.cornerVisible,this.targetVisible=t.targetVisible,this.originWireVisible=t.originWireVisible,this.targetWireVisible=t.targetWireVisible,this.angleVisible=t.angleVisible}_update(){if(!this._visible)return;const e=this.plugin.viewer.scene;if(this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._cornerWorld[0],this._wp[5]=this._cornerWorld[1],this._wp[6]=this._cornerWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._targetWorld[2],this._wp[11]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(math.transformPositions4(e.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vpDirty=!1,this._cpDirty=!0),this._cpDirty){const p=-.3,d=this._originMarker.viewPos[2],m=this._cornerMarker.viewPos[2],f=this._targetMarker.viewPos[2];if(d>p||m>p||f>p)return this._originDot.setVisible(!1),this._cornerDot.setVisible(!1),this._targetDot.setVisible(!1),this._originWire.setVisible(!1),this._targetWire.setVisible(!1),void this._angleLabel.setVisible(!1);math.transformPositions4(e.camera.project.matrix,this._vp,this._pp);for(var t=this._pp,i=this._cp,s=e.canvas.canvas.getBoundingClientRect(),r=s.top,o=s.left,a=e.canvas.boundary,n=a[2],h=a[3],l=0,c=0,u=t.length;c<u;c+=4)i[l]=o+Math.floor((1+t[c+0]/t[c+3])*n/2),i[l+1]=r+Math.floor((1-t[c+1]/t[c+3])*h/2),l+=2;if(this._originDot.setPos(i[0],i[1]),this._cornerDot.setPos(i[2],i[3]),this._targetDot.setPos(i[4],i[5]),this._originWire.setStartAndEnd(i[0],i[1],i[2],i[3]),this._targetWire.setStartAndEnd(i[2],i[3],i[4],i[5]),this._angleLabel.setPosBetweenWires(i[0],i[1],i[2],i[3],i[4],i[5]),math.subVec3(this._originWorld,this._cornerWorld,originVec),math.subVec3(this._targetWorld,this._cornerWorld,targetVec),!(0===originVec[0]&&0===originVec[1]&&0===originVec[2]||0===targetVec[0]&&0===targetVec[1]&&0===targetVec[2])){const e=this._approximate?" ~ ":" = ";math.normalizeVec3(originVec),math.normalizeVec3(targetVec);const t=Math.abs(math.angleVec3(originVec,targetVec));this._angle=t/math.DEGTORAD,this._angleLabel.setText(e+this._angle.toFixed(2)+"")}else this._angleLabel.setText("");this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setVisible(this._visible&&this._angleVisible),this._cpDirty=!1}}set approximate(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._cpDirty=!0,this._needUpdate(0))}get approximate(){return this._approximate}get origin(){return this._originMarker}get corner(){return this._cornerMarker}get target(){return this._targetMarker}get angle(){return this._update(),this._angle}get color(){return this._color}set color(e){this._originDot.setFillColor(e),this._cornerDot.setFillColor(e),this._targetDot.setFillColor(e),this._originWire.setColor(e||"blue"),this._targetWire.setColor(e||"red"),this._angleLabel.setFillColor(e||"#00BBFF"),this._color=e}set visible(e){e=!1!==e,this._visible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setVisible(this._visible&&this._angleVisible)}get visible(){return this._visible}set originVisible(e){e=!1!==e,this._originVisible=e,this._originDot.setVisible(this._visible&&this._originVisible)}get originVisible(){return this._originVisible}set cornerVisible(e){e=!1!==e,this._cornerVisible=e,this._cornerDot.setVisible(this._visible&&this._cornerVisible)}get cornerVisible(){return this._cornerVisible}set targetVisible(e){e=!1!==e,this._targetVisible=e,this._targetDot.setVisible(this._visible&&this._targetVisible)}get targetVisible(){return this._targetVisible}set originWireVisible(e){e=!1!==e,this._originWireVisible=e,this._originWire.setVisible(this._visible&&this._originWireVisible)}get originWireVisible(){return this._originWireVisible}set targetWireVisible(e){e=!1!==e,this._targetWireVisible=e,this._targetWire.setVisible(this._visible&&this._targetWireVisible)}get targetWireVisible(){return this._targetWireVisible}set angleVisible(e){e=!1!==e,this._angleVisible=e,this._angleLabel.setVisible(this._visible&&this._angleVisible)}get angleVisible(){return this._angleVisible}destroy(){const e=this.plugin.viewer.scene;this._onViewMatrix&&e.camera.off(this._onViewMatrix),this._onProjMatrix&&e.camera.off(this._onProjMatrix),this._onCanvasBoundary&&e.canvas.off(this._onCanvasBoundary),this._originDot.destroy(),this._cornerDot.destroy(),this._targetDot.destroy(),this._originWire.destroy(),this._targetWire.destroy(),this._angleLabel.destroy(),super.destroy()}}const HOVERING=0,FINDING_ORIGIN=1,FINDING_CORNER=2,FINDING_TARGET=3;class AngleMeasurementsControl extends Component{constructor(e){super(e.viewer.scene),this.plugin=e,this._active=!1,this._state=0,this._currentAngleMeasurement=null,this._onhoverSurface=null,this._onPickedSurface=null,this._onHoverNothing=null,this._onPickedNothing=null}get active(){return this._active}activate(){if(this._active)return;this.startDot=new Dot(this.plugin._container,{fillColor:this.plugin.defaultColor,zIndex:this.plugin.zIndex+1});const e=this.plugin.viewer.cameraControl;let t=!1,i=null,s=math.vec3();const r=math.vec2(),o=this.plugin.viewer.scene.pickSurfacePrecisionEnabled;let a,n;this._onhoverSurface=e.on("hoverSurface",(e=>{if(t=!0,i=e.entity,s.set(e.worldPos),r.set(e.canvasPos),0===this._state)return this.startDot&&(this.startDot.setVisible(!0),this.startDot.setPos(e.canvasPos[0],e.canvasPos[1])),void(this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer");if(this._currentAngleMeasurement)switch(this._state){case 2:this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.angleVisible=!1,this._currentAngleMeasurement.corner.entity=e.entity,this._currentAngleMeasurement.corner.worldPos=e.worldPos,this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer";break;case 3:this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.target.entity=e.entity,this._currentAngleMeasurement.target.worldPos=e.worldPos,this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer"}}));this._onInputMouseDown=this.plugin.viewer.scene.input.on("mousedown",(e=>{a=e[0],n=e[1]})),this._onInputMouseUp=this.plugin.viewer.scene.input.on("mouseup",(e=>{if(!(e[0]>a+5||e[0]<a-5||e[1]>n+5||e[1]<n-5))switch(this.startDot&&(this.startDot.destroy(),this.startDot=null),this._state){case 0:if(t){if(o){const e=this.plugin.viewer.scene.pick({canvasPos:r,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&s.set(e.worldPos)}this._currentAngleMeasurement=this.plugin.createMeasurement({id:math.createUUID(),origin:{entity:i,worldPos:s},corner:{entity:i,worldPos:s},target:{entity:i,worldPos:s},approximate:!0}),this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._state=2,this.fire("measurementStart",this._currentAngleMeasurement)}break;case 2:if(t){if(o){const e=this.plugin.viewer.scene.pick({canvasPos:r,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&(this._currentAngleMeasurement.corner.worldPos=e.worldPos)}this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._state=3}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement));break;case 3:if(t){if(o){const e=this.plugin.viewer.scene.pick({canvasPos:r,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&(this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.approximate=!1)}this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null,this._state=0}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement))}})),this._onHoverNothing=e.on("hoverOff",(e=>{if(this.startDot&&this.startDot.setVisible(!1),t=!1,this._currentAngleMeasurement){switch(this._state){case 0:case 1:this._currentAngleMeasurement.originVisible=!1;break;case 2:this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.originWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1;break;case 3:this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1}this.plugin.viewer.scene.canvas.canvas.style.cursor="default"}})),this._active=!0}deactivate(){if(!this._active)return;this.startDot&&(this.startDot.destroy(),this.startDot=null),this.reset();const e=this.plugin.viewer.cameraControl,t=this.plugin.viewer.scene.input;t.off(this._onInputMouseDown),t.off(this._onInputMouseUp),e.off(this._onhoverSurface),e.off(this._onPickedSurface),e.off(this._onHoverNothing),e.off(this._onPickedNothing),this._currentAngleMeasurement=null,this._active=!1}reset(){this._active&&(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._state=0)}destroy(){this.deactivate(),super.destroy()}}class AngleMeasurementsPlugin extends Plugin{constructor(e,t={}){super("AngleMeasurements",e),this._container=t.container||document.body,this._control=new AngleMeasurementsControl(this),this._measurements={},this.defaultColor=t.defaultColor,this.zIndex=t.zIndex}send(e,t){}get control(){return this._control}get measurements(){return this._measurements}createMeasurement(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=e.origin,i=e.corner,s=e.target,r=new AngleMeasurement(this,{id:e.id,plugin:this,container:this._container,origin:{entity:t.entity,worldPos:t.worldPos},corner:{entity:i.entity,worldPos:i.worldPos},target:{entity:s.entity,worldPos:s.worldPos},visible:e.visible,originVisible:!0,originWireVisible:!0,cornerVisible:!0,targetWireVisible:!0,targetVisible:!0});return this._measurements[r.id]=r,r.on("destroyed",(()=>{delete this._measurements[r.id]})),this.fire("measurementCreated",r),r}destroyMeasurement(e){const t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("AngleMeasurement not found: "+e)}clear(){const e=Object.keys(this._measurements);for(var t=0,i=e.length;t<i;t++)this.destroyMeasurement(e[t])}destroy(){this.clear(),super.destroy()}}class Annotation extends Marker{constructor(e,t){if(super(e,t),this.plugin=t.plugin,this._container=t.container,!this._container)throw"config missing: container";if(!t.markerElement&&!t.markerHTML)throw"config missing: need either markerElement or markerHTML";if(!t.labelElement&&!t.labelHTML)throw"config missing: need either labelElement or labelHTML";this._htmlDirty=!1,t.markerElement?(this._marker=t.markerElement,this._marker.addEventListener("click",this._onMouseClickedExternalMarker=()=>{this.plugin.fire("markerClicked",this)}),this._marker.addEventListener("mouseenter",this._onMouseEnterExternalMarker=()=>{this.plugin.fire("markerMouseEnter",this)}),this._marker.addEventListener("mouseleave",this._onMouseLeaveExternalMarker=()=>{this.plugin.fire("markerMouseLeave",this)}),this._markerExternal=!0):(this._markerHTML=t.markerHTML,this._htmlDirty=!0,this._markerExternal=!1),t.labelElement?(this._label=t.labelElement,this._labelExternal=!0):(this._labelHTML=t.labelHTML,this._htmlDirty=!0,this._labelExternal=!1),this._markerShown=!!t.markerShown,this._labelShown=!!t.labelShown,this._values=t.values||{},this._layoutDirty=!0,this._visibilityDirty=!0,this._buildHTML(),this._onTick=this.scene.on("tick",(()=>{this._htmlDirty&&(this._buildHTML(),this._htmlDirty=!1,this._layoutDirty=!0,this._visibilityDirty=!0),(this._layoutDirty||this._visibilityDirty)&&(this._markerShown||this._labelShown)&&(this._updatePosition(),this._layoutDirty=!1),this._visibilityDirty&&(this._marker.style.visibility=this.visible&&this._markerShown?"visible":"hidden",this._label.style.visibility=this.visible&&this._markerShown&&this._labelShown?"visible":"hidden",this._visibilityDirty=!1)})),this.on("canvasPos",(()=>{this._layoutDirty=!0})),this.on("visible",(()=>{this._visibilityDirty=!0})),this.setMarkerShown(!1!==t.markerShown),this.setLabelShown(t.labelShown),this.eye=t.eye?t.eye.slice():null,this.look=t.look?t.look.slice():null,this.up=t.up?t.up.slice():null,this.projection=t.projection}_buildHTML(){if(!this._markerExternal){this._marker&&(this._container.removeChild(this._marker),this._marker=null);let e=this._markerHTML||"<p></p>";utils.isArray(e)&&(e=e.join("")),e=this._renderTemplate(e);const t=document.createRange().createContextualFragment(e);this._marker=t.firstChild,this._container.appendChild(this._marker),this._marker.style.visibility=this._markerShown?"visible":"hidden",this._marker.addEventListener("click",(()=>{this.plugin.fire("markerClicked",this)})),this._marker.addEventListener("mouseenter",(()=>{this.plugin.fire("markerMouseEnter",this)})),this._marker.addEventListener("mouseleave",(()=>{this.plugin.fire("markerMouseLeave",this)}))}if(!this._labelExternal){this._label&&(this._container.removeChild(this._label),this._label=null);let e=this._labelHTML||"<p></p>";utils.isArray(e)&&(e=e.join("")),e=this._renderTemplate(e);const t=document.createRange().createContextualFragment(e);this._label=t.firstChild,this._container.appendChild(this._label),this._label.style.visibility=this._markerShown&&this._labelShown?"visible":"hidden"}}_updatePosition(){const e=this.scene.canvas.boundary,t=e[0],i=e[1],s=this.canvasPos;this._marker.style.left=Math.floor(t+s[0])-12+"px",this._marker.style.top=Math.floor(i+s[1])-12+"px",this._marker.style["z-index"]=90005+Math.floor(this._viewPos[2])+1;this._label.style.left=20+Math.floor(t+s[0]+20)+"px",this._label.style.top=Math.floor(i+s[1]+-17)+"px",this._label.style["z-index"]=90005+Math.floor(this._viewPos[2])+1}_renderTemplate(e){for(var t in this._values)if(this._values.hasOwnProperty(t)){const i=this._values[t];e=e.replace(new RegExp("{{"+t+"}}","g"),i)}return e}setMarkerShown(e){e=!!e,this._markerShown!==e&&(this._markerShown=e,this._visibilityDirty=!0)}getMarkerShown(){return this._markerShown}setLabelShown(e){e=!!e,this._labelShown!==e&&(this._labelShown=e,this._visibilityDirty=!0)}getLabelShown(){return this._labelShown}setField(e,t){this._values[e]=t||"",this._htmlDirty=!0}getField(e){return this._values[e]}setValues(e){for(var t in e)if(e.hasOwnProperty(t)){const i=e[t];this.setField(t,i)}}getValues(){return this._values}destroy(){this._marker&&(this._markerExternal?(this._marker.removeEventListener("click",this._onMouseClickedExternalMarker),this._marker.removeEventListener("mouseenter",this._onMouseEnterExternalMarker),this._marker.removeEventListener("mouseleave",this._onMouseLeaveExternalMarker),this._marker=null):this._marker.parentNode.removeChild(this._marker)),this._label&&(this._labelExternal||this._label.parentNode.removeChild(this._label),this._label=null),this.scene.off(this._onTick),super.destroy()}}const tempVec3a$12=math.vec3(),tempVec3b$a=math.vec3(),tempVec3c$7=math.vec3();class AnnotationsPlugin extends Plugin{constructor(e,t){super("Annotations",e),this._labelHTML=t.labelHTML||"<div></div>",this._markerHTML=t.markerHTML||"<div></div>",this._container=t.container||document.body,this._values=t.values||{},this.annotations={},this.surfaceOffset=t.surfaceOffset}send(e,t){if("clearAnnotations"===e)this.clear()}set surfaceOffset(e){null==e&&(e=.3),this._surfaceOffset=e}get surfaceOffset(){return this._surfaceOffset}createAnnotation(e){var t,i;if(this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id),e.pickResult=e.pickResult||e.pickRecord,e.pickResult){const s=e.pickResult;if(s.worldPos&&s.worldNormal){const e=math.normalizeVec3(s.worldNormal,tempVec3a$12),r=math.mulVec3Scalar(e,this._surfaceOffset,tempVec3b$a);t=math.addVec3(s.worldPos,r,tempVec3c$7),i=s.entity}else this.error("Param 'pickResult' does not have both worldPos and worldNormal")}else t=e.worldPos,i=e.entity;var s=null;e.markerElementId&&((s=document.getElementById(e.markerElementId))||this.error("Can't find DOM element for 'markerElementId' value '"+e.markerElementId+"' - defaulting to internally-generated empty DIV"));var r=null;e.labelElementId&&((r=document.getElementById(e.labelElementId))||this.error("Can't find DOM element for 'labelElementId' value '"+e.labelElementId+"' - defaulting to internally-generated empty DIV"));const o=new Annotation(this.viewer.scene,{id:e.id,plugin:this,entity:i,worldPos:t,container:this._container,markerElement:s,labelElement:r,markerHTML:e.markerHTML||this._markerHTML,labelHTML:e.labelHTML||this._labelHTML,occludable:e.occludable,values:utils.apply(e.values,utils.apply(this._values,{})),markerShown:e.markerShown,labelShown:e.labelShown,eye:e.eye,look:e.look,up:e.up,projection:e.projection,visible:!1!==e.visible});return this.annotations[o.id]=o,o.on("destroyed",(()=>{delete this.annotations[o.id],this.fire("annotationDestroyed",o.id)})),this.fire("annotationCreated",o.id),o}destroyAnnotation(e){var t=this.annotations[e];t?t.destroy():this.log("Annotation not found: "+e)}clear(){const e=Object.keys(this.annotations);for(var t=0,i=e.length;t<i;t++)this.destroyAnnotation(e[t])}destroy(){this.clear(),super.destroy()}}const defaultCSS=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }";class Spinner extends Component{get type(){return"Spinner"}constructor(e,t={}){super(e,t),this._canvas=t.canvas,this._element=null,this._isCustom=!1,t.elementId&&(this._element=document.getElementById(t.elementId),this._element?this._adjustPosition():this.error("Can't find given Spinner HTML element: '"+t.elementId+"' - will automatically create default element")),this._element||this._createDefaultSpinner(),this.processes=0}_createDefaultSpinner(){this._injectDefaultCSS();const e=document.createElement("div"),t=e.style;t["z-index"]="9000",t.position="absolute",e.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>',this._canvas.parentElement.appendChild(e),this._element=e,this._isCustom=!1,this._adjustPosition()}_injectDefaultCSS(){const e="xeokit-spinner-css";if(document.getElementById(e))return;const t=document.createElement("style");t.innerHTML=defaultCSS,t.id=e,document.body.appendChild(t)}_adjustPosition(){if(this._isCustom)return;const e=this._canvas,t=this._element,i=t.style;i.left=e.offsetLeft+.5*e.clientWidth-.5*t.clientWidth+"px",i.top=e.offsetTop+.5*e.clientHeight-.5*t.clientHeight+"px"}set processes(e){if(e=e||0,this._processes===e)return;if(e<0)return;const t=this._processes;this._processes=e;const i=this._element;i&&(i.style.visibility=this._processes>0?"visible":"hidden"),this.fire("processes",this._processes),0===this._processes&&this._processes!==t&&this.fire("zeroProcesses",this._processes)}get processes(){return this._processes}_destroy(){this._element&&!this._isCustom&&(this._element.parentNode.removeChild(this._element),this._element=null);const e=document.getElementById("xeokit-spinner-css");e&&e.parentNode.removeChild(e)}}const WEBGL_INFO$1={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},canvas=document.createElement("canvas");if(canvas){const e=canvas.getContext("webgl",{antialias:!0})||canvas.getContext("experimental-webgl",{antialias:!0});WEBGL_INFO$1.WEBGL=!!e,WEBGL_INFO$1.WEBGL&&(WEBGL_INFO$1.ANTIALIAS=e.getContextAttributes().antialias,e.getShaderPrecisionFormat?e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0?WEBGL_INFO$1.FS_MAX_FLOAT_PRECISION="highp":e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?WEBGL_INFO$1.FS_MAX_FLOAT_PRECISION="mediump":WEBGL_INFO$1.FS_MAX_FLOAT_PRECISION="lowp":WEBGL_INFO$1.FS_MAX_FLOAT_PRECISION="mediump",WEBGL_INFO$1.DEPTH_BUFFER_BITS=e.getParameter(e.DEPTH_BITS),WEBGL_INFO$1.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),WEBGL_INFO$1.MAX_CUBE_MAP_SIZE=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),WEBGL_INFO$1.MAX_RENDERBUFFER_SIZE=e.getParameter(e.MAX_RENDERBUFFER_SIZE),WEBGL_INFO$1.MAX_TEXTURE_UNITS=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),WEBGL_INFO$1.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),WEBGL_INFO$1.MAX_VERTEX_ATTRIBS=e.getParameter(e.MAX_VERTEX_ATTRIBS),WEBGL_INFO$1.MAX_VERTEX_UNIFORM_VECTORS=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),WEBGL_INFO$1.MAX_FRAGMENT_UNIFORM_VECTORS=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),WEBGL_INFO$1.MAX_VARYING_VECTORS=e.getParameter(e.MAX_VARYING_VECTORS),e.getSupportedExtensions().forEach((function(e){WEBGL_INFO$1.SUPPORTED_EXTENSIONS[e]=!0})),WEBGL_INFO$1.depthTexturesSupported=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}const WEBGL_CONTEXT_NAMES=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"];class Canvas extends Component{constructor(e,t={}){super(e,t),this._backgroundColor=math.vec3([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),this._backgroundColorFromAmbientLight=!!t.backgroundColorFromAmbientLight,this.canvas=t.canvas,this.gl=null,this.webgl2=!1,this.transparent=!!t.transparent,this.contextAttr=t.contextAttr||{},this.contextAttr.alpha=this.transparent,this.contextAttr.preserveDrawingBuffer=!!this.contextAttr.preserveDrawingBuffer,this.contextAttr.stencil=!1,this.contextAttr.premultipliedAlpha=!!this.contextAttr.premultipliedAlpha,this.contextAttr.antialias=!1!==this.contextAttr.antialias,this.resolutionScale=t.resolutionScale,this.canvas.width=Math.round(this.canvas.clientWidth*this._resolutionScale),this.canvas.height=Math.round(this.canvas.clientHeight*this._resolutionScale),this.boundary=[this.canvas.offsetLeft,this.canvas.offsetTop,this.canvas.clientWidth,this.canvas.clientHeight],this._initWebGL(t);const i=this;this.canvas.addEventListener("webglcontextlost",this._webglcontextlostListener=function(e){console.time("webglcontextrestored"),i.scene._webglContextLost(),i.fire("webglcontextlost"),e.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",this._webglcontextrestoredListener=function(e){i._initWebGL(),i.gl&&(i.scene._webglContextRestored(i.gl),i.fire("webglcontextrestored",i.gl),e.preventDefault()),console.timeEnd("webglcontextrestored")},!1);let s=null,r=null,o=null,a=null,n=null,h=null,l=null,c=null;this._tick=this.scene.on("tick",(()=>{const e=this.canvas,t=this._resolutionScale!==s,i=window.innerWidth!==r||window.innerHeight!==o,u=e.clientWidth!==a||e.clientHeight!==n,p=e.offsetLeft!==h||e.offsetTop!==l,d=e.parentElement;if(t||i||u||p||d!==c){if(this._spinner._adjustPosition(),t||u||p){const i=e.clientWidth,s=e.clientHeight;if(t||u){let t,i=0;for(const e in core.scenes)core.scenes.hasOwnProperty(e)&&(t=core.scenes[e],i+=Math.round(t.canvas.canvas.clientWidth*this._resolutionScale*(t.canvas.canvas.clientHeight*this._resolutionScale)));stats.memory.pixels=i,e.width=Math.round(e.clientWidth*this._resolutionScale),e.height=Math.round(e.clientHeight*this._resolutionScale)}const r=this.boundary;r[0]=e.offsetLeft,r[1]=e.offsetTop,r[2]=i,r[3]=s,t&&!u||this.fire("boundary",r),a=i,n=s}t&&(s=this._resolutionScale),i&&(r=window.innerWidth,o=window.innerHeight),p&&(h=e.offsetLeft,l=e.offsetTop),c=d}})),this._spinner=new Spinner(this.scene,{canvas:this.canvas,elementId:t.spinnerElementId})}get type(){return"Canvas"}get backgroundColorFromAmbientLight(){return this._backgroundColorFromAmbientLight}set backgroundColorFromAmbientLight(e){this._backgroundColorFromAmbientLight=!1!==e,this.glRedraw()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){e?(this._backgroundColor[0]=e[0],this._backgroundColor[1]=e[1],this._backgroundColor[2]=e[2]):(this._backgroundColor[0]=1,this._backgroundColor[1]=1,this._backgroundColor[2]=1),this.glRedraw()}get resolutionScale(){return this._resolutionScale}set resolutionScale(e){if((e=e||1)===this._resolutionScale)return;this._resolutionScale=e;const t=this.canvas;t.width=Math.round(t.clientWidth*this._resolutionScale),t.height=Math.round(t.clientHeight*this._resolutionScale),this.glRedraw()}get spinner(){return this._spinner}_createCanvas(){const e="xeokit-canvas-"+math.createUUID(),t=document.getElementsByTagName("body")[0],i=document.createElement("div"),s=i.style;s.height="100%",s.width="100%",s.padding="0",s.margin="0",s.background="rgba(0,0,0,0);",s.float="left",s.left="0",s.top="0",s.position="absolute",s.opacity="1.0",s["z-index"]="-10000",i.innerHTML+='<canvas id="'+e+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>',t.appendChild(i),this.canvas=document.getElementById(e)}_getElementXY(e){let t=0,i=0;for(;e;)t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:i}}_initWebGL(){if(!this.gl)for(let e=0;!this.gl&&e<WEBGL_CONTEXT_NAMES.length;e++)try{this.gl=this.canvas.getContext(WEBGL_CONTEXT_NAMES[e],this.contextAttr)}catch(e){}if(this.gl||(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0)),this.gl)if(this.webgl2)this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST);else{if(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_standard_derivatives){const e=this.gl.getExtension("OES_standard_derivatives");this.gl.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,this.gl.FASTEST)}WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&this.gl.getExtension("EXT_frag_depth"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&this.gl.getExtension("WEBGL_depth_texture")}}getSnapshot(e){throw"Canvas#getSnapshot() has been replaced by Viewer#getSnapshot() - use that method instead."}readPixels(e,t,i,s){return this.scene._renderer.readPixels(e,t,i,s)}loseWebGLContext(){this.canvas.loseContext&&this.canvas.loseContext()}destroy(){this.scene.off(this._tick),this._spinner._destroy(),this.canvas.removeEventListener("webglcontextlost",this._webglcontextlostListener),this.canvas.removeEventListener("webglcontextrestored",this._webglcontextrestoredListener),this.gl=null,super.destroy()}}class FrameContext{constructor(e){this._scene=e,this._matPool=[],this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.reset()}reset(){this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.gl=this._scene.canvas.gl,this.lastProgramId=null,this.pbrEnabled=!1,this.colorTextureEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.drawElements=0,this.drawArrays=0,this.useProgram=0,this.bindTexture=0,this.bindArray=0,this.pass=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1}getRTCViewMatrix(e,t){let i=this._rtcViewMats[e];return i||(i=this._getNewMat(),createRTCViewMat(this._scene.camera.viewMatrix,t,i),this._rtcViewMats[e]=i),i}getRTCPickViewMatrix(e,t){let i=this._rtcPickViewMats[e];if(!i){i=this._getNewMat();const s=this.pickViewMatrix||this._scene.camera.viewMatrix;createRTCViewMat(s,t,i),this._rtcPickViewMats[e]=i}return i}_getNewMat(){let e=this._matPool[this._matPoolNextFreeIndex];return e||(e=math.mat4(),this._matPool[this._matPoolNextFreeIndex]=e),this._matPoolNextFreeIndex++,e}}class PickResult{constructor(){this.entity=null,this.primitive=null,this.primIndex=-1,this.pickSurfacePrecision=!1,this._canvasPos=new Int16Array([0,0]),this._origin=new Float64Array([0,0,0]),this._direction=new Float64Array([0,0,0]),this._indices=new Int32Array(3),this._localPos=new Float64Array([0,0,0]),this._worldPos=new Float64Array([0,0,0]),this._viewPos=new Float64Array([0,0,0]),this._bary=new Float64Array([0,0,0]),this._worldNormal=new Float64Array([0,0,0]),this._uv=new Float64Array([0,0]),this.reset()}get canvasPos(){return this._gotCanvasPos?this._canvasPos:null}set canvasPos(e){e?(this._canvasPos[0]=e[0],this._canvasPos[1]=e[1],this._gotCanvasPos=!0):this._gotCanvasPos=!1}get origin(){return this._gotOrigin?this._origin:null}set origin(e){e?(this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this._gotOrigin=!0):this._gotOrigin=!1}get direction(){return this._gotDirection?this._direction:null}set direction(e){e?(this._direction[0]=e[0],this._direction[1]=e[1],this._direction[2]=e[2],this._gotDirection=!0):this._gotDirection=!1}get indices(){return this.entity&&this._gotIndices?this._indices:null}set indices(e){e?(this._indices[0]=e[0],this._indices[1]=e[1],this._indices[2]=e[2],this._gotIndices=!0):this._gotIndices=!1}get localPos(){return this.entity&&this._gotLocalPos?this._localPos:null}set localPos(e){e?(this._localPos[0]=e[0],this._localPos[1]=e[1],this._localPos[2]=e[2],this._gotLocalPos=!0):this._gotLocalPos=!1}get worldPos(){return this.entity&&this._gotWorldPos?this._worldPos:null}set worldPos(e){e?(this._worldPos[0]=e[0],this._worldPos[1]=e[1],this._worldPos[2]=e[2],this._gotWorldPos=!0):this._gotWorldPos=!1}get viewPos(){return this.entity&&this._gotViewPos?this._viewPos:null}set viewPos(e){e?(this._viewPos[0]=e[0],this._viewPos[1]=e[1],this._viewPos[2]=e[2],this._gotViewPos=!0):this._gotViewPos=!1}get bary(){return this.entity&&this._gotBary?this._bary:null}set bary(e){e?(this._bary[0]=e[0],this._bary[1]=e[1],this._bary[2]=e[2],this._gotBary=!0):this._gotBary=!1}get worldNormal(){return this.entity&&this._gotWorldNormal?this._worldNormal:null}set worldNormal(e){e?(this._worldNormal[0]=e[0],this._worldNormal[1]=e[1],this._worldNormal[2]=e[2],this._gotWorldNormal=!0):this._gotWorldNormal=!1}get uv(){return this.entity&&this._gotUV?this._uv:null}set uv(e){e?(this._uv[0]=e[0],this._uv[1]=e[1],this._gotUV=!0):this._gotUV=!1}reset(){this.entity=null,this.primIndex=-1,this.primitive=null,this.pickSurfacePrecision=!1,this._gotCanvasPos=!1,this._gotOrigin=!1,this._gotDirection=!1,this._gotIndices=!1,this._gotLocalPos=!1,this._gotWorldPos=!1,this._gotViewPos=!1,this._gotBary=!1,this._gotWorldNormal=!1,this._gotUV=!1}}class Shader{constructor(e,t,i){if(this.allocated=!1,this.compiled=!1,this.handle=e.createShader(t),this.handle){if(this.allocated=!0,e.shaderSource(this.handle,i),e.compileShader(this.handle),this.compiled=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.compiled&&!e.isContextLost()){const t=i.split("\n"),s=[];for(let e=0;e<t.length;e++)s.push(e+1+": "+t[e]+"\n");this.errors=[],this.errors.push(""),this.errors.push(e.getShaderInfoLog(this.handle)),this.errors=this.errors.concat(s.join(""))}}else this.errors=["Failed to allocate"]}destroy(){}}class Sampler{constructor(e,t){this.bindTexture=function(i,s){return!!i.bind(s)&&(e.uniform1i(t,s),!0)}}}class Attribute{constructor(e,t){this._gl=e,this.location=t}bindArrayBuffer(e){e&&(e.bind(),this._gl.enableVertexAttribArray(this.location),this._gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))}}const ids$4=new Map$1({});function joinSansComments(e){const t=[];let i,s;for(let r=0,o=e.length;r<o;r++)i=e[r],s=i.indexOf("/"),s>0&&"/"===i.charAt(s+1)&&(i=i.substring(0,s)),t.push(i);return t.join("\n")}function logErrors(e){console.error(e.join("\n"))}class Program{constructor(e,t){this.id=ids$4.addItem({}),this.source=t,this.init(e)}init(e){if(this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=null,this.uniforms={},this.samplers={},this.attributes={},this._vertexShader=new Shader(e,e.VERTEX_SHADER,joinSansComments(this.source.vertex)),this._fragmentShader=new Shader(e,e.FRAGMENT_SHADER,joinSansComments(this.source.fragment)),!this._vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this._vertexShader.errors),void logErrors(this.errors);if(!this._fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this._fragmentShader.errors),void logErrors(this.errors);if(this.allocated=!0,!this._vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this._vertexShader.errors),void logErrors(this.errors);if(!this._fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this._fragmentShader.errors),void logErrors(this.errors);let t,i,s,r,o;if(this.compiled=!0,this.handle=e.createProgram(),!this.handle)return void(this.errors=["Failed to allocate program"]);if(e.attachShader(this.handle,this._vertexShader.handle),e.attachShader(this.handle,this._fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void logErrors(this.errors);const a=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS);for(i=0;i<a;++i)s=e.getActiveUniform(this.handle,i),s&&(r=s.name,"\0"===r[r.length-1]&&(r=r.substr(0,r.length-1)),o=e.getUniformLocation(this.handle,r),s.type===e.SAMPLER_2D||s.type===e.SAMPLER_CUBE||35682===s.type?this.samplers[r]=new Sampler(e,o):this.uniforms[r]=o);const n=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES);for(i=0;i<n;i++)t=e.getActiveAttrib(this.handle,i),t&&(o=e.getAttribLocation(this.handle,t.name),this.attributes[t.name]=new Attribute(e,o));this.allocated=!0}bind(){this.allocated&&this.gl.useProgram(this.handle)}getLocation(e){if(this.allocated)return this.uniforms[e]}getAttribute(e){if(this.allocated)return this.attributes[e]}bindTexture(e,t,i){if(!this.allocated)return!1;const s=this.samplers[e];return!!s&&s.bindTexture(t,i)}destroy(){this.allocated&&(ids$4.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this.attributes=null,this.uniforms=null,this.samplers=null,this.allocated=!1)}}class ArrayBuf{constructor(e,t,i,s,r,o,a,n,h){switch(this._gl=e,this.type=t,this.allocated=!1,i.constructor){case Uint8Array:this.itemType=e.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=e.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=e.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=e.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=e.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=e.INT,this.itemByteSize=4;break;default:this.itemType=e.FLOAT,this.itemByteSize=4}this.usage=o,this.length=0,this.dataLength=s,this.numItems=0,this.itemSize=r,this.normalized=!!a,this.stride=n||0,this.offset=h||0,this._allocate(i)}_allocate(e){if(this.allocated=!1,this._handle=this._gl.createBuffer(),!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,this._handle),this._gl.bufferData(this.type,e.length>this.dataLength?e.slice(0,this.dataLength):e,this.usage),this._gl.bindBuffer(this.type,null),this.length=e.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}setData(e,t){this.allocated&&(e.length+(t||0)>this.length?(this.destroy(),this._allocate(e)):(this._gl.bindBuffer(this.type,this._handle),t||0===t?this._gl.bufferSubData(this.type,t*this.itemByteSize,e):this._gl.bufferData(this.type,e,this.usage),this._gl.bindBuffer(this.type,null)))}bind(){this.allocated&&this._gl.bindBuffer(this.type,this._handle)}unbind(){this.allocated&&this._gl.bindBuffer(this.type,null)}destroy(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}class OcclusionLayer{constructor(e,t){this.scene=e,this.aabb=math.AABB3(),this.origin=math.vec3(t),this.originHash=this.origin.join(),this.numMarkers=0,this.markers={},this.markerList=[],this.markerIndices={},this.positions=[],this.indices=[],this.positionsBuf=null,this.lenPositionsBuf=0,this.indicesBuf=null,this.sectionPlanesActive=[],this.culledBySectionPlanes=!1,this.occlusionTestList=[],this.lenOcclusionTestList=0,this.pixels=[],this.aabbDirty=!1,this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!1}addMarker(e){this.markers[e.id]=e,this.markerListDirty=!0,this.numMarkers++}markerWorldPosUpdated(e){if(!this.markers[e.id])return;const t=this.markerIndices[e.id];this.positions[3*t+0]=e.worldPos[0],this.positions[3*t+1]=e.worldPos[1],this.positions[3*t+2]=e.worldPos[2],this.positionsDirty=!0}removeMarker(e){delete this.markers[e.id],this.markerListDirty=!0,this.numMarkers--}update(){this.markerListDirty&&(this._buildMarkerList(),this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!0),this.positionsDirty&&(this._buildPositions(),this.positionsDirty=!1,this.aabbDirty=!0,this.vbosDirty=!0),this.aabbDirty&&(this._buildAABB(),this.aabbDirty=!1),this.vbosDirty&&(this._buildVBOs(),this.vbosDirty=!1),this.occlusionTestListDirty&&this._buildOcclusionTestList(),this._updateActiveSectionPlanes()}_buildMarkerList(){for(var e in this.numMarkers=0,this.markers)this.markers.hasOwnProperty(e)&&(this.markerList[this.numMarkers]=this.markers[e],this.markerIndices[e]=this.numMarkers,this.numMarkers++);this.markerList.length=this.numMarkers}_buildPositions(){let e=0;for(let t=0;t<this.numMarkers;t++)if(this.markerList[t]){const i=this.markerList[t].worldPos;this.positions[e++]=i[0],this.positions[e++]=i[1],this.positions[e++]=i[2],this.indices[t]=t}this.positions.length=3*this.numMarkers,this.indices.length=this.numMarkers}_buildAABB(){const e=this.aabb;math.collapseAABB3(e),math.expandAABB3Points3(e,this.positions);const t=this.origin;e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[0],e[4]+=t[1],e[5]+=t[2]}_buildVBOs(){if(this.positionsBuf){if(this.lenPositionsBuf===this.positions.length)return void this.positionsBuf.setData(this.positions);this.positionsBuf.destroy(),this.positionsBuf=null,this.indicesBuf.destroy(),this.indicesBuf=null}const e=this.scene.canvas.gl,t=3*this.numMarkers,i=this.numMarkers;this.positionsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this.positions),t,3,e.STATIC_DRAW),this.indicesBuf=new ArrayBuf(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),i,1,e.STATIC_DRAW),this.lenPositionsBuf=this.positions.length}_buildOcclusionTestList(){const e=this.scene.canvas,t=this.scene.camera.perspective.near,i=e.boundary,s=i[2],r=i[3];let o=0;this.lenOcclusionTestList=0;for(let e=0;e<this.numMarkers;e++){const i=this.markerList[e];if(i.viewPos[2]>-t){i._setVisible(!1);continue}const a=i.canvasPos,n=a[0],h=a[1];n+10<0||h+10<0||n-10>s||h-10>r?i._setVisible(!1):!i.entity||i.entity.visible?i.occludable?(this.occlusionTestList[this.lenOcclusionTestList++]=i,this.pixels[o++]=n,this.pixels[o++]=h):i._setVisible(!0):i._setVisible(!1)}}_updateActiveSectionPlanes(){const e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(let i=0;i<t;i++){const t=e[i];if(t.active){const e=math.planeAABB3Intersect(t.dir,t.dist,this.aabb);if(-1===e)return void(this.culledBySectionPlanes=!0);const s=0===e;this.sectionPlanesActive[i]=s}else this.sectionPlanesActive[i]=!1}this.culledBySectionPlanes=!1}destroy(){this.markers={},this.markerList.length=0,this.positionsBuf&&this.positionsBuf.destroy(),this.indicesBuf&&this.indicesBuf.destroy()}}const MARKER_COLOR=math.vec3([1,0,0]),POINT_SIZE=20,MARKER_SPRITE_CLIPZ_OFFSET=-.001,tempVec3a$11=math.vec3();class OcclusionTester{constructor(e,t){this._scene=e,this._renderBufferManager=t,this._occlusionLayers={},this._occlusionLayersList=[],this._occlusionLayersListDirty=!1,this._shaderSource=null,this._program=null,this._shaderSourceHash=null,this._shaderSourceDirty=!0,this._programDirty=!1,this._markersToOcclusionLayersMap={},this._onCameraViewMatrix=e.camera.on("viewMatrix",(()=>{this._occlusionTestListDirty=!0})),this._onCameraProjMatrix=e.camera.on("projMatrix",(()=>{this._occlusionTestListDirty=!0})),this._onCanvasBoundary=e.canvas.on("boundary",(()=>{this._occlusionTestListDirty=!0}))}addMarker(e){const t=e.origin.join();let i=this._occlusionLayers[t];i||(i=new OcclusionLayer(this._scene,e.origin),this._occlusionLayers[i.originHash]=i,this._occlusionLayersListDirty=!0),i.addMarker(e),this._markersToOcclusionLayersMap[e.id]=i,this._occlusionTestListDirty=!0}markerWorldPosUpdated(e){const t=this._markersToOcclusionLayersMap[e.id];if(!t)return void e.error("Marker has not been added to OcclusionTester");const i=e.origin.join();if(i!==t.originHash){1===t.numMarkers?(t.destroy(),delete this._occlusionLayers[t.originHash],this._occlusionLayersListDirty=!0):t.removeMarker(e);let s=this._occlusionLayers[i];s||(s=new OcclusionLayer(this._scene,e.origin),this._occlusionLayers[i]=t,this._occlusionLayersListDirty=!0),s.addMarker(e),this._markersToOcclusionLayersMap[e.id]=s}else t.markerWorldPosUpdated(e)}removeMarker(e){const t=e.origin.join();let i=this._occlusionLayers[t];i&&(1===i.numMarkers?(i.destroy(),delete this._occlusionLayers[i.originHash],this._occlusionLayersListDirty=!0):i.removeMarker(e),delete this._markersToOcclusionLayersMap[e.id])}get needOcclusionTest(){return this._occlusionTestListDirty}bindRenderBuf(){const e=[this._scene.canvas.canvas.id,this._scene._sectionPlanesState.getHash()].join(";");if(e!==this._shaderSourceHash&&(this._shaderSourceHash=e,this._shaderSourceDirty=!0),this._shaderSourceDirty&&(this._buildShaderSource(),this._shaderSourceDirty=!1,this._programDirty=!0),this._programDirty&&(this._buildProgram(),this._programDirty=!1,this._occlusionTestListDirty=!0),this._occlusionLayersListDirty&&(this._buildOcclusionLayersList(),this._occlusionLayersListDirty=!1),this._occlusionTestListDirty){for(let e=0,t=this._occlusionLayersList.length;e<t;e++){this._occlusionLayersList[e].occlusionTestListDirty=!0}this._occlusionTestListDirty=!1}this._readPixelBuf=this._renderBufferManager.getRenderBuffer("occlusionReadPix"),this._readPixelBuf.bind(),this._readPixelBuf.clear()}_buildOcclusionLayersList(){let e=0;for(let t in this._occlusionLayers)this._occlusionLayers.hasOwnProperty(t)&&(this._occlusionLayersList[e++]=this._occlusionLayers[t]);this._occlusionLayersList.length=e}_buildShaderSource(){this._shaderSource={vertex:this._buildVertexShaderSource(),fragment:this._buildFragmentShaderSource()}}_buildVertexShaderSource(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// OcclusionTester vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("attribute vec3 position;"),i.push("uniform mat4 modelMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),t&&i.push("varying vec4 vWorldPosition;"),i.push("void main(void) {"),i.push("vec4 worldPosition = vec4(position, 1.0); "),i.push("   vec4 viewPosition = viewMatrix * worldPosition;"),t&&i.push("   vWorldPosition = worldPosition;"),i.push("   vec4 clipPos = projMatrix * viewPosition;"),i.push("   gl_PointSize = 20.0;"),e.logarithmicDepthBufferEnabled?WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")):i.push("clipPos.z += -0.001;"),i.push("   gl_Position = clipPos;"),i.push("}"),i}_buildFragmentShaderSource(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// OcclusionTester fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("void main(void) {"),i){s.push("  float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("if (sectionPlaneActive"+r+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); "),s.push("}"),s}_buildProgram(){this._program&&this._program.destroy();const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}drawMarkers(){const e=this._scene,t=e.canvas.gl,i=this._program,s=e._sectionPlanesState,r=e.camera,o=e.camera.project;if(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&e.logarithmicDepthBufferEnabled&&t.getExtension("EXT_frag_depth"),i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,r._project._state.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}for(let e=0,i=this._occlusionLayersList.length;e<i;e++){const i=this._occlusionLayersList[e];if(i.update(),i.culledBySectionPlanes)continue;const o=i.origin;t.uniformMatrix4fv(this._uViewMatrix,!1,createRTCViewMat(r.viewMatrix,o));const a=s.sectionPlanes.length;if(a>0){const e=s.sectionPlanes;for(let s=0;s<a;s++){const r=this._uSectionPlanes[s];if(r){const a=i.sectionPlanesActive[s];if(t.uniform1i(r.active,a?1:0),a){const i=e[s];t.uniform3fv(r.pos,getPlaneRTCPos(i.dist,i.dir,o,tempVec3a$11)),t.uniform3fv(r.dir,i.dir)}}}}this._aPosition.bindArrayBuffer(i.positionsBuf);const n=i.indicesBuf;n.bind(),t.drawElements(t.POINTS,n.numItems,n.itemType,0)}}doOcclusionTest(){{const e=this._scene.canvas.resolutionScale,t=255*MARKER_COLOR[0],i=255*MARKER_COLOR[1],s=255*MARKER_COLOR[2];for(let r=0,o=this._occlusionLayersList.length;r<o;r++){const o=this._occlusionLayersList[r];for(let r=0;r<o.lenOcclusionTestList;r++){const a=o.occlusionTestList[r],n=2*r,h=this._readPixelBuf.read(Math.round(o.pixels[n]*e),Math.round(o.pixels[n+1]*e)),l=h[0]===t&&h[1]===i&&h[2]===s;a._setVisible(l)}}}}unbindRenderBuf(){this._readPixelBuf.unbind()}destroy(){if(!this.destroyed){for(let e=0,t=this._occlusionLayersList.length;e<t;e++){this._occlusionLayersList[e].destroy()}this._program&&this._program.destroy(),this._scene.camera.off(this._onCameraViewMatrix),this._scene.camera.off(this._onCameraProjMatrix),this._scene.canvas.off(this._onCanvasBoundary),this.destroyed=!0}}}const tempVec2=math.vec2();class SAOOcclusionRenderer{constructor(e){this._scene=e,this._numSamples=null,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uScale=null,this._uIntensity=null,this._uBias=null,this._uKernelRadius=null,this._uMinResolution=null,this._uRandomSeed=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null}render(e){if(this._build(),this._programError)return;this._getInverseProjectMat||(this._getInverseProjectMat=(()=>{let e=!0;this._scene.camera.on("projMatrix",(function(){e=!0}));const t=math.mat4();return()=>(e&&math.inverseMat4(s.camera.projMatrix,t),t)})());const t=this._scene.canvas.gl,i=this._program,s=this._scene,r=s.sao,o=t.drawingBufferWidth,a=t.drawingBufferHeight,n=s.camera.project._state,h=n.near,l=n.far,c=n.matrix,u=this._getInverseProjectMat(),p=Math.random(),d="perspective"===s.camera.projection;tempVec2[0]=o,tempVec2[1]=a,t.getExtension("OES_standard_derivatives"),t.viewport(0,0,o,a),t.clearColor(0,0,0,1),t.disable(t.DEPTH_TEST),t.disable(t.BLEND),t.frontFace(t.CCW),t.clear(t.COLOR_BUFFER_BIT),i.bind(),t.uniform1f(this._uCameraNear,h),t.uniform1f(this._uCameraFar,l),t.uniformMatrix4fv(this._uCameraProjectionMatrix,!1,c),t.uniformMatrix4fv(this._uCameraInverseProjectionMatrix,!1,u),t.uniform1i(this._uPerspective,d),t.uniform1f(this._uScale,r.scale*(l/5)),t.uniform1f(this._uIntensity,r.intensity),t.uniform1f(this._uBias,r.bias),t.uniform1f(this._uKernelRadius,r.kernelRadius),t.uniform1f(this._uMinResolution,r.minResolution),t.uniform2fv(this._uViewport,tempVec2),t.uniform1f(this._uRandomSeed,p);const m=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?e.getDepthTexture():e.getTexture();i.bindTexture(this._uDepthTexture,m,0),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),t.drawElements(t.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}_build(){let e=!1;const t=this._scene.sao;if(t.numSamples!==this._numSamples&&(this._numSamples=Math.floor(t.numSamples),e=!0),!e)return;const i=this._scene.canvas.gl;if(this._program&&(this._program.destroy(),this._program=null),this._program=new Program(i,{vertex:["precision highp float;\n                    precision highp int;\n                    \n                    attribute vec3 aPosition;\n                    attribute vec2 aUV;            \n                    \n                    varying vec2 vUV;\n                    \n                    void main () {\n                        gl_Position = vec4(aPosition, 1.0);\n                        vUV = aUV;\n                    }"],fragment:[`#extension GL_OES_standard_derivatives : require              \n                precision highp float;\n                precision highp int;           \n                \n                #define NORMAL_TEXTURE 0\n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n                #define NUM_SAMPLES ${this._numSamples}\n                #define NUM_RINGS 4              \n            \n                varying vec2        vUV;\n            \n                uniform sampler2D   uDepthTexture;\n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;\n                uniform mat4        uProjectMatrix;\n                uniform mat4        uInverseProjectMatrix;\n                \n                uniform bool        uPerspective;\n\n                uniform float       uScale;\n                uniform float       uIntensity;\n                uniform float       uBias;\n                uniform float       uKernelRadius;\n                uniform float       uMinResolution;\n                uniform vec2        uViewport;\n                uniform float       uRandomSeed;\n\n                float pow2( const in float x ) { return x*x; }\n                \n                highp float rand( const in vec2 uv ) {\n                    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n                    highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n                    return fract(sin(sn) * c);\n                }\n\n                vec3 packNormalToRGB( const in vec3 normal ) {\n                    return normalize( normal ) * 0.5 + 0.5;\n                }\n\n                vec3 unpackRGBToNormal( const in vec3 rgb ) {\n                    return 2.0 * rgb.xyz - 1.0;\n                }\n\n                const float packUpscale = 256. / 255.;\n                const float unpackDownScale = 255. / 256.; \n\n                const vec3 packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4 unPackFactors = unpackDownScale / vec4( packFactors, 1. );   \n\n                const float shiftRights = 1. / 256.;\n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float unpackRGBAToFloat( const in vec4 v ) {                   \n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unPackFactors );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n                    return ( near * far ) / ( ( far - near ) * invClipZ - far );\n                }\n\n                float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n                    return linearClipZ * ( near - far ) - near;\n                }\n                \n                float getDepth( const in vec2 screenPosition ) {`+(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?"return texture2D(uDepthTexture, screenPosition).r;":"return unpackRGBAToFloat(texture2D( uDepthTexture, screenPosition));")+"}\n\n                float getViewZ( const in float depth ) {\n                     if (uPerspective) {\n                         return perspectiveDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     } else {\n                        return orthographicDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     }\n                }\n\n                vec3 getViewPos( const in vec2 screenPos, const in float depth, const in float viewZ ) {\n                \tfloat clipW = uProjectMatrix[2][3] * viewZ + uProjectMatrix[3][3];\n                \tvec4 clipPosition = vec4( ( vec3( screenPos, depth ) - 0.5 ) * 2.0, 1.0 );\n                \tclipPosition *= clipW; \n                \treturn ( uInverseProjectMatrix * clipPosition ).xyz;\n                }\n\n                vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPos ) {               \n                    return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n                }\n\n                float scaleDividedByCameraFar;\n                float minResolutionMultipliedByCameraFar;\n\n                float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n                \tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n                \tfloat viewDistance = length( viewDelta );\n                \tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n                \treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - uBias) / (1.0 + pow2( scaledScreenDistance ) );\n                }\n\n                const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n                const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n                float getAmbientOcclusion( const in vec3 centerViewPosition ) {\n            \n                \tscaleDividedByCameraFar = uScale / uCameraFar;\n                \tminResolutionMultipliedByCameraFar = uMinResolution * uCameraFar;\n                \tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUV );\n\n                \tfloat angle = rand( vUV + uRandomSeed ) * PI2;\n                \tvec2 radius = vec2( uKernelRadius * INV_NUM_SAMPLES ) / uViewport;\n                \tvec2 radiusStep = radius;\n\n                \tfloat occlusionSum = 0.0;\n                \tfloat weightSum = 0.0;\n\n                \tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n                \t\tvec2 sampleUv = vUV + vec2( cos( angle ), sin( angle ) ) * radius;\n                \t\tradius += radiusStep;\n                \t\tangle += ANGLE_STEP;\n\n                \t\tfloat sampleDepth = getDepth( sampleUv );\n                \t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n                \t\t\tcontinue;\n                \t\t}\n\n                \t\tfloat sampleViewZ = getViewZ( sampleDepth );\n                \t\tvec3 sampleViewPosition = getViewPos( sampleUv, sampleDepth, sampleViewZ );\n                \t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n                \t\tweightSum += 1.0;\n                \t}\n\n                \tif( weightSum == 0.0 ) discard;\n\n                \treturn occlusionSum * ( uIntensity / weightSum );\n                }\n\n                void main() {\n                \n                \tfloat centerDepth = getDepth( vUV );\n                \t\n                \tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n                \t\tdiscard;\n                \t}\n\n                \tfloat centerViewZ = getViewZ( centerDepth );\n                \tvec3 viewPosition = getViewPos( vUV, centerDepth, centerViewZ );\n\n                \tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n                \n                \tgl_FragColor = packFloatToRGBA(  1.0- ambientOcclusion );\n                }"]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);const s=new Float32Array([1,1,0,1,0,0,1,0]),r=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),o=new Uint8Array([0,1,2,0,2,3]);this._positionsBuf=new ArrayBuf(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),this._uvBuf=new ArrayBuf(i,i.ARRAY_BUFFER,s,s.length,2,i.STATIC_DRAW),this._indicesBuf=new ArrayBuf(i,i.ELEMENT_ARRAY_BUFFER,o,o.length,1,i.STATIC_DRAW),this._program.bind(),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uCameraProjectionMatrix=this._program.getLocation("uProjectMatrix"),this._uCameraInverseProjectionMatrix=this._program.getLocation("uInverseProjectMatrix"),this._uPerspective=this._program.getLocation("uPerspective"),this._uScale=this._program.getLocation("uScale"),this._uIntensity=this._program.getLocation("uIntensity"),this._uBias=this._program.getLocation("uBias"),this._uKernelRadius=this._program.getLocation("uKernelRadius"),this._uMinResolution=this._program.getLocation("uMinResolution"),this._uViewport=this._program.getLocation("uViewport"),this._uRandomSeed=this._program.getLocation("uRandomSeed"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV"),this._dirty=!1}destroy(){this._program&&(this._program.destroy(),this._program=null)}}const blurStdDev=4,blurDepthCutoff=.01,KERNEL_RADIUS=16,sampleOffsetsVert=new Float32Array(createSampleOffsets(17,[0,1])),sampleOffsetsHor=new Float32Array(createSampleOffsets(17,[1,0])),sampleWeights=new Float32Array(createSampleWeights(17,4)),tempVec2a$1=new Float32Array(2);class SAODepthLimitedBlurRenderer{constructor(e){this._scene=e,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uOcclusionTexture="uOcclusionTexture",this._uViewport=null,this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null,this.init()}init(){const e=this._scene.canvas.gl;if(this._program=new Program(e,{vertex:["precision highp float;\n                precision highp int;\n                    \n                attribute vec3 aPosition;\n                attribute vec2 aUV;\n                uniform vec2 uViewport;\n                varying vec2 vUV;\n                varying vec2 vInvSize;\n                void main () {\n                    vUV = aUV;\n                    vInvSize = 1.0 / uViewport;\n                    gl_Position = vec4(aPosition, 1.0);\n                }"],fragment:["precision highp float;\n                precision highp int;\n                    \n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n\n                #define KERNEL_RADIUS 16\n\n                varying vec2        vUV;\n                varying vec2        vInvSize;\n            \n                uniform sampler2D   uDepthTexture;\n                uniform sampler2D   uOcclusionTexture;              \n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;               \n                uniform float       uDepthCutoff;\n\n                uniform vec2        uSampleOffsets[ KERNEL_RADIUS + 1 ];\n                uniform float       uSampleWeights[ KERNEL_RADIUS + 1 ];\n\n                const float         unpackDownscale = 255. / 256.; \n\n                const vec3          packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4          unpackFactors = unpackDownscale / vec4( packFactors, 1. );   \n\n                const float packUpscale = 256. / 255.;\n       \n                const float shiftRights = 1. / 256.;\n                \n                float unpackRGBAToFloat( const in vec4 v ) {\n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unpackFactors );\n                }               \n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float viewZToOrthographicDepth( const in float viewZ) {\n                    return ( viewZ + uCameraNear ) / ( uCameraNear - uCameraFar );\n                }\n              \n                float orthographicDepthToViewZ( const in float linearClipZ) {\n                    return linearClipZ * ( uCameraNear - uCameraFar ) - uCameraNear;\n                }\n\n                float viewZToPerspectiveDepth( const in float viewZ) {\n                    return (( uCameraNear + viewZ ) * uCameraFar ) / (( uCameraFar - uCameraNear ) * viewZ );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ) {\n                    return ( uCameraNear * uCameraFar ) / ( ( uCameraFar - uCameraNear ) * invClipZ - uCameraFar );\n                }\n\n                float getDepth( const in vec2 screenPosition ) {"+(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?"return texture2D(uDepthTexture, screenPosition).r;":"return unpackRGBAToFloat(texture2D( uDepthTexture, screenPosition));")+"}\n\n                float getViewZ( const in float depth ) {\n                     return perspectiveDepthToViewZ( depth );\n                }\n\n                void main() {\n                \n                    float depth = getDepth( vUV );\n                    if( depth >= ( 1.0 - EPSILON ) ) {\n                        discard;\n                    }\n\n                    float centerViewZ = -getViewZ( depth );\n                    bool rBreak = false;\n                    bool lBreak = false;\n\n                    float weightSum = uSampleWeights[0];\n                    float occlusionSum = unpackRGBAToFloat(texture2D( uOcclusionTexture, vUV )) * weightSum;\n\n                    for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n                        float sampleWeight = uSampleWeights[i];\n                        vec2 sampleUVOffset = uSampleOffsets[i] * vInvSize;\n\n                        vec2 sampleUV = vUV + sampleUVOffset;\n                        float viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            rBreak = true;\n                        }\n\n                        if( ! rBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture2D( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n\n                        sampleUV = vUV - sampleUVOffset;\n                        viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            lBreak = true;\n                        }\n\n                        if( ! lBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture2D( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n                    }\n\n                    gl_FragColor = packFloatToRGBA(occlusionSum / weightSum);\n                }"]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);const t=new Float32Array([1,1,0,1,0,0,1,0]),i=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),s=new Uint8Array([0,1,2,0,2,3]);this._positionsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,i,i.length,3,e.STATIC_DRAW),this._uvBuf=new ArrayBuf(e,e.ARRAY_BUFFER,t,t.length,2,e.STATIC_DRAW),this._indicesBuf=new ArrayBuf(e,e.ELEMENT_ARRAY_BUFFER,s,s.length,1,e.STATIC_DRAW),this._program.bind(),this._uViewport=this._program.getLocation("uViewport"),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uDepthCutoff=this._program.getLocation("uDepthCutoff"),this._uSampleOffsets=e.getUniformLocation(this._program.handle,"uSampleOffsets"),this._uSampleWeights=e.getUniformLocation(this._program.handle,"uSampleWeights"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV")}render(e,t,i){if(this._programError)return;this._getInverseProjectMat||(this._getInverseProjectMat=(()=>{let e=!0;this._scene.camera.on("projMatrix",(function(){e=!0}));const t=math.mat4();return()=>(e&&math.inverseMat4(o.camera.projMatrix,t),t)})());const s=this._scene.canvas.gl,r=this._program,o=this._scene,a=s.drawingBufferWidth,n=s.drawingBufferHeight,h=o.camera.project._state,l=h.near,c=h.far;s.viewport(0,0,a,n),s.clearColor(0,0,0,1),s.enable(s.DEPTH_TEST),s.disable(s.BLEND),s.frontFace(s.CCW),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),r.bind(),tempVec2a$1[0]=a,tempVec2a$1[1]=n,s.uniform2fv(this._uViewport,tempVec2a$1),s.uniform1f(this._uCameraNear,l),s.uniform1f(this._uCameraFar,c),s.uniform1f(this._uDepthCutoff,.01),0===i?s.uniform2fv(this._uSampleOffsets,sampleOffsetsHor):s.uniform2fv(this._uSampleOffsets,sampleOffsetsVert),s.uniform1fv(this._uSampleWeights,sampleWeights);const u=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?e.getDepthTexture():e.getTexture(),p=t.getTexture();r.bindTexture(this._uDepthTexture,u,0),r.bindTexture(this._uOcclusionTexture,p,1),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),s.drawElements(s.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}destroy(){this._program.destroy()}}function createSampleWeights(e,t){const i=[];for(let s=0;s<=e;s++)i.push(gaussian(s,t));return i}function gaussian(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)}function createSampleOffsets(e,t){const i=[];for(let s=0;s<=e;s++)i.push(t[0]*s),i.push(t[1]*s);return i}const Canvas2Image=function(){const e=document.createElement("canvas"),t=String.fromCharCode;if(!e.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};const i=!!e.getContext("2d").getImageData,s=!!e.toDataURL,r=!!window.btoa,o=function(e){let i="";const s=e.width,r=e.height;i+="BM";let o=s*r*4+54;i+=t(o%256),o=Math.floor(o/256),i+=t(o%256),o=Math.floor(o/256),i+=t(o%256),o=Math.floor(o/256),i+=t(o%256),i+=t(0,0,0,0,54,0,0,0),i+=t(40,0,0,0);let a=s;i+=t(a%256),a=Math.floor(a/256),i+=t(a%256),a=Math.floor(a/256),i+=t(a%256),a=Math.floor(a/256),i+=t(a%256);let n=r;i+=t(n%256),n=Math.floor(n/256),i+=t(n%256),n=Math.floor(n/256),i+=t(n%256),n=Math.floor(n/256),i+=t(n%256),i+=t(1,0,32,0),i+=t(0,0,0,0);let h=s*r*4;i+=t(h%256),h=Math.floor(h/256),i+=t(h%256),h=Math.floor(h/256),i+=t(h%256),h=Math.floor(h/256),i+=t(h%256),i+=t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const l=e.data;let c,u,p,d,m="",f=r;do{for(p=s*(f-1)*4,d="",c=0;c<s;c++)u=4*c,d+=t(l[p+u+2],l[p+u+1],l[p+u],l[p+u+3]);m+=d}while(--f);return function(e){let i,s,r="";if("string"==typeof e)r=e;else for(s=e,i=0;i<s.length;i++)r+=t(s[i]);return btoa(r)}(i+m)},a=function(e){window.open(e)||(document.location.href=e)},n=function(e,t){return"data:"+t+";base64,"+e},h=function(e){const t=document.createElement("img");return t.src=e,t},l=function(e,t,i,s){if(t&&i){const r=document.createElement("canvas");r.width=t,r.height=i,r.style.width=t+"px",r.style.height=i+"px";const o=r.getContext("2d");return s?(o.save(),o.scale(1,-1),o.imageSmoothingEnabled=!0,o.drawImage(e,0,0,e.width,e.height,0,0,t,-i),o.restore()):(o.imageSmoothingEnabled=!0,o.drawImage(e,0,0,e.width,e.height,0,0,t,i)),r}return e};return{saveAsPNG:function(e,t,i,r,o){if(!s)return!1;const n=l(e,i,r,o).toDataURL("image/png");return t?h(n):(a(n),!0)},saveAsJPEG:function(e,t,i,r,o){if(!s)return!1;const n="image/jpeg",c=l(e,i,r,o).toDataURL(n);return 5==c.indexOf(n)&&(t?h(c):(a(c),!0))},saveAsBMP:function(e,t,c,u,p){if(!(s&&i&&r))return!1;const d="image/bmp",m=function(e){const t=parseInt(e.width),i=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,i)}(l(e,c,u,p)),f=o(m);return t?h(n(f,d)):(a(n(f,d)),!0)}}}();class RenderBuffer{constructor(e,t,i){i=i||{},this.gl=t,this.allocated=!1,this.canvas=e,this.buffer=null,this.bound=!1,this.size=i.size,this._hasDepthTexture=!!i.depthTexture}setSize(e){this.size=e}webglContextRestored(e){this.gl=e,this.buffer=null,this.allocated=!1,this.bound=!1}bind(){if(this._touch(),this.bound)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.buffer.framebuf),this.bound=!0}_touch(){let e,t;const i=this.gl;if(this.size?(e=this.size[0],t=this.size[1]):(e=i.drawingBufferWidth,t=i.drawingBufferHeight),this.buffer){if(this.buffer.width===e&&this.buffer.height===t)return;i.deleteTexture(this.buffer.texture),i.deleteFramebuffer(this.buffer.framebuf),i.deleteRenderbuffer(this.buffer.renderbuf)}const s=i.createTexture();let r;i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),this._hasDepthTexture&&(r=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.DEPTH_COMPONENT,e,t,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null));const o=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t);const a=i.createFramebuffer();if(i.bindFramebuffer(i.FRAMEBUFFER,a),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,s,0),this._hasDepthTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,r,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,o),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,a),!i.isFramebuffer(a))throw"Invalid framebuffer";i.bindFramebuffer(i.FRAMEBUFFER,null);const n=i.checkFramebufferStatus(i.FRAMEBUFFER);switch(n){case i.FRAMEBUFFER_COMPLETE:break;case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case i.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+n}this.buffer={framebuf:a,renderbuf:o,texture:s,depthTexture:r,width:e,height:t},this.bound=!1}clear(){if(!this.bound)throw"Render buffer not bound";const e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}read(e,t){const i=e,s=this.gl.drawingBufferHeight-t,r=new Uint8Array(4),o=this.gl;return o.readPixels(i,s,1,1,o.RGBA,o.UNSIGNED_BYTE,r),r}readImage(e){const t=this.gl,i=this._getImageDataCache(),s=i.pixelData,r=i.canvas,o=i.imageData,a=i.context;t.readPixels(0,0,this.buffer.width,this.buffer.height,t.RGBA,t.UNSIGNED_BYTE,s),o.data.set(s),a.putImageData(o,0,0);const n=e.width||r.width,h=e.height||r.height,l=e.format||"jpeg",c=!0;let u;switch(l){case"jpeg":u=Canvas2Image.saveAsJPEG(r,!0,n,h,c);break;case"png":u=Canvas2Image.saveAsPNG(r,!0,n,h,c);break;case"bmp":u=Canvas2Image.saveAsBMP(r,!0,n,h,c);break;default:console.error("Unsupported image format: '"+l+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),u=Canvas2Image.saveAsJPEG(r,!0,n,h,c)}return u.src}_getImageDataCache(){const e=this.buffer.width,t=this.buffer.height;let i=this._imageDataCache;if(i&&(i.width===e&&i.height===t||(this._imageDataCache=null,i=null)),!i){const s=document.createElement("canvas");s.width=e,s.height=t;const r=s.getContext("2d"),o=r.createImageData(e,t);i={pixelData:new Uint8Array(e*t*4),canvas:s,context:r,imageData:o,width:e,height:t},this._imageDataCache=i}return i}unbind(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.bound=!1}getTexture(){const e=this;return this._texture||(this._texture={renderBuffer:this,bind:function(t){return!(!e.buffer||!e.buffer.texture)&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buffer.texture),!0)},unbind:function(t){e.buffer&&e.buffer.texture&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,null))}})}hasDepthTexture(){return this._hasDepthTexture}getDepthTexture(){if(!this._hasDepthTexture)return null;const e=this;return this._depthTexture||(this._dethTexture={renderBuffer:this,bind:function(t){return!(!e.buffer||!e.buffer.depthTexture)&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buffer.depthTexture),!0)},unbind:function(t){e.buffer&&e.buffer.depthTexture&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,null))}})}destroy(){if(this.allocated){const e=this.gl;e.deleteTexture(this.buffer.texture),e.deleteTexture(this.buffer.depthTexture),e.deleteFramebuffer(this.buffer.framebuf),e.deleteRenderbuffer(this.buffer.renderbuf),this.allocated=!1,this.buffer=null,this.bound=!1}this._imageDataCache=null,this._texture=null,this._depthTexture=null}}class RenderBufferManager{constructor(e){this.scene=e,this._renderBuffersBasic={},this._renderBuffersScaled={}}getRenderBuffer(e,t){const i=1===this.scene.canvas.resolutionScale?this._renderBuffersBasic:this._renderBuffersScaled;let s=i[e];return s||(s=new RenderBuffer(this.scene.canvas.canvas,this.scene.canvas.gl,t),i[e]=s),s}destroy(){for(let e in this._renderBuffersBasic)this._renderBuffersBasic[e].destroy();for(let e in this._renderBuffersScaled)this._renderBuffersScaled[e].destroy()}}const Renderer=function(e,t){t=t||{};const i=new FrameContext(e),s=e.canvas.canvas,r=e.canvas.gl,o=!!t.transparent,a=t.alphaDepthMask,n=new Map$1({});let h={},l={},c=!0,u=!0,p=!0,d=!0,m=!0,f=!0,g=!0,_=!0;const y=new RenderBufferManager(e);let T=!1;const v=new SAOOcclusionRenderer(e),I=new SAODepthLimitedBlurRenderer(e);function E(){c&&(!function(){for(let e in h)if(h.hasOwnProperty(e)){const t=h[e],i=t.drawableMap,s=t.drawableListPreCull;let r=0;for(let e in i)i.hasOwnProperty(e)&&(s[r++]=i[e]);s.length=r}}(),c=!1,u=!0),u&&(!function(){for(let e in h)if(h.hasOwnProperty(e)){const t=h[e];t.isStateSortable&&t.drawableListPreCull.sort(t.stateSortCompare)}}(),u=!1,p=!0),p&&function(){for(let e in h)if(h.hasOwnProperty(e)){const t=h[e],i=t.drawableListPreCull,s=t.drawableList;let r=0;for(let e=0,t=i.length;e<t;e++){const t=i[e];t.rebuildRenderFlags(),t.renderFlags.culled||(s[r++]=t)}s.length=r}}()}function P(e){if(!e.castsShadow)return;const t=e.getShadowRenderBuf();if(t){t.bind(),i.reset(),i.backfaces=!0,i.frontface=!0,i.shadowViewMatrix=e.getShadowViewMatrix(),i.shadowProjMatrix=e.getShadowProjMatrix(),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,1),r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(let e in h)if(h.hasOwnProperty(e)){const t=h[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];!1!==s.visible&&s.castsShadow&&s.drawShadow&&(s.renderFlags.colorOpaque&&s.drawShadow(i))}}t.unbind()}}this._occlusionTester=null,this.setTransparentEnabled=function(e){d=e,p=!0},this.setEdgesEnabled=function(e){m=e,p=!0},this.setSAOEnabled=function(e){f=e,p=!0},this.setPBREnabled=function(e){g=e,p=!0},this.setColorTextureEnabled=function(e){_=e,p=!0},this.needStateSort=function(){u=!0},this.shadowsDirty=function(){},this.imageDirty=function(){p=!0},this.webglContextLost=function(){},this.webglContextRestored=function(e){v.init(),I.init(),p=!0},this.addDrawable=function(e,t){const i=t.type;if(!i)return void console.error("Renderer#addDrawable() : drawable with ID "+e+" has no 'type' - ignoring");let s=h[i];s||(s={type:t.type,count:0,isStateSortable:t.isStateSortable,stateSortCompare:t.stateSortCompare,drawableMap:{},drawableListPreCull:[],drawableList:[]},h[i]=s),s.count++,s.drawableMap[e]=t,l[e]=t,c=!0},this.removeDrawable=function(e){const t=l[e];if(!t)return void console.error("Renderer#removeDrawable() : drawable not found with ID "+e+" - ignoring");const i=t.type,s=h[i];--s.count<=0?delete h[i]:delete s.drawableMap[e],delete l[e],c=!0},this.getPickID=function(e){return n.addItem(e)},this.putPickID=function(e){n.removeItem(e)},this.clear=function(t){if(r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),o)r.clearColor(1,1,1,1);else{const t=e.canvas.backgroundColorFromAmbientLight?this.lights.getAmbientColorAndIntensity():e.canvas.backgroundColor;r.clearColor(t[0],t[1],t[2],1)}r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},this.needsRender=function(){return p||c||u},this.render=function(t){(t=t||{}).force&&(p=!0),E(),p&&(!function(t){WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint&&r.getExtension("OES_element_index_uint");e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.getExtension("EXT_frag_depth");WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&r.getExtension("WEBGL_depth_texture");const s=e.sao;f&&s.possible&&function(t){const s=e.sao,o=y.getRenderBuffer("saoDepth",{depthTexture:WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture});o.bind(),o.clear(),function(e){i.reset(),i.pass=e.pass,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(let e in h)if(h.hasOwnProperty(e)){const t=h[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];!0!==s.culled&&!1!==s.visible&&s.drawDepth&&(s.renderFlags.colorOpaque&&s.drawDepth(i))}}}(t),o.unbind();const a=y.getRenderBuffer("saoOcclusion");if(a.bind(),a.clear(),v.render(o),a.unbind(),s.blur){const e=y.getRenderBuffer("saoOcclusion2");e.bind(),e.clear(),I.render(o,a,0),e.unbind(),a.bind(),a.clear(),I.render(o,e,1),a.unbind()}}(t);(function(){let t=e._lightsState.lights;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.castsShadow&&P(i)}})(),b(t)}(t),stats.frame.frameCount++,p=!1)};const b=function(){const t=[],s=[],n=[],l=[],c=[],u=[],p=[],T=[],v=[],I=[],E=[],P=[],b=[],D=[],w=[],C=[];return function(R){const F=e._lightsState.getAmbientColorAndIntensity();if(i.reset(),i.pass=R.pass,i.withSAO=!1,i.pbrEnabled=g&&!!e.pbrEnabled,i.colorTextureEnabled=_&&!!e.colorTextureEnabled,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),o)r.clearColor(0,0,0,0);else{const t=e.canvas.backgroundColorFromAmbientLight?F:e.canvas.backgroundColor;r.clearColor(t[0],t[1],t[2],1)}r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;const S=e.sao.possible;if(f&&S){const e=y.getRenderBuffer("saoOcclusion");i.occlusionTexture=e?e.getTexture():null}else i.occlusionTexture=null;let x,M,A;const L=Date.now();!1!==R.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);let O=0,N=0,B=0,k=0,G=0,U=0,V=0,H=0,j=0,z=0,W=0,$=0,X=0,Y=0,K=0,q=0;for(let e in h)if(h.hasOwnProperty(e)){const r=h[e].drawableList;for(x=0,M=r.length;x<M;x++){if(A=r[x],!0===A.culled||!1===A.visible)continue;const e=A.renderFlags;e.colorOpaque&&(f&&S&&A.saoEnabled?t[O++]=A:A.drawColorOpaque(i)),d&&e.colorTransparent&&(n[B++]=A),e.xrayedSilhouetteTransparent&&(p[V++]=A),e.xrayedSilhouetteOpaque&&(c[G++]=A),e.highlightedSilhouetteTransparent&&(E[W++]=A),e.highlightedSilhouetteOpaque&&(v[j++]=A),e.selectedSilhouetteTransparent&&(w[K++]=A),e.selectedSilhouetteOpaque&&(b[X++]=A),m&&(e.edgesOpaque&&(s[N++]=A),e.edgesTransparent&&(l[k++]=A)),e.selectedEdgesTransparent&&(C[q++]=A),e.selectedEdgesOpaque&&(D[Y++]=A),e.xrayedEdgesTransparent&&(T[H++]=A),e.xrayedEdgesOpaque&&(u[U++]=A),e.highlightedEdgesTransparent&&(P[$++]=A),e.highlightedEdgesOpaque&&(I[z++]=A)}}if(O>0)for(i.withSAO=!0,x=0;x<O;x++)t[x].drawColorOpaque(i);if(N>0)for(x=0;x<N;x++)s[x].drawEdgesColorOpaque(i);if(G>0)for(x=0;x<G;x++)c[x].drawSilhouetteXRayed(i);if(U>0)for(x=0;x<U;x++)u[x].drawEdgesXRayed(i);if(V>0||H>0||B>0||k>0){if(r.enable(r.CULL_FACE),r.enable(r.BLEND),o?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,a||r.depthMask(!1),H>0)for(x=0;x<H;x++)T[x].drawEdgesXRayed(i);if(V>0)for(x=0;x<V;x++)p[x].drawSilhouetteXRayed(i);if((B>0||k>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),k>0)for(x=0;x<k;x++)A=l[x],A.drawEdgesColorTransparent(i);if(B>0)for(x=0;x<B;x++)A=n[x],A.drawColorTransparent(i);r.disable(r.BLEND),a||r.depthMask(!0)}if(j>0||z>0){if(i.lastProgramId=null,e.highlightMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),z>0)for(x=0;x<z;x++)I[x].drawEdgesHighlighted(i);if(j>0)for(x=0;x<j;x++)v[x].drawSilhouetteHighlighted(i)}if(W>0||$>0||j>0){if(i.lastProgramId=null,e.selectedMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),o?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.CULL_FACE),$>0)for(x=0;x<$;x++)P[x].drawEdgesHighlighted(i);if(W>0)for(x=0;x<W;x++)E[x].drawSilhouetteHighlighted(i);r.disable(r.BLEND)}if(X>0||Y>0){if(i.lastProgramId=null,e.selectedMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),Y>0)for(x=0;x<Y;x++)D[x].drawEdgesSelected(i);if(X>0)for(x=0;x<X;x++)b[x].drawSilhouetteSelected(i)}if(K>0||q>0){if(i.lastProgramId=null,e.selectedMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),o?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),q>0)for(x=0;x<q;x++)C[x].drawEdgesSelected(i);if(K>0)for(x=0;x<K;x++)w[x].drawSilhouetteSelected(i);r.disable(r.BLEND)}const Z=Date.now(),Q=stats.frame;Q.renderTime=(Z-L)/1e3,Q.drawElements=i.drawElements,Q.drawArrays=i.drawArrays,Q.useProgram=i.useProgram,Q.bindTexture=i.bindTexture,Q.bindArray=i.bindArray;const J=WEBGL_INFO$1.MAX_TEXTURE_UNITS;for(let e=0;e<J;e++)r.activeTexture(r.TEXTURE0+e);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);const ee=WEBGL_INFO$1.MAX_VERTEX_ATTRIBS;for(let e=0;e<ee;e++)r.disableVertexAttribArray(e)}}();this.pick=function(){const t=math.vec3(),o=math.mat4(),a=math.mat4(),l=math.vec3(),c=math.vec3([0,1,0]),u=new PickResult,p=math.vec2(),d=math.vec3(),m=math.vec3(),f=math.vec3(),g=math.vec3(),_=math.vec3();return function(T,v=u){let I;v.reset(),E(),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint&&r.getExtension("OES_element_index_uint"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.getExtension("EXT_frag_depth"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&r.getExtension("WEBGL_depth_texture");let P=null,b=null;if(v.pickSurface=T.pickSurface,T.canvasPos)d[0]=T.canvasPos[0],d[1]=T.canvasPos[1],P=e.camera.viewMatrix,b=e.camera.projMatrix,v.canvasPos=T.canvasPos;else{const i=math.frustumMat4(-1,1,-1,1,.01,e.camera.project.far,o);T.matrix?(P=T.matrix,b=i):(m.set(T.origin||[0,0,0]),f.set(T.direction||[0,0,1]),I=math.addVec3(m,f,t),l[0]=Math.random(),l[1]=Math.random(),l[2]=Math.random(),math.normalizeVec3(l),math.cross3Vec3(f,l,c),P=math.lookAtMat4v(m,I,c,a),b=i,v.origin=m,v.direction=f),d[0]=.5*s.clientWidth,d[1]=.5*s.clientHeight}const w=y.getRenderBuffer("pick");w.bind();const C=function(t,s,o,a,l){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=o,i.pickProjMatrix=a,i.pickInvisible=!!l.pickInvisible,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);const c=l.includeEntityIds,u=l.excludeEntityIds;for(let e in h)if(h.hasOwnProperty(e)){const t=h[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];!s.drawPickMesh||!0===s.culled||!0!==l.pickInvisible&&!1===s.visible||!1===s.pickable||(c&&!c[s.id]||u&&u[s.id]||s.drawPickMesh(i))}}const p=e.canvas.resolutionScale,d=t.read(Math.round(s[0]*p),Math.round(s[1]*p));let m=d[0]+256*d[1]+256*d[2]*256+256*d[3]*256*256;if(m<0)return;return n.items[m]}(w,d,P,b,T);if(!C)return w.unbind(),null;const R=C.delegatePickedEntity?C.delegatePickedEntity():C;return R?(T.pickSurface&&(T.pickSurfacePrecision&&e.pickSurfacePrecisionEnabled?(T.canvasPos&&math.canvasPosToWorldRay(e.canvas.canvas,P,b,d,m,f),C.precisionRayPickSurface(m,f,g,_)&&(v.worldPos=g,!1!==T.pickSurfaceNormal&&(v.worldNormal=_),v.pickSurfacePrecision=!0)):C.canPickTriangle&&C.canPickTriangle()?(!function(t,s,o,a,n,h){if(!s.drawPickTriangles)return;i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=a,i.pickProjMatrix=n,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),s.drawPickTriangles(i);const l=e.canvas.resolutionScale,c=t.read(Math.round(o[0]*l),Math.round(o[1]*l));let u=c[0]+256*c[1]+256*c[2]*256+256*c[3]*256*256;u*=3,h.primIndex=u}(w,C,d,P,b,v),C.pickTriangleSurface(P,b,v),v.pickSurfacePrecision=!1):C.canPickWorldPos&&C.canPickWorldPos()&&(p[0]=e.camera.project.near,p[1]=e.camera.project.far,D(w,C,d,P,b,p,v),!1!==T.pickSurfaceNormal&&function(t,s,o,a,n,h){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=a,i.pickProjMatrix=n,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),s.drawPickNormals(i);const l=e.canvas.resolutionScale,c=t.read(Math.round(o[0]*l),Math.round(o[1]*l)),u=[c[0]/256-.5,c[1]/256-.5,c[2]/256-.5];math.normalizeVec3(u),h.worldNormal=u}(w,C,d,P,b,v),v.pickSurfacePrecision=!1)),w.unbind(),v.entity=R,v):(w.unbind(),null)}}();const D=function(){const t=math.vec4(),o=math.vec4(),a=math.vec4(),n=math.vec4(),h=math.vec4(),l=math.mat4(),c=math.mat4(),u=math.mat4();return function(p,d,m,f,g,_,y){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=f,i.pickProjMatrix=g,i.pickZNear=_[0],i.pickZFar=_[1],r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),d.drawPickDepths(i);const T=e.canvas.resolutionScale,v=function(e){const t=[e[0]/256,e[1]/256,e[2]/256,e[3]/256],i=[1/16777216,1/65536,1/256,1];return math.dotVec4(t,i)}(p.read(Math.round(m[0]*T),Math.round(m[1]*T))),I=(m[0]-s.clientWidth/2)/(s.clientWidth/2),E=-(m[1]-s.clientHeight/2)/(s.clientHeight/2),P=d.origin;let b;if(P){const e=createRTCViewMat(f,P,l);b=math.mulMat4(g,e,c)}else b=math.mulMat4(g,f,c);const D=math.inverseMat4(b,u);t[0]=I,t[1]=E,t[2]=-1,t[3]=1;let w=math.transformVec4(D,t);w=math.mulVec4Scalar(w,1/w[3]),o[0]=I,o[1]=E,o[2]=1,o[3]=1;let C=math.transformVec4(D,o);C=math.mulVec4Scalar(C,1/C[3]);const R=math.subVec3(C,w,a),F=math.addVec3(w,math.mulVec4Scalar(R,v,n),h);P&&math.addVec3(F,P),y.worldPos=F}}();this.addMarker=function(t){this._occlusionTester=this._occlusionTester||new OcclusionTester(e,y),this._occlusionTester.addMarker(t),e.occlusionTestCountdown=0},this.markerWorldPosUpdated=function(e){this._occlusionTester.markerWorldPosUpdated(e)},this.removeMarker=function(e){this._occlusionTester.removeMarker(e)},this.doOcclusionTest=function(){if(this._occlusionTester&&this._occlusionTester.needOcclusionTest){E(),this._occlusionTester.bindRenderBuf(),i.reset(),i.backfaces=!0,i.frontface=!0,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(let e in h)if(h.hasOwnProperty(e)){const t=h[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];s.drawOcclusion&&!0!==s.culled&&!1!==s.visible&&!1!==s.pickable&&s.drawOcclusion(i)}}this._occlusionTester.drawMarkers(i),this._occlusionTester.doOcclusionTest(),this._occlusionTester.unbindRenderBuf()}},this.readPixels=function(e,t,i,s){const r=y.getRenderBuffer("snapshot");let o,a,n,h;for(r.bind(),r.clear(),this.render({force:!0,opaqueOnly:s}),a=0;a<i;a++)n=2*a,h=4*a,o=r.read(e[n],e[n+1]),t[h]=o[0],t[h+1]=o[1],t[h+2]=o[2],t[h+3]=o[3];r.unbind(),p=!0},this.beginSnapshot=function(){const e=y.getRenderBuffer("snapshot");e.bind(),e.clear(),T=!0},this.renderSnapshot=function(){if(!T)return;y.getRenderBuffer("snapshot").clear(),this.render({force:!0,opaqueOnly:!1}),p=!0},this.readSnapshot=function(e){return y.getRenderBuffer("snapshot").readImage(e)},this.endSnapshot=function(){if(!T)return;y.getRenderBuffer("snapshot").unbind(),T=!1},this.destroy=function(){h={},l={},y.destroy(),v.destroy(),I.destroy(),this._occlusionTester&&this._occlusionTester.destroy()}};class Input extends Component{constructor(e,t={}){super(e,t),this.KEY_BACKSPACE=8,this.KEY_TAB=9,this.KEY_ENTER=13,this.KEY_SHIFT=16,this.KEY_CTRL=17,this.KEY_ALT=18,this.KEY_PAUSE_BREAK=19,this.KEY_CAPS_LOCK=20,this.KEY_ESCAPE=27,this.KEY_PAGE_UP=33,this.KEY_PAGE_DOWN=34,this.KEY_END=35,this.KEY_HOME=36,this.KEY_LEFT_ARROW=37,this.KEY_UP_ARROW=38,this.KEY_RIGHT_ARROW=39,this.KEY_DOWN_ARROW=40,this.KEY_INSERT=45,this.KEY_DELETE=46,this.KEY_NUM_0=48,this.KEY_NUM_1=49,this.KEY_NUM_2=50,this.KEY_NUM_3=51,this.KEY_NUM_4=52,this.KEY_NUM_5=53,this.KEY_NUM_6=54,this.KEY_NUM_7=55,this.KEY_NUM_8=56,this.KEY_NUM_9=57,this.KEY_A=65,this.KEY_B=66,this.KEY_C=67,this.KEY_D=68,this.KEY_E=69,this.KEY_F=70,this.KEY_G=71,this.KEY_H=72,this.KEY_I=73,this.KEY_J=74,this.KEY_K=75,this.KEY_L=76,this.KEY_M=77,this.KEY_N=78,this.KEY_O=79,this.KEY_P=80,this.KEY_Q=81,this.KEY_R=82,this.KEY_S=83,this.KEY_T=84,this.KEY_U=85,this.KEY_V=86,this.KEY_W=87,this.KEY_X=88,this.KEY_Y=89,this.KEY_Z=90,this.KEY_LEFT_WINDOW=91,this.KEY_RIGHT_WINDOW=92,this.KEY_SELECT_KEY=93,this.KEY_NUMPAD_0=96,this.KEY_NUMPAD_1=97,this.KEY_NUMPAD_2=98,this.KEY_NUMPAD_3=99,this.KEY_NUMPAD_4=100,this.KEY_NUMPAD_5=101,this.KEY_NUMPAD_6=102,this.KEY_NUMPAD_7=103,this.KEY_NUMPAD_8=104,this.KEY_NUMPAD_9=105,this.KEY_MULTIPLY=106,this.KEY_ADD=107,this.KEY_SUBTRACT=109,this.KEY_DECIMAL_POINT=110,this.KEY_DIVIDE=111,this.KEY_F1=112,this.KEY_F2=113,this.KEY_F3=114,this.KEY_F4=115,this.KEY_F5=116,this.KEY_F6=117,this.KEY_F7=118,this.KEY_F8=119,this.KEY_F9=120,this.KEY_F10=121,this.KEY_F11=122,this.KEY_F12=123,this.KEY_NUM_LOCK=144,this.KEY_SCROLL_LOCK=145,this.KEY_SEMI_COLON=186,this.KEY_EQUAL_SIGN=187,this.KEY_COMMA=188,this.KEY_DASH=189,this.KEY_PERIOD=190,this.KEY_FORWARD_SLASH=191,this.KEY_GRAVE_ACCENT=192,this.KEY_OPEN_BRACKET=219,this.KEY_BACK_SLASH=220,this.KEY_CLOSE_BRACKET=221,this.KEY_SINGLE_QUOTE=222,this.KEY_SPACE=32,this.element=t.element,this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0,this.keyboardEnabled=!0,this.mouseover=!1,this.mouseCanvasPos=math.vec2(),this._keyboardEventsElement=t.keyboardEventsElement||document,this._bindEvents()}_bindEvents(){if(!this._eventsBound){this._keyboardEventsElement.addEventListener("keydown",this._keyDownListener=e=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.keyCode===this.KEY_CTRL?this.ctrlDown=!0:e.keyCode===this.KEY_ALT?this.altDown=!0:e.keyCode===this.KEY_SHIFT&&(this.shiftDown=!0),this.keyDown[e.keyCode]=!0,this.fire("keydown",e.keyCode,!0))},!1),this._keyboardEventsElement.addEventListener("keyup",this._keyUpListener=e=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.keyCode===this.KEY_CTRL?this.ctrlDown=!1:e.keyCode===this.KEY_ALT?this.altDown=!1:e.keyCode===this.KEY_SHIFT&&(this.shiftDown=!1),this.keyDown[e.keyCode]=!1,this.fire("keyup",e.keyCode,!0))}),this.element.addEventListener("mouseenter",this._mouseEnterListener=e=>{this.enabled&&(this.mouseover=!0,this._getMouseCanvasPos(e),this.fire("mouseenter",this.mouseCanvasPos,!0))}),this.element.addEventListener("mouseleave",this._mouseLeaveListener=e=>{this.enabled&&(this.mouseover=!1,this._getMouseCanvasPos(e),this.fire("mouseleave",this.mouseCanvasPos,!0))}),this.element.addEventListener("mousedown",this._mouseDownListener=e=>{if(this.enabled){switch(e.which){case 1:this.mouseDownLeft=!0;break;case 2:this.mouseDownMiddle=!0;break;case 3:this.mouseDownRight=!0}this._getMouseCanvasPos(e),this.element.focus(),this.fire("mousedown",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),document.addEventListener("mouseup",this._mouseUpListener=e=>{if(this.enabled){switch(e.which){case 1:this.mouseDownLeft=!1;break;case 2:this.mouseDownMiddle=!1;break;case 3:this.mouseDownRight=!1}this.fire("mouseup",this.mouseCanvasPos,!0)}},!0),document.addEventListener("click",this._clickListener=e=>{if(this.enabled){switch(e.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(e),this.fire("click",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),document.addEventListener("dblclick",this._dblClickListener=e=>{if(this.enabled){switch(e.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(e),this.fire("dblclick",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),this.element.addEventListener("mousemove",this._mouseMoveListener=e=>{this.enabled&&(this._getMouseCanvasPos(e),this.fire("mousemove",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault())}),this.element.addEventListener("wheel",this._mouseWheelListener=(e,t)=>{if(!this.enabled)return;const i=Math.max(-1,Math.min(1,40*-e.deltaY));this.fire("mousewheel",i,!0)},{passive:!0});{let e,t;const i=2;this.on("mousedown",(i=>{e=i[0],t=i[1]})),this.on("mouseup",(s=>{e>=s[0]-i&&e<=s[0]+i&&t>=s[1]-i&&t<=s[1]+i&&this.fire("mouseclicked",s,!0)}))}this._eventsBound=!0}}_unbindEvents(){this._eventsBound&&(this._keyboardEventsElement.removeEventListener("keydown",this._keyDownListener),this._keyboardEventsElement.removeEventListener("keyup",this._keyUpListener),this.element.removeEventListener("mouseenter",this._mouseEnterListener),this.element.removeEventListener("mouseleave",this._mouseLeaveListener),this.element.removeEventListener("mousedown",this._mouseDownListener),document.removeEventListener("mouseup",this._mouseDownListener),document.removeEventListener("click",this._clickListener),document.removeEventListener("dblclick",this._dblClickListener),this.element.removeEventListener("mousemove",this._mouseMoveListener),this.element.removeEventListener("wheel",this._mouseWheelListener),window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientListener),this._eventsBound=!1)}_getMouseCanvasPos(e){if(e){let t=e.target,i=0,s=0;for(;t.offsetParent;)i+=t.offsetLeft,s+=t.offsetTop,t=t.offsetParent;this.mouseCanvasPos[0]=e.pageX-i,this.mouseCanvasPos[1]=e.pageY-s}else e=window.event,this.mouseCanvasPos[0]=e.x,this.mouseCanvasPos[1]=e.y}setEnabled(e){this.enabled!==e&&this.fire("enabled",this.enabled=e)}getEnabled(){return this.enabled}setKeyboardEnabled(e){this.keyboardEnabled=e}getKeyboardEnabled(){return this.keyboardEnabled}destroy(){super.destroy(),this._unbindEvents()}}const ids$3=new Map$1({});class RenderState{constructor(e){this.id=ids$3.addItem({});for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}destroy(){ids$3.removeItem(this.id)}}class Viewport extends Component{get type(){return"Viewport"}constructor(e,t={}){super(e,t),this._state=new RenderState({boundary:[0,0,100,100]}),this.boundary=t.boundary,this.autoBoundary=t.autoBoundary}set boundary(e){if(!this._autoBoundary){if(!e){const t=this.scene.canvas.boundary;e=[0,0,t[2],t[3]]}this._state.boundary=e,this.glRedraw(),this.fire("boundary",this._state.boundary)}}get boundary(){return this._state.boundary}set autoBoundary(e){(e=!!e)!==this._autoBoundary&&(this._autoBoundary=e,this._autoBoundary?this._onCanvasSize=this.scene.canvas.on("boundary",(function(e){const t=e[2],i=e[3];this._state.boundary=[0,0,t,i],this.glRedraw(),this.fire("boundary",this._state.boundary)}),this):this._onCanvasSize&&(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}get autoBoundary(){return this._autoBoundary}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}class Perspective extends Component{get type(){return"Perspective"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new RenderState({matrix:math.mat4(),inverseMatrix:math.mat4(),transposedMatrix:math.mat4(),near:.1,far:2e3}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this._fov=60,this._canvasResized=this.scene.canvas.on("boundary",this._needUpdate,this),this.fov=t.fov,this.fovAxis=t.fovAxis,this.near=t.near,this.far=t.far}_update(){const e=this.scene.viewport.boundary,t=e[2]/e[3],i=this._fovAxis;let s=this._fov;("x"===i||"min"===i&&t<1||"max"===i&&t>1)&&(s/=t),s=Math.min(s,120),math.perspectiveMat4(s*(Math.PI/180),t,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set fov(e){(e=null!=e?e:60)!==this._fov&&(this._fov=e,this._needUpdate(0),this.fire("fov",this._fov))}get fov(){return this._fov}set fovAxis(e){e=e||"min",this._fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),this._fovAxis=e,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}get fovAxis(){return this._fovAxis}set near(e){const t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(e){const t=null!=e?e:2e3;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(math.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(math.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,i,s,r){const o=this.scene.canvas.canvas,a=o.offsetWidth/2,n=o.offsetHeight/2;return i[0]=(e[0]-a)/a,i[1]=(e[1]-n)/n,i[2]=t,i[3]=1,math.mulMat4v4(this.inverseMatrix,i,s),math.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,math.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._canvasResized)}}class Ortho extends Component{get type(){return"Ortho"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new RenderState({matrix:math.mat4(),inverseMatrix:math.mat4(),transposedMatrix:math.mat4(),near:.1,far:2e3}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.scale=t.scale,this.near=t.near,this.far=t.far,this._onCanvasBoundary=this.scene.canvas.on("boundary",this._needUpdate,this)}_update(){const e=this.scene,t=.5*this._scale,i=e.viewport.boundary,s=i[2],r=i[3],o=s/r;let a,n,h,l;s>r?(a=-t,n=t,h=t/o,l=-t/o):(a=-t*o,n=t*o,h=t,l=-t),math.orthoMat4c(a,n,l,h,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set scale(e){null==e&&(e=1),e<=0&&(e=.01),this._scale=e,this._needUpdate(0),this.fire("scale",this._scale)}get scale(){return this._scale}set near(e){const t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(e){const t=null!=e?e:2e3;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(math.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(math.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,i,s,r){const o=this.scene.canvas.canvas,a=o.offsetWidth/2,n=o.offsetHeight/2;return i[0]=(e[0]-a)/a,i[1]=(e[1]-n)/n,i[2]=t,i[3]=1,math.mulMat4v4(this.inverseMatrix,i,s),math.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,math.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._onCanvasBoundary)}}class Frustum$1 extends Component{get type(){return"Frustum"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new RenderState({matrix:math.mat4(),inverseMatrix:math.mat4(),transposedMatrix:math.mat4(),near:.1,far:1e4}),this._left=-1,this._right=1,this._bottom=-1,this._top=1,this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.left=t.left,this.right=t.right,this.bottom=t.bottom,this.top=t.top,this.near=t.near,this.far=t.far}_update(){math.frustumMat4(this._left,this._right,this._bottom,this._top,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set left(e){this._left=null!=e?e:-1,this._needUpdate(0),this.fire("left",this._left)}get left(){return this._left}set right(e){this._right=null!=e?e:1,this._needUpdate(0),this.fire("right",this._right)}get right(){return this._right}set top(e){this._top=null!=e?e:1,this._needUpdate(0),this.fire("top",this._top)}get top(){return this._top}set bottom(e){this._bottom=null!=e?e:-1,this._needUpdate(0),this.fire("bottom",this._bottom)}get bottom(){return this._bottom}set near(e){this._state.near=null!=e?e:.1,this._needUpdate(0),this.fire("near",this._state.near)}get near(){return this._state.near}set far(e){this._state.far=null!=e?e:1e4,this._needUpdate(0),this.fire("far",this._state.far)}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(math.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(math.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,i,s,r){const o=this.scene.canvas.canvas,a=o.offsetWidth/2,n=o.offsetHeight/2;return i[0]=(e[0]-a)/a,i[1]=(e[1]-n)/n,i[2]=t,i[3]=1,math.mulMat4v4(this.inverseMatrix,i,s),math.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,math.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this._state.destroy(),super.destroy()}}class CustomProjection extends Component{get type(){return"CustomProjection"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new RenderState({matrix:math.mat4(),inverseMatrix:math.mat4(),transposedMatrix:math.mat4()}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!1,this.matrix=t.matrix}set matrix(e){this._state.matrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("far",this._state.matrix)}get matrix(){return this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(math.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(math.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,i,s,r){const o=this.scene.canvas.canvas,a=o.offsetWidth/2,n=o.offsetHeight/2;return i[0]=(e[0]-a)/a,i[1]=(e[1]-n)/n,i[2]=t,i[3]=1,math.mulMat4v4(this.inverseMatrix,i,s),math.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,math.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}destroy(){super.destroy(),this._state.destroy()}}const tempVec3$5=math.vec3(),tempVec3b$9=math.vec3(),tempVec3c$6=math.vec3(),tempVec3d$3=math.vec3(),tempVec3e$2=math.vec3(),tempVec3f$2=math.vec3(),tempMat=math.mat4(),tempMatb=math.mat4(),eyeLookVec=math.vec3(),eyeLookVecNorm=math.vec3(),eyeLookOffset=math.vec3(),offsetEye=math.vec3();class Camera extends Component{get type(){return"Camera"}constructor(e,t={}){super(e,t),this._state=new RenderState({deviceMatrix:math.mat4(),hasDeviceMatrix:!1,matrix:math.mat4(),normalMatrix:math.mat4(),inverseMatrix:math.mat4()}),this._perspective=new Perspective(this),this._ortho=new Ortho(this),this._frustum=new Frustum$1(this),this._customProjection=new CustomProjection(this),this._project=this._perspective,this._eye=math.vec3([0,0,10]),this._look=math.vec3([0,0,0]),this._up=math.vec3([0,1,0]),this._worldUp=math.vec3([0,1,0]),this._worldRight=math.vec3([1,0,0]),this._worldForward=math.vec3([0,0,-1]),this.deviceMatrix=t.deviceMatrix,this.eye=t.eye,this.look=t.look,this.up=t.up,this.worldAxis=t.worldAxis,this.gimbalLock=t.gimbalLock,this.constrainPitch=t.constrainPitch,this.projection=t.projection,this._perspective.on("matrix",(()=>{"perspective"===this._projectionType&&this.fire("projMatrix",this._perspective.matrix)})),this._ortho.on("matrix",(()=>{"ortho"===this._projectionType&&this.fire("projMatrix",this._ortho.matrix)})),this._frustum.on("matrix",(()=>{"frustum"===this._projectionType&&this.fire("projMatrix",this._frustum.matrix)})),this._customProjection.on("matrix",(()=>{"customProjection"===this._projectionType&&this.fire("projMatrix",this._customProjection.matrix)}))}_update(){const e=this._state;let t;"ortho"===this.projection?(math.subVec3(this._eye,this._look,eyeLookVec),math.normalizeVec3(eyeLookVec,eyeLookVecNorm),math.mulVec3Scalar(eyeLookVecNorm,1e3,eyeLookOffset),math.addVec3(this._look,eyeLookOffset,offsetEye),t=offsetEye):t=this._eye,e.hasDeviceMatrix?(math.lookAtMat4v(t,this._look,this._up,tempMatb),math.mulMat4(e.deviceMatrix,tempMatb,e.matrix)):math.lookAtMat4v(t,this._look,this._up,e.matrix),math.inverseMat4(this._state.matrix,this._state.inverseMatrix),math.transposeMat4(this._state.inverseMatrix,this._state.normalMatrix),this.glRedraw(),this.fire("matrix",this._state.matrix),this.fire("viewMatrix",this._state.matrix)}orbitYaw(e){let t=math.subVec3(this._eye,this._look,tempVec3$5);math.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,tempMat),t=math.transformPoint3(tempMat,t,tempVec3b$9),this.eye=math.addVec3(this._look,t,tempVec3c$6),this.up=math.transformPoint3(tempMat,this._up,tempVec3d$3)}orbitPitch(e){if(this._constrainPitch&&(e=math.dotVec3(this._up,this._worldUp)/math.DEGTORAD)<1)return;let t=math.subVec3(this._eye,this._look,tempVec3$5);const i=math.cross3Vec3(math.normalizeVec3(t,tempVec3b$9),math.normalizeVec3(this._up,tempVec3c$6));math.rotationMat4v(.0174532925*e,i,tempMat),t=math.transformPoint3(tempMat,t,tempVec3d$3),this.up=math.transformPoint3(tempMat,this._up,tempVec3e$2),this.eye=math.addVec3(t,this._look,tempVec3f$2)}yaw(e){let t=math.subVec3(this._look,this._eye,tempVec3$5);math.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,tempMat),t=math.transformPoint3(tempMat,t,tempVec3b$9),this.look=math.addVec3(t,this._eye,tempVec3c$6),this._gimbalLock&&(this.up=math.transformPoint3(tempMat,this._up,tempVec3d$3))}pitch(e){if(this._constrainPitch&&(e=math.dotVec3(this._up,this._worldUp)/math.DEGTORAD)<1)return;let t=math.subVec3(this._look,this._eye,tempVec3$5);const i=math.cross3Vec3(math.normalizeVec3(t,tempVec3b$9),math.normalizeVec3(this._up,tempVec3c$6));math.rotationMat4v(.0174532925*e,i,tempMat),this.up=math.transformPoint3(tempMat,this._up,tempVec3f$2),t=math.transformPoint3(tempMat,t,tempVec3d$3),this.look=math.addVec3(t,this._eye,tempVec3e$2)}pan(e){const t=math.subVec3(this._eye,this._look,tempVec3$5),i=[0,0,0];let s;if(0!==e[0]){const r=math.cross3Vec3(math.normalizeVec3(t,[]),math.normalizeVec3(this._up,tempVec3b$9));s=math.mulVec3Scalar(r,e[0]),i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]}0!==e[1]&&(s=math.mulVec3Scalar(math.normalizeVec3(this._up,tempVec3c$6),e[1]),i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]),0!==e[2]&&(s=math.mulVec3Scalar(math.normalizeVec3(t,tempVec3d$3),e[2]),i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]),this.eye=math.addVec3(this._eye,i,tempVec3e$2),this.look=math.addVec3(this._look,i,tempVec3f$2)}zoom(e){const t=math.subVec3(this._eye,this._look,tempVec3$5),i=Math.abs(math.lenVec3(t,tempVec3b$9)),s=Math.abs(i+e);if(s<.5)return;const r=math.normalizeVec3(t,tempVec3c$6);this.eye=math.addVec3(this._look,math.mulVec3Scalar(r,s),tempVec3d$3)}set eye(e){this._eye.set(e||[0,0,10]),this._needUpdate(0),this.fire("eye",this._eye)}get eye(){return this._eye}set look(e){this._look.set(e||[0,0,0]),this._needUpdate(0),this.fire("look",this._look)}get look(){return this._look}set up(e){this._up.set(e||[0,1,0]),this._needUpdate(0),this.fire("up",this._up)}get up(){return this._up}set deviceMatrix(e){this._state.deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._state.hasDeviceMatrix=!!e,this._needUpdate(0),this.fire("deviceMatrix",this._state.deviceMatrix)}get deviceMatrix(){return this._state.deviceMatrix}set worldAxis(e){e=e||[1,0,0,0,1,0,0,0,1],this._worldAxis?this._worldAxis.set(e):this._worldAxis=math.vec3(e),this._worldRight[0]=this._worldAxis[0],this._worldRight[1]=this._worldAxis[1],this._worldRight[2]=this._worldAxis[2],this._worldUp[0]=this._worldAxis[3],this._worldUp[1]=this._worldAxis[4],this._worldUp[2]=this._worldAxis[5],this._worldForward[0]=this._worldAxis[6],this._worldForward[1]=this._worldAxis[7],this._worldForward[2]=this._worldAxis[8],this.fire("worldAxis",this._worldAxis)}get worldAxis(){return this._worldAxis}get worldUp(){return this._worldUp}get xUp(){return this._worldUp[0]>this._worldUp[1]&&this._worldUp[0]>this._worldUp[2]}get yUp(){return this._worldUp[1]>this._worldUp[0]&&this._worldUp[1]>this._worldUp[2]}get zUp(){return this._worldUp[2]>this._worldUp[0]&&this._worldUp[2]>this._worldUp[1]}get worldRight(){return this._worldRight}get worldForward(){return this._worldForward}set gimbalLock(e){this._gimbalLock=!1!==e,this.fire("gimbalLock",this._gimbalLock)}get gimbalLock(){return this._gimbalLock}set constrainPitch(e){this._constrainPitch=!!e,this.fire("constrainPitch",this._constrainPitch)}get eyeLookDist(){return math.lenVec3(math.subVec3(this._look,this._eye,tempVec3$5))}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get viewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get normalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get viewNormalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get inverseViewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.inverseMatrix}get projMatrix(){return this[this.projection].matrix}get perspective(){return this._perspective}get ortho(){return this._ortho}get frustum(){return this._frustum}get customProjection(){return this._customProjection}set projection(e){e=e||"perspective",this._projectionType!==e&&("perspective"===e?this._project=this._perspective:"ortho"===e?this._project=this._ortho:"frustum"===e?this._project=this._frustum:"customProjection"===e?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to 'perspective'"),this._project=this._perspective,e="perspective"),this._project._update(),this._projectionType=e,this.glRedraw(),this._update(),this.fire("dirty"),this.fire("projection",this._projectionType),this.fire("projMatrix",this._project.matrix))}get projection(){return this._projectionType}get project(){return this._project}destroy(){super.destroy(),this._state.destroy()}}class Light extends Component{get type(){return"Light"}get isLight(){return!0}constructor(e,t={}){super(e,t)}}class DirLight extends Light{get type(){return"DirLight"}constructor(e,t={}){super(e,t),this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const i=this.scene.camera,s=this.scene.canvas;this._onCameraViewMatrix=i.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=i.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=s.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new RenderState({type:"dir",dir:math.vec3([1,1,1]),color:math.vec3([.7,.7,.8]),intensity:1,space:t.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(this._shadowViewMatrixDirty){this._shadowViewMatrix||(this._shadowViewMatrix=math.identityMat4());const e=this.scene.camera,t=this._state.dir,i=e.look,s=[i[0]-t[0],i[1]-t[1],i[2]-t[2]],r=[0,1,0];math.lookAtMat4v(s,i,r,this._shadowViewMatrix),this._shadowViewMatrixDirty=!1}return this._shadowViewMatrix},getShadowProjMatrix:()=>(this._shadowProjMatrixDirty&&(this._shadowProjMatrix||(this._shadowProjMatrix=math.identityMat4()),math.orthoMat4c(-40,40,-40,40,-40,80,this._shadowProjMatrix),this._shadowProjMatrixDirty=!1),this._shadowProjMatrix),getShadowRenderBuf:()=>(this._shadowRenderBuf||(this._shadowRenderBuf=new RenderBuffer(this.scene.canvas.canvas,this.scene.canvas.gl,{size:[1024,1024]})),this._shadowRenderBuf)}),this.dir=t.dir,this.color=t.color,this.intensity=t.intensity,this.castsShadow=t.castsShadow,this.scene._lightCreated(this)}set dir(e){this._state.dir.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get dir(){return this._state.dir}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}get intensity(){return this._state.intensity}set castsShadow(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}class AmbientLight extends Light{get type(){return"AmbientLight"}constructor(e,t={}){super(e,t),this._state={type:"ambient",color:math.vec3([.7,.7,.7]),intensity:1},this.color=t.color,this.intensity=t.intensity,this.scene._lightCreated(this)}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){this._state.intensity=void 0!==e?e:1,this.glRedraw()}get intensity(){return this._state.intensity}destroy(){super.destroy(),this.scene._lightDestroyed(this)}}class Geometry extends Component{get type(){return"Geometry"}get isGeometry(){return!0}constructor(e,t={}){super(e,t),stats.memory.meshes++}destroy(){super.destroy(),stats.memory.meshes--}}var buildEdgeIndices=function(){const e=[],t=[],i=[],s=[],r=[];let o=0;const a=new Uint16Array(3),n=new Uint16Array(3),h=new Uint16Array(3),l=math.vec3(),c=math.vec3(),u=math.vec3(),p=math.vec3(),d=math.vec3(),m=math.vec3(),f=math.vec3();return function(g,_,y,T){!function(r,o){const a={};let n,h,l,c;const u=Math.pow(10,4);let p,d,m=0;for(p=0,d=r.length;p<d;p+=3)n=r[p],h=r[p+1],l=r[p+2],c=Math.round(n*u)+"_"+Math.round(h*u)+"_"+Math.round(l*u),void 0===a[c]&&(a[c]=m/3,e[m++]=n,e[m++]=h,e[m++]=l),t[p/3]=a[c];for(p=0,d=o.length;p<d;p++)s[p]=t[o[p]],i[s[p]]=o[p]}(g,_),function(t,i){o=0;for(let g=0,_=t;g<_;g+=3){const t=3*s[g],_=3*s[g+1],y=3*s[g+2];i?(a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],n[0]=e[_],n[1]=e[_+1],n[2]=e[_+2],h[0]=e[y],h[1]=e[y+1],h[2]=e[y+2],math.decompressPosition(a,i,l),math.decompressPosition(n,i,c),math.decompressPosition(h,i,u)):(l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],c[0]=e[_],c[1]=e[_+1],c[2]=e[_+2],u[0]=e[y],u[1]=e[y+1],u[2]=e[y+2]),math.subVec3(u,c,p),math.subVec3(l,c,d),math.cross3Vec3(p,d,m),math.normalizeVec3(m,f);const T=r[o]||(r[o]={normal:math.vec3()});T.normal[0]=f[0],T.normal[1]=f[1],T.normal[2]=f[2],o++}}(_.length,y);const v=[],I=Math.cos(math.DEGTORAD*T),E={};let P,b,D,w,C,R,F,S,x,M,A,L=!1;for(let e=0,t=_.length;e<t;e+=3){const t=e/3;for(let i=0;i<3;i++)P=s[e+i],b=s[e+(i+1)%3],D=Math.min(P,b),w=Math.max(P,b),C=D+","+w,void 0===E[C]?E[C]={index1:D,index2:w,face1:t,face2:void 0}:E[C].face2=t}for(C in E)R=E[C],void 0!==R.face2&&(F=r[R.face1].normal,S=r[R.face2].normal,x=math.dotVec3(F,S),x>I)||(M=i[R.index1],A=i[R.index2],(!L&&M>65535||A>65535)&&(L=!0),v.push(M),v.push(A));return L?new Uint32Array(v):new Uint16Array(v)}}();function getPositionsBounds(e){const t=new Float32Array(3),i=new Float32Array(3);let s,r;for(s=0;s<3;s++)t[s]=Number.MAX_VALUE,i[s]=-Number.MAX_VALUE;for(s=0;s<e.length;s+=3)for(r=0;r<3;r++)t[r]=Math.min(t[r],e[s+r]),i[r]=Math.max(i[r],e[s+r]);return{min:t,max:i}}const createPositionsDecodeMatrix=function(){const e=math.mat4(),t=math.mat4();return function(i,s){s=s||math.mat4();const r=i[0],o=i[1],a=i[2],n=i[3]-r,h=i[4]-o,l=i[5]-a,c=65535;return math.identityMat4(e),math.translationMat4v(i,e),math.identityMat4(t),math.scalingMat4v([n/c,h/c,l/c],t),math.mulMat4(e,t,s),s}}();var compressPositions=function(){const e=math.mat4(),t=math.mat4();return function(i,s,r){const o=new Uint16Array(i.length);var a=new Float32Array([r[0]!==s[0]?65535/(r[0]-s[0]):0,r[1]!==s[1]?65535/(r[1]-s[1]):0,r[2]!==s[2]?65535/(r[2]-s[2]):0]);let n;for(n=0;n<i.length;n+=3)o[n+0]=Math.floor((i[n+0]-s[0])*a[0]),o[n+1]=Math.floor((i[n+1]-s[1])*a[1]),o[n+2]=Math.floor((i[n+2]-s[2])*a[2]);math.identityMat4(e),math.translationMat4v(s,e),math.identityMat4(t),math.scalingMat4v([(r[0]-s[0])/65535,(r[1]-s[1])/65535,(r[2]-s[2])/65535],t);return{quantized:o,decodeMatrix:math.mulMat4(e,t,math.identityMat4())}}}();function compressPosition(e,t,i){const s=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);i[0]=Math.floor((e[0]-t[0])*s[0]),i[1]=Math.floor((e[1]-t[1])*s[1]),i[2]=Math.floor((e[2]-t[2])*s[2])}function decompressPosition(e,t,i){return i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i}function decompressAABB(e,t,i=e){return i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i}function decompressPositions(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[12],i[s+1]=e[s+1]*t[5]+t[13],i[s+2]=e[s+2]*t[10]+t[14];return i}function getUVBounds(e){const t=new Float32Array(2),i=new Float32Array(2);let s,r;for(s=0;s<2;s++)t[s]=Number.MAX_VALUE,i[s]=-Number.MAX_VALUE;for(s=0;s<e.length;s+=2)for(r=0;r<2;r++)t[r]=Math.min(t[r],e[s+r]),i[r]=Math.max(i[r],e[s+r]);return{min:t,max:i}}var compressUVs=function(){const e=math.mat3(),t=math.mat3();return function(i,s,r){const o=new Uint16Array(i.length),a=new Float32Array([65535/(r[0]-s[0]),65535/(r[1]-s[1])]);let n;for(n=0;n<i.length;n+=2)o[n+0]=Math.floor((i[n+0]-s[0])*a[0]),o[n+1]=Math.floor((i[n+1]-s[1])*a[1]);math.identityMat3(e),math.translationMat3v(s,e),math.identityMat3(t),math.scalingMat3v([(r[0]-s[0])/65535,(r[1]-s[1])/65535],t);return{quantized:o,decodeMatrix:math.mulMat3(e,t,math.identityMat3())}}}();function compressNormals(e){const t=new Int8Array(e.length);let i,s,r,o,a;for(let n=0;n<e.length;n+=3)r=i=octEncodeVec3$1(e,n,"floor","floor"),s=octDecodeVec2$1(i),o=a=dot$1(e,n,s),i=octEncodeVec3$1(e,n,"ceil","floor"),s=octDecodeVec2$1(i),o=dot$1(e,n,s),o>a&&(r=i,a=o),i=octEncodeVec3$1(e,n,"floor","ceil"),s=octDecodeVec2$1(i),o=dot$1(e,n,s),o>a&&(r=i,a=o),i=octEncodeVec3$1(e,n,"ceil","ceil"),s=octDecodeVec2$1(i),o=dot$1(e,n,s),o>a&&(r=i,a=o),t[n]=r[0],t[n+1]=r[1];return t}function octEncodeVec3$1(e,t,i,s){let r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){let e=(1-Math.abs(o))*(r>=0?1:-1),t=(1-Math.abs(r))*(o>=0?1:-1);r=e,o=t}return new Int8Array([Math[i](127.5*r+(r<0?-1:0)),Math[s](127.5*o+(o<0?-1:0))])}function octDecodeVec2$1(e){let t=e[0],i=e[1];t/=t<0?127:128,i/=i<0?127:128;const s=1-Math.abs(t)-Math.abs(i);s<0&&(t=(1-Math.abs(i))*(t>=0?1:-1),i=(1-Math.abs(t))*(i>=0?1:-1));const r=Math.sqrt(t*t+i*i+s*s);return[t/r,i/r,s/r]}function dot$1(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}function decompressUV(e,t,i){i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]}function decompressUVs(e,t,i=new Float32Array(e.length)){for(let s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[6],i[s+1]=e[s+1]*t[4]+t[7];return i}function decompressNormal(e,t){let i=e[0],s=e[1];i=(2*i+1)/255,s=(2*s+1)/255;const r=1-Math.abs(i)-Math.abs(s);r<0&&(i=(1-Math.abs(s))*(i>=0?1:-1),s=(1-Math.abs(i))*(s>=0?1:-1));const o=Math.sqrt(i*i+s*s+r*r);return t[0]=i/o,t[1]=s/o,t[2]=r/o,t}function decompressNormals(e,t){for(let i=0,s=0,r=e.length;i<r;i+=2){let r=e[i+0],o=e[i+1];r=(2*r+1)/255,o=(2*o+1)/255;const a=1-Math.abs(r)-Math.abs(o);a<0&&(r=(1-Math.abs(o))*(r>=0?1:-1),o=(1-Math.abs(r))*(o>=0?1:-1));const n=Math.sqrt(r*r+o*o+a*a);t[s+0]=r/n,t[s+1]=o/n,t[s+2]=a/n,s+=3}return t}const geometryCompressionUtils={getPositionsBounds:getPositionsBounds,createPositionsDecodeMatrix:createPositionsDecodeMatrix,compressPositions:compressPositions,compressPosition:compressPosition,decompressPositions:decompressPositions,decompressPosition:decompressPosition,decompressAABB:decompressAABB,getUVBounds:getUVBounds,compressUVs:compressUVs,decompressUVs:decompressUVs,decompressUV:decompressUV,compressNormals:compressNormals,decompressNormals:decompressNormals,decompressNormal:decompressNormal},memoryStats$1=stats.memory,bigIndicesSupported$5=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint,IndexArrayType$1=bigIndicesSupported$5?Uint32Array:Uint16Array,tempAABB$2=math.AABB3();class ReadableGeometry extends Geometry{get type(){return"ReadableGeometry"}get isReadableGeometry(){return!0}constructor(e,t={}){super(e,t),this._state=new RenderState({compressGeometry:!!t.compressGeometry,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this._edgeIndicesBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._aabbDirty=!0,this._boundingSphere=!0,this._aabb=null,this._aabbDirty=!0,this._obb=null,this._obbDirty=!0;const i=this._state,s=this.scene.canvas.gl;switch(t.primitive=t.primitive||"triangles",t.primitive){case"points":i.primitive=s.POINTS,i.primitiveName=t.primitive;break;case"lines":i.primitive=s.LINES,i.primitiveName=t.primitive;break;case"line-loop":i.primitive=s.LINE_LOOP,i.primitiveName=t.primitive;break;case"line-strip":i.primitive=s.LINE_STRIP,i.primitiveName=t.primitive;break;case"triangles":i.primitive=s.TRIANGLES,i.primitiveName=t.primitive;break;case"triangle-strip":i.primitive=s.TRIANGLE_STRIP,i.primitiveName=t.primitive;break;case"triangle-fan":i.primitive=s.TRIANGLE_FAN,i.primitiveName=t.primitive;break;default:this.error("Unsupported value for 'primitive': '"+t.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),i.primitive=s.TRIANGLES,i.primitiveName=t.primitive}if(t.positions)if(this._state.compressGeometry){const e=geometryCompressionUtils.getPositionsBounds(t.positions),s=geometryCompressionUtils.compressPositions(t.positions,e.min,e.max);i.positions=s.quantized,i.positionsDecodeMatrix=s.decodeMatrix}else i.positions=t.positions.constructor===Float32Array?t.positions:new Float32Array(t.positions);if(t.colors&&(i.colors=t.colors.constructor===Float32Array?t.colors:new Float32Array(t.colors)),t.uv)if(this._state.compressGeometry){const e=geometryCompressionUtils.getUVBounds(t.uv),s=geometryCompressionUtils.compressUVs(t.uv,e.min,e.max);i.uv=s.quantized,i.uvDecodeMatrix=s.decodeMatrix}else i.uv=t.uv.constructor===Float32Array?t.uv:new Float32Array(t.uv);if(t.normals&&(this._state.compressGeometry?i.normals=geometryCompressionUtils.compressNormals(t.normals):i.normals=t.normals.constructor===Float32Array?t.normals:new Float32Array(t.normals)),t.indices){if(!bigIndicesSupported$5&&t.indices.constructor===Uint32Array)return void this.error("This WebGL implementation does not support Uint32Array");i.indices=t.indices.constructor===Uint32Array||t.indices.constructor===Uint16Array?t.indices:new IndexArrayType$1(t.indices),"triangles"===this._state.primitiveName&&(this._numTriangles=t.indices.length/3)}this._buildHash(),memoryStats$1.meshes++,this._buildVBOs()}_buildVBOs(){const e=this._state,t=this.scene.canvas.gl;if(e.indices&&(e.indicesBuf=new ArrayBuf(t,t.ELEMENT_ARRAY_BUFFER,e.indices,e.indices.length,1,t.STATIC_DRAW),memoryStats$1.indices+=e.indicesBuf.numItems),e.positions&&(e.positionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,e.positions,e.positions.length,3,t.STATIC_DRAW),memoryStats$1.positions+=e.positionsBuf.numItems),e.normals){let i=e.compressGeometry;e.normalsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,e.normals,e.normals.length,3,t.STATIC_DRAW,i),memoryStats$1.normals+=e.normalsBuf.numItems}e.colors&&(e.colorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,e.colors,e.colors.length,4,t.STATIC_DRAW),memoryStats$1.colors+=e.colorsBuf.numItems),e.uv&&(e.uvBuf=new ArrayBuf(t,t.ARRAY_BUFFER,e.uv,e.uv.length,2,t.STATIC_DRAW),memoryStats$1.uvs+=e.uvBuf.numItems)}_buildHash(){const e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positions&&t.push("p"),e.colors&&t.push("c"),(e.normals||e.autoVertexNormals)&&t.push("n"),e.uv&&t.push("u"),e.compressGeometry&&t.push("cp"),t.push(";"),e.hash=t.join("")}_getEdgeIndices(){return this._edgeIndicesBuf||this._buildEdgeIndices(),this._edgeIndicesBuf}_getPickTrianglePositions(){return this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs(),this._pickTrianglePositionsBuf}_getPickTriangleColors(){return this._pickTriangleColorsBuf||this._buildPickTriangleVBOs(),this._pickTriangleColorsBuf}_buildEdgeIndices(){const e=this._state;if(!e.positions||!e.indices)return;const t=this.scene.canvas.gl,i=buildEdgeIndices(e.positions,e.indices,e.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new ArrayBuf(t,t.ELEMENT_ARRAY_BUFFER,i,i.length,1,t.STATIC_DRAW),memoryStats$1.indices+=this._edgeIndicesBuf.numItems}_buildPickTriangleVBOs(){const e=this._state;if(!e.positions||!e.indices)return;const t=this.scene.canvas.gl,i=math.buildPickTriangles(e.positions,e.indices,e.compressGeometry),s=i.positions,r=i.colors;this._pickTrianglePositionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,s.length,3,t.STATIC_DRAW),this._pickTriangleColorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,r,r.length,4,t.STATIC_DRAW,!0),memoryStats$1.positions+=this._pickTrianglePositionsBuf.numItems,memoryStats$1.colors+=this._pickTriangleColorsBuf.numItems}_buildPickVertexVBOs(){}_webglContextLost(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextLost()}_webglContextRestored(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextRestored(),this._buildVBOs(),this._edgeIndicesBuf=null,this._pickVertexPositionsBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._pickVertexPositionsBuf=null,this._pickVertexColorsBuf=null}get primitive(){return this._state.primitiveName}get compressGeometry(){return this._state.compressGeometry}get positions(){return this._state.positions?this._state.compressGeometry?(this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),geometryCompressionUtils.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions)),this._decompressedPositions):this._state.positions:null}set positions(e){const t=this._state,i=t.positions;if(i)if(i.length===e.length){if(this._state.compressGeometry){const i=geometryCompressionUtils.getPositionsBounds(e),s=geometryCompressionUtils.compressPositions(e,i.min,i.max);e=s.quantized,t.positionsDecodeMatrix=s.decodeMatrix}i.set(e),t.positionsBuf&&t.positionsBuf.setData(i),this._setAABBDirty(),this.glRedraw()}else this.error("can't update geometry positions - new positions are wrong length");else this.error("can't update geometry positions - geometry has no positions")}get normals(){if(this._state.normals){if(!this._state.compressGeometry)return this._state.normals;if(!this._decompressedNormals){const e=this._state.normals.length,t=e+e/2;this._decompressedNormals=new Float32Array(t),geometryCompressionUtils.decompressNormals(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}}set normals(e){if(this._state.compressGeometry)return void this.error("can't update geometry normals - quantized geometry is immutable");const t=this._state,i=t.normals;i?i.length===e.length?(i.set(e),t.normalsBuf&&t.normalsBuf.setData(i),this.glRedraw()):this.error("can't update geometry normals - new normals are wrong length"):this.error("can't update geometry normals - geometry has no normals")}get uv(){return this._state.uv?this._state.compressGeometry?(this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),geometryCompressionUtils.decompressUVs(this._state.uv,this._state.uvDecodeMatrix,this._decompressedUV)),this._decompressedUV):this._state.uv:null}set uv(e){if(this._state.compressGeometry)return void this.error("can't update geometry UVs - quantized geometry is immutable");const t=this._state,i=t.uv;i?i.length===e.length?(i.set(e),t.uvBuf&&t.uvBuf.setData(i),this.glRedraw()):this.error("can't update geometry UVs - new UVs are wrong length"):this.error("can't update geometry UVs - geometry has no UVs")}get colors(){return this._state.colors}set colors(e){if(this._state.compressGeometry)return void this.error("can't update geometry colors - quantized geometry is immutable");const t=this._state,i=t.colors;i?i.length===e.length?(i.set(e),t.colorsBuf&&t.colorsBuf.setData(i),this.glRedraw()):this.error("can't update geometry colors - new colors are wrong length"):this.error("can't update geometry colors - geometry has no colors")}get indices(){return this._state.indices}get aabb(){return this._aabbDirty&&(this._aabb||(this._aabb=math.AABB3()),math.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),this._aabbDirty=!1),this._aabb}get obb(){return this._obbDirty&&(this._obb||(this._obb=math.OBB3()),math.positions3ToAABB3(this._state.positions,tempAABB$2,this._state.positionsDecodeMatrix),math.AABB3ToOBB3(tempAABB$2,this._obb),this._obbDirty=!1),this._obb}get numTriangles(){return this._numTriangles}_setAABBDirty(){this._aabbDirty||(this._aabbDirty=!0,this._aabbDirty=!0,this._obbDirty=!0)}_getState(){return this._state}destroy(){super.destroy();const e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy(),this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy(),this._pickVertexPositionsBuf&&this._pickVertexPositionsBuf.destroy(),this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy(),e.destroy(),memoryStats$1.meshes--}}function buildBoxGeometry(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let i=e.ySize||1;i<0&&(console.error("negative ySize not allowed - will invert"),i*=-1);let s=e.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);const r=e.center,o=r?r[0]:0,a=r?r[1]:0,n=r?r[2]:0,h=-t+o,l=-i+a,c=-s+n,u=t+o,p=i+a,d=s+n;return utils.apply(e,{positions:[u,p,d,h,p,d,h,l,d,u,l,d,u,p,d,u,l,d,u,l,c,u,p,c,u,p,d,u,p,c,h,p,c,h,p,d,h,p,d,h,p,c,h,l,c,h,l,d,h,l,c,u,l,c,u,l,d,h,l,d,u,l,c,h,l,c,h,p,c,u,p,c],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}class Material extends Component{get type(){return"Material"}constructor(e,t={}){super(e,t),stats.memory.materials++}destroy(){super.destroy(),stats.memory.materials--}}const alphaModes$1={opaque:0,mask:1,blend:2},alphaModeNames$1=["opaque","mask","blend"];class PhongMaterial extends Material{get type(){return"PhongMaterial"}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"PhongMaterial",ambient:math.vec3([1,1,1]),diffuse:math.vec3([1,1,1]),specular:math.vec3([1,1,1]),emissive:math.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.ambient=t.ambient,this.diffuse=t.diffuse,this.specular=t.specular,this.emissive=t.emissive,this.alpha=t.alpha,this.shininess=t.shininess,this.reflectivity=t.reflectivity,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,t.ambientMap&&(this._ambientMap=this._checkComponent("Texture",t.ambientMap)),t.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",t.diffuseMap)),t.specularMap&&(this._specularMap=this._checkComponent("Texture",t.specularMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.reflectivityMap&&(this._reflectivityMap=this._checkComponent("Texture",t.reflectivityMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.diffuseFresnel&&(this._diffuseFresnel=this._checkComponent("Fresnel",t.diffuseFresnel)),t.specularFresnel&&(this._specularFresnel=this._checkComponent("Fresnel",t.specularFresnel)),t.emissiveFresnel&&(this._emissiveFresnel=this._checkComponent("Fresnel",t.emissiveFresnel)),t.alphaFresnel&&(this._alphaFresnel=this._checkComponent("Fresnel",t.alphaFresnel)),t.reflectivityFresnel&&(this._reflectivityFresnel=this._checkComponent("Fresnel",t.reflectivityFresnel)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this._makeHash()}_makeHash(){const e=this._state,t=["/p"];this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._ambientMap&&(t.push("/am"),this._ambientMap.hasMatrix&&t.push("/mat"),t.push("/"+this._ambientMap.encoding)),this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat"),t.push("/"+this._emissiveMap.encoding)),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),this._reflectivityMap&&(t.push("/rm"),this._reflectivityMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._diffuseFresnel&&t.push("/df"),this._specularFresnel&&t.push("/sf"),this._emissiveFresnel&&t.push("/ef"),this._alphaFresnel&&t.push("/of"),this._reflectivityFresnel&&t.push("/rf"),t.push(";"),e.hash=t.join("")}set ambient(e){let t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set diffuse(e){let t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}set specular(e){let t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get specular(){return this._state.specular}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}set shininess(e){this._state.shininess=void 0!==e?e:80,this.glRedraw()}get shininess(){return this._state.shininess}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set reflectivity(e){this._state.reflectivity=void 0!==e?e:1,this.glRedraw()}get reflectivity(){return this._state.reflectivity}get normalMap(){return this._normalMap}get ambientMap(){return this._ambientMap}get diffuseMap(){return this._diffuseMap}get specularMap(){return this._specularMap}get emissiveMap(){return this._emissiveMap}get alphaMap(){return this._alphaMap}get reflectivityMap(){return this._reflectivityMap}get occlusionMap(){return this._occlusionMap}get diffuseFresnel(){return this._diffuseFresnel}get specularFresnel(){return this._specularFresnel}get emissiveFresnel(){return this._emissiveFresnel}get alphaFresnel(){return this._alphaFresnel}get reflectivityFresnel(){return this._reflectivityFresnel}set alphaMode(e){let t=alphaModes$1[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" - defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return alphaModeNames$1[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}destroy(){super.destroy(),this._state.destroy()}}const PRESETS$3={default:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultWhiteBG:{fill:!0,fillColor:[1,1,1],fillAlpha:.6,edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultDarkBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1},phosphorous:{fill:!0,fillColor:[0,0,0],fillAlpha:.4,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2},sunset:{fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1},vectorscope:{fill:!0,fillColor:[0,0,0],fillAlpha:.7,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2},battlezone:{fill:!0,fillColor:[0,0,0],fillAlpha:1,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3},sepia:{fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},yellowHighlight:{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},greenSelected:{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4577854573726654,.529411792755127,.4100345969200134],edgeAlpha:1,edgeWidth:1},gamegrid:{fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9,edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3}};class EmphasisMaterial extends Material{get type(){return"EmphasisMaterial"}get presets(){return PRESETS$3}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"EmphasisMaterial",fill:null,fillColor:null,fillAlpha:null,edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,backfaces:!0,glowThrough:!0}),this._preset="default",t.preset?(this.preset=t.preset,void 0!==t.fill&&(this.fill=t.fill),t.fillColor&&(this.fillColor=t.fillColor),void 0!==t.fillAlpha&&(this.fillAlpha=t.fillAlpha),void 0!==t.edges&&(this.edges=t.edges),t.edgeColor&&(this.edgeColor=t.edgeColor),void 0!==t.edgeAlpha&&(this.edgeAlpha=t.edgeAlpha),void 0!==t.edgeWidth&&(this.edgeWidth=t.edgeWidth),void 0!==t.backfaces&&(this.backfaces=t.backfaces),void 0!==t.glowThrough&&(this.glowThrough=t.glowThrough)):(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.backfaces=t.backfaces,this.glowThrough=t.glowThrough)}set fill(e){e=!1!==e,this._state.fill!==e&&(this._state.fill=e,this.glRedraw())}get fill(){return this._state.fill}set fillColor(e){let t=this._state.fillColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.fillColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.4,t[1]=.4,t[2]=.4),this.glRedraw()}get fillColor(){return this._state.fillColor}set fillAlpha(e){e=null!=e?e:.2,this._state.fillAlpha!==e&&(this._state.fillAlpha=e,this.glRedraw())}get fillAlpha(){return this._state.fillAlpha}set edges(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(e){let t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(e){e=null!=e?e:.5,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(e){this._state.edgeWidth=e||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set glowThrough(e){e=!1!==e,this._state.glowThrough!==e&&(this._state.glowThrough=e,this.glRedraw())}get glowThrough(){return this._state.glowThrough}set preset(e){if(e=e||"default",this._preset===e)return;const t=PRESETS$3[e];t?(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.glowThrough=t.glowThrough,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(PRESETS$3).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}const PRESETS$2={default:{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}};class EdgeMaterial extends Material{get type(){return"EdgeMaterial"}get presets(){return PRESETS$2}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"EdgeMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null}),this._preset="default",t.preset?(this.preset=t.preset,t.edgeColor&&(this.edgeColor=t.edgeColor),void 0!==t.edgeAlpha&&(this.edgeAlpha=t.edgeAlpha),void 0!==t.edgeWidth&&(this.edgeWidth=t.edgeWidth)):(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth),this.edges=!1!==t.edges}set edges(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(e){let t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(e){e=null!=e?e:1,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(e){this._state.edgeWidth=e||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set preset(e){if(e=e||"default",this._preset===e)return;const t=PRESETS$2[e];t?(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(PRESETS$2).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}const unitsInfo={meters:{abbrev:"m"},metres:{abbrev:"m"},centimeters:{abbrev:"cm"},centimetres:{abbrev:"cm"},millimeters:{abbrev:"mm"},millimetres:{abbrev:"mm"},yards:{abbrev:"yd"},feet:{abbrev:"ft"},inches:{abbrev:"in"}};class Metrics extends Component{constructor(e,t={}){super(e,t),this._units="meters",this._scale=1,this._origin=math.vec3([0,0,0]),this.units=t.units,this.scale=t.scale,this.origin=t.origin}get unitsInfo(){return unitsInfo}set units(e){e||(e="meters");unitsInfo[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to 'meters'"),e="meters"),this._units=e,this.fire("units",this._units)}get units(){return this._units}set scale(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(this._scale=e,this.fire("scale",this._scale))}get scale(){return this._scale}set origin(e){if(!e)return this._origin[0]=0,this._origin[1]=0,void(this._origin[2]=0);this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this.fire("origin",this._origin)}get origin(){return this._origin}worldToRealPos(e,t=math.vec3(3)){t[0]=this._origin[0]+this._scale*e[0],t[1]=this._origin[1]+this._scale*e[1],t[2]=this._origin[2]+this._scale*e[2]}realToWorldPos(e,t=math.vec3(3)){return t[0]=(e[0]-this._origin[0])/this._scale,t[1]=(e[1]-this._origin[1])/this._scale,t[2]=(e[2]-this._origin[2])/this._scale,t}}class SAO extends Component{constructor(e,t={}){super(e,t);const i=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),s=i&&"safari"===i[1].toLowerCase();this._supported=!s&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_standard_derivatives,this.enabled=t.enabled,this.kernelRadius=t.kernelRadius,this.intensity=t.intensity,this.bias=t.bias,this.scale=t.scale,this.minResolution=t.minResolution,this.numSamples=t.numSamples,this.blur=t.blur,this.blendCutoff=t.blendCutoff,this.blendFactor=t.blendFactor}get supported(){return this._supported}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,this.glRedraw())}get enabled(){return this._enabled}get possible(){if(!this._supported)return!1;if(!this._enabled)return!1;const e=this.scene.camera.projection;return"customProjection"!==e&&"frustum"!==e}get active(){return this._active}set kernelRadius(e){null==e&&(e=100),this._kernelRadius!==e&&(this._kernelRadius=e,this.glRedraw())}get kernelRadius(){return this._kernelRadius}set intensity(e){null==e&&(e=.15),this._intensity!==e&&(this._intensity=e,this.glRedraw())}get intensity(){return this._intensity}set bias(e){null==e&&(e=.5),this._bias!==e&&(this._bias=e,this.glRedraw())}get bias(){return this._bias}set scale(e){null==e&&(e=1),this._scale!==e&&(this._scale=e,this.glRedraw())}get scale(){return this._scale}set minResolution(e){null==e&&(e=0),this._minResolution!==e&&(this._minResolution=e,this.glRedraw())}get minResolution(){return this._minResolution}set numSamples(e){null==e&&(e=10),this._numSamples!==e&&(this._numSamples=e,this.glRedraw())}get numSamples(){return this._numSamples}set blur(e){e=!1!==e,this._blur!==e&&(this._blur=e,this.glRedraw())}get blur(){return this._blur}set blendCutoff(e){null==e&&(e=.3),this._blendCutoff!==e&&(this._blendCutoff=e,this.glRedraw())}get blendCutoff(){return this._blendCutoff}set blendFactor(e){null==e&&(e=1),this._blendFactor!==e&&(this._blendFactor=e,this.glRedraw())}get blendFactor(){return this._blendFactor}destroy(){super.destroy()}}const PRESETS$1={default:{pointSize:4,roundPoints:!0,perspectivePoints:!0},square:{pointSize:4,roundPoints:!1,perspectivePoints:!0},round:{pointSize:4,roundPoints:!0,perspectivePoints:!0}};class PointsMaterial extends Material{get type(){return"PointsMaterial"}get presets(){return PRESETS$1}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"PointsMaterial",pointSize:null,roundPoints:null,perspectivePoints:null,minPerspectivePointSize:null,maxPerspectivePointSize:null,filterIntensity:null,minIntensity:null,maxIntensity:null}),t.preset?(this.preset=t.preset,void 0!==t.pointSize&&(this.pointSize=t.pointSize),void 0!==t.roundPoints&&(this.roundPoints=t.roundPoints),void 0!==t.perspectivePoints&&(this.perspectivePoints=t.perspectivePoints),void 0!==t.minPerspectivePointSize&&(this.minPerspectivePointSize=t.minPerspectivePointSize),void 0!==t.maxPerspectivePointSize&&(this.maxPerspectivePointSize=t.minPerspectivePointSize)):(this._preset="default",this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize),this.filterIntensity=t.filterIntensity,this.minIntensity=t.minIntensity,this.maxIntensity=t.maxIntensity}set pointSize(e){this._state.pointSize=e||2,this.glRedraw()}get pointSize(){return this._state.pointSize}set roundPoints(e){e=!1!==e,this._state.roundPoints!==e&&(this._state.roundPoints=e,this.scene._needRecompile=!0,this.glRedraw())}get roundPoints(){return this._state.roundPoints}set perspectivePoints(e){e=!1!==e,this._state.perspectivePoints!==e&&(this._state.perspectivePoints=e,this.scene._needRecompile=!0,this.glRedraw())}get perspectivePoints(){return this._state.perspectivePoints}set minPerspectivePointSize(e){this._state.minPerspectivePointSize=e||1,this.scene._needRecompile=!0,this.glRedraw()}get minPerspectivePointSize(){return this._state.minPerspectivePointSize}set maxPerspectivePointSize(e){this._state.maxPerspectivePointSize=e||6,this.scene._needRecompile=!0,this.glRedraw()}get maxPerspectivePointSize(){return this._state.maxPerspectivePointSize}set filterIntensity(e){e=!1!==e,this._state.filterIntensity!==e&&(this._state.filterIntensity=e,this.scene._needRecompile=!0,this.glRedraw())}get filterIntensity(){return this._state.filterIntensity}set minIntensity(e){this._state.minIntensity=null!=e?e:0,this.glRedraw()}get minIntensity(){return this._state.minIntensity}set maxIntensity(e){this._state.maxIntensity=null!=e?e:1,this.glRedraw()}get maxIntensity(){return this._state.maxIntensity}set preset(e){if(e=e||"default",this._preset===e)return;const t=PRESETS$1[e];t?(this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(PRESETS$1).join(", "))}get preset(){return this._preset}get hash(){return[this.pointSize,this.roundPoints,this.perspectivePoints,this.minPerspectivePointSize,this.maxPerspectivePointSize,this.filterIntensity].join(";")}destroy(){super.destroy(),this._state.destroy()}}const PRESETS={default:{lineWidth:1},thick:{lineWidth:2},thicker:{lineWidth:4}};class LinesMaterial extends Material{get type(){return"LinesMaterial"}get presets(){return PRESETS}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"LinesMaterial",lineWidth:null}),t.preset?(this.preset=t.preset,void 0!==t.lineWidth&&(this.lineWidth=t.lineWidth)):(this._preset="default",this.lineWidth=t.lineWidth)}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set preset(e){if(e=e||"default",this._preset===e)return;const t=PRESETS[e];t?(this.lineWidth=t.lineWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(PRESETS).join(", "))}get preset(){return this._preset}get hash(){return[""+this.lineWidth].join(";")}destroy(){super.destroy(),this._state.destroy()}}function getEntityIDMap(e,t){const i={};let s,r;for(let o=0,a=t.length;o<a;o++)s=t[o],r=e.component[s],r?r.isEntity?i[s]=!0:e.warn("pick(): Component is not an Entity: "+s):e.warn("pick(): Component not found: "+s);return i}class Scene extends Component{get type(){return"Scene"}constructor(e,t={}){super(null,t);const i=t.canvasElement||document.getElementById(t.canvasId);if(!(i instanceof HTMLCanvasElement))throw"Mandatory config expected: valid canvasId or canvasElement";const s=!!t.transparent,r=!!t.alphaDepthMask;this._aabbDirty=!0,this.viewer=e,this.occlusionTestCountdown=0,this.loading=0,this.startTime=(new Date).getTime(),this.models={},this.objects={},this._numObjects=0,this.visibleObjects={},this._numVisibleObjects=0,this.xrayedObjects={},this._numXRayedObjects=0,this.highlightedObjects={},this._numHighlightedObjects=0,this.selectedObjects={},this._numSelectedObjects=0,this.colorizedObjects={},this._numColorizedObjects=0,this.opacityObjects={},this._numOpacityObjects=0,this.offsetObjects={},this._numOffsetObjects=0,this._modelIds=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this._opacityObjectIds=null,this._offsetObjectIds=null,this._collidables={},this._compilables={},this._needRecompile=!1,this.types={},this.components={},this.sectionPlanes={},this.lights={},this.lightMaps={},this.reflectionMaps={},this.realWorldOffset=t.realWorldOffset||new Float64Array([0,0,0]),this.canvas=new Canvas(this,{dontClear:!0,canvas:i,spinnerElementId:t.spinnerElementId,transparent:s,webgl2:!1!==t.webgl2,contextAttr:t.contextAttr||{},backgroundColor:t.backgroundColor,backgroundColorFromAmbientLight:t.backgroundColorFromAmbientLight,premultipliedAlpha:t.premultipliedAlpha}),this.canvas.on("boundary",(()=>{this.glRedraw()})),this.canvas.on("webglContextFailed",(()=>{alert("xeokit failed to find WebGL!")})),this._renderer=new Renderer(this,{transparent:s,alphaDepthMask:r}),this._sectionPlanesState=new function(){this.sectionPlanes=[],this.clippingCaps=!1;let e=null;this.getHash=function(){if(e)return e;const t=this.sectionPlanes;if(0===t.length)return this.hash=";";const i=[];for(let e=0,s=t.length;e<s;e++)t[e],i.push("cp");return i.push(";"),e=i.join(""),e},this.addSectionPlane=function(t){this.sectionPlanes.push(t),e=null},this.removeSectionPlane=function(t){for(let i=0,s=this.sectionPlanes.length;i<s;i++)if(this.sectionPlanes[i].id===t.id)return this.sectionPlanes.splice(i,1),void(e=null)}},this._lightsState=new function(){const e=math.vec4([0,0,0,0]),t=math.vec4();this.lights=[],this.reflectionMaps=[],this.lightMaps=[];let i=null,s=null;this.getHash=function(){if(i)return i;const e=[],t=this.lights;let s;for(let i=0,r=t.length;i<r;i++)s=t[i],e.push("/"),e.push(s.type),e.push("world"===s.space?"w":"v"),s.castsShadow&&e.push("sh");return this.lightMaps.length>0&&e.push("/lm"),this.reflectionMaps.length>0&&e.push("/rm"),e.push(";"),i=e.join(""),i},this.addLight=function(e){this.lights.push(e),s=null,i=null},this.removeLight=function(e){for(let t=0,r=this.lights.length;t<r;t++){if(this.lights[t].id===e.id)return this.lights.splice(t,1),s&&s.id===e.id&&(s=null),void(i=null)}},this.addReflectionMap=function(e){this.reflectionMaps.push(e),i=null},this.removeReflectionMap=function(e){for(let t=0,s=this.reflectionMaps.length;t<s;t++)if(this.reflectionMaps[t].id===e.id)return this.reflectionMaps.splice(t,1),void(i=null)},this.addLightMap=function(e){this.lightMaps.push(e),i=null},this.removeLightMap=function(e){for(let t=0,s=this.lightMaps.length;t<s;t++)if(this.lightMaps[t].id===e.id)return this.lightMaps.splice(t,1),void(i=null)},this.getAmbientColorAndIntensity=function(){if(!s)for(let e=0,t=this.lights.length;e<t;e++){const t=this.lights[e];if("ambient"===t.type){s=t;break}}if(s){const e=s.color,i=s.intensity;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=i,t}return e}},this.input=new Input(this,{dontClear:!0,element:this.canvas.canvas,keyboardEventsElement:t.keyboardEventsElement}),this.metrics=new Metrics(this,{units:t.units,scale:t.scale,origin:t.origin}),this.sao=new SAO(this,{enabled:t.saoEnabled}),this.ticksPerRender=t.ticksPerRender,this.ticksPerOcclusionTest=t.ticksPerOcclusionTest,this.passes=t.passes,this.clearEachPass=t.clearEachPass,this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.gammaFactor=t.gammaFactor,this._entityOffsetsEnabled=!!t.entityOffsetsEnabled,this._pickSurfacePrecisionEnabled=!!t.pickSurfacePrecisionEnabled,this._logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,this._pbrEnabled=!!t.pbrEnabled,this._colorTextureEnabled=!1!==t.colorTextureEnabled,core._addScene(this),this._initDefaults(),this._viewport=new Viewport(this,{id:"default.viewport",autoBoundary:!0,dontClear:!0}),this._camera=new Camera(this,{id:"default.camera",dontClear:!0}),new AmbientLight(this,{color:[1,1,1],intensity:.7}),new DirLight(this,{dir:[.8,-.5,-.5],color:[.67,.67,1],intensity:.7,space:"world"}),new DirLight(this,{dir:[-.8,-1,.5],color:[1,1,.9],intensity:.9,space:"world"}),this._camera.on("dirty",(()=>{this._renderer.imageDirty()}))}_initDefaults(){this.geometry,this.material,this.xrayMaterial,this.edgeMaterial,this.selectedMaterial,this.highlightMaterial}_addComponent(e){if(e.id&&this.components[e.id]&&(this.error("Component "+utils.inQuotes(e.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),e.id=null),!e.id)for(void 0===window.nextID&&(window.nextID=0),e.id="__"+window.nextID++;this.components[e.id];)e.id=math.createUUID();this.components[e.id]=e;const t=e.type;let i=this.types[e.type];i||(i=this.types[t]={}),i[e.id]=e,e.compile&&(this._compilables[e.id]=e),e.isDrawable&&(this._renderer.addDrawable(e.id,e),this._collidables[e.id]=e)}_removeComponent(e){var t=e.id,i=e.type;delete this.components[t];const s=this.types[i];s&&(delete s[t],utils.isEmptyObject(s)&&delete this.types[i]),e.compile&&delete this._compilables[e.id],e.isDrawable&&(this._renderer.removeDrawable(e.id),delete this._collidables[e.id])}_sectionPlaneCreated(e){this.sectionPlanes[e.id]=e,this.scene._sectionPlanesState.addSectionPlane(e._state),this.scene.fire("sectionPlaneCreated",e,!0),this._needRecompile=!0}_lightCreated(e){this.lights[e.id]=e,this.scene._lightsState.addLight(e._state),this._needRecompile=!0}_lightMapCreated(e){this.lightMaps[e.id]=e,this.scene._lightsState.addLightMap(e._state),this._needRecompile=!0}_reflectionMapCreated(e){this.reflectionMaps[e.id]=e,this.scene._lightsState.addReflectionMap(e._state),this._needRecompile=!0}_sectionPlaneDestroyed(e){delete this.sectionPlanes[e.id],this.scene._sectionPlanesState.removeSectionPlane(e._state),this.scene.fire("sectionPlaneDestroyed",e,!0),this._needRecompile=!0}_lightDestroyed(e){delete this.lights[e.id],this.scene._lightsState.removeLight(e._state),this._needRecompile=!0}_lightMapDestroyed(e){delete this.lightMaps[e.id],this.scene._lightsState.removeLightMap(e._state),this._needRecompile=!0}_reflectionMapDestroyed(e){delete this.reflectionMaps[e.id],this.scene._lightsState.removeReflectionMap(e._state),this._needRecompile=!0}_registerModel(e){this.models[e.id]=e,this._modelIds=null}_deregisterModel(e){const t=e.id;delete this.models[t],this._modelIds=null,this.fire("modelUnloaded",t)}_registerObject(e){this.objects[e.id]=e,this._numObjects++,this._objectIds=null}_deregisterObject(e){delete this.objects[e.id],this._numObjects--,this._objectIds=null}_objectVisibilityUpdated(e,t=!0){e.visible?(this.visibleObjects[e.id]=e,this._numVisibleObjects++):(delete this.visibleObjects[e.id],this._numVisibleObjects--),this._visibleObjectIds=null,t&&this.fire("objectVisibility",e,!0)}_objectXRayedUpdated(e){e.xrayed?(this.xrayedObjects[e.id]=e,this._numXRayedObjects++):(delete this.xrayedObjects[e.id],this._numXRayedObjects--),this._xrayedObjectIds=null}_objectHighlightedUpdated(e){e.highlighted?(this.highlightedObjects[e.id]=e,this._numHighlightedObjects++):(delete this.highlightedObjects[e.id],this._numHighlightedObjects--),this._highlightedObjectIds=null}_objectSelectedUpdated(e){e.selected?(this.selectedObjects[e.id]=e,this._numSelectedObjects++):(delete this.selectedObjects[e.id],this._numSelectedObjects--),this._selectedObjectIds=null}_objectColorizeUpdated(e,t){t?(this.colorizedObjects[e.id]=e,this._numColorizedObjects++):(delete this.colorizedObjects[e.id],this._numColorizedObjects--),this._colorizedObjectIds=null}_objectOpacityUpdated(e,t){t?(this.opacityObjects[e.id]=e,this._numOpacityObjects++):(delete this.opacityObjects[e.id],this._numOpacityObjects--),this._opacityObjectIds=null}_objectOffsetUpdated(e,t){!t||0===t[0]&&0===t[1]&&0===t[2]?(this.offsetObjects[e.id]=e,this._numOffsetObjects++):(delete this.offsetObjects[e.id],this._numOffsetObjects--),this._offsetObjectIds=null}_webglContextLost(){this.canvas.spinner.processes++;for(const e in this.components)if(this.components.hasOwnProperty(e)){const t=this.components[e];t._webglContextLost&&t._webglContextLost()}this._renderer.webglContextLost()}_webglContextRestored(){const e=this.canvas.gl;for(const t in this.components)if(this.components.hasOwnProperty(t)){const i=this.components[t];i._webglContextRestored&&i._webglContextRestored(e)}this._renderer.webglContextRestored(e),this.canvas.spinner.processes--}get entityOffsetsEnabled(){return this._entityOffsetsEnabled}get pickSurfacePrecisionEnabled(){return this._pickSurfacePrecisionEnabled}get logarithmicDepthBufferEnabled(){return this._logarithmicDepthBufferEnabled}set pbrEnabled(e){this._pbrEnabled=!!e,this.glRedraw()}get pbrEnabled(){return this._pbrEnabled}set colorTextureEnabled(e){this._colorTextureEnabled=!!e,this.glRedraw()}get colorTextureEnabled(){return this._colorTextureEnabled}doOcclusionTest(){this._needRecompile&&(this._recompile(),this._needRecompile=!1),this._renderer.doOcclusionTest()}render(e){e&&core.runTasks();const t={sceneId:null,pass:0};if(this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),!e&&!this._renderer.needsRender())return;t.sceneId=this.id;const i=this._passes,s=this._clearEachPass;let r,o;for(r=0;r<i;r++)t.pass=r,this.fire("rendering",t,!0),o=s||0===r,this._renderer.render({pass:r,clear:o,force:e}),this.fire("rendered",t,!0);this._saveAmbientColor()}_recompile(){for(const e in this._compilables)this._compilables.hasOwnProperty(e)&&this._compilables[e].compile();this._renderer.shadowsDirty(),this.fire("compile",this,!0)}_saveAmbientColor(){const e=this.canvas;if(e.transparent||e.backgroundImage||e.backgroundColor)this._lastAmbientColor=null;else{const t=this._lightsState.getAmbientColorAndIntensity();this._lastAmbientColor&&this._lastAmbientColor[0]===t[0]&&this._lastAmbientColor[1]===t[1]&&this._lastAmbientColor[2]===t[2]&&this._lastAmbientColor[3]===t[3]||(e.backgroundColor=t,this._lastAmbientColor||(this._lastAmbientColor=math.vec4([0,0,0,1])),this._lastAmbientColor.set(t))}}get modelIds(){return this._modelIds||(this._modelIds=Object.keys(this.models)),this._modelIds}get numObjects(){return this._numObjects}get objectIds(){return this._objectIds||(this._objectIds=Object.keys(this.objects)),this._objectIds}get numVisibleObjects(){return this._numVisibleObjects}get visibleObjectIds(){return this._visibleObjectIds||(this._visibleObjectIds=Object.keys(this.visibleObjects)),this._visibleObjectIds}get numXRayedObjects(){return this._numXRayedObjects}get xrayedObjectIds(){return this._xrayedObjectIds||(this._xrayedObjectIds=Object.keys(this.xrayedObjects)),this._xrayedObjectIds}get numHighlightedObjects(){return this._numHighlightedObjects}get highlightedObjectIds(){return this._highlightedObjectIds||(this._highlightedObjectIds=Object.keys(this.highlightedObjects)),this._highlightedObjectIds}get numSelectedObjects(){return this._numSelectedObjects}get selectedObjectIds(){return this._selectedObjectIds||(this._selectedObjectIds=Object.keys(this.selectedObjects)),this._selectedObjectIds}get numColorizedObjects(){return this._numColorizedObjects}get colorizedObjectIds(){return this._colorizedObjectIds||(this._colorizedObjectIds=Object.keys(this.colorizedObjects)),this._colorizedObjectIds}get opacityObjectIds(){return this._opacityObjectIds||(this._opacityObjectIds=Object.keys(this.opacityObjects)),this._opacityObjectIds}get offsetObjectIds(){return this._offsetObjectIds||(this._offsetObjectIds=Object.keys(this.offsetObjects)),this._offsetObjectIds}set ticksPerRender(e){null==e?e=1:(!utils.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerRender': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._ticksPerRender&&(this._ticksPerRender=e)}get ticksPerRender(){return this._ticksPerRender}set ticksPerOcclusionTest(e){null==e?e=20:(!utils.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerOcclusionTest': '"+e+"' - should be an integer greater than zero."),e=20),e!==this._ticksPerOcclusionTest&&(this._ticksPerOcclusionTest=e)}get ticksPerOcclusionTest(){return this._ticksPerOcclusionTest}set passes(e){null==e?e=1:(!utils.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'passes': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._passes&&(this._passes=e,this.glRedraw())}get passes(){return this._passes}set clearEachPass(e){(e=!!e)!==this._clearEachPass&&(this._clearEachPass=e,this.glRedraw())}get clearEachPass(){return this._clearEachPass}set gammaInput(e){(e=!1!==e)!==this._renderer.gammaInput&&(this._renderer.gammaInput=e,this._needRecompile=!0,this.glRedraw())}get gammaInput(){return this._renderer.gammaInput}set gammaOutput(e){(e=!!e)!==this._renderer.gammaOutput&&(this._renderer.gammaOutput=e,this._needRecompile=!0,this.glRedraw())}get gammaOutput(){return this._renderer.gammaOutput}set gammaFactor(e){(e=null==e?2.2:e)!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=e,this.glRedraw())}get gammaFactor(){return this._renderer.gammaFactor}get geometry(){return this.components["default.geometry"]||buildBoxGeometry(ReadableGeometry)}get material(){return this.components["default.material"]||new PhongMaterial(this,{id:"default.material",emissive:[.4,.4,.4],dontClear:!0})}get xrayMaterial(){return this.components["default.xrayMaterial"]||new EmphasisMaterial(this,{id:"default.xrayMaterial",preset:"sepia",dontClear:!0})}get highlightMaterial(){return this.components["default.highlightMaterial"]||new EmphasisMaterial(this,{id:"default.highlightMaterial",preset:"yellowHighlight",dontClear:!0})}get selectedMaterial(){return this.components["default.selectedMaterial"]||new EmphasisMaterial(this,{id:"default.selectedMaterial",preset:"greenSelected",dontClear:!0})}get edgeMaterial(){return this.components["default.edgeMaterial"]||new EdgeMaterial(this,{id:"default.edgeMaterial",preset:"default",edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get pointsMaterial(){return this.components["default.pointsMaterial"]||new PointsMaterial(this,{id:"default.pointsMaterial",preset:"default",dontClear:!0})}get linesMaterial(){return this.components["default.linesMaterial"]||new LinesMaterial(this,{id:"default.linesMaterial",preset:"default",dontClear:!0})}get viewport(){return this._viewport}get camera(){return this._camera}get center(){if(this._aabbDirty||!this._center){this._center&&this._center||(this._center=math.vec3());const e=this.aabb;this._center[0]=(e[0]+e[3])/2,this._center[1]=(e[1]+e[4])/2,this._center[2]=(e[2]+e[5])/2}return this._center}get aabb(){if(this._aabbDirty){this._aabb||(this._aabb=math.AABB3());let e,t=math.MAX_DOUBLE,i=math.MAX_DOUBLE,s=math.MAX_DOUBLE,r=math.MIN_DOUBLE,o=math.MIN_DOUBLE,a=math.MIN_DOUBLE;const n=this._collidables;let h,l=!1;for(const c in n)if(n.hasOwnProperty(c)){if(h=n[c],!1===h.collidable)continue;e=h.aabb,e[0]<t&&(t=e[0]),e[1]<i&&(i=e[1]),e[2]<s&&(s=e[2]),e[3]>r&&(r=e[3]),e[4]>o&&(o=e[4]),e[5]>a&&(a=e[5]),l=!0}l||(t=-100,i=-100,s=-100,r=100,o=100,a=100),this._aabb[0]=t,this._aabb[1]=i,this._aabb[2]=s,this._aabb[3]=r,this._aabb[4]=o,this._aabb[5]=a,this._aabbDirty=!1}return this._aabb}_setAABBDirty(){this._aabbDirty=!0,this.fire("boundary")}pick(e,t){if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;(e=e||{}).pickSurface=e.pickSurface||e.rayPick,e.canvasPos||e.matrix||e.origin&&e.direction||this.warn("picking without canvasPos, matrix, or ray origin and direction");const i=e.includeEntities||e.include;i&&(e.includeEntityIds=getEntityIDMap(this,i));const s=e.excludeEntities||e.exclude;return s&&(e.excludeEntityIds=getEntityIDMap(this,s)),this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),(t=this._renderer.pick(e,t))?(t.entity&&t.entity.fire&&t.entity.fire("picked",t),t):void 0}clear(){var e;for(const t in this.components)this.components.hasOwnProperty(t)&&((e=this.components[t])._dontClear||e.destroy())}clearLights(){const e=Object.keys(this.lights);for(let t=0,i=e.length;t<i;t++)this.lights[e[t]].destroy()}clearSectionPlanes(){const e=Object.keys(this.sectionPlanes);for(let t=0,i=e.length;t<i;t++)this.sectionPlanes[e[t]].destroy()}getAABB(e){if(void 0===e)return this.aabb;if(utils.isString(e)){const t=this.objects[e];if(t&&t.aabb)return t.aabb;e=[e]}if(0===e.length)return this.aabb;let t,i=math.MAX_DOUBLE,s=math.MAX_DOUBLE,r=math.MAX_DOUBLE,o=math.MIN_DOUBLE,a=math.MIN_DOUBLE,n=math.MIN_DOUBLE;if(this.withObjects(e,(e=>{if(e.collidable){const h=e.aabb;h[0]<i&&(i=h[0]),h[1]<s&&(s=h[1]),h[2]<r&&(r=h[2]),h[3]>o&&(o=h[3]),h[4]>a&&(a=h[4]),h[5]>n&&(n=h[5]),t=!0}})),t){const e=math.AABB3();return e[0]=i,e[1]=s,e[2]=r,e[3]=o,e[4]=a,e[5]=n,e}return this.aabb}setObjectsVisible(e,t){return this.withObjects(e,(e=>{const i=e.visible!==t;return e.visible=t,i}))}setObjectsCollidable(e,t){return this.withObjects(e,(e=>{const i=e.collidable!==t;return e.collidable=t,i}))}setObjectsCulled(e,t){return this.withObjects(e,this.objects,(e=>{const i=e.culled!==t;return e.culled=t,i}))}setObjectsSelected(e,t){return this.withObjects(e,(e=>{const i=e.selected!==t;return e.selected=t,i}))}setObjectsHighlighted(e,t){return this.withObjects(e,(e=>{const i=e.highlighted!==t;return e.highlighted=t,i}))}setObjectsXRayed(e,t){return this.withObjects(e,(e=>{const i=e.xrayed!==t;return e.xrayed=t,i}))}setObjectsEdges(e,t){return this.withObjects(e,(e=>{const i=e.edges!==t;return e.edges=t,i}))}setObjectsColorized(e,t){return this.withObjects(e,(e=>{e.colorize=t}))}setObjectsOpacity(e,t){return this.withObjects(e,(e=>{const i=e.opacity!==t;return e.opacity=t,i}))}setObjectsPickable(e,t){return this.withObjects(e,(e=>{const i=e.pickable!==t;return e.pickable=t,i}))}setObjectsOffset(e,t){this.withObjects(e,(e=>{e.offset=t}))}withObjects(e,t){utils.isString(e)&&(e=[e]);let i=!1;for(let s=0,r=e.length;s<r;s++){const r=e[s];let o=this.objects[r];if(o)i=t(o)||i;else{const e=this.modelIds;for(let s=0,a=e.length;s<a;s++){const a=e[s],n=math.globalizeObjectId(a,r);o=this.objects[n],o&&(i=t(o)||i)}}}return i}destroy(){super.destroy();for(const e in this.components)this.components.hasOwnProperty(e)&&this.components[e].destroy();this.canvas.gl=null,this.components=null,this.models=null,this.objects=null,this.visibleObjects=null,this.xrayedObjects=null,this.highlightedObjects=null,this.selectedObjects=null,this.colorizedObjects=null,this.opacityObjects=null,this.sectionPlanes=null,this.lights=null,this.lightMaps=null,this.reflectionMaps=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this.types=null,this.components=null,this.canvas=null,this._renderer=null,this.input=null,this._viewport=null,this._camera=null}}const DrawShaderSource=function(e){"LambertMaterial"===e._material._state.type?(this.vertex=buildVertexLambert(e),this.fragment=buildFragmentLambert(e)):(this.vertex=buildVertexDraw(e),this.fragment=buildFragmentDraw(e))},TEXTURE_DECODE_FUNCS$2={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};function getReceivesShadow(e){if(!e.receivesShadow)return!1;const t=e.scene._lightsState.lights;if(!t||0===t.length)return!1;for(let e=0,i=t.length;e<i;e++)if(t[e].castsShadow)return!0;return!1}function hasTextures(e){if(!e._geometry._state.uvBuf)return!1;const t=e._material;return!!(t._ambientMap||t._occlusionMap||t._baseColorMap||t._diffuseMap||t._alphaMap||t._specularMap||t._glossinessMap||t._specularGlossinessMap||t._emissiveMap||t._metallicMap||t._roughnessMap||t._metallicRoughnessMap||t._reflectivityMap||t._normalMap)}function hasNormals$1(e){const t=e._geometry._state.primitiveName;return!(!e._geometry._state.autoVertexNormals&&!e._geometry._state.normalsBuf||"triangles"!==t&&"triangle-strip"!==t&&"triangle-fan"!==t)}function buildVertexLambert(e){const t=e.scene,i=e.scene._sectionPlanesState,s=e.scene._lightsState,r=e._geometry._state,o=e._state.billboard,a=e._state.stationary,n=i.sectionPlanes.length>0,h=!!r.compressGeometry,l=[];if(l.push("// Lambertian drawing vertex shader"),t.logarithmicDepthBufferEnabled&&l.push("#extension GL_EXT_frag_depth : enable"),l.push("attribute vec3 position;"),l.push("uniform mat4 modelMatrix;"),l.push("uniform mat4 viewMatrix;"),l.push("uniform mat4 projMatrix;"),l.push("uniform vec4 colorize;"),l.push("uniform vec3 offset;"),h&&l.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(l.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&l.push("varying float vFragDepth;"),l.push("bool isPerspectiveMatrix(mat4 m) {"),l.push("    return (m[2][3] == - 1.0);"),l.push("}"),l.push("varying float isPerspective;")),n&&l.push("varying vec4 vWorldPosition;"),l.push("uniform vec4 lightAmbient;"),l.push("uniform vec4 materialColor;"),l.push("uniform vec3 materialEmissive;"),r.normalsBuf){l.push("attribute vec3 normal;"),l.push("uniform mat4 modelNormalMatrix;"),l.push("uniform mat4 viewNormalMatrix;");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];"ambient"!==t.type&&(l.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&l.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&l.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(l.push("uniform vec3 lightPos"+e+";"),l.push("uniform vec3 lightDir"+e+";")))}h&&(l.push("vec3 octDecode(vec2 oct) {"),l.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),l.push("    if (v.z < 0.0) {"),l.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),l.push("    }"),l.push("    return normalize(v);"),l.push("}"))}if(l.push("varying vec4 vColor;"),"points"===r.primitiveName&&l.push("uniform float pointSize;"),"spherical"!==o&&"cylindrical"!==o||(l.push("void billboard(inout mat4 mat) {"),l.push("   mat[0][0] = 1.0;"),l.push("   mat[0][1] = 0.0;"),l.push("   mat[0][2] = 0.0;"),"spherical"===o&&(l.push("   mat[1][0] = 0.0;"),l.push("   mat[1][1] = 1.0;"),l.push("   mat[1][2] = 0.0;")),l.push("   mat[2][0] = 0.0;"),l.push("   mat[2][1] = 0.0;"),l.push("   mat[2][2] =1.0;"),l.push("}")),l.push("void main(void) {"),l.push("vec4 localPosition = vec4(position, 1.0); "),l.push("vec4 worldPosition;"),h&&l.push("localPosition = positionsDecodeMatrix * localPosition;"),r.normalsBuf&&(h?l.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):l.push("vec4 localNormal = vec4(normal, 0.0); "),l.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),l.push("mat4 viewNormalMatrix2 = viewNormalMatrix;")),l.push("mat4 viewMatrix2 = viewMatrix;"),l.push("mat4 modelMatrix2 = modelMatrix;"),a&&l.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"),"spherical"===o||"cylindrical"===o?(l.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),l.push("billboard(modelMatrix2);"),l.push("billboard(viewMatrix2);"),l.push("billboard(modelViewMatrix);"),r.normalsBuf&&(l.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),l.push("billboard(modelNormalMatrix2);"),l.push("billboard(viewNormalMatrix2);"),l.push("billboard(modelViewNormalMatrix);")),l.push("worldPosition = modelMatrix2 * localPosition;"),l.push("worldPosition.xyz = worldPosition.xyz + offset;"),l.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(l.push("worldPosition = modelMatrix2 * localPosition;"),l.push("worldPosition.xyz = worldPosition.xyz + offset;"),l.push("vec4 viewPosition  = viewMatrix2 * worldPosition; ")),r.normalsBuf&&l.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);"),l.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),l.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),l.push("float lambertian = 1.0;"),r.normalsBuf)for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?l.push("viewLightDir = normalize(lightDir"+e+");"):l.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?l.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):l.push("viewLightDir = -normalize((viewMatrix2 * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?l.push("viewLightDir = normalize(lightDir"+e+");"):l.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+e+", 0.0)).xyz);")}l.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),l.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return l.push("vColor = vec4((lightAmbient.rgb * lightAmbient.a * materialColor.rgb) + materialEmissive.rgb + (reflectedColor * materialColor.rgb), materialColor.a) * colorize;"),n&&l.push("vWorldPosition = worldPosition;"),"points"===r.primitiveName&&l.push("gl_PointSize = pointSize;"),l.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?l.push("vFragDepth = 1.0 + clipPos.w;"):(l.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),l.push("clipPos.z *= clipPos.w;")),l.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),l.push("gl_Position = clipPos;"),l.push("}"),l}function buildFragmentLambert(e){const t=e.scene,i=t._sectionPlanesState;e._material._state;const s=e._geometry._state,r=i.sectionPlanes.length>0,o=t.gammaOutput,a=[];if(a.push("// Lambertian drawing fragment shader"),t.logarithmicDepthBufferEnabled&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),a.push("precision highp float;"),a.push("precision highp int;"),a.push("#else"),a.push("precision mediump float;"),a.push("precision mediump int;"),a.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(a.push("varying float isPerspective;"),a.push("uniform float logDepthBufFC;"),a.push("varying float vFragDepth;")),r){a.push("varying vec4 vWorldPosition;"),a.push("uniform bool clippable;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)a.push("uniform bool sectionPlaneActive"+e+";"),a.push("uniform vec3 sectionPlanePos"+e+";"),a.push("uniform vec3 sectionPlaneDir"+e+";")}if(a.push("varying vec4 vColor;"),o&&(a.push("uniform float gammaFactor;"),a.push("    vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),a.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),a.push("}")),a.push("void main(void) {"),r){a.push("if (clippable) {"),a.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)a.push("if (sectionPlaneActive"+e+") {"),a.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),a.push("}");a.push("  if (dist > 0.0) { discard; }"),a.push("}")}return"points"===s.primitiveName&&(a.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),a.push("float r = dot(cxy, cxy);"),a.push("if (r > 1.0) {"),a.push("   discard;"),a.push("}")),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o?a.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):a.push("gl_FragColor = vColor;"),a.push("}"),a}function buildVertexDraw(e){const t=e.scene,i=e._material,s=e._state,r=t._sectionPlanesState,o=e._geometry._state,a=t._lightsState;let n;const h=s.billboard,l=s.background,c=s.stationary,u=hasTextures(e),p=hasNormals$1(e),d=r.sectionPlanes.length>0,m=getReceivesShadow(e),f=!!o.compressGeometry,g=[];if(g.push("// Drawing vertex shader"),p&&i._normalMap&&g.push("#extension GL_OES_standard_derivatives : enable"),t.logarithmicDepthBufferEnabled&&g.push("#extension GL_EXT_frag_depth : enable"),g.push("attribute  vec3 position;"),f&&g.push("uniform mat4 positionsDecodeMatrix;"),g.push("uniform  mat4 modelMatrix;"),g.push("uniform  mat4 viewMatrix;"),g.push("uniform  mat4 projMatrix;"),g.push("varying  vec3 vViewPosition;"),g.push("uniform  vec3 offset;"),d&&g.push("varying vec4 vWorldPosition;"),t.logarithmicDepthBufferEnabled&&(g.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&g.push("varying float vFragDepth;"),g.push("bool isPerspectiveMatrix(mat4 m) {"),g.push("    return (m[2][3] == - 1.0);"),g.push("}"),g.push("varying float isPerspective;")),a.lightMaps.length>0&&g.push("varying    vec3 vWorldNormal;"),p){g.push("attribute  vec3 normal;"),g.push("uniform    mat4 modelNormalMatrix;"),g.push("uniform    mat4 viewNormalMatrix;"),g.push("varying    vec3 vViewNormal;");for(let e=0,t=a.lights.length;e<t;e++)n=a.lights[e],"ambient"!==n.type&&("dir"===n.type&&g.push("uniform vec3 lightDir"+e+";"),"point"===n.type&&g.push("uniform vec3 lightPos"+e+";"),"spot"===n.type&&(g.push("uniform vec3 lightPos"+e+";"),g.push("uniform vec3 lightDir"+e+";")),"dir"===n.type&&"view"===n.space||g.push("varying vec4 vViewLightReverseDirAndDist"+e+";"));f&&(g.push("vec3 octDecode(vec2 oct) {"),g.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),g.push("    if (v.z < 0.0) {"),g.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),g.push("    }"),g.push("    return normalize(v);"),g.push("}"))}if(u&&(g.push("attribute vec2 uv;"),g.push("varying vec2 vUV;"),f&&g.push("uniform mat3 uvDecodeMatrix;")),o.colors&&(g.push("attribute vec4 color;"),g.push("varying vec4 vColor;")),"points"===o.primitiveName&&g.push("uniform float pointSize;"),"spherical"!==h&&"cylindrical"!==h||(g.push("void billboard(inout mat4 mat) {"),g.push("   mat[0][0] = 1.0;"),g.push("   mat[0][1] = 0.0;"),g.push("   mat[0][2] = 0.0;"),"spherical"===h&&(g.push("   mat[1][0] = 0.0;"),g.push("   mat[1][1] = 1.0;"),g.push("   mat[1][2] = 0.0;")),g.push("   mat[2][0] = 0.0;"),g.push("   mat[2][1] = 0.0;"),g.push("   mat[2][2] =1.0;"),g.push("}")),m){g.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);");for(let e=0,t=a.lights.length;e<t;e++)a.lights[e].castsShadow&&(g.push("uniform mat4 shadowViewMatrix"+e+";"),g.push("uniform mat4 shadowProjMatrix"+e+";"),g.push("varying vec4 vShadowPosFromLight"+e+";"))}if(g.push("void main(void) {"),g.push("vec4 localPosition = vec4(position, 1.0); "),g.push("vec4 worldPosition;"),f&&g.push("localPosition = positionsDecodeMatrix * localPosition;"),p&&(f?g.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):g.push("vec4 localNormal = vec4(normal, 0.0); "),g.push("mat4 modelNormalMatrix2    = modelNormalMatrix;"),g.push("mat4 viewNormalMatrix2     = viewNormalMatrix;")),g.push("mat4 viewMatrix2           = viewMatrix;"),g.push("mat4 modelMatrix2          = modelMatrix;"),c?g.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"):l&&g.push("viewMatrix2[3] = vec4(0.0, 0.0, 0.0 ,1.0);"),"spherical"===h||"cylindrical"===h?(g.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),g.push("billboard(modelMatrix2);"),g.push("billboard(viewMatrix2);"),g.push("billboard(modelViewMatrix);"),p&&(g.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),g.push("billboard(modelNormalMatrix2);"),g.push("billboard(viewNormalMatrix2);"),g.push("billboard(modelViewNormalMatrix);")),g.push("worldPosition = modelMatrix2 * localPosition;"),g.push("worldPosition.xyz = worldPosition.xyz + offset;"),g.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(g.push("worldPosition = modelMatrix2 * localPosition;"),g.push("worldPosition.xyz = worldPosition.xyz + offset;"),g.push("vec4 viewPosition  = viewMatrix2 * worldPosition; ")),p){g.push("vec3 worldNormal = (modelNormalMatrix2 * localNormal).xyz; "),a.lightMaps.length>0&&g.push("vWorldNormal = worldNormal;"),g.push("vViewNormal = normalize((viewNormalMatrix2 * vec4(worldNormal, 1.0)).xyz);"),g.push("vec3 tmpVec3;"),g.push("float lightDist;");for(let e=0,t=a.lights.length;e<t;e++)n=a.lights[e],"ambient"!==n.type&&("dir"===n.type&&"world"===n.space&&(g.push("tmpVec3 = vec3(viewMatrix2 * vec4(lightDir"+e+", 0.0) ).xyz;"),g.push("vViewLightReverseDirAndDist"+e+" = vec4(-tmpVec3, 0.0);")),"point"===n.type&&("world"===n.space?(g.push("tmpVec3 = (viewMatrix2 * vec4(lightPos"+e+", 1.0)).xyz - viewPosition.xyz;"),g.push("lightDist = abs(length(tmpVec3));")):(g.push("tmpVec3 = lightPos"+e+".xyz - viewPosition.xyz;"),g.push("lightDist = abs(length(tmpVec3));")),g.push("vViewLightReverseDirAndDist"+e+" = vec4(tmpVec3, lightDist);")))}if(u&&(f?g.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"):g.push("vUV = uv;")),o.colors&&g.push("vColor = color;"),"points"===o.primitiveName&&g.push("gl_PointSize = pointSize;"),d&&g.push("vWorldPosition = worldPosition;"),g.push("   vViewPosition = viewPosition.xyz;"),g.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?g.push("vFragDepth = 1.0 + clipPos.w;"):(g.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),g.push("clipPos.z *= clipPos.w;")),g.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),l&&g.push("clipPos.z = clipPos.w;"),g.push("gl_Position = clipPos;"),m){g.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),g.push("vec4 tempx; ");for(let e=0,t=a.lights.length;e<t;e++)a.lights[e].castsShadow&&g.push("vShadowPosFromLight"+e+" = texUnitConverter * shadowProjMatrix"+e+" * (shadowViewMatrix"+e+" * worldPosition); ")}return g.push("}"),g}function buildFragmentDraw(e){const t=e.scene;t.canvas.gl;const i=e._material,s=e._geometry._state,r=e.scene._sectionPlanesState,o=e.scene._lightsState,a=e._material._state,n=r.sectionPlanes.length>0,h=hasNormals$1(e),l=s.uvBuf,c="PhongMaterial"===a.type,u="MetallicMaterial"===a.type,p="SpecularMaterial"===a.type,d=getReceivesShadow(e);t.gammaInput;const m=t.gammaOutput,f=[];if(f.push("// Drawing fragment shader"),t.logarithmicDepthBufferEnabled&&f.push("#extension GL_EXT_frag_depth : enable"),h&&i._normalMap&&f.push("#extension GL_OES_standard_derivatives : enable"),f.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),f.push("precision highp float;"),f.push("precision highp int;"),f.push("#else"),f.push("precision mediump float;"),f.push("precision mediump int;"),f.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(f.push("varying float isPerspective;"),f.push("uniform float logDepthBufFC;"),f.push("varying float vFragDepth;")),d&&(f.push("float unpackDepth (vec4 color) {"),f.push("  const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),f.push("  return dot(color, bitShift);"),f.push("}")),f.push("uniform float gammaFactor;"),f.push("vec4 linearToLinear( in vec4 value ) {"),f.push("  return value;"),f.push("}"),f.push("vec4 sRGBToLinear( in vec4 value ) {"),f.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),f.push("}"),f.push("vec4 gammaToLinear( in vec4 value) {"),f.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),f.push("}"),m&&(f.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),f.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),f.push("}")),n){f.push("varying vec4 vWorldPosition;"),f.push("uniform bool clippable;");for(var g=0;g<r.sectionPlanes.length;g++)f.push("uniform bool sectionPlaneActive"+g+";"),f.push("uniform vec3 sectionPlanePos"+g+";"),f.push("uniform vec3 sectionPlaneDir"+g+";")}if(h&&(o.lightMaps.length>0&&(f.push("uniform samplerCube lightMap;"),f.push("uniform mat4 viewNormalMatrix;")),o.reflectionMaps.length>0&&f.push("uniform samplerCube reflectionMap;"),(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("uniform mat4 viewMatrix;"),f.push("#define PI 3.14159265359"),f.push("#define RECIPROCAL_PI 0.31830988618"),f.push("#define RECIPROCAL_PI2 0.15915494"),f.push("#define EPSILON 1e-6"),f.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),f.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),f.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),f.push("}"),f.push("struct IncidentLight {"),f.push("   vec3 color;"),f.push("   vec3 direction;"),f.push("};"),f.push("struct ReflectedLight {"),f.push("   vec3 diffuse;"),f.push("   vec3 specular;"),f.push("};"),f.push("struct Geometry {"),f.push("   vec3 position;"),f.push("   vec3 viewNormal;"),f.push("   vec3 worldNormal;"),f.push("   vec3 viewEyeDir;"),f.push("};"),f.push("struct Material {"),f.push("   vec3    diffuseColor;"),f.push("   float   specularRoughness;"),f.push("   vec3    specularColor;"),f.push("   float   shine;"),f.push("};"),c&&((o.lightMaps.length>0||o.reflectionMaps.length>0)&&(f.push("void computePhongLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.lightMaps.length>0&&(f.push("   vec3 irradiance = "+TEXTURE_DECODE_FUNCS$2[o.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),f.push("   irradiance *= PI;"),f.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),o.reflectionMaps.length>0&&(f.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),f.push("   vec3 radiance               = textureCube(reflectionMap, reflectVec).rgb * 0.2;"),f.push("   radiance *= PI;"),f.push("   reflectedLight.specular     += radiance;")),f.push("}")),f.push("void computePhongLighting(const in IncidentLight directLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),f.push("   float dotNL     = saturate(dot(geometry.viewNormal, directLight.direction));"),f.push("   vec3 irradiance = dotNL * directLight.color * PI;"),f.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.specular += directLight.color * material.specularColor * pow(max(dot(reflect(-directLight.direction, -geometry.viewNormal), geometry.viewEyeDir), 0.0), material.shine);"),f.push("}")),(u||p)&&(f.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),f.push("   float r = ggxRoughness + 0.0001;"),f.push("   return (2.0 / (r * r) - 2.0);"),f.push("}"),f.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),f.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),f.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),f.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),f.push("}"),o.reflectionMaps.length>0&&(f.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),f.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),f.push("   vec3 envMapColor = "+TEXTURE_DECODE_FUNCS$2[o.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),f.push("  return envMapColor;"),f.push("}")),f.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),f.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),f.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),f.push("}"),f.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),f.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),f.push("   return 1.0 / ( gl * gv );"),f.push("}"),f.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),f.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),f.push("   return 0.5 / max( gv + gl, EPSILON );"),f.push("}"),f.push("float D_GGX(const in float alpha, const in float dotNH) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),f.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),f.push("}"),f.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),f.push("   float alpha = ( roughness * roughness );"),f.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),f.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),f.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),f.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),f.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),f.push("   vec3  F = F_Schlick( specularColor, dotLH );"),f.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),f.push("   float D = D_GGX( alpha, dotNH );"),f.push("   return F * (G * D);"),f.push("}"),f.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),f.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),f.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),f.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),f.push("   vec4 r = roughness * c0 + c1;"),f.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),f.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),f.push("   return specularColor * AB.x + AB.y;"),f.push("}"),(o.lightMaps.length>0||o.reflectionMaps.length>0)&&(f.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.lightMaps.length>0&&(f.push("   vec3 irradiance = sRGBToLinear(textureCube(lightMap, geometry.worldNormal)).rgb;"),f.push("   irradiance *= PI;"),f.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),o.reflectionMaps.length>0&&(f.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),f.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),f.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),f.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),f.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),f.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),f.push("}")),f.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),f.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),f.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),f.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),f.push("}"))),f.push("varying vec3 vViewPosition;"),s.colors&&f.push("varying vec4 vColor;"),l&&(h&&i._normalMap||i._ambientMap||i._baseColorMap||i._diffuseMap||i._emissiveMap||i._metallicMap||i._roughnessMap||i._metallicRoughnessMap||i._specularMap||i._glossinessMap||i._specularGlossinessMap||i._occlusionMap||i._alphaMap)&&f.push("varying vec2 vUV;"),h&&(o.lightMaps.length>0&&f.push("varying vec3 vWorldNormal;"),f.push("varying vec3 vViewNormal;")),a.ambient&&f.push("uniform vec3 materialAmbient;"),a.baseColor&&f.push("uniform vec3 materialBaseColor;"),void 0!==a.alpha&&null!==a.alpha&&f.push("uniform vec4 materialAlphaModeCutoff;"),a.emissive&&f.push("uniform vec3 materialEmissive;"),a.diffuse&&f.push("uniform vec3 materialDiffuse;"),void 0!==a.glossiness&&null!==a.glossiness&&f.push("uniform float materialGlossiness;"),void 0!==a.shininess&&null!==a.shininess&&f.push("uniform float materialShininess;"),a.specular&&f.push("uniform vec3 materialSpecular;"),void 0!==a.metallic&&null!==a.metallic&&f.push("uniform float materialMetallic;"),void 0!==a.roughness&&null!==a.roughness&&f.push("uniform float materialRoughness;"),void 0!==a.specularF0&&null!==a.specularF0&&f.push("uniform float materialSpecularF0;"),l&&i._ambientMap&&(f.push("uniform sampler2D ambientMap;"),i._ambientMap._state.matrix&&f.push("uniform mat4 ambientMapMatrix;")),l&&i._baseColorMap&&(f.push("uniform sampler2D baseColorMap;"),i._baseColorMap._state.matrix&&f.push("uniform mat4 baseColorMapMatrix;")),l&&i._diffuseMap&&(f.push("uniform sampler2D diffuseMap;"),i._diffuseMap._state.matrix&&f.push("uniform mat4 diffuseMapMatrix;")),l&&i._emissiveMap&&(f.push("uniform sampler2D emissiveMap;"),i._emissiveMap._state.matrix&&f.push("uniform mat4 emissiveMapMatrix;")),h&&l&&i._metallicMap&&(f.push("uniform sampler2D metallicMap;"),i._metallicMap._state.matrix&&f.push("uniform mat4 metallicMapMatrix;")),h&&l&&i._roughnessMap&&(f.push("uniform sampler2D roughnessMap;"),i._roughnessMap._state.matrix&&f.push("uniform mat4 roughnessMapMatrix;")),h&&l&&i._metallicRoughnessMap&&(f.push("uniform sampler2D metallicRoughnessMap;"),i._metallicRoughnessMap._state.matrix&&f.push("uniform mat4 metallicRoughnessMapMatrix;")),h&&i._normalMap&&(f.push("uniform sampler2D normalMap;"),i._normalMap._state.matrix&&f.push("uniform mat4 normalMapMatrix;"),f.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),f.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),f.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),f.push("      vec2 st0 = dFdx( uv.st );"),f.push("      vec2 st1 = dFdy( uv.st );"),f.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),f.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),f.push("      vec3 N = normalize( surf_norm );"),f.push("      vec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;"),f.push("      mat3 tsn = mat3( S, T, N );"),f.push("      return normalize( tsn * mapN );"),f.push("}")),l&&i._occlusionMap&&(f.push("uniform sampler2D occlusionMap;"),i._occlusionMap._state.matrix&&f.push("uniform mat4 occlusionMapMatrix;")),l&&i._alphaMap&&(f.push("uniform sampler2D alphaMap;"),i._alphaMap._state.matrix&&f.push("uniform mat4 alphaMapMatrix;")),h&&l&&i._specularMap&&(f.push("uniform sampler2D specularMap;"),i._specularMap._state.matrix&&f.push("uniform mat4 specularMapMatrix;")),h&&l&&i._glossinessMap&&(f.push("uniform sampler2D glossinessMap;"),i._glossinessMap._state.matrix&&f.push("uniform mat4 glossinessMapMatrix;")),h&&l&&i._specularGlossinessMap&&(f.push("uniform sampler2D materialSpecularGlossinessMap;"),i._specularGlossinessMap._state.matrix&&f.push("uniform mat4 materialSpecularGlossinessMapMatrix;")),h&&(i._diffuseFresnel||i._specularFresnel||i._alphaFresnel||i._emissiveFresnel||i._reflectivityFresnel)&&(f.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),f.push("    float fr = abs(dot(eyeDir, normal));"),f.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),f.push("    return pow(finalFr, power);"),f.push("}"),i._diffuseFresnel&&(f.push("uniform float  diffuseFresnelCenterBias;"),f.push("uniform float  diffuseFresnelEdgeBias;"),f.push("uniform float  diffuseFresnelPower;"),f.push("uniform vec3   diffuseFresnelCenterColor;"),f.push("uniform vec3   diffuseFresnelEdgeColor;")),i._specularFresnel&&(f.push("uniform float  specularFresnelCenterBias;"),f.push("uniform float  specularFresnelEdgeBias;"),f.push("uniform float  specularFresnelPower;"),f.push("uniform vec3   specularFresnelCenterColor;"),f.push("uniform vec3   specularFresnelEdgeColor;")),i._alphaFresnel&&(f.push("uniform float  alphaFresnelCenterBias;"),f.push("uniform float  alphaFresnelEdgeBias;"),f.push("uniform float  alphaFresnelPower;"),f.push("uniform vec3   alphaFresnelCenterColor;"),f.push("uniform vec3   alphaFresnelEdgeColor;")),i._reflectivityFresnel&&(f.push("uniform float  materialSpecularF0FresnelCenterBias;"),f.push("uniform float  materialSpecularF0FresnelEdgeBias;"),f.push("uniform float  materialSpecularF0FresnelPower;"),f.push("uniform vec3   materialSpecularF0FresnelCenterColor;"),f.push("uniform vec3   materialSpecularF0FresnelEdgeColor;")),i._emissiveFresnel&&(f.push("uniform float  emissiveFresnelCenterBias;"),f.push("uniform float  emissiveFresnelEdgeBias;"),f.push("uniform float  emissiveFresnelPower;"),f.push("uniform vec3   emissiveFresnelCenterColor;"),f.push("uniform vec3   emissiveFresnelEdgeColor;"))),f.push("uniform vec4   lightAmbient;"),h)for(let e=0,t=o.lights.length;e<t;e++){const t=o.lights[e];"ambient"!==t.type&&(f.push("uniform vec4 lightColor"+e+";"),"point"===t.type&&f.push("uniform vec3 lightAttenuation"+e+";"),"dir"===t.type&&"view"===t.space&&f.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&"view"===t.space?f.push("uniform vec3 lightPos"+e+";"):f.push("varying vec4 vViewLightReverseDirAndDist"+e+";"))}if(d)for(let e=0,t=o.lights.length;e<t;e++)o.lights[e].castsShadow&&(f.push("varying vec4 vShadowPosFromLight"+e+";"),f.push("uniform sampler2D shadowMap"+e+";"));if(f.push("uniform vec4 colorize;"),f.push("void main(void) {"),n){f.push("if (clippable) {"),f.push("  float dist = 0.0;");for(g=0;g<r.sectionPlanes.length;g++)f.push("if (sectionPlaneActive"+g+") {"),f.push("   dist += clamp(dot(-sectionPlaneDir"+g+".xyz, vWorldPosition.xyz - sectionPlanePos"+g+".xyz), 0.0, 1000.0);"),f.push("}");f.push("  if (dist > 0.0) { discard; }"),f.push("}")}if("points"===s.primitiveName&&(f.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),f.push("float r = dot(cxy, cxy);"),f.push("if (r > 1.0) {"),f.push("   discard;"),f.push("}")),f.push("float occlusion = 1.0;"),a.ambient?f.push("vec3 ambientColor = materialAmbient;"):f.push("vec3 ambientColor = vec3(1.0, 1.0, 1.0);"),a.diffuse?f.push("vec3 diffuseColor = materialDiffuse;"):a.baseColor?f.push("vec3 diffuseColor = materialBaseColor;"):f.push("vec3 diffuseColor = vec3(1.0, 1.0, 1.0);"),s.colors&&f.push("diffuseColor *= vColor.rgb;"),a.emissive?f.push("vec3 emissiveColor = materialEmissive;"):f.push("vec3  emissiveColor = vec3(0.0, 0.0, 0.0);"),a.specular?f.push("vec3 specular = materialSpecular;"):f.push("vec3 specular = vec3(1.0, 1.0, 1.0);"),void 0!==a.alpha?f.push("float alpha = materialAlphaModeCutoff[0];"):f.push("float alpha = 1.0;"),s.colors&&f.push("alpha *= vColor.a;"),void 0!==a.glossiness?f.push("float glossiness = materialGlossiness;"):f.push("float glossiness = 1.0;"),void 0!==a.metallic?f.push("float metallic = materialMetallic;"):f.push("float metallic = 1.0;"),void 0!==a.roughness?f.push("float roughness = materialRoughness;"):f.push("float roughness = 1.0;"),void 0!==a.specularF0?f.push("float specularF0 = materialSpecularF0;"):f.push("float specularF0 = 1.0;"),l&&(h&&i._normalMap||i._ambientMap||i._baseColorMap||i._diffuseMap||i._occlusionMap||i._emissiveMap||i._metallicMap||i._roughnessMap||i._metallicRoughnessMap||i._specularMap||i._glossinessMap||i._specularGlossinessMap||i._alphaMap)&&(f.push("vec4 texturePos = vec4(vUV.s, vUV.t, 1.0, 1.0);"),f.push("vec2 textureCoord;")),l&&i._ambientMap&&(i._ambientMap._state.matrix?f.push("textureCoord = (ambientMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 ambientTexel = texture2D(ambientMap, textureCoord).rgb;"),f.push("ambientTexel = "+TEXTURE_DECODE_FUNCS$2[i._ambientMap._state.encoding]+"(ambientTexel);"),f.push("ambientColor *= ambientTexel.rgb;")),l&&i._diffuseMap&&(i._diffuseMap._state.matrix?f.push("textureCoord = (diffuseMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 diffuseTexel = texture2D(diffuseMap, textureCoord);"),f.push("diffuseTexel = "+TEXTURE_DECODE_FUNCS$2[i._diffuseMap._state.encoding]+"(diffuseTexel);"),f.push("diffuseColor *= diffuseTexel.rgb;"),f.push("alpha *= diffuseTexel.a;")),l&&i._baseColorMap&&(i._baseColorMap._state.matrix?f.push("textureCoord = (baseColorMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 baseColorTexel = texture2D(baseColorMap, textureCoord);"),f.push("baseColorTexel = "+TEXTURE_DECODE_FUNCS$2[i._baseColorMap._state.encoding]+"(baseColorTexel);"),f.push("diffuseColor *= baseColorTexel.rgb;"),f.push("alpha *= baseColorTexel.a;")),l&&i._emissiveMap&&(i._emissiveMap._state.matrix?f.push("textureCoord = (emissiveMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 emissiveTexel = texture2D(emissiveMap, textureCoord);"),f.push("emissiveTexel = "+TEXTURE_DECODE_FUNCS$2[i._emissiveMap._state.encoding]+"(emissiveTexel);"),f.push("emissiveColor = emissiveTexel.rgb;")),l&&i._alphaMap&&(i._alphaMap._state.matrix?f.push("textureCoord = (alphaMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("alpha *= texture2D(alphaMap, textureCoord).r;")),l&&i._occlusionMap&&(i._occlusionMap._state.matrix?f.push("textureCoord = (occlusionMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("occlusion *= texture2D(occlusionMap, textureCoord).r;")),h&&(o.lights.length>0||o.lightMaps.length>0||o.reflectionMaps.length>0)){l&&i._normalMap?(i._normalMap._state.matrix?f.push("textureCoord = (normalMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition, normalize(vViewNormal), textureCoord );")):f.push("vec3 viewNormal = normalize(vViewNormal);"),l&&i._specularMap&&(i._specularMap._state.matrix?f.push("textureCoord = (specularMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("specular *= texture2D(specularMap, textureCoord).rgb;")),l&&i._glossinessMap&&(i._glossinessMap._state.matrix?f.push("textureCoord = (glossinessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("glossiness *= texture2D(glossinessMap, textureCoord).r;")),l&&i._specularGlossinessMap&&(i._specularGlossinessMap._state.matrix?f.push("textureCoord = (materialSpecularGlossinessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 specGlossRGB = texture2D(materialSpecularGlossinessMap, textureCoord).rgba;"),f.push("specular *= specGlossRGB.rgb;"),f.push("glossiness *= specGlossRGB.a;")),l&&i._metallicMap&&(i._metallicMap._state.matrix?f.push("textureCoord = (metallicMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("metallic *= texture2D(metallicMap, textureCoord).r;")),l&&i._roughnessMap&&(i._roughnessMap._state.matrix?f.push("textureCoord = (roughnessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("roughness *= texture2D(roughnessMap, textureCoord).r;")),l&&i._metallicRoughnessMap&&(i._metallicRoughnessMap._state.matrix?f.push("textureCoord = (metallicRoughnessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec3 metalRoughRGB = texture2D(metallicRoughnessMap, textureCoord).rgb;"),f.push("metallic *= metalRoughRGB.b;"),f.push("roughness *= metalRoughRGB.g;")),f.push("vec3 viewEyeDir = normalize(-vViewPosition);"),i._diffuseFresnel&&(f.push("float diffuseFresnel = fresnel(viewEyeDir, viewNormal, diffuseFresnelEdgeBias, diffuseFresnelCenterBias, diffuseFresnelPower);"),f.push("diffuseColor *= mix(diffuseFresnelEdgeColor, diffuseFresnelCenterColor, diffuseFresnel);")),i._specularFresnel&&(f.push("float specularFresnel = fresnel(viewEyeDir, viewNormal, specularFresnelEdgeBias, specularFresnelCenterBias, specularFresnelPower);"),f.push("specular *= mix(specularFresnelEdgeColor, specularFresnelCenterColor, specularFresnel);")),i._alphaFresnel&&(f.push("float alphaFresnel = fresnel(viewEyeDir, viewNormal, alphaFresnelEdgeBias, alphaFresnelCenterBias, alphaFresnelPower);"),f.push("alpha *= mix(alphaFresnelEdgeColor.r, alphaFresnelCenterColor.r, alphaFresnel);")),i._emissiveFresnel&&(f.push("float emissiveFresnel = fresnel(viewEyeDir, viewNormal, emissiveFresnelEdgeBias, emissiveFresnelCenterBias, emissiveFresnelPower);"),f.push("emissiveColor *= mix(emissiveFresnelEdgeColor, emissiveFresnelCenterColor, emissiveFresnel);")),f.push("if (materialAlphaModeCutoff[1] == 1.0 && alpha < materialAlphaModeCutoff[2]) {"),f.push("   discard;"),f.push("}"),f.push("IncidentLight  light;"),f.push("Material       material;"),f.push("Geometry       geometry;"),f.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),f.push("vec3           viewLightDir;"),c&&(f.push("material.diffuseColor      = diffuseColor;"),f.push("material.specularColor     = specular;"),f.push("material.shine             = materialShininess;")),p&&(f.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),f.push("material.diffuseColor      = diffuseColor * oneMinusSpecularStrength;"),f.push("material.specularRoughness = clamp( 1.0 - glossiness, 0.04, 1.0 );"),f.push("material.specularColor     = specular;")),u&&(f.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),f.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),f.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),f.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);")),f.push("geometry.position      = vViewPosition;"),o.lightMaps.length>0&&f.push("geometry.worldNormal   = normalize(vWorldNormal);"),f.push("geometry.viewNormal    = viewNormal;"),f.push("geometry.viewEyeDir    = viewEyeDir;"),c&&(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("computePhongLightMapping(geometry, material, reflectedLight);"),(p||u)&&(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("computePBRLightMapping(geometry, material, reflectedLight);"),f.push("float shadow = 1.0;"),f.push("float shadowAcneRemover = 0.007;"),f.push("vec3 fragmentDepth;"),f.push("float texelSize = 1.0 / 1024.0;"),f.push("float amountInLight = 0.0;"),f.push("vec3 shadowCoord;"),f.push("vec4 rgbaDepth;"),f.push("float depth;");for(let e=0,t=o.lights.length;e<t;e++){const t=o.lights[e];"ambient"!==t.type&&("dir"===t.type&&"view"===t.space?f.push("viewLightDir = -normalize(lightDir"+e+");"):"point"===t.type&&"view"===t.space?f.push("viewLightDir = normalize(lightPos"+e+" - vViewPosition);"):f.push("viewLightDir = normalize(vViewLightReverseDirAndDist"+e+".xyz);"),d&&t.castsShadow?(f.push("shadow = 0.0;"),f.push("fragmentDepth = vShadowPosFromLight"+e+".xyz;"),f.push("fragmentDepth.z -= shadowAcneRemover;"),f.push("for (int x = -3; x <= 3; x++) {"),f.push("  for (int y = -3; y <= 3; y++) {"),f.push("      float texelDepth = unpackDepth(texture2D(shadowMap"+e+", fragmentDepth.xy + vec2(x, y) * texelSize));"),f.push("      if (fragmentDepth.z < texelDepth) {"),f.push("          shadow += 1.0;"),f.push("      }"),f.push("  }"),f.push("}"),f.push("shadow = shadow / 9.0;"),f.push("light.color =  lightColor"+e+".rgb * (lightColor"+e+".a * shadow);")):f.push("light.color =  lightColor"+e+".rgb * (lightColor"+e+".a );"),f.push("light.direction = viewLightDir;"),c&&f.push("computePhongLighting(light, geometry, material, reflectedLight);"),(p||u)&&f.push("computePBRLighting(light, geometry, material, reflectedLight);"))}c?f.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * diffuseColor) + ((occlusion * (( reflectedLight.diffuse + reflectedLight.specular)))) + emissiveColor;"):f.push("vec3 outgoingLight = (occlusion * (reflectedLight.diffuse)) + (occlusion * reflectedLight.specular) + emissiveColor;")}else f.push("ambientColor *= (lightAmbient.rgb * lightAmbient.a);"),f.push("vec3 outgoingLight = emissiveColor + ambientColor;");return f.push("gl_FragColor = vec4(outgoingLight, alpha) * colorize;"),m&&f.push("gl_FragColor = linearToGamma(gl_FragColor, gammaFactor);"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&f.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),f.push("}"),f}const tempVec3a$10=math.vec3(),ids$2=new Map$1({}),DrawRenderer=function(e,t){this.id=ids$2.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new DrawShaderSource(t),this._allocate(t)},drawRenderers={};DrawRenderer.get=function(e){const t=e.scene,i=[t.canvas.canvas.id,(t.gammaInput?"gi;":";")+(t.gammaOutput?"go":""),t._lightsState.getHash(),t._sectionPlanesState.getHash(),e._geometry._state.hash,e._material._state.hash,e._state.drawHash].join(";");let s=drawRenderers[i];if(!s){if(s=new DrawRenderer(i,e),s.errors)return console.log(s.errors.join("\n")),null;drawRenderers[i]=s,stats.memory.programs++}return s._useCount++,s},DrawRenderer.prototype.put=function(){0==--this._useCount&&(ids$2.removeItem(this.id),this._program&&this._program.destroy(),delete drawRenderers[this._hash],stats.memory.programs--)},DrawRenderer.prototype.webglContextRestored=function(){this._program=null},DrawRenderer.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const i=WEBGL_INFO$1.MAX_TEXTURE_UNITS,s=t.scene,r=t._material,o=s.canvas.gl,a=this._program,n=t._state,h=t._material._state,l=t._geometry._state,c=s.camera,u=t.origin,p=n.background;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,p&&o.depthFunc(o.LEQUAL),this._bindProgram(e)),o.uniformMatrix4fv(this._uViewMatrix,!1,u?e.getRTCViewMatrix(n.originHash,u):c.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,c.viewNormalMatrix),n.clippable){const e=s._sectionPlanesState.sectionPlanes.length;if(e>0){const i=s._sectionPlanesState.sectionPlanes,r=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const s=r.sectionPlanesActivePerLayer[t];if(o.uniform1i(e.active,s?1:0),s){const s=i[t];o.uniform3fv(e.pos,u?getPlaneRTCPos(s.dist,s.dir,u,tempVec3a$10):s.pos),o.uniform3fv(e.dir,s.dir)}}}}}if(h.id!==this._lastMaterialId){e.textureUnit=this._baseTextureUnit;const t=h.backfaces;e.backfaces!==t&&(t?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),e.backfaces=t);const s=h.frontface;switch(e.frontface!==s&&(s?o.frontFace(o.CCW):o.frontFace(o.CW),e.frontface=s),e.lineWidth!==h.lineWidth&&(o.lineWidth(h.lineWidth),e.lineWidth=h.lineWidth),this._uPointSize&&o.uniform1f(this._uPointSize,h.pointSize),h.type){case"LambertMaterial":this._uMaterialAmbient&&o.uniform3fv(this._uMaterialAmbient,h.ambient),this._uMaterialColor&&o.uniform4f(this._uMaterialColor,h.color[0],h.color[1],h.color[2],h.alpha),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive);break;case"PhongMaterial":this._uMaterialShininess&&o.uniform1f(this._uMaterialShininess,h.shininess),this._uMaterialAmbient&&o.uniform3fv(this._uMaterialAmbient,h.ambient),this._uMaterialDiffuse&&o.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&o.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0),r._ambientMap&&r._ambientMap._state.texture&&this._uMaterialAmbientMap&&(a.bindTexture(this._uMaterialAmbientMap,r._ambientMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uMaterialAmbientMapMatrix&&o.uniformMatrix4fv(this._uMaterialAmbientMapMatrix,!1,r._ambientMap._state.matrix)),r._diffuseMap&&r._diffuseMap._state.texture&&this._uDiffuseMap&&(a.bindTexture(this._uDiffuseMap,r._diffuseMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uDiffuseMapMatrix&&o.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,r._diffuseMap._state.matrix)),r._specularMap&&r._specularMap._state.texture&&this._uSpecularMap&&(a.bindTexture(this._uSpecularMap,r._specularMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uSpecularMapMatrix&&o.uniformMatrix4fv(this._uSpecularMapMatrix,!1,r._specularMap._state.matrix)),r._emissiveMap&&r._emissiveMap._state.texture&&this._uEmissiveMap&&(a.bindTexture(this._uEmissiveMap,r._emissiveMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,r._emissiveMap._state.matrix)),r._alphaMap&&r._alphaMap._state.texture&&this._uAlphaMap&&(a.bindTexture(this._uAlphaMap,r._alphaMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,r._alphaMap._state.matrix)),r._reflectivityMap&&r._reflectivityMap._state.texture&&this._uReflectivityMap&&(a.bindTexture(this._uReflectivityMap,r._reflectivityMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._uReflectivityMapMatrix&&o.uniformMatrix4fv(this._uReflectivityMapMatrix,!1,r._reflectivityMap._state.matrix)),r._normalMap&&r._normalMap._state.texture&&this._uNormalMap&&(a.bindTexture(this._uNormalMap,r._normalMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,r._normalMap._state.matrix)),r._occlusionMap&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(a.bindTexture(this._uOcclusionMap,r._occlusionMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,r._occlusionMap._state.matrix)),r._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias&&o.uniform1f(this._uDiffuseFresnelEdgeBias,r._diffuseFresnel.edgeBias),this._uDiffuseFresnelCenterBias&&o.uniform1f(this._uDiffuseFresnelCenterBias,r._diffuseFresnel.centerBias),this._uDiffuseFresnelEdgeColor&&o.uniform3fv(this._uDiffuseFresnelEdgeColor,r._diffuseFresnel.edgeColor),this._uDiffuseFresnelCenterColor&&o.uniform3fv(this._uDiffuseFresnelCenterColor,r._diffuseFresnel.centerColor),this._uDiffuseFresnelPower&&o.uniform1f(this._uDiffuseFresnelPower,r._diffuseFresnel.power)),r._specularFresnel&&(this._uSpecularFresnelEdgeBias&&o.uniform1f(this._uSpecularFresnelEdgeBias,r._specularFresnel.edgeBias),this._uSpecularFresnelCenterBias&&o.uniform1f(this._uSpecularFresnelCenterBias,r._specularFresnel.centerBias),this._uSpecularFresnelEdgeColor&&o.uniform3fv(this._uSpecularFresnelEdgeColor,r._specularFresnel.edgeColor),this._uSpecularFresnelCenterColor&&o.uniform3fv(this._uSpecularFresnelCenterColor,r._specularFresnel.centerColor),this._uSpecularFresnelPower&&o.uniform1f(this._uSpecularFresnelPower,r._specularFresnel.power)),r._alphaFresnel&&(this._uAlphaFresnelEdgeBias&&o.uniform1f(this._uAlphaFresnelEdgeBias,r._alphaFresnel.edgeBias),this._uAlphaFresnelCenterBias&&o.uniform1f(this._uAlphaFresnelCenterBias,r._alphaFresnel.centerBias),this._uAlphaFresnelEdgeColor&&o.uniform3fv(this._uAlphaFresnelEdgeColor,r._alphaFresnel.edgeColor),this._uAlphaFresnelCenterColor&&o.uniform3fv(this._uAlphaFresnelCenterColor,r._alphaFresnel.centerColor),this._uAlphaFresnelPower&&o.uniform1f(this._uAlphaFresnelPower,r._alphaFresnel.power)),r._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias&&o.uniform1f(this._uReflectivityFresnelEdgeBias,r._reflectivityFresnel.edgeBias),this._uReflectivityFresnelCenterBias&&o.uniform1f(this._uReflectivityFresnelCenterBias,r._reflectivityFresnel.centerBias),this._uReflectivityFresnelEdgeColor&&o.uniform3fv(this._uReflectivityFresnelEdgeColor,r._reflectivityFresnel.edgeColor),this._uReflectivityFresnelCenterColor&&o.uniform3fv(this._uReflectivityFresnelCenterColor,r._reflectivityFresnel.centerColor),this._uReflectivityFresnelPower&&o.uniform1f(this._uReflectivityFresnelPower,r._reflectivityFresnel.power)),r._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias&&o.uniform1f(this._uEmissiveFresnelEdgeBias,r._emissiveFresnel.edgeBias),this._uEmissiveFresnelCenterBias&&o.uniform1f(this._uEmissiveFresnelCenterBias,r._emissiveFresnel.centerBias),this._uEmissiveFresnelEdgeColor&&o.uniform3fv(this._uEmissiveFresnelEdgeColor,r._emissiveFresnel.edgeColor),this._uEmissiveFresnelCenterColor&&o.uniform3fv(this._uEmissiveFresnelCenterColor,r._emissiveFresnel.centerColor),this._uEmissiveFresnelPower&&o.uniform1f(this._uEmissiveFresnelPower,r._emissiveFresnel.power));break;case"MetallicMaterial":this._uBaseColor&&o.uniform3fv(this._uBaseColor,h.baseColor),this._uMaterialMetallic&&o.uniform1f(this._uMaterialMetallic,h.metallic),this._uMaterialRoughness&&o.uniform1f(this._uMaterialRoughness,h.roughness),this._uMaterialSpecularF0&&o.uniform1f(this._uMaterialSpecularF0,h.specularF0),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);const t=r._baseColorMap;t&&t._state.texture&&this._uBaseColorMap&&(a.bindTexture(this._uBaseColorMap,t._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uBaseColorMapMatrix&&o.uniformMatrix4fv(this._uBaseColorMapMatrix,!1,t._state.matrix));const s=r._metallicMap;s&&s._state.texture&&this._uMetallicMap&&(a.bindTexture(this._uMetallicMap,s._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uMetallicMapMatrix&&o.uniformMatrix4fv(this._uMetallicMapMatrix,!1,s._state.matrix));const n=r._roughnessMap;n&&n._state.texture&&this._uRoughnessMap&&(a.bindTexture(this._uRoughnessMap,n._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uRoughnessMapMatrix&&o.uniformMatrix4fv(this._uRoughnessMapMatrix,!1,n._state.matrix));const l=r._metallicRoughnessMap;l&&l._state.texture&&this._uMetallicRoughnessMap&&(a.bindTexture(this._uMetallicRoughnessMap,l._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uMetallicRoughnessMapMatrix&&o.uniformMatrix4fv(this._uMetallicRoughnessMapMatrix,!1,l._state.matrix)),(d=r._emissiveMap)&&d._state.texture&&this._uEmissiveMap&&(a.bindTexture(this._uEmissiveMap,d._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._state.matrix)),(m=r._occlusionMap)&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(a.bindTexture(this._uOcclusionMap,m._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,m._state.matrix)),(f=r._alphaMap)&&f._state.texture&&this._uAlphaMap&&(a.bindTexture(this._uAlphaMap,f._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,f._state.matrix)),(g=r._normalMap)&&g._state.texture&&this._uNormalMap&&(a.bindTexture(this._uNormalMap,g._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,g._state.matrix));break;case"SpecularMaterial":this._uMaterialDiffuse&&o.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&o.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialGlossiness&&o.uniform1f(this._uMaterialGlossiness,h.glossiness),this._uMaterialReflectivity&&o.uniform1f(this._uMaterialReflectivity,h.reflectivity),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);const c=r._diffuseMap;c&&c._state.texture&&this._uDiffuseMap&&(a.bindTexture(this._uDiffuseMap,c._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uDiffuseMapMatrix&&o.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,c._state.matrix));const u=r._specularMap;u&&u._state.texture&&this._uSpecularMap&&(a.bindTexture(this._uSpecularMap,u._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uSpecularMapMatrix&&o.uniformMatrix4fv(this._uSpecularMapMatrix,!1,u._state.matrix));const p=r._glossinessMap;p&&p._state.texture&&this._uGlossinessMap&&(a.bindTexture(this._uGlossinessMap,p._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uGlossinessMapMatrix&&o.uniformMatrix4fv(this._uGlossinessMapMatrix,!1,p._state.matrix));const _=r._specularGlossinessMap;var d,m,f,g;_&&_._state.texture&&this._uSpecularGlossinessMap&&(a.bindTexture(this._uSpecularGlossinessMap,_._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uSpecularGlossinessMapMatrix&&o.uniformMatrix4fv(this._uSpecularGlossinessMapMatrix,!1,_._state.matrix)),(d=r._emissiveMap)&&d._state.texture&&this._uEmissiveMap&&(a.bindTexture(this._uEmissiveMap,d._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._state.matrix)),(m=r._occlusionMap)&&m._state.texture&&this._uOcclusionMap&&(a.bindTexture(this._uOcclusionMap,m._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,m._state.matrix)),(f=r._alphaMap)&&f._state.texture&&this._uAlphaMap&&(a.bindTexture(this._uAlphaMap,f._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,f._state.matrix)),(g=r._normalMap)&&g._state.texture&&this._uNormalMap&&(a.bindTexture(this._uNormalMap,g._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,g._state.matrix))}this._lastMaterialId=h.id}if(o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,t.worldMatrix),this._uModelNormalMatrix&&o.uniformMatrix4fv(this._uModelNormalMatrix,o.FALSE,t.worldNormalMatrix),this._uClippable&&o.uniform1i(this._uClippable,n.clippable),this._uColorize){const e=n.colorize,t=this._lastColorize;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(o.uniform4fv(this._uColorize,e),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3])}o.uniform3fv(this._uOffset,n.offset),l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._uUVDecodeMatrix&&o.uniformMatrix3fv(this._uUVDecodeMatrix,!1,l.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf),e.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(l.normalsBuf),e.bindArray++),this._aUV&&(this._aUV.bindArrayBuffer(l.uvBuf),e.bindArray++),this._aColor&&(this._aColor.bindArrayBuffer(l.colorsBuf),e.bindArray++),this._aFlags&&(this._aFlags.bindArrayBuffer(l.flagsBuf),e.bindArray++),l.indicesBuf&&(l.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=l.id),l.indicesBuf?(o.drawElements(l.primitive,l.indicesBuf.numItems,l.indicesBuf.itemType,0),e.drawElements++):l.positions&&(o.drawArrays(o.TRIANGLES,0,l.positions.numItems),e.drawArrays++),p&&o.depthFunc(o.LESS)},DrawRenderer.prototype._allocate=function(e){const t=e.scene,i=t.canvas.gl,s=e._material,r=t._lightsState,o=t._sectionPlanesState,a=e._material._state;if(this._program=new Program(i,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const n=this._program;this._uPositionsDecodeMatrix=n.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=n.getLocation("uvDecodeMatrix"),this._uModelMatrix=n.getLocation("modelMatrix"),this._uModelNormalMatrix=n.getLocation("modelNormalMatrix"),this._uViewMatrix=n.getLocation("viewMatrix"),this._uViewNormalMatrix=n.getLocation("viewNormalMatrix"),this._uProjMatrix=n.getLocation("projMatrix"),this._uGammaFactor=n.getLocation("gammaFactor"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[],this._uShadowViewMatrix=[],this._uShadowProjMatrix=[],t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=n.getLocation("logDepthBufFC"));const h=r.lights;let l;for(var c=0,u=h.length;c<u;c++){switch(l=h[c],l.type){case"ambient":this._uLightAmbient[c]=n.getLocation("lightAmbient");break;case"dir":this._uLightColor[c]=n.getLocation("lightColor"+c),this._uLightPos[c]=null,this._uLightDir[c]=n.getLocation("lightDir"+c);break;case"point":this._uLightColor[c]=n.getLocation("lightColor"+c),this._uLightPos[c]=n.getLocation("lightPos"+c),this._uLightDir[c]=null,this._uLightAttenuation[c]=n.getLocation("lightAttenuation"+c);break;case"spot":this._uLightColor[c]=n.getLocation("lightColor"+c),this._uLightPos[c]=n.getLocation("lightPos"+c),this._uLightDir[c]=n.getLocation("lightDir"+c),this._uLightAttenuation[c]=n.getLocation("lightAttenuation"+c)}l.castsShadow&&(this._uShadowViewMatrix[c]=n.getLocation("shadowViewMatrix"+c),this._uShadowProjMatrix[c]=n.getLocation("shadowProjMatrix"+c))}r.lightMaps.length>0&&(this._uLightMap="lightMap"),r.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),this._uSectionPlanes=[];for(c=0,u=o.sectionPlanes.length;c<u;c++)this._uSectionPlanes.push({active:n.getLocation("sectionPlaneActive"+c),pos:n.getLocation("sectionPlanePos"+c),dir:n.getLocation("sectionPlaneDir"+c)});switch(this._uPointSize=n.getLocation("pointSize"),a.type){case"LambertMaterial":this._uMaterialColor=n.getLocation("materialColor"),this._uMaterialEmissive=n.getLocation("materialEmissive"),this._uAlphaModeCutoff=n.getLocation("materialAlphaModeCutoff");break;case"PhongMaterial":this._uMaterialAmbient=n.getLocation("materialAmbient"),this._uMaterialDiffuse=n.getLocation("materialDiffuse"),this._uMaterialSpecular=n.getLocation("materialSpecular"),this._uMaterialEmissive=n.getLocation("materialEmissive"),this._uAlphaModeCutoff=n.getLocation("materialAlphaModeCutoff"),this._uMaterialShininess=n.getLocation("materialShininess"),s._ambientMap&&(this._uMaterialAmbientMap="ambientMap",this._uMaterialAmbientMapMatrix=n.getLocation("ambientMapMatrix")),s._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=n.getLocation("diffuseMapMatrix")),s._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=n.getLocation("specularMapMatrix")),s._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=n.getLocation("emissiveMapMatrix")),s._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=n.getLocation("alphaMapMatrix")),s._reflectivityMap&&(this._uReflectivityMap="reflectivityMap",this._uReflectivityMapMatrix=n.getLocation("reflectivityMapMatrix")),s._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=n.getLocation("normalMapMatrix")),s._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=n.getLocation("occlusionMapMatrix")),s._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias=n.getLocation("diffuseFresnelEdgeBias"),this._uDiffuseFresnelCenterBias=n.getLocation("diffuseFresnelCenterBias"),this._uDiffuseFresnelEdgeColor=n.getLocation("diffuseFresnelEdgeColor"),this._uDiffuseFresnelCenterColor=n.getLocation("diffuseFresnelCenterColor"),this._uDiffuseFresnelPower=n.getLocation("diffuseFresnelPower")),s._specularFresnel&&(this._uSpecularFresnelEdgeBias=n.getLocation("specularFresnelEdgeBias"),this._uSpecularFresnelCenterBias=n.getLocation("specularFresnelCenterBias"),this._uSpecularFresnelEdgeColor=n.getLocation("specularFresnelEdgeColor"),this._uSpecularFresnelCenterColor=n.getLocation("specularFresnelCenterColor"),this._uSpecularFresnelPower=n.getLocation("specularFresnelPower")),s._alphaFresnel&&(this._uAlphaFresnelEdgeBias=n.getLocation("alphaFresnelEdgeBias"),this._uAlphaFresnelCenterBias=n.getLocation("alphaFresnelCenterBias"),this._uAlphaFresnelEdgeColor=n.getLocation("alphaFresnelEdgeColor"),this._uAlphaFresnelCenterColor=n.getLocation("alphaFresnelCenterColor"),this._uAlphaFresnelPower=n.getLocation("alphaFresnelPower")),s._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias=n.getLocation("reflectivityFresnelEdgeBias"),this._uReflectivityFresnelCenterBias=n.getLocation("reflectivityFresnelCenterBias"),this._uReflectivityFresnelEdgeColor=n.getLocation("reflectivityFresnelEdgeColor"),this._uReflectivityFresnelCenterColor=n.getLocation("reflectivityFresnelCenterColor"),this._uReflectivityFresnelPower=n.getLocation("reflectivityFresnelPower")),s._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias=n.getLocation("emissiveFresnelEdgeBias"),this._uEmissiveFresnelCenterBias=n.getLocation("emissiveFresnelCenterBias"),this._uEmissiveFresnelEdgeColor=n.getLocation("emissiveFresnelEdgeColor"),this._uEmissiveFresnelCenterColor=n.getLocation("emissiveFresnelCenterColor"),this._uEmissiveFresnelPower=n.getLocation("emissiveFresnelPower"));break;case"MetallicMaterial":this._uBaseColor=n.getLocation("materialBaseColor"),this._uMaterialMetallic=n.getLocation("materialMetallic"),this._uMaterialRoughness=n.getLocation("materialRoughness"),this._uMaterialSpecularF0=n.getLocation("materialSpecularF0"),this._uMaterialEmissive=n.getLocation("materialEmissive"),this._uAlphaModeCutoff=n.getLocation("materialAlphaModeCutoff"),s._baseColorMap&&(this._uBaseColorMap="baseColorMap",this._uBaseColorMapMatrix=n.getLocation("baseColorMapMatrix")),s._metallicMap&&(this._uMetallicMap="metallicMap",this._uMetallicMapMatrix=n.getLocation("metallicMapMatrix")),s._roughnessMap&&(this._uRoughnessMap="roughnessMap",this._uRoughnessMapMatrix=n.getLocation("roughnessMapMatrix")),s._metallicRoughnessMap&&(this._uMetallicRoughnessMap="metallicRoughnessMap",this._uMetallicRoughnessMapMatrix=n.getLocation("metallicRoughnessMapMatrix")),s._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=n.getLocation("emissiveMapMatrix")),s._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=n.getLocation("occlusionMapMatrix")),s._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=n.getLocation("alphaMapMatrix")),s._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=n.getLocation("normalMapMatrix"));break;case"SpecularMaterial":this._uMaterialDiffuse=n.getLocation("materialDiffuse"),this._uMaterialSpecular=n.getLocation("materialSpecular"),this._uMaterialGlossiness=n.getLocation("materialGlossiness"),this._uMaterialReflectivity=n.getLocation("reflectivityFresnel"),this._uMaterialEmissive=n.getLocation("materialEmissive"),this._uAlphaModeCutoff=n.getLocation("materialAlphaModeCutoff"),s._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=n.getLocation("diffuseMapMatrix")),s._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=n.getLocation("specularMapMatrix")),s._glossinessMap&&(this._uGlossinessMap="glossinessMap",this._uGlossinessMapMatrix=n.getLocation("glossinessMapMatrix")),s._specularGlossinessMap&&(this._uSpecularGlossinessMap="materialSpecularGlossinessMap",this._uSpecularGlossinessMapMatrix=n.getLocation("materialSpecularGlossinessMapMatrix")),s._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=n.getLocation("emissiveMapMatrix")),s._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=n.getLocation("occlusionMapMatrix")),s._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=n.getLocation("alphaMapMatrix")),s._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=n.getLocation("normalMapMatrix"))}this._aPosition=n.getAttribute("position"),this._aNormal=n.getAttribute("normal"),this._aUV=n.getAttribute("uv"),this._aColor=n.getAttribute("color"),this._aFlags=n.getAttribute("flags"),this._uClippable=n.getLocation("clippable"),this._uColorize=n.getLocation("colorize"),this._uOffset=n.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize=new Float32Array(4),this._baseTextureUnit=0},DrawRenderer.prototype._bindProgram=function(e){const t=WEBGL_INFO$1.MAX_TEXTURE_UNITS,i=this._scene,s=i.canvas.gl,r=i._lightsState,o=i.camera.project;let a;const n=this._program;if(n.bind(),e.useProgram++,e.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize[0]=-1,this._lastColorize[1]=-1,this._lastColorize[2]=-1,this._lastColorize[3]=-1,s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),i.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}for(var h=0,l=r.lights.length;h<l;h++)if(a=r.lights[h],this._uLightAmbient[h])s.uniform4f(this._uLightAmbient[h],a.color[0],a.color[1],a.color[2],a.intensity);else if(this._uLightColor[h]&&s.uniform4f(this._uLightColor[h],a.color[0],a.color[1],a.color[2],a.intensity),this._uLightPos[h]&&(s.uniform3fv(this._uLightPos[h],a.pos),this._uLightAttenuation[h]&&s.uniform1f(this._uLightAttenuation[h],a.attenuation)),this._uLightDir[h]&&s.uniform3fv(this._uLightDir[h],a.dir),a.castsShadow){this._uShadowViewMatrix[h]&&s.uniformMatrix4fv(this._uShadowViewMatrix[h],!1,a.getShadowViewMatrix()),this._uShadowProjMatrix[h]&&s.uniformMatrix4fv(this._uShadowProjMatrix[h],!1,a.getShadowProjMatrix());const i=a.getShadowRenderBuf();i&&(n.bindTexture("shadowMap"+h,i.getTexture(),e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++)}r.lightMaps.length>0&&r.lightMaps[0].texture&&this._uLightMap&&(n.bindTexture(this._uLightMap,r.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),r.reflectionMaps.length>0&&r.reflectionMaps[0].texture&&this._uReflectionMap&&(n.bindTexture(this._uReflectionMap,r.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),this._uGammaFactor&&s.uniform1f(this._uGammaFactor,i.gammaFactor),this._baseTextureUnit=e.textureUnit};class EmphasisFillShaderSource{constructor(e){this.vertex=buildVertex$5(e),this.fragment=buildFragment$5(e)}}function buildVertex$5(e){const t=e.scene,i=t._lightsState,s=hasNormals(e),r=t._sectionPlanesState.sectionPlanes.length>0,o=!!e._geometry._state.compressGeometry,a=e._state.billboard,n=e._state.stationary,h=[];if(h.push("// EmphasisFillShaderSource vertex shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&h.push("#extension GL_EXT_frag_depth : enable"),h.push("attribute vec3 position;"),h.push("uniform mat4 modelMatrix;"),h.push("uniform mat4 viewMatrix;"),h.push("uniform mat4 projMatrix;"),h.push("uniform vec4 colorize;"),h.push("uniform vec3 offset;"),o&&h.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(h.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&h.push("varying float vFragDepth;"),h.push("bool isPerspectiveMatrix(mat4 m) {"),h.push("    return (m[2][3] == - 1.0);"),h.push("}"),h.push("varying float isPerspective;")),r&&h.push("varying vec4 vWorldPosition;"),h.push("uniform vec4   lightAmbient;"),h.push("uniform vec4   fillColor;"),s){h.push("attribute vec3 normal;"),h.push("uniform mat4 modelNormalMatrix;"),h.push("uniform mat4 viewNormalMatrix;");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];"ambient"!==t.type&&(h.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&h.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&h.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&h.push("uniform vec3 lightPos"+e+";"))}o&&(h.push("vec3 octDecode(vec2 oct) {"),h.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),h.push("    if (v.z < 0.0) {"),h.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),h.push("    }"),h.push("    return normalize(v);"),h.push("}"))}if(h.push("varying vec4 vColor;"),"spherical"!==a&&"cylindrical"!==a||(h.push("void billboard(inout mat4 mat) {"),h.push("   mat[0][0] = 1.0;"),h.push("   mat[0][1] = 0.0;"),h.push("   mat[0][2] = 0.0;"),"spherical"===a&&(h.push("   mat[1][0] = 0.0;"),h.push("   mat[1][1] = 1.0;"),h.push("   mat[1][2] = 0.0;")),h.push("   mat[2][0] = 0.0;"),h.push("   mat[2][1] = 0.0;"),h.push("   mat[2][2] =1.0;"),h.push("}")),h.push("void main(void) {"),h.push("vec4 localPosition = vec4(position, 1.0); "),h.push("vec4 worldPosition;"),o&&h.push("localPosition = positionsDecodeMatrix * localPosition;"),s&&(o?h.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):h.push("vec4 localNormal = vec4(normal, 0.0); "),h.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),h.push("mat4 viewNormalMatrix2 = viewNormalMatrix;")),h.push("mat4 viewMatrix2 = viewMatrix;"),h.push("mat4 modelMatrix2 = modelMatrix;"),n&&h.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"),"spherical"===a||"cylindrical"===a?(h.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),h.push("billboard(modelMatrix2);"),h.push("billboard(viewMatrix2);"),h.push("billboard(modelViewMatrix);"),s&&(h.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),h.push("billboard(modelNormalMatrix2);"),h.push("billboard(viewNormalMatrix2);"),h.push("billboard(modelViewNormalMatrix);")),h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("worldPosition.xyz = worldPosition.xyz + offset;"),h.push("vec4 viewPosition  = viewMatrix2 * worldPosition; ")),s&&h.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);"),h.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),h.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),h.push("float lambertian = 1.0;"),s)for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?h.push("viewLightDir = normalize(lightDir"+e+");"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+e+", 0.0)).xyz);");else{if("point"!==t.type)continue;"view"===t.space?h.push("viewLightDir = normalize(lightPos"+e+" - viewPosition.xyz);"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightPos"+e+", 0.0)).xyz);")}h.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),h.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return h.push("vColor = vec4(reflectedColor * fillColor.rgb, fillColor.a);"),r&&h.push("vWorldPosition = worldPosition;"),"points"===e._geometry._state.primitiveName&&h.push("gl_PointSize = pointSize;"),h.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?h.push("vFragDepth = 1.0 + clipPos.w;"):(h.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),h.push("clipPos.z *= clipPos.w;")),h.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),h.push("gl_Position = clipPos;"),h.push("}"),h}function hasNormals(e){const t=e._geometry._state.primitiveName;return!(!e._geometry._state.autoVertexNormals&&!e._geometry._state.normalsBuf||"triangles"!==t&&"triangle-strip"!==t&&"triangle-fan"!==t)}function buildFragment$5(e){const t=e.scene,i=e.scene._sectionPlanesState,s=e.scene.gammaOutput,r=i.sectionPlanes.length>0,o=[];if(o.push("// Lambertian drawing fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),s&&(o.push("uniform float gammaFactor;"),o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}")),r){o.push("varying vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)o.push("uniform bool sectionPlaneActive"+e+";"),o.push("uniform vec3 sectionPlanePos"+e+";"),o.push("uniform vec3 sectionPlaneDir"+e+";")}if(o.push("varying vec4 vColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)o.push("if (sectionPlaneActive"+e+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return"points"===e._geometry._state.primitiveName&&(o.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("float r = dot(cxy, cxy);"),o.push("if (r > 1.0) {"),o.push("   discard;"),o.push("}")),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s?o.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):o.push("gl_FragColor = vColor;"),o.push("}"),o}const ids$1=new Map$1({}),tempVec3a$$=math.vec3(),EmphasisFillRenderer=function(e,t){this.id=ids$1.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new EmphasisFillShaderSource(t),this._allocate(t)},xrayFillRenderers={};EmphasisFillRenderer.get=function(e){const t=[e.scene.id,e.scene.gammaOutput?"go":"",e.scene._sectionPlanesState.getHash(),e._geometry._state.normalsBuf?"n":"",e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";");let i=xrayFillRenderers[t];return i||(i=new EmphasisFillRenderer(t,e),xrayFillRenderers[t]=i,stats.memory.programs++),i._useCount++,i},EmphasisFillRenderer.prototype.put=function(){0==--this._useCount&&(ids$1.removeItem(this.id),this._program&&this._program.destroy(),delete xrayFillRenderers[this._hash],stats.memory.programs--)},EmphasisFillRenderer.prototype.webglContextRestored=function(){this._program=null},EmphasisFillRenderer.prototype.drawMesh=function(e,t,i){this._program||this._allocate(t);const s=this._scene,r=s.camera,o=s.canvas.gl,a=0===i?t._xrayMaterial._state:1===i?t._highlightMaterial._state:t._selectedMaterial._state,n=t._state,h=t._geometry._state,l=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniformMatrix4fv(this._uViewMatrix,!1,l?e.getRTCViewMatrix(n.originHash,l):r.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),n.clippable){const e=s._sectionPlanesState.sectionPlanes.length;if(e>0){const i=s._sectionPlanesState.sectionPlanes,r=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const s=r.sectionPlanesActivePerLayer[t];if(o.uniform1i(e.active,s?1:0),s){const s=i[t];o.uniform3fv(e.pos,l?getPlaneRTCPos(s.dist,s.dir,l,tempVec3a$$):s.pos),o.uniform3fv(e.dir,s.dir)}}}}}if(a.id!==this._lastMaterialId){const t=a.fillColor,i=a.backfaces;e.backfaces!==i&&(i?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),e.backfaces=i),o.uniform4f(this._uFillColor,t[0],t[1],t[2],a.fillAlpha),this._lastMaterialId=a.id}o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,t.worldMatrix),this._uModelNormalMatrix&&o.uniformMatrix4fv(this._uModelNormalMatrix,o.FALSE,t.worldNormalMatrix),this._uClippable&&o.uniform1i(this._uClippable,n.clippable),o.uniform3fv(this._uOffset,n.offset),h.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&o.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(h.positionsBuf),e.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(h.normalsBuf),e.bindArray++),h.indicesBuf?(h.indicesBuf.bind(),e.bindArray++):h.positionsBuf,this._lastGeometryId=h.id),h.indicesBuf?(o.drawElements(h.primitive,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++):h.positionsBuf&&(o.drawArrays(o.TRIANGLES,0,h.positionsBuf.numItems),e.drawArrays++)},EmphasisFillRenderer.prototype._allocate=function(e){const t=e.scene,i=t._lightsState,s=t._sectionPlanesState,r=t.canvas.gl;if(this._program=new Program(r,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const o=this._program;this._uPositionsDecodeMatrix=o.getLocation("positionsDecodeMatrix"),this._uModelMatrix=o.getLocation("modelMatrix"),this._uModelNormalMatrix=o.getLocation("modelNormalMatrix"),this._uViewMatrix=o.getLocation("viewMatrix"),this._uViewNormalMatrix=o.getLocation("viewNormalMatrix"),this._uProjMatrix=o.getLocation("projMatrix"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(let e=0,t=i.lights.length;e<t;e++){switch(i.lights[e].type){case"ambient":this._uLightAmbient[e]=o.getLocation("lightAmbient");break;case"dir":this._uLightColor[e]=o.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=o.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=o.getLocation("lightColor"+e),this._uLightPos[e]=o.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=o.getLocation("lightAttenuation"+e)}}this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:o.getLocation("sectionPlaneActive"+e),pos:o.getLocation("sectionPlanePos"+e),dir:o.getLocation("sectionPlaneDir"+e)});this._uFillColor=o.getLocation("fillColor"),this._aPosition=o.getAttribute("position"),this._aNormal=o.getAttribute("normal"),this._uClippable=o.getLocation("clippable"),this._uGammaFactor=o.getLocation("gammaFactor"),this._uOffset=o.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=o.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},EmphasisFillRenderer.prototype._bindProgram=function(e){const t=this._scene,i=t.canvas.gl,s=t._lightsState,r=t.camera,o=r.project;if(this._program.bind(),e.useProgram++,e.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastIndicesBufId=null,i.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.normalMatrix),i.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];this._uLightAmbient[e]?i.uniform4f(this._uLightAmbient[e],t.color[0],t.color[1],t.color[2],t.intensity):(this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir))}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,t.gammaFactor)};class EmphasisEdgesShaderSource{constructor(e){this.vertex=buildVertex$4(e),this.fragment=buildFragment$4(e)}}function buildVertex$4(e){const t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,r=e._state.billboard,o=e._state.stationary,a=[];return a.push("// Edges drawing vertex shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("attribute vec3 position;"),a.push("uniform mat4 modelMatrix;"),a.push("uniform mat4 viewMatrix;"),a.push("uniform mat4 projMatrix;"),a.push("uniform vec4 edgeColor;"),a.push("uniform vec3 offset;"),s&&a.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(a.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("varying float vFragDepth;"),a.push("bool isPerspectiveMatrix(mat4 m) {"),a.push("    return (m[2][3] == - 1.0);"),a.push("}"),a.push("varying float isPerspective;")),i&&a.push("varying vec4 vWorldPosition;"),a.push("varying vec4 vColor;"),"spherical"!==r&&"cylindrical"!==r||(a.push("void billboard(inout mat4 mat) {"),a.push("   mat[0][0] = 1.0;"),a.push("   mat[0][1] = 0.0;"),a.push("   mat[0][2] = 0.0;"),"spherical"===r&&(a.push("   mat[1][0] = 0.0;"),a.push("   mat[1][1] = 1.0;"),a.push("   mat[1][2] = 0.0;")),a.push("   mat[2][0] = 0.0;"),a.push("   mat[2][1] = 0.0;"),a.push("   mat[2][2] =1.0;"),a.push("}")),a.push("void main(void) {"),a.push("vec4 localPosition = vec4(position, 1.0); "),a.push("vec4 worldPosition;"),s&&a.push("localPosition = positionsDecodeMatrix * localPosition;"),a.push("mat4 viewMatrix2 = viewMatrix;"),a.push("mat4 modelMatrix2 = modelMatrix;"),o&&a.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"),"spherical"===r||"cylindrical"===r?(a.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),a.push("billboard(modelMatrix2);"),a.push("billboard(viewMatrix2);"),a.push("billboard(modelViewMatrix);"),a.push("worldPosition = modelMatrix2 * localPosition;"),a.push("worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(a.push("worldPosition = modelMatrix2 * localPosition;"),a.push("worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition  = viewMatrix2 * worldPosition; ")),a.push("vColor = edgeColor;"),i&&a.push("vWorldPosition = worldPosition;"),a.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?a.push("vFragDepth = 1.0 + clipPos.w;"):(a.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),a.push("clipPos.z *= clipPos.w;")),a.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),a.push("gl_Position = clipPos;"),a.push("}"),a}function buildFragment$4(e){const t=e.scene,i=e.scene._sectionPlanesState,s=e.scene.gammaOutput,r=i.sectionPlanes.length>0,o=[];if(o.push("// Edges drawing fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),s&&(o.push("uniform float gammaFactor;"),o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}")),r){o.push("varying vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)o.push("uniform bool sectionPlaneActive"+e+";"),o.push("uniform vec3 sectionPlanePos"+e+";"),o.push("uniform vec3 sectionPlaneDir"+e+";")}if(o.push("varying vec4 vColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)o.push("if (sectionPlaneActive"+e+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s?o.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):o.push("gl_FragColor = vColor;"),o.push("}"),o}const ids=new Map$1({}),tempVec3a$_=math.vec3(),EmphasisEdgesRenderer=function(e,t){this.id=ids.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new EmphasisEdgesShaderSource(t),this._allocate(t)},renderers$4={};EmphasisEdgesRenderer.get=function(e){const t=[e.scene.id,e.scene.gammaOutput?"go":"",e.scene._sectionPlanesState.getHash(),e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";");let i=renderers$4[t];return i||(i=new EmphasisEdgesRenderer(t,e),renderers$4[t]=i,stats.memory.programs++),i._useCount++,i},EmphasisEdgesRenderer.prototype.put=function(){0==--this._useCount&&(ids.removeItem(this.id),this._program&&this._program.destroy(),delete renderers$4[this._hash],stats.memory.programs--)},EmphasisEdgesRenderer.prototype.webglContextRestored=function(){this._program=null},EmphasisEdgesRenderer.prototype.drawMesh=function(e,t,i){this._program||this._allocate(t);const s=this._scene,r=s.camera,o=s.canvas.gl;let a;const n=t._state,h=t._geometry,l=h._state,c=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniformMatrix4fv(this._uViewMatrix,!1,c?e.getRTCViewMatrix(n.originHash,c):r.viewMatrix),n.clippable){const e=s._sectionPlanesState.sectionPlanes.length;if(e>0){const i=s._sectionPlanesState.sectionPlanes,r=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const s=r.sectionPlanesActivePerLayer[t];if(o.uniform1i(e.active,s?1:0),s){const s=i[t];o.uniform3fv(e.pos,c?getPlaneRTCPos(s.dist,s.dir,c,tempVec3a$_):s.pos),o.uniform3fv(e.dir,s.dir)}}}}}switch(i){case 0:a=t._xrayMaterial._state;break;case 1:a=t._highlightMaterial._state;break;case 2:a=t._selectedMaterial._state;break;default:a=t._edgeMaterial._state}if(a.id!==this._lastMaterialId){const t=a.backfaces;if(e.backfaces!==t&&(t?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),e.backfaces=t),e.lineWidth!==a.edgeWidth&&(o.lineWidth(a.edgeWidth),e.lineWidth=a.edgeWidth),this._uEdgeColor){const e=a.edgeColor,t=a.edgeAlpha;o.uniform4f(this._uEdgeColor,e[0],e[1],e[2],t)}this._lastMaterialId=a.id}let u;o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,t.worldMatrix),this._uClippable&&o.uniform1i(this._uClippable,n.clippable),o.uniform3fv(this._uOffset,n.offset),l.primitive===o.TRIANGLES?u=h._getEdgeIndices():l.primitive===o.LINES&&(u=l.indicesBuf),u&&(l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf,l.compressGeometry?o.UNSIGNED_SHORT:o.FLOAT),e.bindArray++),u.bind(),e.bindArray++,this._lastGeometryId=l.id),o.drawElements(o.LINES,u.numItems,u.itemType,0),e.drawElements++)},EmphasisEdgesRenderer.prototype._allocate=function(e){const t=e.scene,i=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Program(i,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const r=this._program;this._uPositionsDecodeMatrix=r.getLocation("positionsDecodeMatrix"),this._uModelMatrix=r.getLocation("modelMatrix"),this._uViewMatrix=r.getLocation("viewMatrix"),this._uProjMatrix=r.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:r.getLocation("sectionPlaneActive"+e),pos:r.getLocation("sectionPlanePos"+e),dir:r.getLocation("sectionPlaneDir"+e)});this._uEdgeColor=r.getLocation("edgeColor"),this._aPosition=r.getAttribute("position"),this._uClippable=r.getLocation("clippable"),this._uGammaFactor=r.getLocation("gammaFactor"),this._uOffset=r.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=r.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},EmphasisEdgesRenderer.prototype._bindProgram=function(e){const t=this._program,i=this._scene,s=i.canvas.gl,r=i.camera.project;if(t.bind(),e.useProgram++,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),i.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,i.gammaFactor)};class PickMeshShaderSource{constructor(e){this.vertex=buildVertex$3(e),this.fragment=buildFragment$3(e)}}function buildVertex$3(e){const t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,r=e._state.billboard,o=e._state.stationary,a=[];return a.push("// Mesh picking vertex shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("attribute vec3 position;"),a.push("uniform mat4 modelMatrix;"),a.push("uniform mat4 viewMatrix;"),a.push("uniform mat4 projMatrix;"),a.push("varying vec4 vViewPosition;"),a.push("uniform vec3 offset;"),s&&a.push("uniform mat4 positionsDecodeMatrix;"),i&&a.push("varying vec4 vWorldPosition;"),t.logarithmicDepthBufferEnabled&&(a.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("varying float vFragDepth;"),a.push("bool isPerspectiveMatrix(mat4 m) {"),a.push("    return (m[2][3] == - 1.0);"),a.push("}"),a.push("varying float isPerspective;")),"spherical"!==r&&"cylindrical"!==r||(a.push("void billboard(inout mat4 mat) {"),a.push("   mat[0][0] = 1.0;"),a.push("   mat[0][1] = 0.0;"),a.push("   mat[0][2] = 0.0;"),"spherical"===r&&(a.push("   mat[1][0] = 0.0;"),a.push("   mat[1][1] = 1.0;"),a.push("   mat[1][2] = 0.0;")),a.push("   mat[2][0] = 0.0;"),a.push("   mat[2][1] = 0.0;"),a.push("   mat[2][2] =1.0;"),a.push("}")),a.push("void main(void) {"),a.push("vec4 localPosition = vec4(position, 1.0); "),s&&a.push("localPosition = positionsDecodeMatrix * localPosition;"),a.push("mat4 viewMatrix2 = viewMatrix;"),a.push("mat4 modelMatrix2 = modelMatrix;"),o&&a.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"),"spherical"!==r&&"cylindrical"!==r||(a.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),a.push("billboard(modelMatrix2);"),a.push("billboard(viewMatrix2);")),a.push("   vec4 worldPosition = modelMatrix2 * localPosition;"),a.push("   worldPosition.xyz = worldPosition.xyz + offset;"),a.push("   vec4 viewPosition = viewMatrix2 * worldPosition;"),i&&a.push("   vWorldPosition = worldPosition;"),a.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?a.push("vFragDepth = 1.0 + clipPos.w;"):(a.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),a.push("clipPos.z *= clipPos.w;")),a.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),a.push("gl_Position = clipPos;"),a.push("}"),a}function buildFragment$3(e){const t=e.scene,i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("// Mesh picking fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;")),r.push("uniform vec4 pickColor;"),s){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(var o=0;o<i.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<i.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("   gl_FragColor = pickColor; "),r.push("}"),r}const tempVec3a$Z=math.vec3(),PickMeshRenderer=function(e,t){this._hash=e,this._shaderSource=new PickMeshShaderSource(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},renderers$3={};PickMeshRenderer.get=function(e){const t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.hash].join(";");let i=renderers$3[t];if(!i){if(i=new PickMeshRenderer(t,e),i.errors)return console.log(i.errors.join("\n")),null;renderers$3[t]=i,stats.memory.programs++}return i._useCount++,i},PickMeshRenderer.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete renderers$3[this._hash],stats.memory.programs--)},PickMeshRenderer.prototype.webglContextRestored=function(){this._program=null},PickMeshRenderer.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const i=this._scene,s=i.canvas.gl,r=t._state,o=t._material._state,a=t._geometry._state,n=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),s.uniformMatrix4fv(this._uViewMatrix,!1,n?e.getRTCPickViewMatrix(r.originHash,n):e.pickViewMatrix),r.clippable){const e=i._sectionPlanesState.sectionPlanes.length;if(e>0){const r=i._sectionPlanesState.sectionPlanes,o=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const i=o.sectionPlanesActivePerLayer[t];if(s.uniform1i(e.active,i?1:0),i){const i=r[t];s.uniform3fv(e.pos,n?getPlaneRTCPos(i.dist,i.dir,n,tempVec3a$Z):i.pos),s.uniform3fv(e.dir,i.dir)}}}}}if(o.id!==this._lastMaterialId){const t=o.backfaces;e.backfaces!==t&&(t?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=t);const i=o.frontface;e.frontface!==i&&(i?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=i),this._lastMaterialId=o.id}s.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),s.uniformMatrix4fv(this._uModelMatrix,!1,t.worldMatrix),this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),a.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(a.positionsBuf,a.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),e.bindArray++),a.indicesBuf&&(a.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=a.id);var h=t._state.pickID;const l=h>>24&255,c=h>>16&255,u=h>>8&255,p=255&h;s.uniform4f(this._uPickColor,p/255,u/255,c/255,l/255),a.indicesBuf?(s.drawElements(a.primitive,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++):a.positions&&s.drawArrays(s.TRIANGLES,0,a.positions.numItems)},PickMeshRenderer.prototype._allocate=function(e){const t=e.scene,i=t.canvas.gl;if(this._program=new Program(i,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._uClippable=s.getLocation("clippable"),this._uPickColor=s.getLocation("pickColor"),this._uOffset=s.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastGeometryId=null},PickMeshRenderer.prototype._bindProgram=function(e){const t=this._scene,i=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.useProgram++,t.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}this._lastMaterialId=null,this._lastGeometryId=null};class PickTriangleShaderSource{constructor(e){this.vertex=buildVertex$2(e),this.fragment=buildFragment$2(e)}}function buildVertex$2(e){const t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry;e._state.billboard,e._state.stationary;const r=[];return r.push("// Surface picking vertex shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable"),r.push("attribute vec3 position;"),r.push("attribute vec4 color;"),r.push("uniform mat4 modelMatrix;"),r.push("uniform mat4 viewMatrix;"),r.push("uniform mat4 projMatrix;"),r.push("uniform vec3 offset;"),i&&(r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;")),t.logarithmicDepthBufferEnabled&&(r.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("varying float vFragDepth;"),r.push("bool isPerspectiveMatrix(mat4 m) {"),r.push("    return (m[2][3] == - 1.0);"),r.push("}"),r.push("varying float isPerspective;")),r.push("varying vec4 vColor;"),s&&r.push("uniform mat4 positionsDecodeMatrix;"),r.push("void main(void) {"),r.push("vec4 localPosition = vec4(position, 1.0); "),s&&r.push("localPosition = positionsDecodeMatrix * localPosition;"),r.push("   vec4 worldPosition = modelMatrix * localPosition; "),r.push("   worldPosition.xyz = worldPosition.xyz + offset;"),r.push("   vec4 viewPosition = viewMatrix * worldPosition;"),i&&r.push("   vWorldPosition = worldPosition;"),r.push("   vColor = color;"),r.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?r.push("vFragDepth = 1.0 + clipPos.w;"):(r.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),r.push("clipPos.z *= clipPos.w;")),r.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),r.push("gl_Position = clipPos;"),r.push("}"),r}function buildFragment$2(e){const t=e.scene,i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("// Surface picking fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),r.push("varying vec4 vColor;"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;")),s){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(let e=0;e<i.sectionPlanes.length;e++)r.push("uniform bool sectionPlaneActive"+e+";"),r.push("uniform vec3 sectionPlanePos"+e+";"),r.push("uniform vec3 sectionPlaneDir"+e+";")}if(r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(let e=0;e<i.sectionPlanes.length;e++)r.push("if (sectionPlaneActive"+e+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("   gl_FragColor = vColor;"),r.push("}"),r}const tempVec3a$Y=math.vec3(),PickTriangleRenderer=function(e,t){this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new PickTriangleShaderSource(t),this._allocate(t)},renderers$2={};PickTriangleRenderer.get=function(e){const t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";");let i=renderers$2[t];if(!i){if(i=new PickTriangleRenderer(t,e),i.errors)return console.log(i.errors.join("\n")),null;renderers$2[t]=i,stats.memory.programs++}return i._useCount++,i},PickTriangleRenderer.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete renderers$2[this._hash],stats.memory.programs--)},PickTriangleRenderer.prototype.webglContextRestored=function(){this._program=null},PickTriangleRenderer.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const i=this._scene,s=i.canvas.gl,r=t._state,o=t._material._state,a=t._geometry,n=t._geometry._state,h=t.origin,l=o.backfaces,c=o.frontface,u=i.camera.project,p=a._getPickTrianglePositions(),d=a._getPickTriangleColors();if(this._program.bind(),e.useProgram++,i.logarithmicDepthBufferEnabled){const e=2/(Math.log(u.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}if(s.uniformMatrix4fv(this._uViewMatrix,!1,h?e.getRTCPickViewMatrix(r.originHash,h):e.pickViewMatrix),r.clippable){const e=i._sectionPlanesState.sectionPlanes.length;if(e>0){const r=i._sectionPlanesState.sectionPlanes,o=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const i=o.sectionPlanesActivePerLayer[t];if(s.uniform1i(e.active,i?1:0),i){const i=r[t];s.uniform3fv(e.pos,h?getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$Y):i.pos),s.uniform3fv(e.dir,i.dir)}}}}}s.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),i.logarithmicDepthBufferEnabled&&s.uniform1f(this._uZFar,i.camera.project.far),e.backfaces!==l&&(l?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=l),e.frontface!==c&&(c?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=c),s.uniformMatrix4fv(this._uModelMatrix,!1,t.worldMatrix),this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),this._uPositionsDecodeMatrix?(s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(p,n.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT)):this._aPosition.bindArrayBuffer(p),d.bind(),s.enableVertexAttribArray(this._aColor.location),s.vertexAttribPointer(this._aColor.location,d.itemSize,d.itemType,!0,0,0),s.drawArrays(n.primitive,0,p.numItems/3)},PickTriangleRenderer.prototype._allocate=function(e){const t=e.scene,i=t.canvas.gl;if(this._program=new Program(i,this._shaderSource),this._useCount=0,this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._uClippable=s.getLocation("clippable"),this._uOffset=s.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))};class OcclusionShaderSource{constructor(e){this.vertex=buildVertex$1(e),this.fragment=buildFragment$1(e)}}function buildVertex$1(e){const t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,r=e._state.billboard,o=e._state.stationary,a=[];return a.push("// Mesh occlusion vertex shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("attribute vec3 position;"),a.push("uniform mat4 modelMatrix;"),a.push("uniform mat4 viewMatrix;"),a.push("uniform mat4 projMatrix;"),a.push("uniform vec3 offset;"),s&&a.push("uniform mat4 positionsDecodeMatrix;"),i&&a.push("varying vec4 vWorldPosition;"),t.logarithmicDepthBufferEnabled&&(a.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("varying float vFragDepth;"),a.push("bool isPerspectiveMatrix(mat4 m) {"),a.push("    return (m[2][3] == - 1.0);"),a.push("}"),a.push("varying float isPerspective;")),"spherical"!==r&&"cylindrical"!==r||(a.push("void billboard(inout mat4 mat) {"),a.push("   mat[0][0] = 1.0;"),a.push("   mat[0][1] = 0.0;"),a.push("   mat[0][2] = 0.0;"),"spherical"===r&&(a.push("   mat[1][0] = 0.0;"),a.push("   mat[1][1] = 1.0;"),a.push("   mat[1][2] = 0.0;")),a.push("   mat[2][0] = 0.0;"),a.push("   mat[2][1] = 0.0;"),a.push("   mat[2][2] =1.0;"),a.push("}")),a.push("void main(void) {"),a.push("vec4 localPosition = vec4(position, 1.0); "),a.push("vec4 worldPosition;"),s&&a.push("localPosition = positionsDecodeMatrix * localPosition;"),a.push("mat4 viewMatrix2 = viewMatrix;"),a.push("mat4 modelMatrix2 = modelMatrix;"),o&&a.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"),"spherical"===r||"cylindrical"===r?(a.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),a.push("billboard(modelMatrix2);"),a.push("billboard(viewMatrix2);"),a.push("billboard(modelViewMatrix);"),a.push("worldPosition = modelMatrix2 * localPosition;"),a.push("worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(a.push("worldPosition = modelMatrix2 * localPosition;"),a.push("worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition  = viewMatrix2 * worldPosition; ")),i&&a.push("   vWorldPosition = worldPosition;"),a.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?a.push("vFragDepth = 1.0 + clipPos.w;"):(a.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),a.push("clipPos.z *= clipPos.w;")),a.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),a.push("gl_Position = clipPos;"),a.push("}"),a}function buildFragment$1(e){const t=e.scene,i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("// Mesh occlusion fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;")),s){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(var o=0;o<i.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<i.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return r.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),t.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("}"),r}const tempVec3a$X=math.vec3(),OcclusionRenderer=function(e,t){this._hash=e,this._shaderSource=new OcclusionShaderSource(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},renderers$1={};OcclusionRenderer.get=function(e){const t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.occlusionHash].join(";");let i=renderers$1[t];if(!i){if(i=new OcclusionRenderer(t,e),i.errors)return console.log(i.errors.join("\n")),null;renderers$1[t]=i,stats.memory.programs++}return i._useCount++,i},OcclusionRenderer.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete renderers$1[this._hash],stats.memory.programs--)},OcclusionRenderer.prototype.webglContextRestored=function(){this._program=null},OcclusionRenderer.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const i=this._scene,s=i.canvas.gl,r=t._material._state,o=t._state,a=t._geometry._state,n=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),r.id!==this._lastMaterialId){const t=r.backfaces;e.backfaces!==t&&(t?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=t);const i=r.frontface;e.frontface!==i&&(i?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=i),this._lastMaterialId=r.id}const h=i.camera;if(s.uniformMatrix4fv(this._uViewMatrix,!1,n?e.getRTCViewMatrix(o.originHash,n):h.viewMatrix),o.clippable){const e=i._sectionPlanesState.sectionPlanes.length;if(e>0){const r=i._sectionPlanesState.sectionPlanes,o=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const i=o.sectionPlanesActivePerLayer[t];if(s.uniform1i(e.active,i?1:0),i){const i=r[t];s.uniform3fv(e.pos,n?getPlaneRTCPos(i.dist,i.dir,n,tempVec3a$X):i.pos),s.uniform3fv(e.dir,i.dir)}}}}}s.uniformMatrix4fv(this._uProjMatrix,!1,h._project._state.matrix),s.uniformMatrix4fv(this._uModelMatrix,s.FALSE,t.worldMatrix),this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),a.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(a.positionsBuf,a.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),e.bindArray++),a.indicesBuf&&(a.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=a.id),a.indicesBuf?(s.drawElements(a.primitive,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++):a.positions&&s.drawArrays(s.TRIANGLES,0,a.positions.numItems)},OcclusionRenderer.prototype._allocate=function(e){const t=e.scene,i=t.canvas.gl;if(this._program=new Program(i,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._uClippable=s.getLocation("clippable"),this._uOffset=s.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},OcclusionRenderer.prototype._bindProgram=function(e){const t=this._scene,i=t.camera.project,s=t.canvas.gl;if(this._program.bind(),e.useProgram++,s.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null};class ShadowShaderSource{constructor(e){this.vertex=buildVertex(e),this.fragment=buildFragment(e)}}function buildVertex(e){const t=e.scene._sectionPlanesState.sectionPlanes.length>0,i=!!e._geometry._state.compressGeometry,s=[];return s.push("// Mesh shadow vertex shader"),s.push("attribute vec3 position;"),s.push("uniform mat4 modelMatrix;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform vec3 offset;"),i&&s.push("uniform mat4 positionsDecodeMatrix;"),t&&s.push("varying vec4 vWorldPosition;"),s.push("void main(void) {"),s.push("vec4 localPosition = vec4(position, 1.0); "),s.push("vec4 worldPosition;"),i&&s.push("localPosition = positionsDecodeMatrix * localPosition;"),s.push("worldPosition = modelMatrix * localPosition;"),s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&s.push("vWorldPosition = worldPosition;"),s.push("   gl_Position = shadowProjMatrix * viewPosition;"),s.push("}"),s}function buildFragment(e){const t=e.scene;t.canvas.gl;const i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("// Mesh shadow fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),s){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(var o=0;o<i.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("vec4 encodeFloat( const in float depth ) {"),r.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),r.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),r.push("  vec4 comp = fract(depth * bitShift);"),r.push("  comp -= comp.xxyz * bitMask;"),r.push("  return comp;"),r.push("}"),r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<i.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return r.push("gl_FragColor = encodeFloat(gl_FragCoord.z);"),r.push("}"),r}const ShadowRenderer=function(e,t){this._hash=e,this._shaderSource=new ShadowShaderSource(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},renderers={};ShadowRenderer.get=function(e){const t=e.scene,i=[t.canvas.canvas.id,t._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.hash].join(";");let s=renderers[i];if(!s){if(s=new ShadowRenderer(i,e),s.errors)return console.log(s.errors.join("\n")),null;renderers[i]=s,stats.memory.programs++}return s._useCount++,s},ShadowRenderer.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete renderers[this._hash],stats.memory.programs--)},ShadowRenderer.prototype.webglContextRestored=function(){this._program=null},ShadowRenderer.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const i=this._scene.canvas.gl,s=t._material._state,r=t._geometry._state;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),s.id!==this._lastMaterialId){const t=s.backfaces;e.backfaces!==t&&(t?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),e.backfaces=t);const r=s.frontface;e.frontface!==r&&(r?i.frontFace(i.CCW):i.frontFace(i.CW),e.frontface=r),e.lineWidth!==s.lineWidth&&(i.lineWidth(s.lineWidth),e.lineWidth=s.lineWidth),this._uPointSize&&i.uniform1i(this._uPointSize,s.pointSize),this._lastMaterialId=s.id}if(i.uniformMatrix4fv(this._uModelMatrix,i.FALSE,t.worldMatrix),r.combineGeometry){const s=t.vertexBufs;s.id!==this._lastVertexBufsId&&(s.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(s.positionsBuf,s.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),e.bindArray++),this._lastVertexBufsId=s.id)}this._uClippable&&i.uniform1i(this._uClippable,t._state.clippable),i.uniform3fv(this._uOffset,t._state.offset),r.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,r.positionsDecodeMatrix),r.combineGeometry?r.indicesBufCombined&&(r.indicesBufCombined.bind(),e.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(r.positionsBuf,r.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),e.bindArray++),r.indicesBuf&&(r.indicesBuf.bind(),e.bindArray++)),this._lastGeometryId=r.id),r.combineGeometry?r.indicesBufCombined&&(i.drawElements(r.primitive,r.indicesBufCombined.numItems,r.indicesBufCombined.itemType,0),e.drawElements++):r.indicesBuf?(i.drawElements(r.primitive,r.indicesBuf.numItems,r.indicesBuf.itemType,0),e.drawElements++):r.positions&&(i.drawArrays(i.TRIANGLES,0,r.positions.numItems),e.drawArrays++)},ShadowRenderer.prototype._allocate=function(e){const t=e.scene,i=t.canvas.gl;if(this._program=new Program(i,this._shaderSource),this._scene=t,this._useCount=0,this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),this._uSectionPlanes={};for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._uClippable=s.getLocation("clippable"),this._uOffset=s.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},ShadowRenderer.prototype._bindProgram=function(e){this._program||this._allocate(mesh);const t=this._scene,i=t.canvas.gl,s=t._sectionPlanesState;if(this._program.bind(),e.useProgram++,i.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),i.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,s.sectionPlanes.length>0){let e,t,r,o,a;for(let n=0,h=this._uSectionPlanes.length;n<h;n++)e=this._uSectionPlanes[n],t=e.active,r=s.sectionPlanes[n],t&&i.uniform1i(t,r.active),o=e.pos,o&&i.uniform3fv(e.pos,r.pos),a=e.dir,a&&i.uniform3fv(e.dir,r.dir)}};class RenderFlags{constructor(){this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}reset(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}const obb=math.OBB3(),angleAxis$1=math.vec4(),q1$1=math.vec4(),q2$1=math.vec4(),xAxis$1=math.vec3([1,0,0]),yAxis$1=math.vec3([0,1,0]),zAxis$1=math.vec3([0,0,1]),veca$1=math.vec3(3),vecb$1=math.vec3(3),identityMat$1=math.identityMat4();class Mesh extends Component{constructor(e,t={}){super(e,t),this.originalSystemId=t.originalSystemId||this.id,this.renderFlags=new RenderFlags,this._state=new RenderState({visible:!0,culled:!1,pickable:null,clippable:null,collidable:null,occluder:!1!==t.occluder,castsShadow:null,receivesShadow:null,xrayed:!1,highlighted:!1,selected:!1,edges:!1,stationary:!!t.stationary,background:!!t.background,billboard:this._checkBillboard(t.billboard),layer:null,colorize:null,pickID:this.scene._renderer.getPickID(this),drawHash:"",pickHash:"",offset:math.vec3(),origin:null,originHash:null}),this._drawRenderer=null,this._shadowRenderer=null,this._emphasisFillRenderer=null,this._emphasisEdgesRenderer=null,this._pickMeshRenderer=null,this._pickTriangleRenderer=null,this._occlusionRenderer=null,this._geometry=t.geometry?this._checkComponent2(["ReadableGeometry","VBOGeometry"],t.geometry):this.scene.geometry,this._material=t.material?this._checkComponent2(["PhongMaterial","MetallicMaterial","SpecularMaterial","LambertMaterial"],t.material):this.scene.material,this._xrayMaterial=t.xrayMaterial?this._checkComponent("EmphasisMaterial",t.xrayMaterial):this.scene.xrayMaterial,this._highlightMaterial=t.highlightMaterial?this._checkComponent("EmphasisMaterial",t.highlightMaterial):this.scene.highlightMaterial,this._selectedMaterial=t.selectedMaterial?this._checkComponent("EmphasisMaterial",t.selectedMaterial):this.scene.selectedMaterial,this._edgeMaterial=t.edgeMaterial?this._checkComponent("EdgeMaterial",t.edgeMaterial):this.scene.edgeMaterial,this._parentNode=null,this._aabb=null,this._aabbDirty=!0,this._numTriangles=this._geometry?this._geometry.numTriangles:0,this.scene._aabbDirty=!0,this._scale=math.vec3(),this._quaternion=math.identityQuaternion(),this._rotation=math.vec3(),this._position=math.vec3(),this._worldMatrix=math.identityMat4(),this._worldNormalMatrix=math.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0;const i=t.origin||t.rtcCenter;if(i&&(this._state.origin=math.vec3(i),this._state.originHash=i.join()),t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),this._isObject=t.isObject,this._isObject&&this.scene._registerObject(this),this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.layer=t.layer,this.colorize=t.colorize,this.opacity=t.opacity,this.offset=t.offset,t.parentId){const e=this.scene.components[t.parentId];e?e.isNode?e.addChild(this):this.error("Parent is not a Node: '"+t.parentId+"'"):this.error("Parent not found: '"+t.parentId+"'"),this._parentNode=e}else t.parent&&(t.parent.isNode||this.error("Parent is not a Node"),t.parent.addChild(this),this._parentNode=t.parent);this.compile()}get type(){return"Mesh"}get isMesh(){return!0}get parent(){return this._parentNode}get geometry(){return this._geometry}get material(){return this._material}get position(){return this._position}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set rotation(e){this._rotation.set(e||[0,0,0]),math.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),math.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=math.identityMat4()),math.composeMat4(this._position,this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1),this.__localMatrix}set matrix(e){this.__localMatrix||(this.__localMatrix=math.identityMat4()),this.__localMatrix.set(e||identityMat$1),math.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix(),this._worldNormalMatrix}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}get origin(){return this._state.origin}set origin(e){e?(this._state.origin||(this._state.origin=math.vec3()),this._state.origin.set(e),this._state.originHash=e.join(),this._setAABBDirty(),this.scene._aabbDirty=!0):this._state.origin&&(this._state.origin=null,this._state.originHash=null,this._setAABBDirty(),this.scene._aabbDirty=!0)}get rtcCenter(){return this.origin}set rtcCenter(e){this.origin=e}get numTriangles(){return this._numTriangles}get visible(){return this._state.visible}set visible(e){e=!1!==e,this._state.visible=e,this._isObject&&this.scene._objectVisibilityUpdated(this),this.glRedraw()}get xrayed(){return this._state.xrayed}set xrayed(e){e=!!e,this._state.xrayed!==e&&(this._state.xrayed=e,this._isObject&&this.scene._objectXRayedUpdated(this),this.glRedraw())}get highlighted(){return this._state.highlighted}set highlighted(e){(e=!!e)!==this._state.highlighted&&(this._state.highlighted=e,this._isObject&&this.scene._objectHighlightedUpdated(this),this.glRedraw())}get selected(){return this._state.selected}set selected(e){(e=!!e)!==this._state.selected&&(this._state.selected=e,this._isObject&&this.scene._objectSelectedUpdated(this),this.glRedraw())}get edges(){return this._state.edges}set edges(e){(e=!!e)!==this._state.edges&&(this._state.edges=e,this.glRedraw())}get culled(){return this._state.culled}set culled(e){this._state.culled=!!e,this.glRedraw()}get clippable(){return this._state.clippable}set clippable(e){e=!1!==e,this._state.clippable!==e&&(this._state.clippable=e,this.glRedraw())}get collidable(){return this._state.collidable}set collidable(e){(e=!1!==e)!==this._state.collidable&&(this._state.collidable=e,this._setAABBDirty(),this.scene._aabbDirty=!0)}get pickable(){return this._state.pickable}set pickable(e){e=!1!==e,this._state.pickable!==e&&(this._state.pickable=e)}get castsShadow(){return this._state.castsShadow}set castsShadow(e){(e=!1!==e)!==this._state.castsShadow&&(this._state.castsShadow=e,this.glRedraw())}get receivesShadow(){return this._state.receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._state.receivesShadow&&(this._state.receivesShadow=e,this._state.hash=e?"/mod/rs;":"/mod;",this.fire("dirty",this))}get saoEnabled(){return!1}get colorize(){return this._state.colorize}set colorize(e){let t=this._state.colorize;t||(t=this._state.colorize=new Float32Array(4),t[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);const i=!!e;this.scene._objectColorizeUpdated(this,i),this.glRedraw()}get opacity(){return this._state.colorize[3]}set opacity(e){let t=this._state.colorize;t||(t=this._state.colorize=new Float32Array(4),t[0]=1,t[1]=1,t[2]=1);const i=null!=e;t[3]=i?e:1,this.scene._objectOpacityUpdated(this,i),this.glRedraw()}get transparent(){return 2===this._material.alphaMode||this._state.colorize[3]<1}get layer(){return this._state.layer}set layer(e){e=e||0,(e=Math.round(e))!==this._state.layer&&(this._state.layer=e,this._renderer.needStateSort())}get stationary(){return this._state.stationary}get billboard(){return this._state.billboard}get offset(){return this._state.offset}set offset(e){this._state.offset.set(e||[0,0,0]),this._setAABBDirty(),this.glRedraw()}get isDrawable(){return!0}get isStateSortable(){return!0}get xrayMaterial(){return this._xrayMaterial}get highlightMaterial(){return this._highlightMaterial}get selectedMaterial(){return this._selectedMaterial}get edgeMaterial(){return this._edgeMaterial}_checkBillboard(e){return"spherical"!==(e=e||"none")&&"cylindrical"!==e&&"none"!==e&&(this.error("Unsupported value for 'billboard': "+e+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),e="none"),e}compile(){const e=this._makeDrawHash();this._state.drawHash!==e&&(this._state.drawHash=e,this._putDrawRenderers(),this._drawRenderer=DrawRenderer.get(this),this._emphasisFillRenderer=EmphasisFillRenderer.get(this),this._emphasisEdgesRenderer=EmphasisEdgesRenderer.get(this));const t=this._makePickHash();if(this._state.pickHash!==t&&(this._state.pickHash=t,this._putPickRenderers(),this._pickMeshRenderer=PickMeshRenderer.get(this)),this._state.occluder){const e=this._makeOcclusionHash();this._state.occlusionHash!==e&&(this._state.occlusionHash=e,this._putOcclusionRenderer(),this._occlusionRenderer=OcclusionRenderer.get(this))}}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0}_buildWorldMatrix(){const e=this.matrix;if(this._parentNode)math.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(let t=0,i=e.length;t<i;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_buildWorldNormalMatrix(){this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldNormalMatrix||(this._worldNormalMatrix=math.mat4()),math.transposeMat4(this._worldMatrix,this._worldNormalMatrix),math.inverseMat4(this._worldNormalMatrix),this._worldNormalMatrixDirty=!1}_setAABBDirty(){if(this.collidable)for(let e=this;e;e=e._parentNode)e._aabbDirty=!0}_updateAABB(){this.scene._aabbDirty=!0,this._aabb||(this._aabb=math.AABB3()),this._buildAABB(this.worldMatrix,this._aabb),this._aabbDirty=!1}_webglContextRestored(){this._drawRenderer&&this._drawRenderer.webglContextRestored(),this._shadowRenderer&&this._shadowRenderer.webglContextRestored(),this._emphasisFillRenderer&&this._emphasisFillRenderer.webglContextRestored(),this._emphasisEdgesRenderer&&this._emphasisEdgesRenderer.webglContextRestored(),this._pickMeshRenderer&&this._pickMeshRenderer.webglContextRestored(),this._pickTriangleRenderer&&this._pickMeshRenderer.webglContextRestored(),this._occlusionRenderer&&this._occlusionRenderer.webglContextRestored()}_makeDrawHash(){const e=this.scene,t=[e.canvas.canvas.id,(e.gammaInput?"gi;":";")+(e.gammaOutput?"go":""),e._lightsState.getHash(),e._sectionPlanesState.getHash()],i=this._state;return i.stationary&&t.push("/s"),"none"===i.billboard?t.push("/n"):"spherical"===i.billboard?t.push("/s"):"cylindrical"===i.billboard&&t.push("/c"),i.receivesShadow&&t.push("/rs"),t.push(";"),t.join("")}_makePickHash(){const e=this.scene,t=[e.canvas.canvas.id,e._sectionPlanesState.getHash()],i=this._state;return i.stationary&&t.push("/s"),"none"===i.billboard?t.push("/n"):"spherical"===i.billboard?t.push("/s"):"cylindrical"===i.billboard&&t.push("/c"),t.push(";"),t.join("")}_makeOcclusionHash(){const e=this.scene,t=[e.canvas.canvas.id,e._sectionPlanesState.getHash()],i=this._state;return i.stationary&&t.push("/s"),"none"===i.billboard?t.push("/n"):"spherical"===i.billboard?t.push("/s"):"cylindrical"===i.billboard&&t.push("/c"),t.push(";"),t.join("")}_buildAABB(e,t){math.transformOBB3(e,this._geometry.obb,obb),math.OBB3ToAABB3(obb,t);const i=this._state.offset;if(t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[0],t[4]+=i[1],t[5]+=i[2],this._state.origin){const e=this._state.origin;t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[0],t[4]+=e[1],t[5]+=e[2]}}rotate(e,t){return angleAxis$1[0]=e[0],angleAxis$1[1]=e[1],angleAxis$1[2]=e[2],angleAxis$1[3]=t*math.DEGTORAD,math.angleAxisToQuaternion(angleAxis$1,q1$1),math.mulQuaternions(this.quaternion,q1$1,q2$1),this.quaternion=q2$1,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(e,t){return angleAxis$1[0]=e[0],angleAxis$1[1]=e[1],angleAxis$1[2]=e[2],angleAxis$1[3]=t*math.DEGTORAD,math.angleAxisToQuaternion(angleAxis$1,q1$1),math.mulQuaternions(q1$1,this.quaternion,q1$1),this}rotateX(e){return this.rotate(xAxis$1,e)}rotateY(e){return this.rotate(yAxis$1,e)}rotateZ(e){return this.rotate(zAxis$1,e)}translate(e,t){return math.vec3ApplyQuaternion(this.quaternion,e,veca$1),math.mulVec3Scalar(veca$1,t,vecb$1),math.addVec3(this.position,vecb$1,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(e){return this.translate(xAxis$1,e)}translateY(e){return this.translate(yAxis$1,e)}translateZ(e){return this.translate(zAxis$1,e)}_putDrawRenderers(){this._drawRenderer&&(this._drawRenderer.put(),this._drawRenderer=null),this._shadowRenderer&&(this._shadowRenderer.put(),this._shadowRenderer=null),this._emphasisFillRenderer&&(this._emphasisFillRenderer.put(),this._emphasisFillRenderer=null),this._emphasisEdgesRenderer&&(this._emphasisEdgesRenderer.put(),this._emphasisEdgesRenderer=null)}_putPickRenderers(){this._pickMeshRenderer&&(this._pickMeshRenderer.put(),this._pickMeshRenderer=null),this._pickTriangleRenderer&&(this._pickTriangleRenderer.put(),this._pickTriangleRenderer=null)}_putOcclusionRenderer(){this._occlusionRenderer&&(this._occlusionRenderer.put(),this._occlusionRenderer=null)}stateSortCompare(e,t){return e._state.layer-t._state.layer||e._drawRenderer.id-t._drawRenderer.id||e._material._state.id-t._material._state.id||e._geometry._state.id-t._geometry._state.id}rebuildRenderFlags(){this.renderFlags.reset(),this._getActiveSectionPlanes()?(this.renderFlags.numLayers=1,this.renderFlags.numVisibleLayers=1,this.renderFlags.visibleLayers[0]=0,this._updateRenderFlags()):this.renderFlags.culled=!0}_updateRenderFlags(){const e=this.renderFlags,t=this._state;if(t.xrayed){const t=this._xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}else{if(this._material._state.alpha<1||t.colorize[3]<1?e.colorTransparent=!0:e.colorOpaque=!0,t.edges){this._edgeMaterial._state.alpha<1?e.edgesTransparent=!0:e.edgesOpaque=!0}if(t.selected){const t=this._selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}else if(t.highlighted){const t=this._highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}_getActiveSectionPlanes(){if(this._state.clippable){const e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(let i=0;i<t;i++){const t=e[i],s=this.renderFlags;if(t.active)if(this._state.origin){const e=math.planeAABB3Intersect(t.dir,t.dist,this.aabb);if(-1===e)return!1;const r=0===e;s.sectionPlanesActivePerLayer[i]=r}else s.sectionPlanesActivePerLayer[i]=!0;else s.sectionPlanesActivePerLayer[i]=!1}}return!0}drawColorOpaque(e){(this._drawRenderer||(this._drawRenderer=DrawRenderer.get(this)))&&this._drawRenderer.drawMesh(e,this)}drawColorTransparent(e){(this._drawRenderer||(this._drawRenderer=DrawRenderer.get(this)))&&this._drawRenderer.drawMesh(e,this)}drawSilhouetteXRayed(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=EmphasisFillRenderer.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,0)}drawSilhouetteHighlighted(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=EmphasisFillRenderer.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,1)}drawSilhouetteSelected(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=EmphasisFillRenderer.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,2)}drawEdgesColorOpaque(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=EmphasisEdgesRenderer.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,3)}drawEdgesColorTransparent(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=EmphasisEdgesRenderer.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,3)}drawEdgesXRayed(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=EmphasisEdgesRenderer.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,0)}drawEdgesHighlighted(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=EmphasisEdgesRenderer.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,1)}drawEdgesSelected(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=EmphasisEdgesRenderer.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,2)}drawOcclusion(e){(this._state.occluder&&this._occlusionRenderer||(this._occlusionRenderer=OcclusionRenderer.get(this)))&&this._occlusionRenderer.drawMesh(e,this)}drawShadow(e){(this._shadowRenderer||(this._shadowRenderer=ShadowRenderer.get(this)))&&this._shadowRenderer.drawMesh(e,this)}drawPickMesh(e){(this._pickMeshRenderer||(this._pickMeshRenderer=PickMeshRenderer.get(this)))&&this._pickMeshRenderer.drawMesh(e,this)}canPickTriangle(){return this._geometry.isReadableGeometry}drawPickTriangles(e){(this._pickTriangleRenderer||(this._pickTriangleRenderer=PickTriangleRenderer.get(this)))&&this._pickTriangleRenderer.drawMesh(e,this)}pickTriangleSurface(e,t,i){pickTriangleSurface(this,e,t,i)}drawPickVertices(e){}delegatePickedEntity(){return this}destroy(){super.destroy(),this._putDrawRenderers(),this._putPickRenderers(),this._putOcclusionRenderer(),this.scene._renderer.putPickID(this._state.pickID),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this.glRedraw()}}const pickTriangleSurface=function(){const e=math.vec3(),t=math.vec3(),i=math.vec3(),s=math.vec3(),r=math.vec3(),o=math.vec3(),a=math.vec4(),n=math.vec3(),h=math.vec3(),l=math.vec3(),c=math.vec3(),u=math.vec3(),p=math.vec3(),d=math.vec3(),m=math.vec3(),f=math.vec3(),g=math.vec4(),_=math.vec4(),y=math.vec4(),T=math.vec3(),v=math.vec3(),I=math.vec3(),E=math.vec3(),P=math.vec3(),b=math.vec3(),D=math.vec3(),w=math.vec3(),C=math.vec3(),R=math.vec3(),F=math.vec3();return function(S,x,M,A){var L=A.primIndex;if(null!=L&&L>-1){const k=S.geometry._state,G=S.scene,U=G.camera,V=G.canvas;if("triangles"===k.primitiveName){A.primitive="triangle";const G=L,H=k.indices,j=k.positions;let z,W,$,X;if(H){var O=H[G+0],N=H[G+1],B=H[G+2];o[0]=O,o[1]=N,o[2]=B,A.indices=o,z=3*O,W=3*N,$=3*B}else z=3*G,W=z+3,$=W+3;if(i[0]=j[z+0],i[1]=j[z+1],i[2]=j[z+2],s[0]=j[W+0],s[1]=j[W+1],s[2]=j[W+2],r[0]=j[$+0],r[1]=j[$+1],r[2]=j[$+2],k.compressGeometry){const e=k.positionsDecodeMatrix;e&&(geometryCompressionUtils.decompressPosition(i,e,i),geometryCompressionUtils.decompressPosition(s,e,s),geometryCompressionUtils.decompressPosition(r,e,r))}A.canvasPos?(X=A.canvasPos,math.canvasPosToLocalRay(V.canvas,x,M,S.worldMatrix,X,e,t)):A.origin&&A.direction&&math.worldRayToLocalRay(S.worldMatrix,A.origin,A.direction,e,t),math.normalizeVec3(t),math.rayPlaneIntersect(e,t,i,s,r,a),A.localPos=a,A.position=a,g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=1,math.transformVec4(S.worldMatrix,g,_),n[0]=_[0],n[1]=_[1],n[2]=_[2],A.worldPos=n,math.transformVec4(U.matrix,_,y),h[0]=y[0],h[1]=y[1],h[2]=y[2],A.viewPos=h,math.cartesianToBarycentric(a,i,s,r,l),A.bary=l;const Y=k.normals;if(Y){if(k.compressGeometry){const e=3*O,t=3*N,i=3*B;geometryCompressionUtils.decompressNormal(Y.subarray(e,e+2),c),geometryCompressionUtils.decompressNormal(Y.subarray(t,t+2),u),geometryCompressionUtils.decompressNormal(Y.subarray(i,i+2),p)}else c[0]=Y[z],c[1]=Y[z+1],c[2]=Y[z+2],u[0]=Y[W],u[1]=Y[W+1],u[2]=Y[W+2],p[0]=Y[$],p[1]=Y[$+1],p[2]=Y[$+2];const e=math.addVec3(math.addVec3(math.mulVec3Scalar(c,l[0],T),math.mulVec3Scalar(u,l[1],v),I),math.mulVec3Scalar(p,l[2],E),P);A.worldNormal=math.normalizeVec3(math.transformVec3(S.worldNormalMatrix,e,b))}const K=k.uv;if(K){if(d[0]=K[2*O],d[1]=K[2*O+1],m[0]=K[2*N],m[1]=K[2*N+1],f[0]=K[2*B],f[1]=K[2*B+1],k.compressGeometry){const e=k.uvDecodeMatrix;e&&(geometryCompressionUtils.decompressUV(d,e,d),geometryCompressionUtils.decompressUV(m,e,m),geometryCompressionUtils.decompressUV(f,e,f))}A.uv=math.addVec3(math.addVec3(math.mulVec2Scalar(d,l[0],D),math.mulVec2Scalar(m,l[1],w),C),math.mulVec2Scalar(f,l[2],R),F)}}}}}();function buildCylinderGeometry(e={}){let t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);let i=e.radiusBottom||1;i<0&&(console.error("negative radiusBottom not allowed - will invert"),i*=-1);let s=e.height||1;s<0&&(console.error("negative height not allowed - will invert"),s*=-1);let r=e.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<3&&(r=3);let o=e.heightSegments||1;o<0&&(console.error("negative heightSegments not allowed - will invert"),o*=-1),o<1&&(o=1);const a=!!e.openEnded;let n=e.center;const h=n?n[0]:0,l=n?n[1]:0,c=n?n[2]:0,u=s/2,p=s/o,d=2*Math.PI/r,m=1/r,f=(t-i)/o,g=[],_=[],y=[],T=[];let v,I,E,P,b,D,w,C,R,F,S;const x=(90-180*Math.atan(s/(i-t))/Math.PI)/90;for(v=0;v<=o;v++)for(b=t-v*f,D=u-v*p,I=0;I<=r;I++)E=Math.sin(I*d),P=Math.cos(I*d),_.push(b*E),_.push(x),_.push(b*P),y.push(I*m),y.push(1*v/o),g.push(b*E+h),g.push(D+l),g.push(b*P+c);for(v=0;v<o;v++)for(I=0;I<=r;I++)w=v*(r+1)+I,C=w+r,T.push(w),T.push(C),T.push(C+1),T.push(w),T.push(C+1),T.push(w+1);if(!a&&t>0){for(R=g.length/3,_.push(0),_.push(1),_.push(0),y.push(.5),y.push(.5),g.push(0+h),g.push(u+l),g.push(0+c),I=0;I<=r;I++)E=Math.sin(I*d),P=Math.cos(I*d),F=.5*Math.sin(I*d)+.5,S=.5*Math.cos(I*d)+.5,_.push(t*E),_.push(1),_.push(t*P),y.push(F),y.push(S),g.push(t*E+h),g.push(u+l),g.push(t*P+c);for(I=0;I<r;I++)n=R,w=R+1+I,T.push(w),T.push(w+1),T.push(n)}if(!a&&i>0){for(R=g.length/3,_.push(0),_.push(-1),_.push(0),y.push(.5),y.push(.5),g.push(0+h),g.push(0-u+l),g.push(0+c),I=0;I<=r;I++)E=Math.sin(I*d),P=Math.cos(I*d),F=.5*Math.sin(I*d)+.5,S=.5*Math.cos(I*d)+.5,_.push(i*E),_.push(-1),_.push(i*P),y.push(F),y.push(S),g.push(i*E+h),g.push(0-u+l),g.push(i*P+c);for(I=0;I<r;I++)n=R,w=R+1+I,T.push(n),T.push(w+1),T.push(w)}return utils.apply(e,{positions:g,normals:_,uv:y,indices:T})}function buildSphereGeometry(e={}){const t=e.lod||1,i=e.center?e.center[0]:0,s=e.center?e.center[1]:0,r=e.center?e.center[2]:0;let o=e.radius||1;o<0&&(console.error("negative radius not allowed - will invert"),o*=-1);let a=e.heightSegments||18;a<0&&(console.error("negative heightSegments not allowed - will invert"),a*=-1),a=Math.floor(t*a),a<18&&(a=18);let n=e.widthSegments||18;n<0&&(console.error("negative widthSegments not allowed - will invert"),n*=-1),n=Math.floor(t*n),n<18&&(n=18);const h=[],l=[],c=[],u=[];let p,d,m,f,g,_,y,T,v,I,E,P,b,D,w;for(p=0;p<=a;p++)for(m=p*Math.PI/a,f=Math.sin(m),g=Math.cos(m),d=0;d<=n;d++)_=2*d*Math.PI/n,y=Math.sin(_),T=Math.cos(_),v=T*f,I=g,E=y*f,P=1-d/n,b=p/a,l.push(v),l.push(I),l.push(E),c.push(P),c.push(b),h.push(i+o*v),h.push(s+o*I),h.push(r+o*E);for(p=0;p<a;p++)for(d=0;d<n;d++)D=p*(n+1)+d,w=D+n+1,u.push(D+1),u.push(w+1),u.push(w),u.push(D+1),u.push(w),u.push(D);return utils.apply(e,{positions:h,normals:l,uv:c,indices:u})}const letters={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function buildVectorTextGeometry(e={}){var t=e.origin||[0,0,0],i=t[0],s=t[1],r=t[2],o=e.size||1,a=[],n=[],h=e.text;utils.isNumeric(h)&&(h=""+h);for(var l,c,u,p,d,m,f,g,_,y=(h||"").split("\n"),T=0,v=0,I=.04,E=0;E<y.length;E++){l=0,u=(c=y[E]).length;for(var P=0;P<u;P++)if(p=letters[c.charAt(P)]){d=1,m=-1,f=-1,g=p.points.length;for(var b=0;b<g;b++)-1!==(_=p.points[b])[0]||-1!==_[1]?(a.push(l+_[0]*o*I+i),a.push(v+_[1]*o*I+s),a.push(0+r),-1===m?m=T:(-1===f||(m=f),f=T),T++,d?d=!1:(n.push(m),n.push(f))):d=1;l+=p.width*I*o}v-=35*I*o}return utils.apply(e,{primitive:"lines",positions:a,indices:n})}class AxisGizmoPlugin extends Plugin{constructor(e,t){super("AxisGizmo",e,t=t||{});const i=e.scene.camera;t.canvasId||t.canvasElement||this.error("Config expected: either 'canvasId' or 'canvasElement'");try{this._axisGizmoScene=new Scene(e,{canvasId:t.canvasId,canvasElement:t.canvasElement,transparent:!0})}catch(e){return void this.error(e)}const s=this._axisGizmoScene;s.clearLights(),new AmbientLight(s,{color:[.45,.45,.5],intensity:.9}),new DirLight(s,{dir:[-.5,.5,-.6],color:[.8,.8,.7],intensity:1,space:"view"}),new DirLight(s,{dir:[.5,-.5,-.6],color:[.8,.8,.8],intensity:1,space:"view"});const r=s.camera;i.on("matrix",(function(){const e=i.eye,t=i.look,s=i.up,o=math.mulVec3Scalar(math.normalizeVec3(math.subVec3(e,t,[])),22);r.look=[0,0,0],r.eye=o,r.up=s}));const o=new ReadableGeometry(s,buildCylinderGeometry({radiusTop:.01,radiusBottom:.6,height:1.7,radialSegments:20,heightSegments:1,openEnded:!1})),a=new ReadableGeometry(s,buildCylinderGeometry({radiusTop:.2,radiusBottom:.2,height:4.5,radialSegments:20,heightSegments:1,openEnded:!1})),n=new PhongMaterial(s,{diffuse:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),h=new PhongMaterial(s,{emissive:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),l=new PhongMaterial(s,{diffuse:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),c=new PhongMaterial(s,{emissive:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),u=new PhongMaterial(s,{diffuse:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),p=new PhongMaterial(s,{emissive:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),d=new PhongMaterial(s,{diffuse:[.5,.5,.5],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2});this._meshes=[new Mesh(s,{geometry:new ReadableGeometry(s,buildSphereGeometry({radius:9,heightSegments:60,widthSegments:60})),material:new PhongMaterial(s,{diffuse:[0,0,0],emissive:[.1,.1,.1],ambient:[.1,.1,.2],specular:[0,0,0],alpha:.4,alphaMode:"blend",frontface:"cw"}),pickable:!1,collidable:!1,visible:!1!==t.visible}),new Mesh(s,{geometry:new ReadableGeometry(s,buildSphereGeometry({radius:1})),material:d,pickable:!1,collidable:!1,visible:!1!==t.visible}),new Mesh(s,{geometry:o,material:n,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[5,0,0],rotation:[0,0,-90]}),new Mesh(s,{geometry:a,material:n,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[2,0,0],rotation:[0,0,90]}),new Mesh(s,{geometry:new ReadableGeometry(s,buildVectorTextGeometry({text:"X",size:1.5})),material:h,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[7,0,0],billboard:"spherical"}),new Mesh(s,{geometry:o,material:l,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,5,0]}),new Mesh(s,{geometry:a,material:l,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,2,0]}),new Mesh(s,{geometry:new ReadableGeometry(s,buildVectorTextGeometry({text:"Y",size:1.5})),material:c,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,7,0],billboard:"spherical"}),new Mesh(s,{geometry:o,material:u,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,5],rotation:[90,0,0]}),new Mesh(s,{geometry:a,material:u,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,2],rotation:[90,0,0]}),new Mesh(s,{geometry:new ReadableGeometry(s,buildVectorTextGeometry({text:"Z",size:1.5})),material:p,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,7],billboard:"spherical"})]}setVisible(e){for(let t=0;t<this._meshes.length;t++)this._meshes[t].visible=e}destroy(){this._axisGizmoCanvas=null,this._axisGizmoScene.destroy(),this._axisGizmoScene=null,super.destroy()}}class SectionPlane extends Component{get type(){return"SectionPlane"}constructor(e,t={}){super(e,t),this._state=new RenderState({active:!0,pos:math.vec3(),dir:math.vec3(),dist:0}),this.active=t.active,this.pos=t.pos,this.dir=t.dir,this.scene._sectionPlaneCreated(this)}set active(e){this._state.active=!1!==e,this.glRedraw(),this.fire("active",this._state.active)}get active(){return this._state.active}set pos(e){this._state.pos.set(e||[0,0,0]),this._state.dist=-math.dotVec3(this._state.pos,this._state.dir),this.fire("pos",this._state.pos)}get pos(){return this._state.pos}set dir(e){this._state.dir.set(e||[0,0,-1]),this._state.dist=-math.dotVec3(this._state.pos,this._state.dir),this.glRedraw(),this.fire("dir",this._state.dir)}get dir(){return this._state.dir}get dist(){return this._state.dist}flipDir(){const e=this._state.dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,this._state.dist=-math.dotVec3(this._state.pos,this._state.dir),this.fire("dir",this._state.dir),this.glRedraw()}destroy(){this._state.destroy(),this.scene._sectionPlaneDestroyed(this),super.destroy()}}const tempVec3$4=math.vec3();class BCFViewpointsPlugin extends Plugin{constructor(e,t={}){super("BCFViewpoints",e,t),this.originatingSystem=t.originatingSystem||"xeokit.io",this.authoringTool=t.authoringTool||"xeokit.io"}getViewpoint(e={}){const t=this.viewer.scene,i=t.camera,s=t.realWorldOffset,r=!0===e.reverseClippingPlanes;let o={},a=math.normalizeVec3(math.subVec3(i.look,i.eye,math.vec3())),n=i.eye,h=i.up;i.yUp&&(a=YToZ(a),n=YToZ(n),h=YToZ(h));const l=xyzArrayToObject(math.addVec3(n,s));"ortho"===i.projection?o.orthogonal_camera={camera_view_point:l,camera_direction:xyzArrayToObject(a),camera_up_vector:xyzArrayToObject(h),view_to_world_scale:i.ortho.scale}:o.perspective_camera={camera_view_point:l,camera_direction:xyzArrayToObject(a),camera_up_vector:xyzArrayToObject(h),field_of_view:i.perspective.fov};const c=t.sectionPlanes;for(let e in c)if(c.hasOwnProperty(e)){let t,a=c[e],n=a.pos;t=r?math.negateVec3(a.dir,math.vec3()):a.dir,i.yUp&&(n=YToZ(n),t=YToZ(t)),math.addVec3(n,s),n=xyzArrayToObject(n),t=xyzArrayToObject(t),o.clipping_planes||(o.clipping_planes=[]),o.clipping_planes.push({location:n,direction:t})}o.components={visibility:{view_setup_hints:{spaces_visible:!!e.spacesVisible,space_boundaries_visible:!!e.spaceBoundariesVisible,openings_visible:!!e.openingsVisible}}};const u=new Set(t.opacityObjectIds),p=new Set(t.xrayedObjectIds),d=new Set(t.colorizedObjectIds),m=Object.values(t.objects).filter((e=>u.has(e.id)||d.has(e.id)||p.has(e.id))).reduce(((e,i)=>{let s,r=colorizeToRGB(i.colorize);i.xrayed?(s=0===t.xrayMaterial.fillAlpha&&0!==t.xrayMaterial.edgeAlpha?.1:t.xrayMaterial.fillAlpha,s=Math.round(255*s).toString(16).padStart(2,"0"),r=s+r):u.has(i.id)&&(s=Math.round(255*i.opacity).toString(16).padStart(2,"0"),r=s+r),e[r]||(e[r]=[]);const o=i.id,a=i.originalSystemId,n={ifc_guid:a,originating_system:this.originatingSystem};return a!==o&&(n.authoring_tool_id=o),e[r].push(n),e}),{}),f=Object.entries(m).map((([e,t])=>({color:e,components:t})));o.components.coloring=f;const g=t.objectIds,_=t.visibleObjects,y=t.visibleObjectIds,T=g.filter((e=>!_[e])),v=t.selectedObjectIds;return e.defaultInvisible||y.length<T.length?(o.components.visibility.exceptions=this._createBCFComponents(y),o.components.visibility.default_visibility=!1):(o.components.visibility.exceptions=this._createBCFComponents(T),o.components.visibility.default_visibility=!0),o.components.selection=this._createBCFComponents(v),!1!==e.snapshot&&(o.snapshot={snapshot_type:"png",snapshot_data:this.viewer.getSnapshot({format:"png"})}),o}_createBCFComponents(e){const t=this.viewer.scene,i=[];for(let s=0,r=e.length;s<r;s++){const r=e[s],o=t.objects[r];if(o){const e={ifc_guid:o.originalSystemId,originating_system:this.originatingSystem};o.originalSystemId!==r&&(e.authoring_tool_id=r),i.push(e)}}return i}setViewpoint(e,t={}){if(!e)return;const i=this.viewer,s=i.scene,r=s.camera,o=!1!==t.rayCast,a=!1!==t.immediate,n=!1!==t.reset,h=s.realWorldOffset,l=!0===t.reverseClippingPlanes;if(s.clearSectionPlanes(),e.clipping_planes&&e.clipping_planes.forEach((function(e){let t=xyzObjectToArray(e.location,tempVec3$4),i=xyzObjectToArray(e.direction,tempVec3$4);l&&math.negateVec3(i),math.subVec3(t,h),r.yUp&&(t=ZToY(t),i=ZToY(i)),new SectionPlane(s,{pos:t,dir:i})})),n&&(s.setObjectsXRayed(s.xrayedObjectIds,!1),s.setObjectsHighlighted(s.highlightedObjectIds,!1),s.setObjectsSelected(s.selectedObjectIds,!1)),e.components){if(e.components.visibility){e.components.visibility.default_visibility?(s.setObjectsVisible(s.objectIds,!0),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((e=>this._withBCFComponent(t,e,(e=>e.visible=!1))))):(s.setObjectsVisible(s.objectIds,!1),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((e=>this._withBCFComponent(t,e,(e=>e.visible=!0)))));const r=e.components.visibility.view_setup_hints;r&&(!1===r.spaces_visible&&s.setObjectsVisible(i.metaScene.getObjectIDsByType("IfcSpace"),!1),!1===r.openings_visible&&s.setObjectsVisible(i.metaScene.getObjectIDsByType("IfcOpening"),!1),r.space_boundaries_visible)}e.components.selection&&(s.setObjectsSelected(s.selectedObjectIds,!1),e.components.selection.forEach((e=>this._withBCFComponent(t,e,(e=>e.selected=!0))))),e.components.coloring&&e.components.coloring.forEach((e=>{let i=e.color,s=0,r=!1;8===i.length&&(s=parseInt(i.substring(0,2),16)/256,s<=1&&s>=.95&&(s=1),i=i.substring(2),r=!0);const o=[parseInt(i.substring(0,2),16)/256,parseInt(i.substring(2,4),16)/256,parseInt(i.substring(4,6),16)/256];e.components.map((e=>this._withBCFComponent(t,e,(e=>{e.colorize=o,r&&(e.opacity=s)}))))}))}if(e.perspective_camera||e.orthogonal_camera){let n,l,c,u;if(e.perspective_camera?(n=xyzObjectToArray(e.perspective_camera.camera_view_point,tempVec3$4),l=xyzObjectToArray(e.perspective_camera.camera_direction,tempVec3$4),c=xyzObjectToArray(e.perspective_camera.camera_up_vector,tempVec3$4),r.perspective.fov=e.perspective_camera.field_of_view,u="perspective"):(n=xyzObjectToArray(e.orthogonal_camera.camera_view_point,tempVec3$4),l=xyzObjectToArray(e.orthogonal_camera.camera_direction,tempVec3$4),c=xyzObjectToArray(e.orthogonal_camera.camera_up_vector,tempVec3$4),r.ortho.scale=e.orthogonal_camera.view_to_world_scale,u="ortho"),math.subVec3(n,h),r.yUp&&(n=ZToY(n),l=ZToY(l),c=ZToY(c)),o){const e=s.pick({pickSurface:!0,origin:n,direction:l});l=e?e.worldPos:math.addVec3(n,l,tempVec3$4)}else l=math.addVec3(n,l,tempVec3$4);a?(r.eye=n,r.look=l,r.up=c,r.projection=u):i.cameraFlight.flyTo({eye:n,look:l,up:c,duration:t.duration,projection:u})}}_withBCFComponent(e,t,i){const s=this.viewer,r=s.scene;if(t.authoring_tool_id&&t.originating_system===this.originatingSystem){const o=t.authoring_tool_id,a=r.objects[o];if(a)return void i(a);if(e.updateCompositeObjects){if(s.metaScene.metaObjects[o])return void r.withObjects(s.metaScene.getObjectIDsInSubtree(o),i)}}if(t.ifc_guid){const o=t.ifc_guid,a=r.objects[o];if(a)return void i(a);if(e.updateCompositeObjects){if(s.metaScene.metaObjects[o])return void r.withObjects(s.metaScene.getObjectIDsInSubtree(o),i)}Object.keys(r.models).forEach((t=>{const a=math.globalizeObjectId(t,o),n=r.objects[a];if(n)i(n);else if(e.updateCompositeObjects){if(s.metaScene.metaObjects[a])return void r.withObjects(s.metaScene.getObjectIDsInSubtree(a),i)}}))}}destroy(){super.destroy()}}function xyzArrayToObject(e){return{x:e[0],y:e[1],z:e[2]}}function xyzObjectToArray(e,t){return(t=new Float64Array(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t}function YToZ(e){return new Float64Array([e[0],-e[2],e[1]])}function ZToY(e){return new Float64Array([e[0],e[2],-e[1]])}function colorizeToRGB(e){let t="";return t+=Math.round(255*e[0]).toString(16).padStart(2,"0"),t+=Math.round(255*e[1]).toString(16).padStart(2,"0"),t+=Math.round(255*e[2]).toString(16).padStart(2,"0"),t}var distVec3=math.vec3();const lengthWire=(e,t,i,s)=>{var r=e-i,o=t-s;return Math.sqrt(r*r+o*o)};class DistanceMeasurement extends Component{constructor(e,t={}){if(super(e.viewer.scene,t),this.plugin=e,this._container=t.container,!this._container)throw"config missing: container";this._eventSubs={};var i=this.plugin.viewer.scene;this._originMarker=new Marker(i,t.origin),this._targetMarker=new Marker(i,t.target),this._originWorld=math.vec3(),this._targetWorld=math.vec3(),this._wp=new Float64Array(24),this._vp=new Float64Array(24),this._pp=new Float64Array(24),this._cp=new Int16Array(8),this._xAxisLabelCulled=!1,this._yAxisLabelCulled=!1,this._zAxisLabelCulled=!1,this._color=t.color||this.plugin.defaultColor,this._originDot=new Dot(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0}),this._targetDot=new Dot(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0}),this._lengthWire=new Wire(this._container,{color:this._color,thickness:2,zIndex:e.zIndex}),this._xAxisWire=new Wire(this._container,{color:"red",thickness:1,zIndex:e.zIndex}),this._yAxisWire=new Wire(this._container,{color:"green",thickness:1,zIndex:e.zIndex}),this._zAxisWire=new Wire(this._container,{color:"blue",thickness:1,zIndex:e.zIndex}),this._lengthLabel=new Label(this._container,{fillColor:this._color,prefix:"",text:"",zIndex:void 0!==e.zIndex?e.zIndex+2:void 0}),this._xAxisLabel=new Label(this._container,{fillColor:"red",prefix:"X",text:"",zIndex:void 0!==e.zIndex?e.zIndex+2:void 0}),this._yAxisLabel=new Label(this._container,{fillColor:"green",prefix:"Y",text:"",zIndex:void 0!==e.zIndex?e.zIndex+2:void 0}),this._zAxisLabel=new Label(this._container,{fillColor:"blue",prefix:"Z",text:"",zIndex:void 0!==e.zIndex?e.zIndex+2:void 0}),this._wpDirty=!1,this._vpDirty=!1,this._cpDirty=!1,this._visible=!1,this._originVisible=!1,this._targetVisible=!1,this._wireVisible=!1,this._axisVisible=!1,this._originMarker.on("worldPos",(e=>{this._originWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._targetMarker.on("worldPos",(e=>{this._targetWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._onViewMatrix=i.camera.on("viewMatrix",(()=>{this._vpDirty=!0,this._needUpdate(0)})),this._onProjMatrix=i.camera.on("projMatrix",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onCanvasBoundary=i.canvas.on("boundary",(()=>{this._cpDirty=!0,this._needUpdate(0)})),this._onMetricsUnits=i.metrics.on("units",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onMetricsScale=i.metrics.on("scale",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onMetricsOrigin=i.metrics.on("origin",(()=>{this._cpDirty=!0,this._needUpdate()})),this.approximate=t.approximate,this.visible=t.visible,this.originVisible=t.originVisible,this.targetVisible=t.targetVisible,this.wireVisible=t.wireVisible,this.axisVisible=t.axisVisible}_update(){if(!this._visible)return;const e=this.plugin.viewer.scene;this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._targetWorld[0],this._wp[5]=this._originWorld[1],this._wp[6]=this._originWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._originWorld[2],this._wp[11]=1,this._wp[12]=this._targetWorld[0],this._wp[13]=this._targetWorld[1],this._wp[14]=this._targetWorld[2],this._wp[15]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(math.transformPositions4(e.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vp[15]=1,this._vpDirty=!1,this._cpDirty=!0);const t=this._originMarker.viewPos[2],i=this._targetMarker.viewPos[2];if(t>-.3||i>-.3)return this._xAxisLabel.setVisible(!1),this._yAxisLabel.setVisible(!1),this._zAxisLabel.setVisible(!1),this._lengthLabel.setVisible(!1),this._xAxisWire.setVisible(!1),this._yAxisWire.setVisible(!1),this._zAxisWire.setVisible(!1),this._lengthWire.setVisible(!1),this._originDot.setVisible(!1),void this._targetDot.setVisible(!1);if(this._cpDirty){math.transformPositions4(e.camera.project.matrix,this._vp,this._pp);var s=this._pp,r=this._cp,o=e.canvas.canvas.getBoundingClientRect(),a=o.top,n=o.left,h=e.canvas.boundary,l=h[2],c=h[3],u=0;const t=this.plugin.viewer.scene.metrics,i=t.scale,m=t.units,f=t.unitsInfo[m].abbrev;for(var p=0,d=s.length;p<d;p+=4)r[u]=n+Math.floor((1+s[p+0]/s[p+3])*l/2),r[u+1]=a+Math.floor((1-s[p+1]/s[p+3])*c/2),u+=2;this._originDot.setPos(r[0],r[1]),this._targetDot.setPos(r[6],r[7]),this._lengthWire.setStartAndEnd(r[0],r[1],r[6],r[7]),this._xAxisWire.setStartAndEnd(r[0],r[1],r[2],r[3]),this._yAxisWire.setStartAndEnd(r[2],r[3],r[4],r[5]),this._zAxisWire.setStartAndEnd(r[4],r[5],r[6],r[7]),this._lengthLabel.setPosOnWire(r[0],r[1],r[6],r[7]),this._xAxisLabel.setPosOnWire(r[0],r[1],r[2],r[3]),this._yAxisLabel.setPosOnWire(r[2],r[3],r[4],r[5]),this._zAxisLabel.setPosOnWire(r[4],r[5],r[6],r[7]);const g=this._approximate?" ~ ":" = ";this._length=Math.abs(math.lenVec3(math.subVec3(this._targetWorld,this._originWorld,distVec3))),this._lengthLabel.setText(g+(this._length*i).toFixed(2)+f);const _=Math.abs(lengthWire(r[0],r[1],r[2],r[3])),y=Math.abs(lengthWire(r[2],r[3],r[4],r[5])),T=Math.abs(lengthWire(r[4],r[5],r[6],r[7])),v=this.plugin.labelMinAxisLength;this._xAxisLabelCulled=_<v,this._yAxisLabelCulled=y<v,this._zAxisLabelCulled=T<v,this._xAxisLabelCulled?this._xAxisLabel.setVisible(!1):(this._xAxisLabel.setText(g+Math.abs((this._targetWorld[0]-this._originWorld[0])*i).toFixed(2)+f),this._xAxisLabel.setVisible(this.axisVisible)),this._yAxisLabelCulled?this._yAxisLabel.setVisible(!1):(this._yAxisLabel.setText(g+Math.abs((this._targetWorld[1]-this._originWorld[1])*i).toFixed(2)+f),this._yAxisLabel.setVisible(this.axisVisible)),this._zAxisLabelCulled?this._zAxisLabel.setVisible(!1):(this._zAxisLabel.setText(g+Math.abs((this._targetWorld[2]-this._originWorld[2])*i).toFixed(2)+f),this._zAxisLabel.setVisible(this.axisVisible)),this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._xAxisWire.setVisible(this.axisVisible),this._yAxisWire.setVisible(this.axisVisible),this._zAxisWire.setVisible(this.axisVisible),this._lengthWire.setVisible(this.wireVisible),this._lengthLabel.setVisible(this.wireVisible),this._cpDirty=!1}}set approximate(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._cpDirty=!0,this._needUpdate(0))}get approximate(){return this._approximate}get origin(){return this._originMarker}get target(){return this._targetMarker}get length(){this._update();const e=this.plugin.viewer.scene.metrics.scale;return this._length*e}get color(){return this._color}set color(e){this._color=e,this._originDot.setFillColor(e),this._targetDot.setFillColor(e),this._lengthWire.setColor(e),this._lengthLabel.setFillColor(e)}set visible(e){e=void 0!==e?Boolean(e):this.plugin.defaultVisible,this._visible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._lengthWire.setVisible(this._visible&&this._wireVisible),this._lengthLabel.setVisible(this._visible&&this._wireVisible);var t=this._visible&&this._axisVisible;this._xAxisWire.setVisible(t),this._yAxisWire.setVisible(t),this._zAxisWire.setVisible(t),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled)}get visible(){return this._visible}set originVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultOriginVisible,this._originVisible=e,this._originDot.setVisible(this._visible&&this._originVisible)}get originVisible(){return this._originVisible}set targetVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultTargetVisible,this._targetVisible=e,this._targetDot.setVisible(this._visible&&this._targetVisible)}get targetVisible(){return this._targetVisible}set axisVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._axisVisible=e;var t=this._visible&&this._axisVisible;this._xAxisWire.setVisible(t),this._yAxisWire.setVisible(t),this._zAxisWire.setVisible(t),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled)}get axisVisible(){return this._axisVisible}set wireVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultWireVisible,this._wireVisible=e;var t=this._visible&&this._wireVisible;this._lengthLabel.setVisible(t),this._lengthWire.setVisible(t)}get wireVisible(){return this._wireVisible}destroy(){const e=this.plugin.viewer.scene,t=e.metrics;this._onViewMatrix&&e.camera.off(this._onViewMatrix),this._onProjMatrix&&e.camera.off(this._onProjMatrix),this._onCanvasBoundary&&e.canvas.off(this._onCanvasBoundary),this._onMetricsUnits&&t.off(this._onMetricsUnits),this._onMetricsScale&&t.off(this._onMetricsScale),this._onMetricsOrigin&&t.off(this._onMetricsOrigin),this._originDot.destroy(),this._targetDot.destroy(),this._xAxisWire.destroy(),this._yAxisWire.destroy(),this._zAxisWire.destroy(),this._lengthLabel.destroy(),this._xAxisLabel.destroy(),this._yAxisLabel.destroy(),this._zAxisLabel.destroy(),this._lengthWire.destroy(),super.destroy()}}class DistanceMeasurementsControl extends Component{constructor(e){super(e.viewer.scene),this.plugin=e,this._active=!1,this._currentDistMeasurement=null,this._currentDistMeasurementInitState={wireVisible:null,axisVisible:null,targetVisible:null},this._onHoverSurface=null,this._onHoverOff=null,this._onPickedNothing=null,this._onInputMouseDown=null,this._onInputMouseUp=null}get active(){return this._active}activate(){if(this._active)return;const e=this.plugin.viewer.cameraControl;let t=null;const i=math.vec3(),s=math.vec2(),r=this.plugin.viewer.scene.pickSurfacePrecisionEnabled;let o,a;this.startDot=new Dot(this.plugin._container,{fillColor:this.plugin.defaultColor,zIndex:this.plugin.zIndex+1}),this._onHoverSurface=e.on("hoverSurface",(e=>{t=e.entity,i.set(e.worldPos),s.set(e.canvasPos),this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer",this._currentDistMeasurement?(this._currentDistMeasurement.wireVisible=this._currentDistMeasurementInitState.wireVisible,this._currentDistMeasurement.axisVisible=this._currentDistMeasurementInitState.axisVisible,this._currentDistMeasurement.targetVisible=this._currentDistMeasurementInitState.targetVisible,this._currentDistMeasurement.target.entity=t,this._currentDistMeasurement.target.worldPos=i):this.startDot&&(this.startDot.setVisible(!0),this.startDot.setPos(e.canvasPos[0],e.canvasPos[1]))}));this._onInputMouseDown=this.plugin.viewer.scene.input.on("mousedown",(e=>{o=e[0],a=e[1]})),this._onInputMouseUp=this.plugin.viewer.scene.input.on("mouseup",(e=>{if(!(e[0]>o+5||e[0]<o-5||e[1]>a+5||e[1]<a-5))if(this.startDot&&(this.startDot.destroy(),this.startDot=null),this._currentDistMeasurement)if(t){if(r){const e=this.plugin.viewer.scene.pick({canvasPos:s,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&(this._currentDistMeasurement.target.worldPos=e.worldPos),this._currentDistMeasurement.approximate=!1}this.fire("measurementEnd",this._currentDistMeasurement),this._currentDistMeasurement=null}else this._currentDistMeasurement.destroy(),this.fire("measurementCancel",this._currentDistMeasurement),this._currentDistMeasurement=null;else if(t){if(r){const e=this.plugin.viewer.scene.pick({canvasPos:s,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&i.set(e.worldPos)}this._currentDistMeasurement=this.plugin.createMeasurement({id:math.createUUID(),origin:{entity:t,worldPos:i},target:{entity:t,worldPos:i},approximate:!0}),this._currentDistMeasurementInitState.axisVisible=this._currentDistMeasurement.axisVisible,this._currentDistMeasurementInitState.wireVisible=this._currentDistMeasurement.wireVisible,this._currentDistMeasurementInitState.targetVisible=this._currentDistMeasurement.targetVisible,this.fire("measurementStart",this._currentDistMeasurement)}})),this._onHoverOff=e.on("hoverOff",(e=>{this.startDot&&this.startDot.setVisible(!1),t=null,this._currentDistMeasurement&&(this._currentDistMeasurement.wireVisible=!1,this._currentDistMeasurement.targetVisible=!1,this._currentDistMeasurement.axisVisible=!1),this.plugin.viewer.scene.canvas.canvas.style.cursor="default"})),this._onPickedNothing=e.on("pickedNothing",(e=>{this._currentDistMeasurement&&(this._currentDistMeasurement.destroy(),this._currentDistMeasurement=null)})),this._active=!0}deactivate(){if(!this._active)return;this.startDot&&(this.startDot.destroy(),this.startDot=null),this.reset();const e=this.plugin.viewer.scene.input;e.off(this._onInputMouseDown),e.off(this._onInputMouseUp);const t=this.plugin.viewer.cameraControl;t.off(this._onHoverSurface),t.off(this._onHoverOff),t.off(this._onPickedNothing),this._currentDistMeasurement=null,this._active=!1}reset(){this._active&&this._currentDistMeasurement&&(this._currentDistMeasurement.destroy(),this._currentDistMeasurement=null)}destroy(){this.deactivate(),super.destroy()}}class DistanceMeasurementsPlugin extends Plugin{constructor(e,t={}){super("DistanceMeasurements",e),this._container=t.container||document.body,this._control=new DistanceMeasurementsControl(this),this._measurements={},this.labelMinAxisLength=t.labelMinAxisLength,this.defaultVisible=!1!==t.defaultVisible,this.defaultOriginVisible=!1!==t.defaultOriginVisible,this.defaultTargetVisible=!1!==t.defaultTargetVisible,this.defaultWireVisible=!1!==t.defaultWireVisible,this.defaultAxisVisible=!1!==t.defaultAxisVisible,this.defaultColor=void 0!==t.defaultColor?t.defaultColor:"#00BBFF",this.zIndex=t.zIndex}send(e,t){}get control(){return this._control}get measurements(){return this._measurements}set labelMinAxisLength(e){e<1&&(this.error("labelMinAxisLength must be >= 1; defaulting to 25"),e=25),this._labelMinAxisLength=e||25}get labelMinAxisLength(){return this._labelMinAxisLength}createMeasurement(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=e.origin,i=e.target,s=new DistanceMeasurement(this,{id:e.id,plugin:this,container:this._container,origin:{entity:t.entity,worldPos:t.worldPos},target:{entity:i.entity,worldPos:i.worldPos},visible:e.visible,wireVisible:e.wireVisible,originVisible:e.originVisible,targetVisible:e.targetVisible,color:e.color});return this._measurements[s.id]=s,s.on("destroyed",(()=>{delete this._measurements[s.id]})),this.fire("measurementCreated",s),s}destroyMeasurement(e){const t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("DistanceMeasurement not found: "+e)}clear(){const e=Object.keys(this._measurements);for(var t=0,i=e.length;t<i;t++)this.destroyMeasurement(e[t])}destroy(){this.clear(),super.destroy()}}class FastNavPlugin extends Plugin{constructor(e,t={}){super("FastNav",e),this._hideColorTexture=!1!==t.hideColorTexture,this._hidePBR=!1!==t.hidePBR,this._hideSAO=!1!==t.hideSAO,this._hideEdges=!1!==t.hideEdges,this._hideTransparentObjects=!!t.hideTransparentObjects,this._scaleCanvasResolution=!!t.scaleCanvasResolution,this._scaleCanvasResolutionFactor=t.scaleCanvasResolutionFactor||.6,this._delayBeforeRestore=!1!==t.delayBeforeRestore,this._delayBeforeRestoreSeconds=t.delayBeforeRestoreSeconds||.5;let i=1e3*this._delayBeforeRestoreSeconds,s=!1;const r=()=>{i=1e3*this._delayBeforeRestoreSeconds,s||(e.scene._renderer.setColorTextureEnabled(!this._hideColorTexture),e.scene._renderer.setPBREnabled(!this._hidePBR),e.scene._renderer.setSAOEnabled(!this._hideSAO),e.scene._renderer.setTransparentEnabled(!this._hideTransparentObjects),e.scene._renderer.setEdgesEnabled(!this._hideEdges),this._scaleCanvasResolution?e.scene.canvas.resolutionScale=this._scaleCanvasResolutionFactor:e.scene.canvas.resolutionScale=1,s=!0)};this._onCanvasBoundary=e.scene.canvas.on("boundary",r),this._onCameraMatrix=e.scene.camera.on("matrix",r),this._onSceneTick=e.scene.on("tick",(t=>{s&&(i-=t.deltaTime,(!this._delayBeforeRestore||i<=0)&&(e.scene.canvas.resolutionScale=1,e.scene._renderer.setEdgesEnabled(!0),e.scene._renderer.setColorTextureEnabled(!0),e.scene._renderer.setPBREnabled(!0),e.scene._renderer.setSAOEnabled(!0),e.scene._renderer.setTransparentEnabled(!0),s=!1))}));let o=!1;this._onSceneMouseDown=e.scene.input.on("mousedown",(()=>{o=!0})),this._onSceneMouseUp=e.scene.input.on("mouseup",(()=>{o=!1})),this._onSceneMouseMove=e.scene.input.on("mousemove",(()=>{o&&r()}))}get hideColorTexture(){return this._hideColorTexture}set hideColorTexture(e){this._hideColorTexture=e}get hidePBR(){return this._hidePBR}set hidePBR(e){this._hidePBR=e}get hideSAO(){return this._hideSAO}set hideSAO(e){this._hideSAO=e}get hideEdges(){return this._hideEdges}set hideEdges(e){this._hideEdges=e}get hideTransparentObjects(){return this._hideTransparentObjects}set hideTransparentObjects(e){this._hideTransparentObjects=!1!==e}get scaleCanvasResolution(){return this._scaleCanvasResolution}set scaleCanvasResolution(e){this._scaleCanvasResolution=e}get scaleCanvasResolutionFactor(){return this._scaleCanvasResolutionFactor}set scaleCanvasResolutionFactor(e){this._scaleCanvasResolutionFactor=e||.6}get delayBeforeRestore(){return this._delayBeforeRestore}set delayBeforeRestore(e){this._delayBeforeRestore=e}get delayBeforeRestoreSeconds(){return this._delayBeforeRestoreSeconds}set delayBeforeRestoreSeconds(e){this._delayBeforeRestoreSeconds=null!=e?e:.5}send(e,t){}destroy(){this.viewer.scene.camera.off(this._onCameraMatrix),this.viewer.scene.canvas.off(this._onCanvasBoundary),this.viewer.scene.input.off(this._onSceneMouseDown),this.viewer.scene.input.off(this._onSceneMouseUp),this.viewer.scene.input.off(this._onSceneMouseMove),this.viewer.scene.off(this._onSceneTick),super.destroy()}}class GLTFDefaultDataSource{constructor(){}getMetaModel(e,t,i){utils.loadJSON(e,(e=>{t(e)}),(function(e){i(e)}))}getGLTF(e,t,i){utils.loadJSON(e,(e=>{t(e)}),(function(e){i(e)}))}getArrayBuffer(e,t,i,s){loadArraybuffer(e,t,(e=>{i(e)}),(function(e){s(e)}))}}function loadArraybuffer(e,t,i,s){var r=()=>{};i=i||r,s=s||r;const o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){const e=!!o[2];var a=o[3];a=window.decodeURIComponent(a),e&&(a=window.atob(a));try{const e=new ArrayBuffer(a.length),t=new Uint8Array(e);for(var n=0;n<a.length;n++)t[n]=a.charCodeAt(n);window.setTimeout((function(){i(e)}),0)}catch(e){window.setTimeout((function(){s(e)}),0)}}else{const r=getBasePath(e)+t,o=new XMLHttpRequest;o.open("GET",r,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){4===o.readyState&&(200===o.status?i(o.response):s("loadArrayBuffer error : "+o.response))},o.send(null)}}function getBasePath(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}class PerformanceMesh{constructor(e,t,i,s,r=null,o=0){this.model=e,this.object=null,this.parent=null,this.id=t,this.pickId=this.model.scene._renderer.getPickID(this),this.aabb=math.AABB3(),this._layer=r,this._portionId=o,this._color=[i[0],i[1],i[2],s],this._colorize=[i[0],i[1],i[2],s],this._colorizing=!1,this._transparent=s<255,this.numTriangles=0,this.origin=null}_finalize(e){this._layer.initFlags(this._portionId,e,this._transparent)}_finalize2(){this._layer.flushInitFlags&&this._layer.flushInitFlags()}_setVisible(e){this._layer.setVisible(this._portionId,e,this._transparent)}_setColor(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this._layer.setColor(this._portionId,this._color,!1)}_setColorize(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this._layer.setColor(this._portionId,this._colorize,false),this._colorizing=!0):(this._layer.setColor(this._portionId,this._color,false),this._colorizing=!1)}_setOpacity(e,t){const i=e<255,s=this._transparent!==i;this._color[3]=e,this._colorize[3]=e,this._transparent=i,this._colorizing?this._layer.setColor(this._portionId,this._colorize):this._layer.setColor(this._portionId,this._color),s&&this._layer.setTransparent(this._portionId,t,i)}_setOffset(e){this._layer.setOffset(this._portionId,e)}_setHighlighted(e){this._layer.setHighlighted(this._portionId,e,this._transparent)}_setXRayed(e){this._layer.setXRayed(this._portionId,e,this._transparent)}_setSelected(e){this._layer.setSelected(this._portionId,e,this._transparent)}_setEdges(e){this._layer.setEdges(this._portionId,e,this._transparent)}_setClippable(e){this._layer.setClippable(this._portionId,e,this._transparent)}_setCollidable(e){this._layer.setCollidable(this._portionId,e)}_setPickable(e){this._layer.setPickable(this._portionId,e,this._transparent)}_setCulled(e){this._layer.setCulled(this._portionId,e,this._transparent)}canPickTriangle(){return!1}drawPickTriangles(e,t){}pickTriangleSurface(e){}precisionRayPickSurface(e,t,i,s){return!!this._layer.precisionRayPickSurface&&this._layer.precisionRayPickSurface(this._portionId,e,t,i,s)}canPickWorldPos(){return!0}drawPickDepths(e){this.model.drawPickDepths(e)}drawPickNormals(e){this.model.drawPickNormals(e)}delegatePickedEntity(){return this.parent}_destroy(){this.model.scene._renderer.putPickID(this.pickId)}}class ScratchMemory{constructor(){this._uint8Arrays={},this._float32Arrays={}}_clear(){this._uint8Arrays={},this._float32Arrays={}}getUInt8Array(e){let t=this._uint8Arrays[e];return t||(t=new Uint8Array(e),this._uint8Arrays[e]=t),t}getFloat32Array(e){let t=this._float32Arrays[e];return t||(t=new Float32Array(e),this._float32Arrays[e]=t),t}}const batchingLayerScratchMemory=new ScratchMemory;let countUsers=0;function getScratchMemory(){return countUsers++,batchingLayerScratchMemory}function putScratchMemory(){0!==countUsers&&(countUsers--,0===countUsers&&batchingLayerScratchMemory._clear())}const RENDER_PASSES={NOT_RENDERED:0,COLOR_OPAQUE:1,COLOR_TRANSPARENT:2,SILHOUETTE_HIGHLIGHTED:3,SILHOUETTE_SELECTED:4,SILHOUETTE_XRAYED:5,EDGES_COLOR_OPAQUE:6,EDGES_COLOR_TRANSPARENT:7,EDGES_HIGHLIGHTED:8,EDGES_SELECTED:9,EDGES_XRAYED:10,PICK:11},tempVec4$7=math.vec4(),tempVec3a$W=math.vec3();class TrianglesBatchingColorRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=this._scene,r=s.camera,o=t.model,a=s.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(r.viewMatrix,h):r.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,o.worldNormalMatrix);const l=s._sectionPlanesState.sectionPlanes.length;if(l>0){const e=s._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const o=r.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,o?1:0),o){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$W);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(n.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(n.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,o=t.camera.project;s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const s=t.sao;if(s.possible){const t=i.drawingBufferWidth,r=i.drawingBufferHeight;tempVec4$7[0]=t,tempVec4$7[1]=r,tempVec4$7[2]=s.blendCutoff,tempVec4$7[3]=s.blendFactor,i.uniform4fv(this._uSAOParams,tempVec4$7),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0;let r;const o=[];o.push("// Triangles batching draw vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec3 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("uniform vec4 lightAmbient;");for(let e=0,t=i.lights.length;e<t;e++)r=i.lights[e],"ambient"!==r.type&&(o.push("uniform vec4 lightColor"+e+";"),"dir"===r.type&&o.push("uniform vec3 lightDir"+e+";"),"point"===r.type&&o.push("uniform vec3 lightPos"+e+";"),"spot"===r.type&&(o.push("uniform vec3 lightPos"+e+";"),o.push("uniform vec3 lightDir"+e+";")));o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),s&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;")),o.push("varying vec4 vColor;"),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;");for(let e=0,t=i.lights.length;e<t;e++)if(r=i.lights[e],"ambient"!==r.type){if("dir"===r.type)"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===r.type)"view"===r.space?o.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==r.type)continue;"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}return o.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),o.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;")),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;")),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching draw fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),s.push("   gl_FragColor            = vec4(vColor.rgb * ambient, 1.0);")):s.push("   gl_FragColor            = vColor;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec4$6=math.vec4(),tempVec3a$V=math.vec3();class TrianglesBatchingFlatColorRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=this._scene,r=s.camera,o=t.model,a=s.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(r.viewMatrix,h):r.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);const l=s._sectionPlanesState.sectionPlanes.length;if(l>0){const e=s._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t],o=r.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,o?1:0),o){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$V);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(n.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,o=t.camera.project;s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const s=t.sao;if(s.possible){const t=i.drawingBufferWidth,r=i.drawingBufferHeight;tempVec4$6[0]=t,tempVec4$6[1]=r,tempVec4$6[2]=s.blendCutoff,tempVec4$6[3]=s.blendFactor,i.uniform4fv(this._uSAOParams,tempVec4$6),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching flat-shading draw vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vViewPosition = viewPosition;"),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._lightsState,i=e._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("// Triangles batching flat-shading draw fragment shader"),r.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;")),this._withSAO&&(r.push("uniform sampler2D uOcclusionTexture;"),r.push("uniform vec4      uSAOParams;"),r.push("const float       packUpscale = 256. / 255.;"),r.push("const float       unpackDownScale = 255. / 256.;"),r.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),r.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),r.push("float unpackRGBToFloat( const in vec4 v ) {"),r.push("    return dot( v, unPackFactors );"),r.push("}")),s){r.push("varying vec4 vWorldPosition;"),r.push("varying vec4 vFlags2;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)r.push("uniform bool sectionPlaneActive"+e+";"),r.push("uniform vec3 sectionPlanePos"+e+";"),r.push("uniform vec3 sectionPlaneDir"+e+";")}r.push("uniform mat4 viewMatrix;"),r.push("uniform vec4 lightAmbient;");for(let e=0,i=t.lights.length;e<i;e++){const i=t.lights[e];"ambient"!==i.type&&(r.push("uniform vec4 lightColor"+e+";"),"dir"===i.type&&r.push("uniform vec3 lightDir"+e+";"),"point"===i.type&&r.push("uniform vec3 lightPos"+e+";"),"spot"===i.type&&(r.push("uniform vec3 lightPos"+e+";"),r.push("uniform vec3 lightDir"+e+";")))}if(r.push("varying vec4 vViewPosition;"),r.push("varying vec4 vColor;"),r.push("void main(void) {"),s){r.push("  bool clippable = (float(vFlags2.x) > 0.0);"),r.push("  if (clippable) {"),r.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)r.push("if (sectionPlaneActive"+e+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { "),r.push("      discard;"),r.push("  }"),r.push("}")}r.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),r.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),r.push("float lambertian = 1.0;"),r.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),r.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),r.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );");for(let e=0,i=t.lights.length;e<i;e++){const i=t.lights[e];if("ambient"!==i.type){if("dir"===i.type)"view"===i.space?r.push("viewLightDir = normalize(lightDir"+e+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===i.type)"view"===i.space?r.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):r.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==i.type)continue;"view"===i.space?r.push("viewLightDir = normalize(lightDir"+e+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}r.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),r.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return r.push("vec4 fragColor =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(r.push("   float viewportWidth     = uSAOParams[0];"),r.push("   float viewportHeight    = uSAOParams[1];"),r.push("   float blendCutoff       = uSAOParams[2];"),r.push("   float blendFactor       = uSAOParams[3];"),r.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),r.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),r.push("   gl_FragColor            = vec4(fragColor.rgb * ambient, 1.0);")):r.push("   gl_FragColor            = fragColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("}"),r}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const defaultColor$4=new Float32Array([1,1,1]),tempVec3a$U=math.vec3();class TrianglesBatchingSilhouetteRenderer{constructor(e,t){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.SILHOUETTE_XRAYED){const e=r.xrayMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_SELECTED){const e=r.selectedMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,defaultColor$4);const l=h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix;a.uniformMatrix4fv(this._uViewMatrix,!1,l),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*c,o=s.renderFlags;for(let t=0;t<c;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$U);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching silhouette vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 color;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let i,s;const r=t.sectionPlanes.length>0,o=[];if(o.push("// Triangles batching silhouette fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("uniform bool sectionPlaneActive"+i+";"),o.push("uniform vec3 sectionPlanePos"+i+";"),o.push("uniform vec3 sectionPlaneDir"+i+";");if(o.push("uniform vec4 color;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("if (sectionPlaneActive"+i+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("gl_FragColor = color;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$T=math.vec3(),defaultColor$3=new Float32Array([0,0,0,1]);class TrianglesBatchingEdgesRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.EDGES_XRAYED){const e=r.xrayMaterial._state,t=e.edgeColor,i=e.edgeAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.EDGES_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.edgeColor,i=e.edgeAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.EDGES_SELECTED){const e=r.selectedMaterial._state,t=e.edgeColor,i=e.edgeAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,defaultColor$3);a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,o=s.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$T);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.edgeIndicesBuf.bind(),a.drawElements(a.LINES,n.edgeIndicesBuf.numItems,n.edgeIndicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uColor=i.getLocation("color"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry edges drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("uniform vec4 color;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(color.r, color.g, color.b, color.a);"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = vColor;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$S=math.vec3();class TrianglesBatchingEdgesColorRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,o=s.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$S);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.edgeIndicesBuf.bind(),a.drawElements(a.LINES,n.edgeIndicesBuf.numItems,n.edgeIndicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry edges drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = vColor;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$R=math.vec3();class TrianglesBatchingPickMeshRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,c=h?createRTCViewMat(l,h):l;if(a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,c),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$R);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(n.pickColorsBuf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry picking vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 pickColor;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry picking fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   gl_FragColor = vPickColor; "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$Q=math.vec3();class TrianglesBatchingPickDepthRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniform1i(this._uPickInvisible,e.pickInvisible);const l=e.pickViewMatrix||o.viewMatrix,c=h?createRTCViewMat(l,h):l;if(a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,c),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),a.uniform1f(this._uPickZNear,e.pickZNear),a.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,t)}const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$Q);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching pick depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching pick depth fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("varying vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    gl_FragColor = packDepth(zNormalizedDepth); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$P=math.vec3();class TrianglesBatchingPickNormalsRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniform1i(this._uPickInvisible,e.pickInvisible),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,c=h?createRTCViewMat(l,h):l;if(a.uniformMatrix4fv(this._uViewMatrix,!1,c),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$P);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(n.normalsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching pick normals vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec3 normal;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec3 vWorldNormal;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vec3 worldNormal =  octDecode(normal.xy); "),i.push("      vWorldNormal = worldNormal;"),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching pick normals fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("varying vec3 vWorldNormal;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$O=math.vec3();class TrianglesBatchingOcclusionRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.canvas.gl,a=t._state,n=r.camera,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,a=s.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const r=a.sectionPlanesActivePerLayer[i+t];if(o.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$O);o.uniform3fv(s.pos,e)}else o.uniform3fv(s.pos,i.pos);o.uniform3fv(s.dir,i.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching occlusion fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("      if (sectionPlaneActive"+e+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$N=math.vec3();class TrianglesBatchingDepthRenderer{constructor(e){this._scene=e,this._allocate(),this._hash=this._getHash()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,o=s.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$N);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec2 vHighPrecisionZW;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vHighPrecisionZW = gl_Position.zw;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching depth fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("precision highp float;"),s.push("precision highp int;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("const float   packUpScale = 256. / 255.;"),s.push("const float   unpackDownscale = 255. / 256.;"),s.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),s.push("const float   shiftRight8 = 1.0 / 256.;"),s.push("vec4 packDepthToRGBA( const in float v ) {"),s.push("    vec4 r = vec4( fract( v * packFactors ), v );"),s.push("    r.yzw -= r.xyz * shiftRight8;"),s.push("    return r * packUpScale;"),s.push("}"),s.push("varying vec2 vHighPrecisionZW;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?s.push("    gl_FragColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "):s.push("    gl_FragColor = packDepthToRGBA(fragCoordZ); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null,stats.memory.programs--}}const tempVec3a$M=math.vec3();class TrianglesBatchingNormalsRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(t)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,o=s.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$M);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aNormal.bindArrayBuffer(n.normalsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2&&(this._aFlags2=i.getAttribute("flags2")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry normals vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec3 normal;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 worldNormalMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 viewNormalMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec3 vViewNormal;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition   = viewMatrix * worldPosition; "),i.push("      vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),i.push("      vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(i.push("      vWorldPosition  = worldPosition;"),i.push("      vFlags2         = flags2;")),i.push("      vViewNormal = viewNormal;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry normals fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$L=math.vec3();class TrianglesBatchingShadowRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){const i=this._scene,s=i.canvas.gl,r=t._state;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),i.logarithmicDepthBufferEnabled&&s.uniform1f(this._uZFar,i.camera.project.far),this._aPosition.bindArrayBuffer(r.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(r.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(r.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(r.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(r.offsetsBuf),r.indicesBuf.bind();const o=i._sectionPlanesState.sectionPlanes.length;if(o>0){const e=i._sectionPlanesState.sectionPlanes,r=t.layerIndex*o,a=model.renderFlags,n=t._state.origin;for(let t=0;t<o;t++){const i=this._uSectionPlanes[t];if(i){const o=a.sectionPlanesActivePerLayer[r+t];if(s.uniform1i(i.active,o?1:0),o){const r=e[t];if(n){const e=getPlaneRTCPos(r.dist,r.dir,n,tempVec3a$L);s.uniform3fv(i.pos,e)}else s.uniform3fv(i.pos,r.pos);s.uniform3fv(i.dir,r.dir)}}}}s.drawElements(s.TRIANGLES,r.indicesBuf.numItems,r.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),e.logarithmicDepthBufferEnabled&&(this._uZFar=s.getLocation("zFar")),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2")}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),t.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry shadow vertex shader"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("void main(void) {"),i.push("  bool visible        = (float(flags.x) > 0.0);"),i.push("  bool transparent    = ((float(color.a) / 255.0) < 1.0);"),i.push("  if (!visible || transparent) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("      vViewPosition = viewPosition;"),i.push("      gl_Position = shadowProjMatrix * viewPosition;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene._sectionPlanesState,t=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry shadow fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vViewPosition;"),i.push("vec4 encodeFloat( const in float v ) {"),i.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),i.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),i.push("  vec4 comp = fract(v * bitShift);"),i.push("  comp -= comp.xxyz * bitMask;"),i.push("  return comp;"),i.push("}"),i.push("void main(void) {"),t){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var s=0;s<e.sectionPlanes.length;s++)i.push("      if (sectionPlaneActive"+s+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return i.push("    gl_FragColor = encodeFloat( gl_FragCoord.z); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec4$5=math.vec4(),tempVec3a$K=math.vec3(),TEXTURE_DECODE_FUNCS$1={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};class TrianglesBatchingColorQualityRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=WEBGL_INFO$1.MAX_TEXTURE_UNITS,r=this._scene,o=r.camera,a=t.model,n=r.canvas.gl,h=t._state,l=t._state.origin,c=h.textureSet;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,i),n.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,a.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,a.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,s=a.renderFlags;for(let t=0;t<u;t++){const r=this._uSectionPlanes[t];if(r){const o=s.sectionPlanesActivePerLayer[i+t];if(n.uniform1i(r.active,o?1:0),o){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$K);n.uniform3fv(r.pos,e)}else n.uniform3fv(r.pos,i.pos);n.uniform3fv(r.dir,i.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&n.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(h.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(h.uvBuf),this._aColor&&this._aColor.bindArrayBuffer(h.colorsBuf),this._aMetallicRoughness&&this._aMetallicRoughness.bindArrayBuffer(h.metallicRoughnessBuf),this._aFlags&&this._aFlags.bindArrayBuffer(h.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(h.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(h.offsetsBuf),c&&(this._program.bindTexture(this._uBaseColorMap,c.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uMetallicRoughMap,c.metallicRoughnessTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uEmissiveMap,c.emissiveTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uNormalMap,c.normalsTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s),h.indicesBuf.bind(),n.drawElements(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}i.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),i.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aUV=s.getAttribute("uv"),this._aColor=s.getAttribute("color"),this._aMetallicRoughness=s.getAttribute("metallicRoughness"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uBaseColorMap="uBaseColorMap",this._uMetallicRoughMap="uMetallicRoughMap",this._uEmissiveMap="uEmissiveMap",this._uNormalMap="uNormalMap",this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=WEBGL_INFO$1.MAX_TEXTURE_UNITS,i=this._scene,s=i.canvas.gl,r=this._program,o=i._lightsState,a=o.lights,n=i.camera.project;r.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,i._lightsState.getAmbientColorAndIntensity());for(let e=0,t=a.length;e<t;e++){const t=a[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(o.reflectionMaps.length>0&&o.reflectionMaps[0].texture&&this._uReflectionMap&&(r.bindTexture(this._uReflectionMap,o.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),o.lightMaps.length>0&&o.lightMaps[0].texture&&this._uLightMap&&(r.bindTexture(this._uLightMap,o.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),this._withSAO){const r=i.sao;if(r.possible){const i=s.drawingBufferWidth,o=s.drawingBufferHeight;tempVec4$5[0]=i,tempVec4$5[1]=o,tempVec4$5[2]=r.blendCutoff,tempVec4$5[3]=r.blendFactor,s.uniform4fv(this._uSAOParams,tempVec4$5),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++}}if(i.logarithmicDepthBufferEnabled){const e=2/(Math.log(n.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,i.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0,r=t.clippingCaps,o=[];return o.push("// Triangles batching quality draw vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#extension GL_OES_standard_derivatives : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec3 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec2 uv;"),o.push("attribute vec2 metallicRoughness;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),o.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("varying vec4 vViewPosition;"),o.push("varying vec3 vViewNormal;"),o.push("varying vec4 vColor;"),o.push("varying vec2 vUV;"),o.push("varying vec2 vMetallicRoughness;"),i.lightMaps.length>0&&o.push("varying vec3 vWorldNormal;"),s&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),r&&o.push("varying vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;"))),s&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),o.push("vMetallicRoughness = metallicRoughness;"),i.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,i=e._sectionPlanesState,s=e._lightsState,r=i.sectionPlanes.length>0,o=i.clippingCaps,a=[];a.push("// Triangles batching quality draw fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("#extension GL_OES_standard_derivatives : enable"),a.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),a.push("precision highp float;"),a.push("precision highp int;"),a.push("#else"),a.push("precision mediump float;"),a.push("precision mediump int;"),a.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(a.push("varying float isPerspective;"),a.push("uniform float logDepthBufFC;"),a.push("varying float vFragDepth;")),a.push("uniform sampler2D uBaseColorMap;"),a.push("uniform sampler2D uMetallicRoughMap;"),a.push("uniform sampler2D uEmissiveMap;"),a.push("uniform sampler2D uNormalMap;"),a.push("varying vec4 vViewPosition;"),a.push("varying vec3 vViewNormal;"),a.push("varying vec4 vColor;"),a.push("varying vec2 vUV;"),a.push("varying vec2 vMetallicRoughness;"),s.lightMaps.length>0&&a.push("varying vec3 vWorldNormal;"),a.push("uniform mat4 viewMatrix;"),s.reflectionMaps.length>0&&a.push("uniform samplerCube reflectionMap;"),s.lightMaps.length>0&&a.push("uniform samplerCube lightMap;"),a.push("uniform vec4 lightAmbient;");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];"ambient"!==t.type&&(a.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&a.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&a.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(a.push("uniform vec3 lightPos"+e+";"),a.push("uniform vec3 lightDir"+e+";")))}if(this._withSAO&&(a.push("uniform sampler2D uOcclusionTexture;"),a.push("uniform vec4      uSAOParams;"),a.push("const float       packUpscale = 256. / 255.;"),a.push("const float       unpackDownScale = 255. / 256.;"),a.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),a.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),a.push("float unpackRGBAToDepth( const in vec4 v ) {"),a.push("    return dot( v, unPackFactors );"),a.push("}")),a.push("uniform float gammaFactor;"),a.push("vec4 linearToLinear( in vec4 value ) {"),a.push("  return value;"),a.push("}"),a.push("vec4 sRGBToLinear( in vec4 value ) {"),a.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),a.push("}"),a.push("vec4 gammaToLinear( in vec4 value) {"),a.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),a.push("}"),t&&(a.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),a.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),a.push("}")),r){a.push("varying vec4 vWorldPosition;"),a.push("varying vec4 vFlags2;"),o&&a.push("varying vec4 vClipPosition;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)a.push("uniform bool sectionPlaneActive"+e+";"),a.push("uniform vec3 sectionPlanePos"+e+";"),a.push("uniform vec3 sectionPlaneDir"+e+";")}if(a.push("#define PI 3.14159265359"),a.push("#define RECIPROCAL_PI 0.31830988618"),a.push("#define RECIPROCAL_PI2 0.15915494"),a.push("#define EPSILON 1e-6"),a.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),a.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),a.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),a.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),a.push("      vec2 st0 = dFdx( uv.st );"),a.push("      vec2 st1 = dFdy( uv.st );"),a.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),a.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),a.push("      vec3 N = normalize( surf_norm );"),a.push("      vec3 mapN = texture2D( uNormalMap, uv ).xyz * 2.0 - 1.0;"),a.push("      mat3 tsn = mat3( S, T, N );"),a.push("      return normalize( tsn * mapN );"),a.push("}"),a.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),a.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),a.push("}"),a.push("struct IncidentLight {"),a.push("   vec3 color;"),a.push("   vec3 direction;"),a.push("};"),a.push("struct ReflectedLight {"),a.push("   vec3 diffuse;"),a.push("   vec3 specular;"),a.push("};"),a.push("struct Geometry {"),a.push("   vec3 position;"),a.push("   vec3 viewNormal;"),a.push("   vec3 worldNormal;"),a.push("   vec3 viewEyeDir;"),a.push("};"),a.push("struct Material {"),a.push("   vec3  diffuseColor;"),a.push("   float specularRoughness;"),a.push("   vec3  specularColor;"),a.push("   float shine;"),a.push("};"),a.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),a.push("   float r = ggxRoughness + 0.0001;"),a.push("   return (2.0 / (r * r) - 2.0);"),a.push("}"),a.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),a.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),a.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),a.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),a.push("}"),s.reflectionMaps.length>0&&(a.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),a.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),a.push("   vec3 envMapColor = "+TEXTURE_DECODE_FUNCS$1[s.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),a.push("  return envMapColor;"),a.push("}")),a.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),a.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),a.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),a.push("}"),a.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),a.push("   float a2 = ( alpha * alpha );"),a.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),a.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),a.push("   return 1.0 / ( gl * gv );"),a.push("}"),a.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),a.push("   float a2 = ( alpha * alpha );"),a.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),a.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),a.push("   return 0.5 / max( gv + gl, EPSILON );"),a.push("}"),a.push("float D_GGX(const in float alpha, const in float dotNH) {"),a.push("   float a2 = ( alpha * alpha );"),a.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),a.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),a.push("}"),a.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),a.push("   float alpha = ( roughness * roughness );"),a.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),a.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),a.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),a.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),a.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),a.push("   vec3  F = F_Schlick( specularColor, dotLH );"),a.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),a.push("   float D = D_GGX( alpha, dotNH );"),a.push("   return F * (G * D);"),a.push("}"),a.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),a.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),a.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),a.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),a.push("   vec4 r = roughness * c0 + c1;"),a.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),a.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),a.push("   return specularColor * AB.x + AB.y;"),a.push("}"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&(a.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),s.lightMaps.length>0&&(a.push("   vec3 irradiance = "+TEXTURE_DECODE_FUNCS$1[s.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),a.push("   irradiance *= PI;"),a.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),a.push("   reflectedLight.diffuse +=  irradiance * diffuseBRDFContrib;")),s.reflectionMaps.length>0&&(a.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),a.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),a.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),a.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),a.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),a.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),a.push("}")),a.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),a.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),a.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),a.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),a.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),a.push("}"),a.push("void main(void) {"),r){a.push("  bool clippable = (float(vFlags2.x) > 0.0);"),a.push("  if (clippable) {"),a.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)a.push("if (sectionPlaneActive"+e+") {"),a.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),a.push("}");o?(a.push("  if (dist > (0.002 * vClipPosition.w)) {"),a.push("      discard;"),a.push("  }"),a.push("  if (dist > 0.0) { "),a.push("      gl_FragColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("  gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("  return;"),a.push("}")):(a.push("  if (dist > 0.0) { "),a.push("      discard;"),a.push("  }")),a.push("}")}a.push("IncidentLight  light;"),a.push("Material       material;"),a.push("Geometry       geometry;"),a.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),a.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),a.push("float opacity = float(vColor.a) / 255.0;"),a.push("vec3  baseColor = rgb;"),a.push("float specularF0 = 1.0;"),a.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),a.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),a.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),a.push("vec4 baseColorTexel = texture2D(uBaseColorMap, vUV);"),a.push("baseColor = baseColorTexel.rgb;"),a.push("opacity = 1.0;"),a.push("vec3 metalRoughTexel = texture2D(uMetallicRoughMap, vUV).rgb;"),a.push("metallic = metalRoughTexel.r;"),a.push("roughness = metalRoughTexel.g;"),a.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition.xyz, normalize(vViewNormal), vUV );"),a.push("material.diffuseColor      = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),a.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),a.push("material.specularColor     = mix(vec3(dielectricSpecular), baseColor, metallic);"),a.push("geometry.position      = vViewPosition.xyz;"),a.push("geometry.viewNormal    = -normalize(viewNormal);"),a.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),s.lightMaps.length>0&&a.push("geometry.worldNormal   = normalize(vWorldNormal);"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&a.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?a.push("light.direction =  normalize(lightDir"+e+");"):a.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?a.push("light.direction =  normalize(lightPos"+e+" - vViewPosition.xyz);"):a.push("light.direction =  normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?a.push("light.direction =  normalize(lightDir"+e+");"):a.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}a.push("light.color =  lightColor"+e+".rgb * lightColor"+e+".a;"),a.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return a.push("vec3 emissiveColor = linearToLinear(texture2D(uEmissiveMap, vUV)).rgb;"),a.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * baseColor * opacity * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular) + emissiveColor;"),a.push("vec4 fragColor;"),this._withSAO?(a.push("   float viewportWidth     = uSAOParams[0];"),a.push("   float viewportHeight    = uSAOParams[1];"),a.push("   float blendCutoff       = uSAOParams[2];"),a.push("   float blendFactor       = uSAOParams[3];"),a.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),a.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),a.push("   fragColor               = vec4(outgoingLight.rgb * ambient, opacity);")):a.push("   fragColor            = vec4(outgoingLight.rgb, opacity);"),t&&a.push("fragColor = linearToGamma(fragColor, gammaFactor);"),a.push("gl_FragColor = fragColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("}"),a}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$J=math.vec3();class TrianglesBatchingPickNormalsFlatRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniform1i(this._uPickInvisible,e.pickInvisible),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,c=h?createRTCViewMat(l,h):l;if(a.uniformMatrix4fv(this._uViewMatrix,!1,c),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$J);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles batching pick flat normals vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("varying vec4 vWorldPosition;"),t&&i.push("varying vec4 vFlags2;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vWorldPosition = worldPosition;"),t&&i.push("      vFlags2 = flags2;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching pick flat normals fragment shader"),s.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("varying vec4 vWorldPosition;"),i){s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),s.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),s.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),s.push("  gl_FragColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec4$4=math.vec4(),tempVec3a$I=math.vec3();class TrianglesBatchingColorTextureRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=WEBGL_INFO$1.MAX_TEXTURE_UNITS,r=this._scene,o=r.camera,a=t.model,n=r.canvas.gl,h=t._state,l=t._state.origin,c=h.textureSet;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,i),n.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,a.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,a.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,s=a.renderFlags;for(let t=0;t<u;t++){const r=this._uSectionPlanes[t];if(r){const o=s.sectionPlanesActivePerLayer[i+t];if(n.uniform1i(r.active,o?1:0),o){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$I);n.uniform3fv(r.pos,e)}else n.uniform3fv(r.pos,i.pos);n.uniform3fv(r.dir,i.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&n.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(h.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(h.uvBuf),this._aColor&&this._aColor.bindArrayBuffer(h.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(h.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(h.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(h.offsetsBuf),c&&c.colorTexture&&(this._program.bindTexture(this._uColorMap,c.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s),h.indicesBuf.bind(),n.drawElements(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aUV=s.getAttribute("uv"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uColorMap="uColorMap",this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=WEBGL_INFO$1.MAX_TEXTURE_UNITS,i=this._scene,s=i.canvas.gl,r=this._program,o=i._lightsState.lights,a=i.camera.project;r.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,a.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,i._lightsState.getAmbientColorAndIntensity());for(let e=0,t=o.length;e<t;e++){const t=o[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const r=i.sao;if(r.possible){const i=s.drawingBufferWidth,o=s.drawingBufferHeight;tempVec4$4[0]=i,tempVec4$4[1]=o,tempVec4$4[2]=r.blendCutoff,tempVec4$4[3]=r.blendFactor,s.uniform4fv(this._uSAOParams,tempVec4$4),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++}}if(i.logarithmicDepthBufferEnabled){const e=2/(Math.log(a.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0;let r;const o=[];o.push("// Triangles batching color texture vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec3 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec2 uv;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),o.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("uniform vec4 lightAmbient;");for(let e=0,t=i.lights.length;e<t;e++)r=i.lights[e],"ambient"!==r.type&&(o.push("uniform vec4 lightColor"+e+";"),"dir"===r.type&&o.push("uniform vec3 lightDir"+e+";"),"point"===r.type&&o.push("uniform vec3 lightPos"+e+";"),"spot"===r.type&&(o.push("uniform vec3 lightPos"+e+";"),o.push("uniform vec3 lightDir"+e+";")));o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),s&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;")),o.push("varying vec4 vColor;"),o.push("varying vec2 vUV;"),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;");for(let e=0,t=i.lights.length;e<t;e++)if(r=i.lights[e],"ambient"!==r.type){if("dir"===r.type)"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===r.type)"view"===r.space?o.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==r.type)continue;"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}return o.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),o.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),o.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;")),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;")),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles batching color texture fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("uniform sampler2D uColorMap;"),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("varying vec2 vUV;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("vec4 colorTexel = texture2D(uColorMap, vUV);"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),s.push("   gl_FragColor            = vec4(vColor.rgb * colorTexel.rgb * ambient, 1.0);")):s.push("   gl_FragColor            = vec4(colorTexel.rgb, 1.0);"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class TrianglesBatchingRenderers{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorTextureRenderer&&!this._colorTextureRenderer.getValid()&&(this._colorTextureRenderer.destroy(),this._colorTextureRenderer=null),this._colorTextureRendererWithSAO&&!this._colorTextureRendererWithSAO.getValid()&&(this._colorTextureRendererWithSAO.destroy(),this._colorTextureRendererWithSAO=null),this._colorQualityRenderer&&!this._colorQualityRenderer.getValid()&&(this._colorQualityRenderer.destroy(),this._colorQualityRenderer=null),this._colorQualityRendererWithSAO&&!this._colorQualityRendererWithSAO.getValid()&&(this._colorQualityRendererWithSAO.destroy(),this._colorQualityRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!1===this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new TrianglesBatchingColorRenderer(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new TrianglesBatchingColorRenderer(this._scene,!0)),this._colorRendererWithSAO}get flatColorRenderer(){return this._flatColorRenderer||(this._flatColorRenderer=new TrianglesBatchingFlatColorRenderer(this._scene,!1)),this._flatColorRenderer}get flatColorRendererWithSAO(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new TrianglesBatchingFlatColorRenderer(this._scene,!0)),this._flatColorRendererWithSAO}get colorTextureRenderer(){return this._colorTextureRenderer||(this._colorTextureRenderer=new TrianglesBatchingColorTextureRenderer(this._scene,!1)),this._colorTextureRenderer}get colorTextureRendererWithSAO(){return this._colorTextureRendererWithSAO||(this._colorTextureRendererWithSAO=new TrianglesBatchingColorTextureRenderer(this._scene,!0)),this._colorTextureRendererWithSAO}get colorQualityRenderer(){return this._colorQualityRenderer||(this._colorQualityRenderer=new TrianglesBatchingColorQualityRenderer(this._scene,!1)),this._colorQualityRenderer}get colorQualityRendererWithSAO(){return this._colorQualityRendererWithSAO||(this._colorQualityRendererWithSAO=new TrianglesBatchingColorQualityRenderer(this._scene,!0)),this._colorQualityRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new TrianglesBatchingSilhouetteRenderer(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new TrianglesBatchingDepthRenderer(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new TrianglesBatchingNormalsRenderer(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new TrianglesBatchingEdgesRenderer(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new TrianglesBatchingEdgesColorRenderer(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new TrianglesBatchingPickMeshRenderer(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new TrianglesBatchingPickNormalsRenderer(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new TrianglesBatchingPickNormalsFlatRenderer(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new TrianglesBatchingPickDepthRenderer(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new TrianglesBatchingOcclusionRenderer(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new TrianglesBatchingShadowRenderer(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorTextureRenderer&&this._colorTextureRenderer.destroy(),this._colorTextureRendererWithSAO&&this._colorTextureRendererWithSAO.destroy(),this._colorQualityRenderer&&this._colorQualityRenderer.destroy(),this._colorQualityRendererWithSAO&&this._colorQualityRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const cachdRenderers={};function getBatchingRenderers$1(e){const t=e.id;let i=cachdRenderers[t];return i||(i=new TrianglesBatchingRenderers(e),cachdRenderers[t]=i,i._compile(),e.on("compile",(()=>{i._compile()})),e.on("destroyed",(()=>{delete cachdRenderers[t],i._destroy()}))),i}const bigIndicesSupported$4=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint;class TrianglesBatchingBuffer{constructor(e=5e6){bigIndicesSupported$4?e>5e6&&(e=5e6):e>65530&&(e=65530),this.maxVerts=e,this.maxIndices=3*e,this.positions=[],this.colors=[],this.uv=[],this.metallicRoughness=[],this.normals=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[],this.edgeIndices=[]}}const translate=math.mat4(),scale=math.mat4();function quantizePositions(e,t,i){const s=e.length,r=new Uint16Array(s),o=t[0],a=t[1],n=t[2],h=t[3]-o,l=t[4]-a,c=t[5]-n,u=65525,p=u/h,d=u/l,m=u/c,f=e=>e>=0?e:0;for(let t=0;t<s;t+=3)r[t+0]=Math.floor(f(e[t+0]-o)*p),r[t+1]=Math.floor(f(e[t+1]-a)*d),r[t+2]=Math.floor(f(e[t+2]-n)*m);return math.identityMat4(translate),math.translationMat4v(t,translate),math.identityMat4(scale),math.scalingMat4v([h/u,l/u,c/u],scale),math.mulMat4(translate,scale,i),r}function transformAndOctEncodeNormals(e,t,i,s,r){let o,a,n,h,l,c,u=new Float32Array([0,0,0,0]),p=new Float32Array([0,0,0,0]);for(c=0;c<i;c+=3)u[0]=t[c],u[1]=t[c+1],u[2]=t[c+2],math.transformVec3(e,u,p),math.normalizeVec3(p,p),n=o=octEncodeVec3(p,"floor","floor"),a=octDecodeVec2(o),h=l=dot(p,a),o=octEncodeVec3(p,"ceil","floor"),a=octDecodeVec2(o),h=dot(p,a),h>l&&(n=o,l=h),o=octEncodeVec3(p,"floor","ceil"),a=octDecodeVec2(o),h=dot(p,a),h>l&&(n=o,l=h),o=octEncodeVec3(p,"ceil","ceil"),a=octDecodeVec2(o),h=dot(p,a),h>l&&(n=o,l=h),s[r+c+0]=n[0],s[r+c+1]=n[1],s[r+c+2]=0;return r+=i}function octEncodeNormals(e){const t=e.length,i=new Int8Array(t);let s,r,o,a;for(let n=0;n<t;n+=3)r=s=octEncodeNormal(e,n,"floor","floor"),octDecodeVec2(s),o=a=dot(e,n),s=octEncodeNormal(e,n,"ceil","floor"),octDecodeVec2(s),o=dot(e,n),o>a&&(r=s,a=o),s=octEncodeNormal(e,n,"floor","ceil"),octDecodeVec2(s),o=dot(e,n),o>a&&(r=s,a=o),s=octEncodeNormal(e,n,"ceil","ceil"),octDecodeVec2(s),o=dot(e,n),o>a&&(r=s,a=o),i[n+0]=r[0],i[n+1]=r[1],i[n+2]=0;return new Int8Array(i)}function octEncodeVec3(e,t,i){let s=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),r=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));if(e[2]<0){let e=s,t=r;e=(1-Math.abs(r))*(s>=0?1:-1),t=(1-Math.abs(s))*(r>=0?1:-1),s=e,r=t}return new Int8Array([Math[t](127.5*s+(s<0?-1:0)),Math[i](127.5*r+(r<0?-1:0))])}function octEncodeNormal(e,t,i,s){let r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){let e=(1-Math.abs(o))*(r>=0?1:-1),t=(1-Math.abs(r))*(o>=0?1:-1);r=e,o=t}return new Int8Array([Math[i](127.5*r+(r<0?-1:0)),Math[s](127.5*o+(o<0?-1:0))])}function octDecodeVec2(e){let t=e[0],i=e[1];t/=t<0?127:128,i/=i<0?127:128;const s=1-Math.abs(t)-Math.abs(i);s<0&&(t=(1-Math.abs(i))*(t>=0?1:-1),i=(1-Math.abs(t))*(i>=0?1:-1));const r=Math.sqrt(t*t+i*i+s*s);return[t/r,i/r,s/r]}function dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}const tempMat4$2=math.mat4(),tempMat4b=math.mat4(),tempVec4a$9=math.vec4([0,0,0,1]),tempVec4b$9=math.vec4([0,0,0,1]),tempVec4c$7=math.vec4([0,0,0,1]),tempOBB3$2=math.OBB3(),tempVec3a$H=math.vec3(),tempVec3b$8=math.vec3(),tempVec3c$5=math.vec3(),tempVec3d$2=math.vec3(),tempVec3e$1=math.vec3(),tempVec3f$1=math.vec3(),tempVec3g$1=math.vec3();class TrianglesBatchingLayer{constructor(e){this.model=e.model,this.sortId="TrianglesBatchingLayer"+(e.solid?"-solid":"-surface")+(e.autoNormals?"-autonormals":"-normals")+(e.textureSet&&e.textureSet.colorTexture?"-colorTexture":"")+(e.textureSet&&e.textureSet.metallicRoughnessTexture?"-metallicRoughnessTexture":""),this.layerIndex=e.layerIndex,this._batchingRenderers=getBatchingRenderers$1(e.model.scene),this._buffer=new TrianglesBatchingBuffer(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new RenderState({origin:math.vec3(),positionsBuf:null,offsetsBuf:null,normalsBuf:null,colorsBuf:null,uvBuf:null,metallicRoughnessBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,edgeIndicesBuf:null,positionsDecodeMatrix:math.mat4(),uvDecodeMatrix:null,textureSet:e.textureSet,pbrSupported:!1}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=math.collapseAABB3(),this._portions=[],this._numVerts=0,this._finalized=!1,e.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(e.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,e.uvDecodeMatrix?(this._state.uvDecodeMatrix=math.mat3(e.uvDecodeMatrix),this._preCompressedNormalsExpected=!0):this._preCompressedNormalsExpected=!1,e.origin&&this._state.origin.set(e.origin),this.aabb=math.collapseAABB3(),this.solid=!!e.solid}canCreatePortion(e,t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts&&this._buffer.indices.length+t<this._buffer.maxIndices}createPortion(e){if(this._finalized)throw"Already finalized";const t=e.positions,i=e.positionsCompressed,s=e.normals,r=e.normalsCompressed,o=e.uv,a=e.uvCompressed,n=e.colors,h=e.colorsCompressed,l=e.indices,c=e.edgeIndices,u=e.color,p=e.metallic,d=e.roughness,m=e.opacity,f=e.meshMatrix,g=e.worldMatrix,_=e.worldAABB,y=e.pickColor,T=this.model.scene,v=this._buffer,I=v.positions.length/3;let E;if(this._preCompressedPositionsExpected){if(!i)throw"positionsCompressed expected";E=i.length/3;for(let e=0,t=i.length;e<t;e++)v.positions.push(i[e]);const e=geometryCompressionUtils.getPositionsBounds(i),t=geometryCompressionUtils.decompressPosition(e.min,this._state.positionsDecodeMatrix,[]),s=geometryCompressionUtils.decompressPosition(e.max,this._state.positionsDecodeMatrix,[]);_[0]=t[0],_[1]=t[1],_[2]=t[2],_[3]=s[0],_[4]=s[1],_[5]=s[2],g&&(math.AABB3ToOBB3(_,tempOBB3$2),math.transformOBB3(g,tempOBB3$2),math.OBB3ToAABB3(tempOBB3$2,_))}else{if(!t)throw"positions expected";E=t.length/3;const e=t.length,i=v.positions.length;for(let e=0,i=t.length;e<i;e++)v.positions.push(t[e]);if(f)for(let t=i,s=i+e;t<s;t+=3)tempVec4a$9[0]=v.positions[t+0],tempVec4a$9[1]=v.positions[t+1],tempVec4a$9[2]=v.positions[t+2],math.transformPoint4(f,tempVec4a$9,tempVec4b$9),v.positions[t+0]=tempVec4b$9[0],v.positions[t+1]=tempVec4b$9[1],v.positions[t+2]=tempVec4b$9[2],math.expandAABB3Point3(this._modelAABB,tempVec4b$9),g?(math.transformPoint4(g,tempVec4b$9,tempVec4c$7),math.expandAABB3Point3(_,tempVec4c$7)):math.expandAABB3Point3(_,tempVec4b$9);else for(let t=i,s=i+e;t<s;t+=3)tempVec4a$9[0]=v.positions[t+0],tempVec4a$9[1]=v.positions[t+1],tempVec4a$9[2]=v.positions[t+2],math.expandAABB3Point3(this._modelAABB,tempVec4a$9),g?(math.transformPoint4(g,tempVec4a$9,tempVec4b$9),math.expandAABB3Point3(_,tempVec4b$9)):math.expandAABB3Point3(_,tempVec4a$9)}if(this._state.origin){const e=this._state.origin;_[0]+=e[0],_[1]+=e[1],_[2]+=e[2],_[3]+=e[0],_[4]+=e[1],_[5]+=e[2]}if(math.expandAABB3(this.aabb,_),r&&r.length>0)for(let e=0,t=r.length;e<t;e++)v.normals.push(r[e]);else if(s&&s.length>0){const e=tempMat4$2;f?math.inverseMat4(math.transposeMat4(f,tempMat4b),e):math.identityMat4(e,e),transformAndOctEncodeNormals(e,s,s.length,v.normals,v.normals.length)}if(n)for(let e=0,t=n.length;e<t;e+=3)v.colors.push(255*n[e]),v.colors.push(255*n[e+1]),v.colors.push(255*n[e+2]),v.colors.push(255);else if(h)for(let e=0,t=n.length;e<t;e+=3)v.colors.push(n[e]),v.colors.push(n[e+1]),v.colors.push(n[e+2]),v.colors.push(255);else if(u){const e=u[0],t=u[1],i=u[2],s=m,r=null!=p?p:0,o=null!=d?d:255;for(let a=0;a<E;a++)v.colors.push(e),v.colors.push(t),v.colors.push(i),v.colors.push(s),v.metallicRoughness.push(r),v.metallicRoughness.push(o)}if(o&&o.length>0)for(let e=0,t=o.length;e<t;e++)v.uv.push(o[e]);else if(a&&a.length>0)for(let e=0,t=a.length;e<t;e++)v.uv.push(a[e]);if(l)for(let e=0,t=l.length;e<t;e++)v.indices.push(l[e]+I);if(c)for(let e=0,t=c.length;e<t;e++)v.edgeIndices.push(c[e]+I);{const e=v.pickColors.length;for(let t=e,i=e+4*E;t<i;t+=4)v.pickColors.push(y[0]),v.pickColors.push(y[1]),v.pickColors.push(y[2]),v.pickColors.push(y[3])}if(T.entityOffsetsEnabled)for(let e=0;e<E;e++)v.offsets.push(0),v.offsets.push(0),v.offsets.push(0);const P=this._portions.length,b={vertsBase:I,numVerts:E};return T.pickSurfacePrecisionEnabled&&(l&&(b.indices=l),T.entityOffsetsEnabled&&(b.offset=new Float32Array(3))),this._portions.push(b),this._numPortions++,this.model.numPortions++,this._numVerts+=b.numVerts,P}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this.model.scene.canvas.gl,i=this._buffer;if(i.positions.length>0){const s=this._preCompressedPositionsExpected?new Uint16Array(i.positions):quantizePositions(i.positions,this._modelAABB,e.positionsDecodeMatrix);if(e.positionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,s.length,3,t.STATIC_DRAW),this.model.scene.pickSurfacePrecisionEnabled)for(let e=0,t=this._portions.length;e<t;e++){const t=this._portions[e],i=3*t.vertsBase,r=i+3*t.numVerts;t.quantizedPositions=s.slice(i,r)}}if(i.normals.length>0){const s=new Int8Array(i.normals);let r=!0;e.normalsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.normals.length,3,t.STATIC_DRAW,r)}if(i.colors.length>0){const s=new Uint8Array(i.colors);let r=!1;e.colorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.colors.length,4,t.DYNAMIC_DRAW,r)}if(i.uv.length>0)if(e.uvDecodeMatrix){let s=!1;e.uvBuf=new ArrayBuf(t,t.ARRAY_BUFFER,i.uv,i.uv.length,2,t.STATIC_DRAW,s)}else{const s=geometryCompressionUtils.getUVBounds(i.uv),r=geometryCompressionUtils.compressUVs(i.uv,s.min,s.max),o=r.quantized;let a=!1;e.uvDecodeMatrix=math.mat3(r.decodeMatrix),e.uvBuf=new ArrayBuf(t,t.ARRAY_BUFFER,o,o.length,2,t.STATIC_DRAW,a)}if(i.metallicRoughness.length>0){const s=new Uint8Array(i.metallicRoughness);let r=!1;e.metallicRoughnessBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.metallicRoughness.length,2,t.STATIC_DRAW,r)}if(i.positions.length>0){const s=i.positions.length/3*4,r=new Uint8Array(s),o=new Uint8Array(s);let a=!1,n=!0;e.flagsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,r,r.length,4,t.DYNAMIC_DRAW,a),e.flags2Buf=new ArrayBuf(t,t.ARRAY_BUFFER,o,o.length,4,t.DYNAMIC_DRAW,n)}if(i.pickColors.length>0){const s=new Uint8Array(i.pickColors);let r=!1;e.pickColorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.pickColors.length,4,t.STATIC_DRAW,r)}if(this.model.scene.entityOffsetsEnabled&&i.offsets.length>0){const s=new Float32Array(i.offsets);e.offsetsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.offsets.length,3,t.DYNAMIC_DRAW)}const s=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint;if(i.indices.length>0){const r=s?new Uint32Array(i.indices):new Uint16Array(i.indices);e.indicesBuf=new ArrayBuf(t,t.ELEMENT_ARRAY_BUFFER,r,i.indices.length,1,t.STATIC_DRAW)}if(i.edgeIndices.length>0){const r=s?new Uint32Array(i.edgeIndices):new Uint16Array(i.edgeIndices);e.edgeIndicesBuf=new ArrayBuf(t,t.ELEMENT_ARRAY_BUFFER,r,i.edgeIndices.length,1,t.STATIC_DRAW)}this._state.pbrSupported=!!(e.metallicRoughnessBuf&&e.uvBuf&&e.normalsBuf&&e.textureSet&&e.textureSet.colorTexture&&e.textureSet.metallicRoughnessTexture),this._state.colorTextureSupported=!!(e.uvBuf&&e.normalsBuf&&e.textureSet&&e.textureSet.colorTexture),this._buffer=null,this._finalized=!0}isEmpty(){return!this._state.indicesBuf}initFlags(e,t,i){t&ENTITY_FLAGS.VISIBLE&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&ENTITY_FLAGS.HIGHLIGHTED&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&ENTITY_FLAGS.XRAYED&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&ENTITY_FLAGS.SELECTED&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&ENTITY_FLAGS.CLIPPABLE&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ENTITY_FLAGS.EDGES&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ENTITY_FLAGS.PICKABLE&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ENTITY_FLAGS.CULLED&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,i,true),this._setFlags2(e,t,true)}flushInitFlags(){this._setDeferredFlags(),this._setDeferredFlags2()}setVisible(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.VISIBLE?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}setHighlighted(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.HIGHLIGHTED?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}setXRayed(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.XRAYED?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}setSelected(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.SELECTED?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}setEdges(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.EDGES?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CLIPPABLE?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCulled(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CULLED?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.PICKABLE?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}setColor(e,t){if(!this._finalized)throw"Not finalized";const i=e,s=this._portions[i],r=4*s.vertsBase,o=4*s.numVerts,a=this._scratchMemory.getUInt8Array(o),n=t[0],h=t[1],l=t[2],c=t[3];for(let e=0;e<o;e+=4)a[e+0]=n,a[e+1]=h,a[e+2]=l,a[e+3]=c;this._state.colorsBuf&&this._state.colorsBuf.setData(a,r,o)}setTransparent(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}_setFlags(e,t,i,s=!1){if(!this._finalized)throw"Not finalized";const r=e,o=this._portions[r],a=4*o.vertsBase,n=4*o.numVerts,h=!!(t&ENTITY_FLAGS.VISIBLE),l=!!(t&ENTITY_FLAGS.XRAYED),c=!!(t&ENTITY_FLAGS.HIGHLIGHTED),u=!!(t&ENTITY_FLAGS.SELECTED),p=!!(t&ENTITY_FLAGS.CULLED);let d,m;d=!h||p||l?RENDER_PASSES.NOT_RENDERED:i?RENDER_PASSES.COLOR_TRANSPARENT:RENDER_PASSES.COLOR_OPAQUE,m=!h||p?RENDER_PASSES.NOT_RENDERED:u?RENDER_PASSES.SILHOUETTE_SELECTED:c?RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:l?RENDER_PASSES.SILHOUETTE_XRAYED:RENDER_PASSES.NOT_RENDERED;let f=0;f=!h||p?RENDER_PASSES.NOT_RENDERED:u?RENDER_PASSES.EDGES_SELECTED:c?RENDER_PASSES.EDGES_HIGHLIGHTED:l?RENDER_PASSES.EDGES_XRAYED:!!(t&ENTITY_FLAGS.EDGES)?i?RENDER_PASSES.EDGES_COLOR_TRANSPARENT:RENDER_PASSES.EDGES_COLOR_OPAQUE:RENDER_PASSES.NOT_RENDERED;let g=h&&!p&&!!(t&ENTITY_FLAGS.PICKABLE)?RENDER_PASSES.PICK:RENDER_PASSES.NOT_RENDERED;if(s){this._deferredFlagValues||(this._deferredFlagValues=new Uint8Array(4*this._numVerts));for(let e=a,t=a+n;e<t;e+=4)this._deferredFlagValues[e+0]=d,this._deferredFlagValues[e+1]=m,this._deferredFlagValues[e+2]=f,this._deferredFlagValues[e+3]=g}else if(this._state.flagsBuf){const e=this._scratchMemory.getUInt8Array(n);for(let t=0;t<n;t+=4)e[t+0]=d,e[t+1]=m,e[t+2]=f,e[t+3]=g;this._state.flagsBuf.setData(e,a,n)}}_setDeferredFlags(){this._deferredFlagValues&&(this._state.flagsBuf.setData(this._deferredFlagValues),this._deferredFlagValues=null)}_setFlags2(e,t,i=!1){if(!this._finalized)throw"Not finalized";const s=e,r=this._portions[s],o=4*r.vertsBase,a=4*r.numVerts,n=t&ENTITY_FLAGS.CLIPPABLE?255:0;if(i){this._setDeferredFlag2Values||(this._setDeferredFlag2Values=new Uint8Array(4*this._numVerts));for(let e=o,t=o+a;e<t;e+=4)this._setDeferredFlag2Values[e]=n}else if(this._state.flags2Buf){const e=this._scratchMemory.getUInt8Array(a);for(let t=0;t<a;t+=4)e[t+0]=n;this._state.flags2Buf.setData(e,o,a)}}_setDeferredFlags2(){this._setDeferredFlag2Values&&(this._state.flags2Buf.setData(this._setDeferredFlag2Values),this._setDeferredFlag2Values=null)}setOffset(e,t){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const i=e,s=this._portions[i],r=3*s.vertsBase,o=3*s.numVerts,a=this._scratchMemory.getFloat32Array(o),n=t[0],h=t[1],l=t[2];for(let e=0;e<o;e+=3)a[e+0]=n,a[e+1]=h,a[e+2]=l;this._state.offsetsBuf&&this._state.offsetsBuf.setData(a,r,o),this.model.scene.pickSurfacePrecisionEnabled&&(s.offset[0]=t[0],s.offset[1]=t[1],s.offset[2]=t[2])}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.colorQualityRendererWithSAO&&this._batchingRenderers.colorQualityRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRendererWithSAO&&this._batchingRenderers.colorTextureRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):this._state.normalsBuf?this._batchingRenderers.colorRendererWithSAO&&this._batchingRenderers.colorRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):this._batchingRenderers.flatColorRendererWithSAO&&this._batchingRenderers.flatColorRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.colorQualityRenderer&&this._batchingRenderers.colorQualityRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRenderer&&this._batchingRenderers.colorTextureRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}_updateBackfaceCull(e,t){const i=this.model.backfaces||!this.solid||e.sectioned;if(t.backfaces!==i){const e=t.gl;i?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),t.backfaces=i}}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.colorQualityRenderer&&this._batchingRenderers.colorQualityRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRenderer&&this._batchingRenderers.colorTextureRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT))}drawDepth(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.depthRenderer&&this._batchingRenderers.depthRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.normalsRenderer&&this._batchingRenderers.normalsRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_XRAYED))}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_HIGHLIGHTED))}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_SELECTED))}drawEdgesColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_COLOR_OPAQUE)}drawEdgesColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&0!==this._numTransparentLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_COLOR_TRANSPARENT)}drawEdgesHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_HIGHLIGHTED)}drawEdgesSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_SELECTED)}drawEdgesXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_XRAYED)}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.occlusionRenderer&&this._batchingRenderers.occlusionRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawShadow(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.shadowRenderer&&this._batchingRenderers.shadowRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickMeshRenderer&&this._batchingRenderers.pickMeshRenderer.drawLayer(t,this,RENDER_PASSES.PICK))}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickDepthRenderer&&this._batchingRenderers.pickDepthRenderer.drawLayer(t,this,RENDER_PASSES.PICK))}drawPickNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickNormalsFlatRenderer&&this._batchingRenderers.pickNormalsFlatRenderer.drawLayer(t,this,RENDER_PASSES.PICK))}precisionRayPickSurface(e,t,i,s,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state,a=this._portions[e];if(!a)return this.model.error("portion not found: "+e),!1;const n=a.quantizedPositions,h=a.indices,l=o.origin,c=a.offset,u=tempVec3a$H,p=tempVec3b$8;u.set(l?math.subVec3(t,l,tempVec3c$5):t),p.set(i),c&&math.subVec3(u,c),math.transformRay(this.model.worldNormalMatrix,u,p,u,p);const d=tempVec3d$2,m=tempVec3e$1,f=tempVec3f$1;let g=!1,_=0;const y=tempVec3g$1;for(let e=0,i=h.length;e<i;e+=3){const i=3*h[e],a=3*h[e+1],T=3*h[e+2];if(d[0]=n[i],d[1]=n[i+1],d[2]=n[i+2],m[0]=n[a],m[1]=n[a+1],m[2]=n[a+2],f[0]=n[T],f[1]=n[T+1],f[2]=n[T+2],math.decompressPosition(d,o.positionsDecodeMatrix),math.decompressPosition(m,o.positionsDecodeMatrix),math.decompressPosition(f,o.positionsDecodeMatrix),math.rayTriangleIntersect(u,p,d,m,f,y)){math.transformPoint3(this.model.worldMatrix,y,y),c&&math.addVec3(y,c),l&&math.addVec3(y,l);const e=Math.abs(math.lenVec3(math.subVec3(y,t,[])));(!g||e>_)&&(_=e,s.set(y),r&&math.triangleNormal(d,m,f,r),g=!0)}}return g&&r&&(math.transformVec3(this.model.worldNormalMatrix,r,r),math.normalizeVec3(r)),g}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.normalsBuf&&(e.normalsBuf.destroy(),e.normalsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.indicesBuf&&(e.indicesBuf.destroy(),e.indicessBuf=null),e.edgeIndicesBuf&&(e.edgeIndicesBuf.destroy(),e.edgeIndicessBuf=null),e.destroy()}}const tempVec4$3=math.vec4(),tempVec3a$G=math.vec3();class TrianglesInstancingColorRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$G);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(n.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(n.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(n.modelNormalMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal.bindArrayBuffer(h.normalsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),l.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),e.drawElements++,l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aColor.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=s.length;e<t;e++){const t=s[e];this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const s=t.sao;if(s.possible){const t=i.drawingBufferWidth,r=i.drawingBufferHeight;tempVec4$3[0]=t,tempVec4$3[1]=r,tempVec4$3[2]=s.blendCutoff,tempVec4$3[3]=s.blendFactor,i.uniform4fv(this._uSAOParams,tempVec4$3),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0;let r,o,a;const n=[];for(n.push("// Instancing geometry drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("uniform int renderPass;"),n.push("attribute vec3 position;"),n.push("attribute vec2 normal;"),n.push("attribute vec4 color;"),n.push("attribute vec4 flags;"),n.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&n.push("attribute vec3 offset;"),n.push("attribute vec4 modelMatrixCol0;"),n.push("attribute vec4 modelMatrixCol1;"),n.push("attribute vec4 modelMatrixCol2;"),n.push("attribute vec4 modelNormalMatrixCol0;"),n.push("attribute vec4 modelNormalMatrixCol1;"),n.push("attribute vec4 modelNormalMatrixCol2;"),n.push("uniform mat4 worldMatrix;"),n.push("uniform mat4 worldNormalMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 viewNormalMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("varying float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("varying float isPerspective;")),n.push("uniform vec4 lightAmbient;"),r=0,o=i.lights.length;r<o;r++)a=i.lights[r],"ambient"!==a.type&&(n.push("uniform vec4 lightColor"+r+";"),"dir"===a.type&&n.push("uniform vec3 lightDir"+r+";"),"point"===a.type&&n.push("uniform vec3 lightPos"+r+";"),"spot"===a.type&&(n.push("uniform vec3 lightPos"+r+";"),n.push("uniform vec3 lightDir"+r+";")));for(n.push("vec3 octDecode(vec2 oct) {"),n.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),n.push("    if (v.z < 0.0) {"),n.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),n.push("    }"),n.push("    return normalize(v);"),n.push("}"),s&&(n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;")),n.push("varying vec4 vColor;"),n.push("void main(void) {"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),n.push("} else {"),n.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),n.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&n.push("      worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix * worldPosition; "),n.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),n.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),n.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;"),r=0,o=i.lights.length;r<o;r++)if(a=i.lights[r],"ambient"!==a.type){if("dir"===a.type)"view"===a.space?n.push("viewLightDir = normalize(lightDir"+r+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);");else if("point"===a.type)"view"===a.space?n.push("viewLightDir = -normalize(lightPos"+r+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+r+", 0.0)).xyz);");else{if("spot"!==a.type)continue;"view"===a.space?n.push("viewLightDir = normalize(lightDir"+r+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+r+".rgb * lightColor"+r+".a);")}return n.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),n.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?n.push("vFragDepth = 1.0 + clipPos.w;"):(n.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),n.push("clipPos.z *= clipPos.w;")),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2;")),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing geometry drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),s.push("   gl_FragColor            = vec4(vColor.rgb * ambient, 1.0);")):s.push("    gl_FragColor           = vColor;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec4$2=math.vec4(),tempVec3a$F=math.vec3();class TrianglesInstancingFlatColorRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$F);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),l.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aColor.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=s.length;e<t;e++){const t=s[e];this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const s=t.sao;if(s.possible){const t=i.drawingBufferWidth,r=i.drawingBufferHeight;tempVec4$2[0]=t,tempVec4$2[1]=r,tempVec4$2[2]=s.blendCutoff,tempVec4$2[3]=s.blendFactor,i.uniform4fv(this._uSAOParams,tempVec4$2),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry flat-shading drawing vertex shader"),i.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vViewPosition = viewPosition;"),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState;let s,r;const o=t.sectionPlanes.length>0,a=[];if(a.push("// Instancing geometry flat-shading drawing fragment shader"),a.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),a.push("precision highp float;"),a.push("precision highp int;"),a.push("#else"),a.push("precision mediump float;"),a.push("precision mediump int;"),a.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(a.push("varying float isPerspective;"),a.push("uniform float logDepthBufFC;"),a.push("varying float vFragDepth;")),this._withSAO&&(a.push("uniform sampler2D uOcclusionTexture;"),a.push("uniform vec4      uSAOParams;"),a.push("const float       packUpscale = 256. / 255.;"),a.push("const float       unpackDownScale = 255. / 256.;"),a.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),a.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),a.push("float unpackRGBToFloat( const in vec4 v ) {"),a.push("    return dot( v, unPackFactors );"),a.push("}")),o){a.push("varying vec4 vWorldPosition;"),a.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)a.push("uniform bool sectionPlaneActive"+e+";"),a.push("uniform vec3 sectionPlanePos"+e+";"),a.push("uniform vec3 sectionPlaneDir"+e+";")}for(a.push("uniform mat4 viewMatrix;"),a.push("uniform vec4 lightAmbient;"),s=0,r=i.lights.length;s<r;s++){const e=i.lights[s];"ambient"!==e.type&&(a.push("uniform vec4 lightColor"+s+";"),"dir"===e.type&&a.push("uniform vec3 lightDir"+s+";"),"point"===e.type&&a.push("uniform vec3 lightPos"+s+";"),"spot"===e.type&&(a.push("uniform vec3 lightPos"+s+";"),a.push("uniform vec3 lightDir"+s+";")))}if(a.push("varying vec4 vViewPosition;"),a.push("varying vec4 vColor;"),a.push("void main(void) {"),o){a.push("  bool clippable = (float(vFlags2.x) > 0.0);"),a.push("  if (clippable) {"),a.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)a.push("if (sectionPlaneActive"+e+") {"),a.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),a.push("}");a.push("  if (dist > 0.0) { "),a.push("      discard;"),a.push("  }"),a.push("}")}for(a.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),a.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),a.push("float lambertian = 1.0;"),a.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),a.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),a.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );"),s=0,r=i.lights.length;s<r;s++){const e=i.lights[s];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?a.push("viewLightDir = normalize(lightDir"+s+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+s+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?a.push("viewLightDir = -normalize(lightPos"+s+" - viewPosition.xyz);"):a.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+s+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?a.push("viewLightDir = normalize(lightDir"+s+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+s+", 0.0)).xyz);")}a.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),a.push("reflectedColor += lambertian * (lightColor"+s+".rgb * lightColor"+s+".a);")}}return a.push("vec4 fragColor = vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(a.push("   float viewportWidth     = uSAOParams[0];"),a.push("   float viewportHeight    = uSAOParams[1];"),a.push("   float blendCutoff       = uSAOParams[2];"),a.push("   float blendFactor       = uSAOParams[3];"),a.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),a.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),a.push("   gl_FragColor            = vec4(fragColor.rgb * ambient, 1.0);")):a.push("    gl_FragColor           = fragColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("}"),a}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$E=math.vec3();class TrianglesInstancingSilhouetteRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(t.model.scene),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.SILHOUETTE_XRAYED){const e=r.xrayMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_SELECTED){const e=r.selectedMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,math.vec3([1,1,1]));a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$E);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf,a.UNSIGNED_BYTE,!0),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf,a.UNSIGNED_BYTE,!0),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing fill vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("uniform vec4 color;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing fill fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("uniform vec4 color;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = color;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$D=math.vec3(),defaultColor$2=new Float32Array([0,0,0,1]);class TrianglesInstancingEdgesRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.EDGES_XRAYED){const e=r.xrayMaterial._state,t=e.edgeColor,i=e.edgeAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.EDGES_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.edgeColor,i=e.edgeAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.EDGES_SELECTED){const e=r.selectedMaterial._state,t=e.edgeColor,i=e.edgeAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,defaultColor$2);a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$D);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags&&(this._aFlags.bindArrayBuffer(n.flagsBuf,a.UNSIGNED_BYTE,!0),l.vertexAttribDivisorANGLE(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf,a.UNSIGNED_BYTE,!0),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.edgeIndicesBuf.bind(),l.drawElementsInstancedANGLE(a.LINES,h.edgeIndicesBuf.numItems,h.edgeIndicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0),this._aFlags&&l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uColor=s.getLocation("color"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles instancing edges vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("uniform vec4 color;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(color.r, color.g, color.b, color.a);"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = vColor;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$C=math.vec3();class TrianglesInstancingEdgesColorRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$C);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),l.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags&&(this._aFlags.bindArrayBuffer(n.flagsBuf,a.UNSIGNED_BYTE,!0),l.vertexAttribDivisorANGLE(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf,a.UNSIGNED_BYTE,!0),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.edgeIndicesBuf.bind(),l.drawElementsInstancedANGLE(a.LINES,h.edgeIndicesBuf.numItems,h.edgeIndicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aColor.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0),this._aFlags&&l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles instancing edges vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = vColor;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$B=math.vec3();class TrianglesInstancingPickMeshRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=h.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i);const u=e.pickViewMatrix||o.viewMatrix,p=c?createRTCViewMat(u,c):u;if(a.uniformMatrix4fv(this._uViewMatrix,!1,p),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(n.pickColorsBuf),l.vertexAttribDivisorANGLE(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.indicesBuf.bind();const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,o=s.renderFlags;for(let t=0;t<d;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$B);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aPickColor.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._uRenderPass=s.getLocation("renderPass"),this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry picking vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 pickColor;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry picking fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = vPickColor; "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$A=math.vec3();class TrianglesInstancingPickDepthRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.canvas.gl,a=t._state,n=a.geometry,h=this._instanceExt,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram());const c=r.camera;o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||c.viewMatrix,p=l?createRTCViewMat(u,l):u;if(o.uniformMatrix4fv(this._uViewMatrix,!1,p),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,t)}const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,a=s.renderFlags;for(let t=0;t<d;t++){const s=this._uSectionPlanes[t];if(s){const r=a.sectionPlanesActivePerLayer[i+t];if(o.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$A);o.uniform3fv(s.pos,e)}else o.uniform3fv(s.pos,i.pos);o.uniform3fv(s.dir,i.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.indicesBuf.bind(),h.drawElementsInstancedANGLE(o.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("  vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry depth fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    gl_FragColor = packDepth(zNormalizedDepth); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$z=math.vec3();class TrianglesInstancingPickNormalsRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||o.viewMatrix,p=c?createRTCViewMat(u,c):u;if(a.uniformMatrix4fv(this._uViewMatrix,!1,p),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,o=s.renderFlags;for(let t=0;t<d;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$z);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(n.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(n.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(n.modelNormalMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal.bindArrayBuffer(h.normalsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry normals vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec2 normal;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("attribute vec4 modelNormalMatrixCol0;"),i.push("attribute vec4 modelNormalMatrixCol1;"),i.push("attribute vec4 modelNormalMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec3 vWorldNormal;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),i.push("  vec3 worldNormal = vec3(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2));"),i.push("  vWorldNormal = worldNormal;"),t&&i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry normals fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec3 vWorldNormal;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("if (sectionPlaneActive"+r+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$y=math.vec3();class TrianglesInstancingOcclusionRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$y);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(n.colorsBuf),l.vertexAttribDivisorANGLE(this._aColor.location,1)),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),this._aColor&&l.vertexAttribDivisorANGLE(this._aColor.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing occlusion fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$x=math.vec3();class TrianglesInstancingDepthRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$x);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry depth drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec2 vHighPrecisionZW;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vHighPrecisionZW = gl_Position.zw;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let i,s;const r=t.sectionPlanes.length>0,o=[];if(o.push("// Instancing geometry depth drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("precision highp float;"),o.push("precision highp int;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("uniform bool sectionPlaneActive"+i+";"),o.push("uniform vec3 sectionPlanePos"+i+";"),o.push("uniform vec3 sectionPlaneDir"+i+";");if(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture||(o.push("const float   packUpScale = 256. / 255.;"),o.push("const float   unpackDownscale = 255. / 256.;"),o.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),o.push("const float   shiftRight8 = 1.0 / 256.;"),o.push("vec4 packDepthToRGBA( const in float v ) {"),o.push("    vec4 r = vec4( fract( v * packFactors ), v );"),o.push("    r.yzw -= r.xyz * shiftRight8;"),o.push("    return r * packUpScale;"),o.push("}")),o.push("varying vec2 vHighPrecisionZW;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("if (sectionPlaneActive"+i+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?o.push("    gl_FragColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "):o.push("    gl_FragColor = packDepthToRGBA(fragCoordZ); "),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$w=math.vec3();class TrianglesInstancingNormalsRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,c?createRTCViewMat(o.viewMatrix,c):o.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$w);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal.bindArrayBuffer(h.normalsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aColor.bindArrayBuffer(n.colorsBuf),l.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aColor.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2&&(this._aFlags2=s.getAttribute("flags2")),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry normals drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec3 normal;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 worldNormalMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 viewNormalMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec3 vViewNormal;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),i.push("  vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("  vViewNormal = viewNormal;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing geometry depth drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$v=math.vec3();class TrianglesInstancingShadowRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){const i=t.model,s=i.scene,r=s.canvas.gl,o=t._state,a=o.geometry,n=this._instanceExt;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,t)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),n.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aColor.bindArrayBuffer(o.colorsBuf),n.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(o.flagsBuf),n.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),n.vertexAttribDivisorANGLE(this._aFlags2.location,1));const h=s._sectionPlanesState.sectionPlanes.length;if(h>0){const e=s._sectionPlanesState.sectionPlanes,o=t.layerIndex*h,a=i.renderFlags,n=t._state.origin;for(let t=0;t<h;t++){const i=this._uSectionPlanes[t];if(i){const s=a.sectionPlanesActivePerLayer[o+t];if(r.uniform1i(i.active,s?1:0),s){const s=e[t];if(n){const e=getPlaneRTCPos(s.dist,s.dir,n,tempVec3a$v);r.uniform3fv(i.pos,e)}else r.uniform3fv(i.pos,s.pos);r.uniform3fv(i.dir,s.dir)}}}}a.indicesBuf.bind(),n.drawElementsInstancedANGLE(r.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,o.numInstances),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),n.vertexAttribDivisorANGLE(this._aColor.location,0),n.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2")}_bindProgram(e,t){const i=this._scene.canvas.gl;this._program.bind(),i.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),i.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry shadow drawing vertex shader"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("bool visible      = (float(flags.x) > 0.0);"),i.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),i.push("if (!visible || transparent) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("  gl_Position = shadowProjMatrix * viewPosition;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing geometry depth drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec4$1=math.vec4(),tempVec3a$u=math.vec3(),TEXTURE_DECODE_FUNCS={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};class TrianglesInstancingColorQualityRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=WEBGL_INFO$1.MAX_TEXTURE_UNITS,r=t.model,o=this._scene,a=o.camera,n=o.canvas.gl,h=t._state,l=h.origin,c=h.textureSet,u=h.geometry,p=this._instanceExt;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,i),n.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(a.viewMatrix,l):a.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,a.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,r.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,r.worldNormalMatrix);const d=o._sectionPlanesState.sectionPlanes.length;if(d>0){const e=o._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,s=r.renderFlags;for(let t=0;t<d;t++){const r=this._uSectionPlanes[t];if(r){const o=s.sectionPlanesActivePerLayer[i+t];if(n.uniform1i(r.active,o?1:0),o){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$u);n.uniform3fv(r.pos,e)}else n.uniform3fv(r.pos,i.pos);n.uniform3fv(r.dir,i.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._uUVDecodeMatrix&&n.uniformMatrix3fv(this._uUVDecodeMatrix,!1,u.uvDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(h.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(h.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(h.modelMatrixCol2Buf),p.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),p.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),p.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(h.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(h.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(h.modelNormalMatrixCol2Buf),p.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),p.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),p.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aNormal.bindArrayBuffer(u.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(u.uvBuf),this._aColor.bindArrayBuffer(u.colorsBuf),p.vertexAttribDivisorANGLE(this._aColor.location,1),this._aMetallicRoughness.bindArrayBuffer(h.metallicRoughnessBuf),p.vertexAttribDivisorANGLE(this._aMetallicRoughness.location,1),this._aFlags.bindArrayBuffer(h.flagsBuf),p.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(h.flags2Buf),p.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(h.offsetsBuf),p.vertexAttribDivisorANGLE(this._aOffset.location,1)),c&&(this._program.bindTexture(this._uBaseColorMap,c.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uMetallicRoughMap,c.metallicRoughnessTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uEmissiveMap,c.emissiveTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uNormalMap,c.normalsTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s),u.indicesBuf.bind(),p.drawElementsInstancedANGLE(n.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,h.numInstances),e.drawElements++,p.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),p.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),p.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),p.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),p.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),p.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),p.vertexAttribDivisorANGLE(this._aColor.location,0),p.vertexAttribDivisorANGLE(this._aMetallicRoughness.location,0),p.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&p.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&p.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(var a=0,n=r.length;a<n;a++)switch(o=r[a],o.type){case"dir":this._uLightColor[a]=s.getLocation("lightColor"+a),this._uLightPos[a]=null,this._uLightDir[a]=s.getLocation("lightDir"+a);break;case"point":this._uLightColor[a]=s.getLocation("lightColor"+a),this._uLightPos[a]=s.getLocation("lightPos"+a),this._uLightDir[a]=null,this._uLightAttenuation[a]=s.getLocation("lightAttenuation"+a);break;case"spot":this._uLightColor[a]=s.getLocation("lightColor"+a),this._uLightPos[a]=s.getLocation("lightPos"+a),this._uLightDir[a]=s.getLocation("lightDir"+a),this._uLightAttenuation[a]=s.getLocation("lightAttenuation"+a)}i.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),i.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aNormal=s.getAttribute("normal"),this._aUV=s.getAttribute("uv"),this._aColor=s.getAttribute("color"),this._aMetallicRoughness=s.getAttribute("metallicRoughness"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._uBaseColorMap="uBaseColorMap",this._uMetallicRoughMap="uMetallicRoughMap",this._uEmissiveMap="uEmissiveMap",this._uNormalMap="uNormalMap",this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=WEBGL_INFO$1.MAX_TEXTURE_UNITS,i=this._scene,s=i.canvas.gl,r=i._lightsState,o=r.lights,a=i.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,a.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,i._lightsState.getAmbientColorAndIntensity());for(let e=0,t=o.length;e<t;e++){const t=o[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(r.reflectionMaps.length>0&&r.reflectionMaps[0].texture&&this._uReflectionMap&&(this._program.bindTexture(this._uReflectionMap,r.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),r.lightMaps.length>0&&r.lightMaps[0].texture&&this._uLightMap&&(this._program.bindTexture(this._uLightMap,r.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),this._withSAO){const r=i.sao;if(r.possible){const i=s.drawingBufferWidth,o=s.drawingBufferHeight;tempVec4$1[0]=i,tempVec4$1[1]=o,tempVec4$1[2]=r.blendCutoff,tempVec4$1[3]=r.blendFactor,s.uniform4fv(this._uSAOParams,tempVec4$1),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++}}if(i.logarithmicDepthBufferEnabled){const e=2/(Math.log(a.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,i.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0,r=t.clippingCaps,o=[];return o.push("// Instancing geometry quality drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#extension GL_OES_standard_derivatives : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec2 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec2 uv;"),o.push("attribute vec2 metallicRoughness;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("attribute vec4 modelMatrixCol0;"),o.push("attribute vec4 modelMatrixCol1;"),o.push("attribute vec4 modelMatrixCol2;"),o.push("attribute vec4 modelNormalMatrixCol0;"),o.push("attribute vec4 modelNormalMatrixCol1;"),o.push("attribute vec4 modelNormalMatrixCol2;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),o.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("varying vec4 vViewPosition;"),o.push("varying vec3 vViewNormal;"),o.push("varying vec4 vColor;"),o.push("varying vec2 vUV;"),o.push("varying vec2 vMetallicRoughness;"),i.lightMaps.length>0&&o.push("varying vec3 vWorldNormal;"),s&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),r&&o.push("varying vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),o.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&o.push("      worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),o.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),o.push("vec3 viewNormal = vec4(viewNormalMatrix * worldNormal).xyz;"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;")),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),o.push("vMetallicRoughness = metallicRoughness;"),i.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,i=e._sectionPlanesState,s=e._lightsState,r=i.sectionPlanes.length>0,o=i.clippingCaps,a=[];a.push("// Instancing geometry quality drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("#extension GL_OES_standard_derivatives : enable"),a.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),a.push("precision highp float;"),a.push("precision highp int;"),a.push("#else"),a.push("precision mediump float;"),a.push("precision mediump int;"),a.push("#endif"),e.logarithmicDepthBufferEnabled&&(a.push("varying float isPerspective;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(a.push("uniform float logDepthBufFC;"),a.push("varying float vFragDepth;"))),a.push("uniform sampler2D uBaseColorMap;"),a.push("uniform sampler2D uMetallicRoughMap;"),a.push("uniform sampler2D uEmissiveMap;"),a.push("uniform sampler2D uNormalMap;"),this._withSAO&&(a.push("uniform sampler2D uOcclusionTexture;"),a.push("uniform vec4      uSAOParams;"),a.push("const float       packUpscale = 256. / 255.;"),a.push("const float       unpackDownScale = 255. / 256.;"),a.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),a.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),a.push("float unpackRGBAToDepth( const in vec4 v ) {"),a.push("    return dot( v, unPackFactors );"),a.push("}")),s.reflectionMaps.length>0&&a.push("uniform samplerCube reflectionMap;"),s.lightMaps.length>0&&a.push("uniform samplerCube lightMap;"),a.push("uniform vec4 lightAmbient;");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];"ambient"!==t.type&&(a.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&a.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&a.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(a.push("uniform vec3 lightPos"+e+";"),a.push("uniform vec3 lightDir"+e+";")))}if(a.push("uniform float gammaFactor;"),a.push("vec4 linearToLinear( in vec4 value ) {"),a.push("  return value;"),a.push("}"),a.push("vec4 sRGBToLinear( in vec4 value ) {"),a.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),a.push("}"),a.push("vec4 gammaToLinear( in vec4 value) {"),a.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),a.push("}"),t&&(a.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),a.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),a.push("}")),r){a.push("varying vec4 vWorldPosition;"),a.push("varying vec4 vFlags2;"),o&&a.push("varying vec4 vClipPosition;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)a.push("uniform bool sectionPlaneActive"+e+";"),a.push("uniform vec3 sectionPlanePos"+e+";"),a.push("uniform vec3 sectionPlaneDir"+e+";")}if(a.push("varying vec4 vViewPosition;"),a.push("varying vec3 vViewNormal;"),a.push("varying vec4 vColor;"),a.push("varying vec2 vUV;"),a.push("varying vec2 vMetallicRoughness;"),s.lightMaps.length>0&&a.push("varying vec3 vWorldNormal;"),a.push("uniform mat4 viewMatrix;"),a.push("#define PI 3.14159265359"),a.push("#define RECIPROCAL_PI 0.31830988618"),a.push("#define RECIPROCAL_PI2 0.15915494"),a.push("#define EPSILON 1e-6"),a.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),a.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),a.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),a.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),a.push("      vec2 st0 = dFdx( uv.st );"),a.push("      vec2 st1 = dFdy( uv.st );"),a.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),a.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),a.push("      vec3 N = normalize( surf_norm );"),a.push("      vec3 mapN = texture2D( uNormalMap, uv ).xyz * 2.0 - 1.0;"),a.push("      mat3 tsn = mat3( S, T, N );"),a.push("      return normalize( tsn * mapN );"),a.push("}"),a.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),a.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),a.push("}"),a.push("struct IncidentLight {"),a.push("   vec3 color;"),a.push("   vec3 direction;"),a.push("};"),a.push("struct ReflectedLight {"),a.push("   vec3 diffuse;"),a.push("   vec3 specular;"),a.push("};"),a.push("struct Geometry {"),a.push("   vec3 position;"),a.push("   vec3 viewNormal;"),a.push("   vec3 worldNormal;"),a.push("   vec3 viewEyeDir;"),a.push("};"),a.push("struct Material {"),a.push("   vec3    diffuseColor;"),a.push("   float   specularRoughness;"),a.push("   vec3    specularColor;"),a.push("   float   shine;"),a.push("};"),a.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),a.push("   float r = ggxRoughness + 0.0001;"),a.push("   return (2.0 / (r * r) - 2.0);"),a.push("}"),a.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),a.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),a.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),a.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),a.push("}"),s.reflectionMaps.length>0&&(a.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),a.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),a.push("   vec3 envMapColor = "+TEXTURE_DECODE_FUNCS[s.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),a.push("  return envMapColor;"),a.push("}")),a.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),a.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),a.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),a.push("}"),a.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),a.push("   float a2 = ( alpha * alpha );"),a.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),a.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),a.push("   return 1.0 / ( gl * gv );"),a.push("}"),a.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),a.push("   float a2 = ( alpha * alpha );"),a.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),a.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),a.push("   return 0.5 / max( gv + gl, EPSILON );"),a.push("}"),a.push("float D_GGX(const in float alpha, const in float dotNH) {"),a.push("   float a2 = ( alpha * alpha );"),a.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),a.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),a.push("}"),a.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),a.push("   float alpha = ( roughness * roughness );"),a.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),a.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),a.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),a.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),a.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),a.push("   vec3  F = F_Schlick( specularColor, dotLH );"),a.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),a.push("   float D = D_GGX( alpha, dotNH );"),a.push("   return F * (G * D);"),a.push("}"),a.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),a.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),a.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),a.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),a.push("   vec4 r = roughness * c0 + c1;"),a.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),a.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),a.push("   return specularColor * AB.x + AB.y;"),a.push("}"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&(a.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),s.lightMaps.length>0&&(a.push("   vec3 irradiance = "+TEXTURE_DECODE_FUNCS[s.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),a.push("   irradiance *= PI;"),a.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),a.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),s.reflectionMaps.length>0&&(a.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),a.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),a.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),a.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),a.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),a.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),a.push("}")),a.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),a.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),a.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),a.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),a.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),a.push("}"),a.push("void main(void) {"),r){a.push("  bool clippable = (float(vFlags2.x) > 0.0);"),a.push("  if (clippable) {"),a.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)a.push("if (sectionPlaneActive"+e+") {"),a.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),a.push("}");o?(a.push("  if (dist > (0.002 * vClipPosition.w)) {"),a.push("      discard;"),a.push("  }"),a.push("  if (dist > 0.0) { "),a.push("      gl_FragColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("  gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("  return;"),a.push("}")):(a.push("  if (dist > 0.0) { "),a.push("      discard;"),a.push("  }")),a.push("}")}a.push("IncidentLight  light;"),a.push("Material       material;"),a.push("Geometry       geometry;"),a.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),a.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),a.push("float alpha = float(vColor.a) / 255.0;"),a.push("vec3  baseColor = rgb;"),a.push("float specularF0 = 1.0;"),a.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),a.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),a.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),a.push("vec4 baseColorTexel = texture2D(uBaseColorMap, vUV);"),a.push("baseColor = baseColorTexel.rgb;"),a.push("opacity = 1.0;"),a.push("vec3 metalRoughTexel = texture2D(uMetallicRoughMap, vUV).rgb;"),a.push("metallic = metalRoughTexel.r;"),a.push("roughness = metalRoughTexel.g;"),a.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition.xyz, normalize(vViewNormal), vUV );"),a.push("material.baseColor      = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),a.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),a.push("material.specularColor     = mix(vec3(dielectricSpecular), baseColor, metallic);"),a.push("geometry.position      = vViewPosition.xyz;"),a.push("geometry.viewNormal    = -normalize(vViewNormal);"),a.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),s.lightMaps.length>0&&a.push("geometry.worldNormal   = normalize(vWorldNormal);"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&a.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?a.push("light.direction = normalize(lightDir"+e+");"):a.push("light.direction = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?a.push("light.direction = normalize(lightPos"+e+" - vViewPosition.xyz);"):a.push("light.direction = normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?a.push("light.direction = normalize(lightDir"+e+");"):a.push("light.direction = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}a.push("light.color =  lightColor"+e+".rgb * lightColor"+e+".a;"),a.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return a.push("vec3 emissiveColor = linearToLinear(texture2D(uEmissiveMap, vUV)).rgb;"),a.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * baseColor * alpha * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular) + emissiveColor;"),a.push("vec4 fragColor;"),this._withSAO?(a.push("   float viewportWidth     = uSAOParams[0];"),a.push("   float viewportHeight    = uSAOParams[1];"),a.push("   float blendCutoff       = uSAOParams[2];"),a.push("   float blendFactor       = uSAOParams[3];"),a.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),a.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),a.push("   fragColor            = vec4(outgoingLight.rgb * ambient, alpha);")):a.push("   fragColor            = vec4(outgoingLight.rgb, alpha);"),t&&a.push("fragColor = linearToGamma(fragColor, gammaFactor);"),a.push("gl_FragColor = fragColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("}"),a}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$t=math.vec3();class TrianglesInstancingPickNormalsFlatRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=n.geometry,l=this._instanceExt,c=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||o.viewMatrix,p=c?createRTCViewMat(u,c):u;if(a.uniformMatrix4fv(this._uViewMatrix,!1,p),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,o=s.renderFlags;for(let t=0;t<d;t++){const s=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(c){const e=getPlaneRTCPos(i.dist,i.dir,c,tempVec3a$t);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),l.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),l.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),l.vertexAttribDivisorANGLE(this._aOffset.location,1)),h.indicesBuf.bind(),l.drawElementsInstancedANGLE(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,n.numInstances),l.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),l.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),l.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&l.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&l.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry normals vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&i.push("varying vec4 vFlags2;"),i.push("varying vec4 vWorldPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry normals fragment shader"),s.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("varying vec4 vWorldPosition;"),i){s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec3 vWorldNormal;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("if (sectionPlaneActive"+r+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),s.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),s.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),s.push("  gl_FragColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec4=math.vec4(),tempVec3a$s=math.vec3();class TrianglesInstancingColorTextureRenderer{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,i){const s=WEBGL_INFO$1.MAX_TEXTURE_UNITS,r=t.model,o=r.scene,a=o.camera,n=o.canvas.gl,h=t._state,l=h.geometry,c=this._instanceExt,u=t._state.origin,p=h.textureSet;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,i),n.uniformMatrix4fv(this._uViewMatrix,!1,u?createRTCViewMat(a.viewMatrix,u):a.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,a.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,r.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,r.worldNormalMatrix);const d=o._sectionPlanesState.sectionPlanes.length;if(d>0){const e=o._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,s=r.renderFlags;for(let t=0;t<d;t++){const r=this._uSectionPlanes[t];if(r){const o=s.sectionPlanesActivePerLayer[i+t];if(n.uniform1i(r.active,o?1:0),o){const i=e[t];if(u){const e=getPlaneRTCPos(i.dist,i.dir,u,tempVec3a$s);n.uniform3fv(r.pos,e)}else n.uniform3fv(r.pos,i.pos);n.uniform3fv(r.dir,i.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._uUVDecodeMatrix&&n.uniformMatrix3fv(this._uUVDecodeMatrix,!1,l.uvDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(h.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(h.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(h.modelMatrixCol2Buf),c.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),c.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),c.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(h.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(h.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(h.modelNormalMatrixCol2Buf),c.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),c.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),c.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aNormal.bindArrayBuffer(l.normalsBuf),this._aUV.bindArrayBuffer(l.uvBuf),this._aColor.bindArrayBuffer(h.colorsBuf),c.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(h.flagsBuf),c.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(h.flags2Buf),c.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(h.offsetsBuf),c.vertexAttribDivisorANGLE(this._aOffset.location,1)),l.indicesBuf.bind(),c.drawElementsInstancedANGLE(n.TRIANGLES,l.indicesBuf.numItems,l.indicesBuf.itemType,0,h.numInstances),e.drawElements++,c.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),c.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),c.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),c.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),c.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),c.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),c.vertexAttribDivisorANGLE(this._aColor.location,0),c.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&c.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&c.vertexAttribDivisorANGLE(this._aOffset.location,0),p&&p.colorTexture&&(this._program.bindTexture(this._uColorMap,p.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=i.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=s.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=s.getLocation("lightColor"+e),this._uLightPos[e]=s.getLocation("lightPos"+e),this._uLightDir[e]=s.getLocation("lightDir"+e),this._uLightAttenuation[e]=s.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aUV=s.getAttribute("uv"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),this._uColorMap="uColorMap",this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=s.length;e<t;e++){const t=s[e];this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const s=t.sao;if(s.possible){const t=i.drawingBufferWidth,r=i.drawingBufferHeight;tempVec4[0]=t,tempVec4[1]=r,tempVec4[2]=s.blendCutoff,tempVec4[3]=s.blendFactor,i.uniform4fv(this._uSAOParams,tempVec4),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0;let r,o,a;const n=[];for(n.push("// Instancing geometry drawing vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("uniform int renderPass;"),n.push("attribute vec3 position;"),n.push("attribute vec2 normal;"),n.push("attribute vec4 color;"),n.push("attribute vec2 uv;"),n.push("attribute vec4 flags;"),n.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&n.push("attribute vec3 offset;"),n.push("attribute vec4 modelMatrixCol0;"),n.push("attribute vec4 modelMatrixCol1;"),n.push("attribute vec4 modelMatrixCol2;"),n.push("attribute vec4 modelNormalMatrixCol0;"),n.push("attribute vec4 modelNormalMatrixCol1;"),n.push("attribute vec4 modelNormalMatrixCol2;"),n.push("uniform mat4 worldMatrix;"),n.push("uniform mat4 worldNormalMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 viewNormalMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform mat4 positionsDecodeMatrix;"),n.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("varying float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("varying float isPerspective;")),n.push("uniform vec4 lightAmbient;"),r=0,o=i.lights.length;r<o;r++)a=i.lights[r],"ambient"!==a.type&&(n.push("uniform vec4 lightColor"+r+";"),"dir"===a.type&&n.push("uniform vec3 lightDir"+r+";"),"point"===a.type&&n.push("uniform vec3 lightPos"+r+";"),"spot"===a.type&&(n.push("uniform vec3 lightPos"+r+";"),n.push("uniform vec3 lightDir"+r+";")));for(n.push("vec3 octDecode(vec2 oct) {"),n.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),n.push("    if (v.z < 0.0) {"),n.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),n.push("    }"),n.push("    return normalize(v);"),n.push("}"),s&&(n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;")),n.push("varying vec4 vColor;"),n.push("varying vec2 vUV;"),n.push("void main(void) {"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),n.push("} else {"),n.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),n.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&n.push("      worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix * worldPosition; "),n.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),n.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),n.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;"),r=0,o=i.lights.length;r<o;r++)if(a=i.lights[r],"ambient"!==a.type){if("dir"===a.type)"view"===a.space?n.push("viewLightDir = normalize(lightDir"+r+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);");else if("point"===a.type)"view"===a.space?n.push("viewLightDir = -normalize(lightPos"+r+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+r+", 0.0)).xyz);");else{if("spot"!==a.type)continue;"view"===a.space?n.push("viewLightDir = normalize(lightDir"+r+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+r+".rgb * lightColor"+r+".a);")}return n.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),n.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),n.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?n.push("vFragDepth = 1.0 + clipPos.w;"):(n.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),n.push("clipPos.z *= clipPos.w;")),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2;")),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing geometry drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("uniform sampler2D uColorMap;"),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("varying vec2 vUV;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("vec4 colorTexel = texture2D(uColorMap, vUV);"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),s.push("   gl_FragColor            = vec4(vColor.rgb * colorTexel.rgb * ambient, 1.0);")):s.push("   gl_FragColor            = vec4(colorTexel.rgb, 1.0);"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class TrianglesInstancingRenderers{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorQualityRenderer&&!this._colorQualityRenderer.getValid()&&(this._colorQualityRenderer.destroy(),this._colorQualityRenderer=null),this._colorQualityRendererWithSAO&&!this._colorQualityRendererWithSAO.getValid()&&(this._colorQualityRendererWithSAO.destroy(),this._colorQualityRendererWithSAO=null),this._colorTextureRenderer&&!this._colorTextureRenderer.getValid()&&(this._colorTextureRenderer.destroy(),this._colorTextureRenderer=null),this._colorTextureRendererWithSAO&&!this._colorTextureRendererWithSAO.getValid()&&(this._colorTextureRendererWithSAO.destroy(),this._colorTextureRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new TrianglesInstancingColorRenderer(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new TrianglesInstancingColorRenderer(this._scene,!0)),this._colorRendererWithSAO}get flatColorRenderer(){return this._flatColorRenderer||(this._flatColorRenderer=new TrianglesInstancingFlatColorRenderer(this._scene,!1)),this._flatColorRenderer}get flatColorRendererWithSAO(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new TrianglesInstancingFlatColorRenderer(this._scene,!0)),this._flatColorRendererWithSAO}get colorQualityRenderer(){return this._colorQualityRenderer||(this._colorQualityRenderer=new TrianglesInstancingColorQualityRenderer(this._scene,!1)),this._colorQualityRenderer}get colorQualityRendererWithSAO(){return this._colorQualityRendererWithSAO||(this._colorQualityRendererWithSAO=new TrianglesInstancingColorQualityRenderer(this._scene,!0)),this._colorQualityRendererWithSAO}get colorTextureRenderer(){return this._colorTextureRenderer||(this._colorTextureRenderer=new TrianglesInstancingColorTextureRenderer(this._scene,!1)),this._colorTextureRenderer}get colorTextureRendererWithSAO(){return this._colorTextureRendererWithSAO||(this._colorTextureRendererWithSAO=new TrianglesInstancingColorTextureRenderer(this._scene,!0)),this._colorTextureRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new TrianglesInstancingSilhouetteRenderer(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new TrianglesInstancingDepthRenderer(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new TrianglesInstancingNormalsRenderer(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new TrianglesInstancingEdgesRenderer(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new TrianglesInstancingEdgesColorRenderer(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new TrianglesInstancingPickMeshRenderer(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new TrianglesInstancingPickNormalsRenderer(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new TrianglesInstancingPickNormalsFlatRenderer(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new TrianglesInstancingPickDepthRenderer(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new TrianglesInstancingOcclusionRenderer(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new TrianglesInstancingShadowRenderer(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorQualityRenderer&&this._colorQualityRenderer.destroy(),this._colorQualityRendererWithSAO&&this._colorQualityRendererWithSAO.destroy(),this._colorTextureRenderer&&this._colorTextureRenderer.destroy(),this._colorTextureRendererWithSAO&&this._colorTextureRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const cachedRenderers$4={};function getInstancingRenderers$1(e){const t=e.id;let i=cachedRenderers$4[t];return i||(i=new TrianglesInstancingRenderers(e),cachedRenderers$4[t]=i,i._compile(),e.on("compile",(()=>{i._compile()})),e.on("destroyed",(()=>{delete cachedRenderers$4[t],i._destroy()}))),i}const tempUint8Vec4$2=new Uint8Array(4),tempVec4a$8=math.vec4([0,0,0,1]),tempVec4b$8=math.vec4([0,0,0,1]),tempVec4c$6=math.vec4([0,0,0,1]),tempVec3fa$2=new Float32Array(3),tempVec3a$r=math.vec3(),tempVec3b$7=math.vec3(),tempVec3c$4=math.vec3(),tempVec3d$1=math.vec3(),tempVec3e=math.vec3(),tempVec3f=math.vec3(),tempVec3g=math.vec3();class TrianglesInstancingLayer{constructor(e){this.model=e.model,this.sortId="TrianglesInstancingLayer"+(e.solid?"-solid":"-surface")+(e.normals?"-normals":"-autoNormals"),this.layerIndex=e.layerIndex,this._instancingRenderers=getInstancingRenderers$1(e.model.scene),this._aabb=math.collapseAABB3();const t={numInstances:0,obb:math.OBB3(),origin:math.vec3(),geometry:e.geometry,textureSet:e.textureSet,pbrSupported:!1};this._state=new RenderState(t),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.geometry.numIndices,this._colors=[],this._metallicRoughness=[],this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[],this._portions=[],e.origin&&this._state.origin.set(e.origin),this._finalized=!1,this.aabb=math.collapseAABB3(),this.solid=!!e.solid}createPortion(e){const t=e.color,i=e.metallic,s=e.roughness,r=e.opacity,o=e.meshMatrix,a=e.worldMatrix,n=e.aabb,h=e.pickColor;if(this._finalized)throw"Already finalized";const l=t[0],c=t[1],u=t[2];if(t[3],this._colors.push(l),this._colors.push(c),this._colors.push(u),this._colors.push(r),this._metallicRoughness.push(null!=i?i:0),this._metallicRoughness.push(null!=s?s:255),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(o[0]),this._modelMatrixCol0.push(o[4]),this._modelMatrixCol0.push(o[8]),this._modelMatrixCol0.push(o[12]),this._modelMatrixCol1.push(o[1]),this._modelMatrixCol1.push(o[5]),this._modelMatrixCol1.push(o[9]),this._modelMatrixCol1.push(o[13]),this._modelMatrixCol2.push(o[2]),this._modelMatrixCol2.push(o[6]),this._modelMatrixCol2.push(o[10]),this._modelMatrixCol2.push(o[14]),this._state.geometry.normalsBuf){let e=math.transposeMat4(o,math.mat4()),t=math.inverseMat4(e);this._modelNormalMatrixCol0.push(t[0]),this._modelNormalMatrixCol0.push(t[4]),this._modelNormalMatrixCol0.push(t[8]),this._modelNormalMatrixCol0.push(t[12]),this._modelNormalMatrixCol1.push(t[1]),this._modelNormalMatrixCol1.push(t[5]),this._modelNormalMatrixCol1.push(t[9]),this._modelNormalMatrixCol1.push(t[13]),this._modelNormalMatrixCol2.push(t[2]),this._modelNormalMatrixCol2.push(t[6]),this._modelNormalMatrixCol2.push(t[10]),this._modelNormalMatrixCol2.push(t[14])}this._pickColors.push(h[0]),this._pickColors.push(h[1]),this._pickColors.push(h[2]),this._pickColors.push(h[3]),math.collapseAABB3(n);const p=this._state.geometry.obb,d=p.length;for(let e=0;e<d;e+=4)tempVec4a$8[0]=p[e+0],tempVec4a$8[1]=p[e+1],tempVec4a$8[2]=p[e+2],math.transformPoint4(o,tempVec4a$8,tempVec4b$8),a?(math.transformPoint4(a,tempVec4b$8,tempVec4c$6),math.expandAABB3Point3(n,tempVec4c$6)):math.expandAABB3Point3(n,tempVec4b$8);if(this._state.origin){const e=this._state.origin;n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[0],n[4]+=e[1],n[5]+=e[2]}math.expandAABB3(this.aabb,n),this._state.numInstances++;const m=this._portions.length,f={};return this.model.scene.pickSurfacePrecisionEnabled&&(f.matrix=o.slice(),f.inverseMatrix=null,f.normalMatrix=null),this._portions.push(f),this._numPortions++,this.model.numPortions++,m}finalize(){if(this._finalized)throw"Already finalized";const e=this._state,t=e.geometry,i=e.textureSet,s=this.model.scene.canvas.gl,r=this._colors.length,o=r;if(r>0){let e=!1;this._state.colorsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,s.DYNAMIC_DRAW,e),this._colors=[]}if(this._metallicRoughness.length>0){const e=new Uint8Array(this._metallicRoughness);let t=!1;this._state.metallicRoughnessBuf=new ArrayBuf(s,s.ARRAY_BUFFER,e,this._metallicRoughness.length,2,s.STATIC_DRAW,t)}if(o>0){let e=!1,t=!0;this._state.flagsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,new Uint8Array(o),o,4,s.DYNAMIC_DRAW,e),this._state.flags2Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Uint8Array(o),o,4,s.DYNAMIC_DRAW,t)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const e=!1;this._state.offsetsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,s.DYNAMIC_DRAW,e),this._offsets=[]}if(this._modelMatrixCol0.length>0){const e=!1;this._state.modelMatrixCol0Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,s.STATIC_DRAW,e),this._state.modelMatrixCol1Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,s.STATIC_DRAW,e),this._state.modelMatrixCol2Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,s.STATIC_DRAW,e),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._state.geometry.normalsBuf&&(this._state.modelNormalMatrixCol0Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol0),this._modelNormalMatrixCol0.length,4,s.STATIC_DRAW,e),this._state.modelNormalMatrixCol1Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol1),this._modelNormalMatrixCol1.length,4,s.STATIC_DRAW,e),this._state.modelNormalMatrixCol2Buf=new ArrayBuf(s,s.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol2),this._modelNormalMatrixCol2.length,4,s.STATIC_DRAW,e),this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[])}if(this._pickColors.length>0){const e=!1;this._state.pickColorsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,s.STATIC_DRAW,e),this._pickColors=[]}this._state.pbrSupported=!!(e.metallicRoughnessBuf&&t.uvBuf&&t.normalsBuf&&i&&i.colorTexture&&i.metallicRoughnessTexture),this._state.colorTextureSupported=!!(t.uvBuf&&t.normalsBuf&&i&&i.colorTexture),this._finalized=!0}initFlags(e,t,i){t&ENTITY_FLAGS.VISIBLE&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&ENTITY_FLAGS.HIGHLIGHTED&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&ENTITY_FLAGS.XRAYED&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&ENTITY_FLAGS.SELECTED&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&ENTITY_FLAGS.CLIPPABLE&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ENTITY_FLAGS.EDGES&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ENTITY_FLAGS.PICKABLE&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ENTITY_FLAGS.CULLED&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}setVisible(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.VISIBLE?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}setHighlighted(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.HIGHLIGHTED?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}setXRayed(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.XRAYED?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}setSelected(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.SELECTED?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}setEdges(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.EDGES?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CLIPPABLE?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.PICKABLE?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,i)}setCulled(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CULLED?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}setColor(e,t){if(!this._finalized)throw"Not finalized";tempUint8Vec4$2[0]=t[0],tempUint8Vec4$2[1]=t[1],tempUint8Vec4$2[2]=t[2],tempUint8Vec4$2[3]=t[3],this._state.colorsBuf&&this._state.colorsBuf.setData(tempUint8Vec4$2,4*e,4)}setTransparent(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}_setFlags(e,t,i){if(!this._finalized)throw"Not finalized";const s=!!(t&ENTITY_FLAGS.VISIBLE),r=!!(t&ENTITY_FLAGS.XRAYED),o=!!(t&ENTITY_FLAGS.HIGHLIGHTED),a=!!(t&ENTITY_FLAGS.SELECTED),n=!!(t&ENTITY_FLAGS.CULLED);let h,l;h=!s||n||r?RENDER_PASSES.NOT_RENDERED:i?RENDER_PASSES.COLOR_TRANSPARENT:RENDER_PASSES.COLOR_OPAQUE,l=!s||n?RENDER_PASSES.NOT_RENDERED:a?RENDER_PASSES.SILHOUETTE_SELECTED:o?RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:r?RENDER_PASSES.SILHOUETTE_XRAYED:RENDER_PASSES.NOT_RENDERED;let c=0;c=!s||n?RENDER_PASSES.NOT_RENDERED:a?RENDER_PASSES.EDGES_SELECTED:o?RENDER_PASSES.EDGES_HIGHLIGHTED:r?RENDER_PASSES.EDGES_XRAYED:!!(t&ENTITY_FLAGS.EDGES)?i?RENDER_PASSES.EDGES_COLOR_TRANSPARENT:RENDER_PASSES.EDGES_COLOR_OPAQUE:RENDER_PASSES.NOT_RENDERED;let u=s&&!n&&!!(t&ENTITY_FLAGS.PICKABLE)?RENDER_PASSES.PICK:RENDER_PASSES.NOT_RENDERED;tempUint8Vec4$2[0]=h,tempUint8Vec4$2[1]=l,tempUint8Vec4$2[2]=c,tempUint8Vec4$2[3]=u,this._state.flagsBuf&&this._state.flagsBuf.setData(tempUint8Vec4$2,4*e,4)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const i=t&ENTITY_FLAGS.CLIPPABLE?255:0;tempUint8Vec4$2[0]=i,this._state.flags2Buf&&this._state.flags2Buf.setData(tempUint8Vec4$2,4*e,4)}setOffset(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(tempVec3fa$2[0]=t[0],tempVec3fa$2[1]=t[1],tempVec3fa$2[2]=t[2],this._state.offsetsBuf&&this._state.offsetsBuf.setData(tempVec3fa$2,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(e,t){if(this._numCulledLayerPortions===this._numPortions||0===this._numVisibleLayerPortions||this._numTransparentLayerPortions===this._numPortions||this._numXRayedLayerPortions===this._numPortions)return;this._updateBackfaceCull(e,t);const i=this._state.geometry;t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled&&i.normalsBuf?this._instancingRenderers.colorQualityRendererWithSAO&&this._instancingRenderers.colorQualityRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRendererWithSAO&&this._instancingRenderers.colorTextureRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):i.normalsBuf?this._instancingRenderers.colorRendererWithSAO&&this._instancingRenderers.colorRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):this._instancingRenderers.flatColorRendererWithSAO&&this._instancingRenderers.flatColorRendererWithSAO.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):t.pbrEnabled&&this.model.pbrEnabled&&i.normalsBuf?this._instancingRenderers.colorQualityRenderer&&this._instancingRenderers.colorQualityRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRenderer&&this._instancingRenderers.colorTextureRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):i.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}_updateBackfaceCull(e,t){const i=this.model.backfaces||!this.solid||e.sectioned;if(t.backfaces!==i){const e=t.gl;i?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),t.backfaces=i}}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled&&this._state.geometry.normalsBuf?this._instancingRenderers.colorQualityRenderer&&this._instancingRenderers.colorQualityRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT):this._state.geometry.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT))}drawDepth(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.depthRenderer&&this._instancingRenderers.depthRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.normalsRenderer&&this._instancingRenderers.normalsRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_XRAYED))}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_HIGHLIGHTED))}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_SELECTED))}drawEdgesColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_COLOR_OPAQUE)}drawEdgesColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_COLOR_TRANSPARENT)}drawEdgesXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_XRAYED)}drawEdgesHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_HIGHLIGHTED)}drawEdgesSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,RENDER_PASSES.EDGES_SELECTED)}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.occlusionRenderer&&this._instancingRenderers.occlusionRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawShadow(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.shadowRenderer&&this._instancingRenderers.shadowRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE))}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickMeshRenderer&&this._instancingRenderers.pickMeshRenderer.drawLayer(t,this,RENDER_PASSES.PICK))}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickDepthRenderer&&this._instancingRenderers.pickDepthRenderer.drawLayer(t,this,RENDER_PASSES.PICK))}drawPickNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickNormalsRenderer&&this._instancingRenderers.pickNormalsRenderer.drawLayer(t,this,RENDER_PASSES.PICK))}precisionRayPickSurface(e,t,i,s,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state.geometry,a=this._state,n=this._portions[e];if(!n)return this.model.error("portion not found: "+e),!1;n.inverseMatrix||(n.inverseMatrix=math.inverseMat4(n.matrix,math.mat4())),r&&!n.normalMatrix&&(n.normalMatrix=math.transposeMat4(n.inverseMatrix,math.mat4()));const h=o.quantizedPositions,l=o.indices,c=a.origin,u=n.offset,p=tempVec3a$r,d=tempVec3b$7;p.set(c?math.subVec3(t,c,tempVec3c$4):t),d.set(i),u&&math.subVec3(p,u),math.transformRay(this.model.worldNormalMatrix,p,d,p,d),math.transformRay(n.inverseMatrix,p,d,p,d);const m=tempVec3d$1,f=tempVec3e,g=tempVec3f;let _=!1,y=0;const T=tempVec3g;for(let e=0,i=l.length;e<i;e+=3){const i=3*l[e+0],o=3*l[e+1],v=3*l[e+2];if(m[0]=h[i],m[1]=h[i+1],m[2]=h[i+2],f[0]=h[o],f[1]=h[o+1],f[2]=h[o+2],g[0]=h[v],g[1]=h[v+1],g[2]=h[v+2],math.decompressPosition(m,a.positionsDecodeMatrix),math.decompressPosition(f,a.positionsDecodeMatrix),math.decompressPosition(g,a.positionsDecodeMatrix),math.rayTriangleIntersect(p,d,m,f,g,T)){math.transformPoint3(n.matrix,T,T),math.transformPoint3(this.model.worldMatrix,T,T),u&&math.addVec3(T,u),c&&math.addVec3(T,c);const e=Math.abs(math.lenVec3(math.subVec3(T,t,[])));(!_||e>y)&&(y=e,s.set(T),r&&math.triangleNormal(m,f,g,r),_=!0)}}return _&&r&&(math.transformVec3(n.normalMatrix,r,r),math.transformVec3(this.model.worldNormalMatrix,r,r),math.normalizeVec3(r)),_}destroy(){const e=this._state;e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.modelNormalMatrixCol0Buf&&(e.modelNormalMatrixCol0Buf.destroy(),e.modelNormalMatrixCol0Buf=null),e.modelNormalMatrixCol1Buf&&(e.modelNormalMatrixCol1Buf.destroy(),e.modelNormalMatrixCol1Buf=null),e.modelNormalMatrixCol2Buf&&(e.modelNormalMatrixCol2Buf.destroy(),e.modelNormalMatrixCol2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}const tempVec3a$q=math.vec3();class LinesBatchingColorRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=this._scene,r=s.camera,o=t.model,a=s.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(r.viewMatrix,h):r.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),a.lineWidth(s.linesMaterial.lineWidth);const l=s._sectionPlanesState.sectionPlanes.length;if(l>0){const e=s._sectionPlanesState.sectionPlanes,i=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const s=this._uSectionPlanes[t];if(s){const o=r.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,o?1:0),o){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$q);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(n.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),n.indicesBuf.bind(),a.drawElements(a.LINES,n.indicesBuf.numItems,n.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,i=t.canvas.gl,s=this._program,r=t.camera.project;if(s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Lines batching color vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Lines batching color fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   gl_FragColor            = vColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const defaultColor$1=new Float32Array([1,1,1]),tempVec3a$p=math.vec3();class LinesBatchingSilhouetteRenderer{constructor(e,t){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.SILHOUETTE_XRAYED){const e=r.xrayMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_SELECTED){const e=r.selectedMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,defaultColor$1);const l=h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix;a.uniformMatrix4fv(this._uViewMatrix,!1,l),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.lineWidth(r.linesMaterial.lineWidth);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*c,o=s.renderFlags;for(let t=0;t<c;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$p);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),a.drawElements(a.LINES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Lines batching silhouette vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 color;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Lines batching silhouette fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("uniform vec4 color;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = color;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class LinesBatchingRenderers{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new LinesBatchingColorRenderer(this._scene,!1)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new LinesBatchingSilhouetteRenderer(this._scene)),this._silhouetteRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}const cachedRenderers$3={};function getBatchingRenderers(e){const t=e.id;let i=cachedRenderers$3[t];return i||(i=new LinesBatchingRenderers(e),cachedRenderers$3[t]=i,i._compile(),e.on("compile",(()=>{i._compile()})),e.on("destroyed",(()=>{delete cachedRenderers$3[t],i._destroy()}))),i}const bigIndicesSupported$3=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint;class LinesBatchingBuffer{constructor(e=5e6){bigIndicesSupported$3?e>5e6&&(e=5e6):e>65530&&(e=65530),this.maxVerts=e,this.maxIndices=3*e,this.positions=[],this.colors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[]}}const tempVec4a$7=math.vec4([0,0,0,1]),tempVec4b$7=math.vec4([0,0,0,1]),tempVec4c$5=math.vec4([0,0,0,1]),tempOBB3$1=math.OBB3();class LinesBatchingLayer{constructor(e){this.layerIndex=e.layerIndex,this._batchingRenderers=getBatchingRenderers(e.model.scene),this.model=e.model,this._buffer=new LinesBatchingBuffer(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new RenderState({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,positionsDecodeMatrix:math.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=math.collapseAABB3(),this._portions=[],this._numVerts=0,this._finalized=!1,this._positionsDecodeMatrix=e.positionsDecodeMatrix,this._preCompressed=!!this._positionsDecodeMatrix,e.origin&&(this._state.origin=math.vec3(e.origin)),this.aabb=math.collapseAABB3()}canCreatePortion(e,t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts&&this._buffer.indices.length+t<this._buffer.maxIndices}createPortion(e){if(this._finalized)throw"Already finalized";const t=e.positions,i=e.indices,s=e.color,r=e.opacity,o=e.meshMatrix,a=e.worldMatrix,n=e.worldAABB;e.pickColor;const h=this._buffer,l=h.positions.length/3,c=t.length/3,u=t.length;if(this._preCompressed){for(let e=0,i=t.length;e<i;e++)h.positions.push(t[e]);const e=geometryCompressionUtils.getPositionsBounds(t),i=geometryCompressionUtils.decompressPosition(e.min,this._positionsDecodeMatrix,[]),s=geometryCompressionUtils.decompressPosition(e.max,this._positionsDecodeMatrix,[]);n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=s[0],n[4]=s[1],n[5]=s[2],a&&(math.AABB3ToOBB3(n,tempOBB3$1),math.transformOBB3(a,tempOBB3$1),math.OBB3ToAABB3(tempOBB3$1,n))}else{const e=h.positions.length;for(let e=0,i=t.length;e<i;e++)h.positions.push(t[e]);if(o)for(let t=e,i=e+u;t<i;t+=3)tempVec4a$7[0]=h.positions[t+0],tempVec4a$7[1]=h.positions[t+1],tempVec4a$7[2]=h.positions[t+2],math.transformPoint4(o,tempVec4a$7,tempVec4b$7),h.positions[t+0]=tempVec4b$7[0],h.positions[t+1]=tempVec4b$7[1],h.positions[t+2]=tempVec4b$7[2],math.expandAABB3Point3(this._modelAABB,tempVec4b$7),a?(math.transformPoint4(a,tempVec4b$7,tempVec4c$5),math.expandAABB3Point3(n,tempVec4c$5)):math.expandAABB3Point3(n,tempVec4b$7);else for(let t=e,i=e+u;t<i;t+=3)tempVec4a$7[0]=h.positions[t+0],tempVec4a$7[1]=h.positions[t+1],tempVec4a$7[2]=h.positions[t+2],math.expandAABB3Point3(this._modelAABB,tempVec4a$7),a?(math.transformPoint4(a,tempVec4a$7,tempVec4b$7),math.expandAABB3Point3(n,tempVec4b$7)):math.expandAABB3Point3(n,tempVec4a$7)}if(this._state.origin){const e=this._state.origin;n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[0],n[4]+=e[1],n[5]+=e[2]}if(math.expandAABB3(this.aabb,n),s){const e=s[0],t=s[1],i=s[2],o=r;for(let s=0;s<c;s++)h.colors.push(e),h.colors.push(t),h.colors.push(i),h.colors.push(o)}if(i)for(let e=0,t=i.length;e<t;e++)h.indices.push(i[e]+l);if(this.model.scene.entityOffsetsEnabled)for(let e=0;e<c;e++)h.offsets.push(0),h.offsets.push(0),h.offsets.push(0);const p=this._portions.length/2;return this._portions.push(l),this._portions.push(c),this._numPortions++,this.model.numPortions++,this._numVerts+=c,p}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this.model.scene.canvas.gl,i=this._buffer;if(i.positions.length>0)if(this._preCompressed){e.positionsDecodeMatrix=this._positionsDecodeMatrix;const s=new Uint16Array(i.positions);e.positionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.positions.length,3,t.STATIC_DRAW)}else{const s=quantizePositions(new Float32Array(i.positions),this._modelAABB,e.positionsDecodeMatrix);e.positionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.positions.length,3,t.STATIC_DRAW)}if(i.colors.length>0){const s=new Uint8Array(i.colors);let r=!1;e.colorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.colors.length,4,t.DYNAMIC_DRAW,r)}if(i.colors.length>0){const s=i.colors.length,r=new Uint8Array(s),o=new Uint8Array(s);let a=!1,n=!0;e.flagsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,r,r.length,4,t.DYNAMIC_DRAW,a),e.flags2Buf=new ArrayBuf(t,t.ARRAY_BUFFER,o,o.length,4,t.DYNAMIC_DRAW,n)}if(this.model.scene.entityOffsetsEnabled&&i.offsets.length>0){const s=new Float32Array(i.offsets);e.offsetsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.offsets.length,3,t.DYNAMIC_DRAW)}const s=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint;if(i.indices.length>0){const r=s?new Uint32Array(i.indices):new Uint16Array(i.indices);e.indicesBuf=new ArrayBuf(t,t.ELEMENT_ARRAY_BUFFER,r,i.indices.length,1,t.STATIC_DRAW)}this._buffer=null,this._finalized=!0}initFlags(e,t,i){t&ENTITY_FLAGS.VISIBLE&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&ENTITY_FLAGS.HIGHLIGHTED&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&ENTITY_FLAGS.XRAYED&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&ENTITY_FLAGS.SELECTED&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&ENTITY_FLAGS.CLIPPABLE&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ENTITY_FLAGS.EDGES&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ENTITY_FLAGS.PICKABLE&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ENTITY_FLAGS.CULLED&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,i,true),this._setFlags2(e,t,true)}flushInitFlags(){this._setDeferredFlags(),this._setDeferredFlags2()}setVisible(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.VISIBLE?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}setHighlighted(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.HIGHLIGHTED?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}setXRayed(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.XRAYED?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}setSelected(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.SELECTED?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}setEdges(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.EDGES?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CLIPPABLE?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCulled(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CULLED?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.PICKABLE?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}setColor(e,t){if(!this._finalized)throw"Not finalized";const i=2*e,s=4*this._portions[i],r=4*this._portions[i+1],o=this._scratchMemory.getUInt8Array(r),a=t[0],n=t[1],h=t[2],l=t[3];for(let e=0;e<r;e+=4)o[e+0]=a,o[e+1]=n,o[e+2]=h,o[e+3]=l;this._state.colorsBuf.setData(o,s,r)}setTransparent(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}_setFlags(e,t,i,s=!1){if(!this._finalized)throw"Not finalized";const r=2*e,o=4*this._portions[r],a=4*this._portions[r+1];this._scratchMemory.getUInt8Array(a);const n=!!(t&ENTITY_FLAGS.VISIBLE),h=!!(t&ENTITY_FLAGS.XRAYED),l=!!(t&ENTITY_FLAGS.CULLED);let c,u;c=!n||l||h?RENDER_PASSES.NOT_RENDERED:i?RENDER_PASSES.COLOR_TRANSPARENT:RENDER_PASSES.COLOR_OPAQUE,u=!n||l?RENDER_PASSES.NOT_RENDERED:!!(t&ENTITY_FLAGS.SELECTED)?RENDER_PASSES.SILHOUETTE_SELECTED:!!(t&ENTITY_FLAGS.HIGHLIGHTED)?RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:h?RENDER_PASSES.SILHOUETTE_XRAYED:RENDER_PASSES.NOT_RENDERED;let p=n&&!l&&!!(t&ENTITY_FLAGS.PICKABLE)?RENDER_PASSES.PICK:RENDER_PASSES.NOT_RENDERED;if(s){this._deferredFlagValues||(this._deferredFlagValues=new Uint8Array(4*this._numVerts));for(let e=o,t=o+a;e<t;e+=4)this._deferredFlagValues[e+0]=c,this._deferredFlagValues[e+1]=u,this._deferredFlagValues[e+2]=0,this._deferredFlagValues[e+3]=p}else if(this._state.flagsBuf){const e=this._scratchMemory.getUInt8Array(a);for(let t=0;t<a;t+=4)e[t+0]=c,e[t+1]=u,e[t+2]=0,e[t+3]=p;this._state.flagsBuf.setData(e,o,a)}}_setDeferredFlags(){this._deferredFlagValues&&(this._state.flagsBuf.setData(this._deferredFlagValues),this._deferredFlagValues=null)}_setFlags2(e,t,i=!1){if(!this._finalized)throw"Not finalized";const s=2*e,r=4*this._portions[s],o=4*this._portions[s+1],a=t&ENTITY_FLAGS.CLIPPABLE?255:0;if(i){this._setDeferredFlag2Values||(this._setDeferredFlag2Values=new Uint8Array(4*this._numVerts));for(let e=r,t=r+o;e<t;e+=4)this._setDeferredFlag2Values[e]=a}else{const e=this._scratchMemory.getUInt8Array(o);for(let t=0;t<o;t+=4)e[t+0]=a;this._state.flags2Buf.setData(e,r,o)}}_setDeferredFlags2(){this._setDeferredFlag2Values&&(this._state.flags2Buf.setData(this._setDeferredFlag2Values),this._setDeferredFlag2Values=null)}setOffset(e,t){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const i=2*e,s=3*this._portions[i],r=3*this._portions[i+1],o=this._scratchMemory.getFloat32Array(r),a=t[0],n=t[1],h=t[2];for(let e=0;e<r;e+=3)o[e+0]=a,o[e+1]=n,o[e+2]=h;this._state.offsetsBuf.setData(o,s,r)}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_XRAYED)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_HIGHLIGHTED)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_SELECTED)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawEdgesXRayed(e,t){}drawPickMesh(e){}drawPickDepths(e){}drawPickNormals(e){}drawOcclusion(e){}drawShadow(e){}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.indicesBuf&&(e.indicesBuf.destroy(),e.indicessBuf=null),e.destroy()}}const tempVec3a$o=math.vec3();class LinesInstancingColorRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.lineWidth(r.linesMaterial.lineWidth);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*c,o=s.renderFlags;for(let t=0;t<c;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$o);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.indicesBuf.bind(),h.drawElementsInstancedANGLE(a.LINES,n.indicesBuf.numItems,n.indicesBuf.itemType,0,n.numInstances),e.drawElements++,h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Lines instancing color vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),i.push("uniform vec4 lightAmbient;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0,  float(color.a) / 255.0);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let i,s;const r=t.sectionPlanes.length>0,o=[];if(o.push("// Lines instancing color fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("uniform bool sectionPlaneActive"+i+";"),o.push("uniform vec3 sectionPlanePos"+i+";"),o.push("uniform vec3 sectionPlaneDir"+i+";");if(o.push("varying vec4 vColor;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("if (sectionPlaneActive"+i+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),o.push("   gl_FragColor            = vec4(vColor.rgb * ambient, vColor.a);")):o.push("    gl_FragColor           = vColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$n=math.vec3();class LinesInstancingSilhouetteRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin;if(!this._program&&(this._allocate(t.model.scene),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.SILHOUETTE_XRAYED){const e=r.xrayMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_SELECTED){const e=r.selectedMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,math.vec3([1,1,1]));a.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.lineWidth(r.linesMaterial.lineWidth);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*c,o=s.renderFlags;for(let t=0;t<c;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$n);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf,a.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf,a.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.indicesBuf.bind(),h.drawElementsInstancedANGLE(a.LINES,n.indicesBuf.numItems,n.indicesBuf.itemType,0,n.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Lines instancing silhouette vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),i.push("uniform vec4 color;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Lines instancing silhouette fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("uniform vec4 color;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = color;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class LinesInstancingRenderers{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new LinesInstancingColorRenderer(this._scene)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new LinesInstancingSilhouetteRenderer(this._scene)),this._silhouetteRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}const cachedRenderers$2={};function getInstancingRenderers(e){const t=e.id;let i=cachedRenderers$2[t];return i||(i=new LinesInstancingRenderers(e),cachedRenderers$2[t]=i,i._compile(),e.on("compile",(()=>{i._compile()})),e.on("destroyed",(()=>{delete cachedRenderers$2[t],i._destroy()}))),i}const tempUint8Vec4$1=new Uint8Array(4),tempVec4a$6=math.vec4([0,0,0,1]),tempVec4b$6=math.vec4([0,0,0,1]),tempVec4c$4=math.vec4([0,0,0,1]),tempVec3fa$1=new Float32Array(3);class LinesInstancingLayer{constructor(e){this.model=e.model,this.geometry=e.geometry,this.material=e.material,this.sortId="LinesInstancingLayer",this.layerIndex=e.layerIndex,this._linesInstancingRenderers=getInstancingRenderers(e.model.scene),this._aabb=math.collapseAABB3(),this._state=new RenderState({obb:math.OBB3(),numInstances:0,origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.geometry.numIndices,this._colors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],e.origin&&(this._state.origin=math.vec3(e.origin)),this._finalized=!1,this.aabb=math.collapseAABB3()}createPortion(e){const t=e.color,i=e.opacity,s=e.meshMatrix,r=e.worldMatrix,o=e.aabb;if(this._finalized)throw"Already finalized";const a=t[0],n=t[1],h=t[2];t[3],this._colors.push(a),this._colors.push(n),this._colors.push(h),this._colors.push(i),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(s[0]),this._modelMatrixCol0.push(s[4]),this._modelMatrixCol0.push(s[8]),this._modelMatrixCol0.push(s[12]),this._modelMatrixCol1.push(s[1]),this._modelMatrixCol1.push(s[5]),this._modelMatrixCol1.push(s[9]),this._modelMatrixCol1.push(s[13]),this._modelMatrixCol2.push(s[2]),this._modelMatrixCol2.push(s[6]),this._modelMatrixCol2.push(s[10]),this._modelMatrixCol2.push(s[14]),math.collapseAABB3(o);const l=this._state.obb,c=l.length;for(let e=0;e<c;e+=4)tempVec4a$6[0]=l[e+0],tempVec4a$6[1]=l[e+1],tempVec4a$6[2]=l[e+2],math.transformPoint4(s,tempVec4a$6,tempVec4b$6),r?(math.transformPoint4(r,tempVec4b$6,tempVec4c$4),math.expandAABB3Point3(o,tempVec4c$4)):math.expandAABB3Point3(o,tempVec4b$6);if(this._state.origin){const e=this._state.origin;o[0]+=e[0],o[1]+=e[1],o[2]+=e[2],o[3]+=e[0],o[4]+=e[1],o[5]+=e[2]}math.expandAABB3(this.aabb,o),this._state.numInstances++;const u=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,u}finalize(){if(this._finalized)throw"Already finalized";const e=this.model.scene.canvas.gl,t=this._colors.length,i=t;if(t>0){let t=!1;this._state.colorsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,e.DYNAMIC_DRAW,t),this._colors=[]}if(i>0){let t=!1,s=!0;this._state.flagsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Uint8Array(i),i,4,e.DYNAMIC_DRAW,t),this._state.flags2Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Uint8Array(i),i,4,e.DYNAMIC_DRAW,s)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const t=!1;this._state.offsetsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,e.DYNAMIC_DRAW,t),this._offsets=[]}if(this._modelMatrixCol0.length>0){const t=!1;this._state.modelMatrixCol0Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol1Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol2Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,e.STATIC_DRAW,t),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}this._finalized=!0}initFlags(e,t,i){t&ENTITY_FLAGS.VISIBLE&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&ENTITY_FLAGS.HIGHLIGHTED&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&ENTITY_FLAGS.XRAYED&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&ENTITY_FLAGS.SELECTED&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&ENTITY_FLAGS.CLIPPABLE&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ENTITY_FLAGS.EDGES&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ENTITY_FLAGS.PICKABLE&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ENTITY_FLAGS.CULLED&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}setVisible(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.VISIBLE?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}setHighlighted(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.HIGHLIGHTED?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}setXRayed(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.XRAYED?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}setSelected(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.SELECTED?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}setEdges(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.EDGES?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CLIPPABLE?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.PICKABLE?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,i)}setCulled(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CULLED?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}setColor(e,t){if(!this._finalized)throw"Not finalized";tempUint8Vec4$1[0]=t[0],tempUint8Vec4$1[1]=t[1],tempUint8Vec4$1[2]=t[2],tempUint8Vec4$1[3]=t[3],this._state.colorsBuf.setData(tempUint8Vec4$1,4*e,4)}setTransparent(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}_setFlags(e,t,i){if(!this._finalized)throw"Not finalized";const s=!!(t&ENTITY_FLAGS.VISIBLE),r=!!(t&ENTITY_FLAGS.XRAYED),o=!!(t&ENTITY_FLAGS.HIGHLIGHTED),a=!!(t&ENTITY_FLAGS.SELECTED),n=!!(t&ENTITY_FLAGS.CULLED);let h,l;h=!s||n||r?RENDER_PASSES.NOT_RENDERED:i?RENDER_PASSES.COLOR_TRANSPARENT:RENDER_PASSES.COLOR_OPAQUE,l=!s||n?RENDER_PASSES.NOT_RENDERED:a?RENDER_PASSES.SILHOUETTE_SELECTED:o?RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:r?RENDER_PASSES.SILHOUETTE_XRAYED:RENDER_PASSES.NOT_RENDERED;let c=0;c=!s||n?RENDER_PASSES.NOT_RENDERED:a?RENDER_PASSES.EDGES_SELECTED:o?RENDER_PASSES.EDGES_HIGHLIGHTED:r?RENDER_PASSES.EDGES_XRAYED:!!(t&ENTITY_FLAGS.EDGES)?i?RENDER_PASSES.EDGES_COLOR_TRANSPARENT:RENDER_PASSES.EDGES_COLOR_OPAQUE:RENDER_PASSES.NOT_RENDERED;let u=s&&!n&&!!(t&ENTITY_FLAGS.PICKABLE)?RENDER_PASSES.PICK:RENDER_PASSES.NOT_RENDERED;tempUint8Vec4$1[0]=h,tempUint8Vec4$1[1]=l,tempUint8Vec4$1[2]=c,tempUint8Vec4$1[3]=u,this._state.flagsBuf.setData(tempUint8Vec4$1,4*e,4)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const i=t&ENTITY_FLAGS.CLIPPABLE?255:0;tempUint8Vec4$1[0]=i,this._state.flags2Buf.setData(tempUint8Vec4$1,4*e,4)}setOffset(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(tempVec3fa$1[0]=t[0],tempVec3fa$1[1]=t[1],tempVec3fa$1[2]=t[2],this._state.offsetsBuf.setData(tempVec3fa$1,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_XRAYED)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_HIGHLIGHTED)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_SELECTED)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesXRayed(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawOcclusion(e,t){}drawShadow(e,t){}drawPickMesh(e,t){}drawPickDepths(e,t){}drawPickNormals(e,t){}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.destroy()}}const tempVec3a$m=math.vec3();class PointsBatchingColorRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=this._scene,r=s.camera,o=t.model,a=s.canvas.gl,n=t._state,h=t._state.origin,l=s.pointsMaterial;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(r.viewMatrix,h):r.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);const c=s._sectionPlanesState.sectionPlanes.length;if(c>0){const e=s._sectionPlanesState.sectionPlanes,i=t.layerIndex*c,r=o.renderFlags;for(let t=0;t<c;t++){const s=this._uSectionPlanes[t];if(s){const o=r.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,o?1:0),o){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$m);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(n.colorsBuf),l.filterIntensity&&a.uniform2f(this._uIntensityRange,l.minIntensity,l.maxIntensity),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),a.uniform1f(this._uPointSize,l.pointSize);const u="ortho"===s.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*s.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,u),a.drawArrays(a.POINTS,0,n.positionsBuf.numItems),e.drawArrays++}_allocate(){const e=this._scene,t=e.pointsMaterial._state,i=e.canvas.gl;if(this._program=new Program(i,this._buildShader(e)),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.filterIntensity&&(this._uIntensityRange=s.getLocation("intensityRange")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial,s=[];return s.push("// Points batching color vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),i.filterIntensity&&s.push("uniform vec2 intensityRange;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),i.filterIntensity&&(s.push("float intensity = float(color.a) / 255.0;"),s.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {")),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),i.filterIntensity&&s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points batching color fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   gl_FragColor = vColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const defaultColor=new Float32Array([1,1,1]),tempVec3a$l=math.vec3();class PointsBatchingSilhouetteRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.SILHOUETTE_XRAYED){const e=r.xrayMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_SELECTED){const e=r.selectedMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,defaultColor);const c=h?createRTCViewMat(o.viewMatrix,h):o.viewMatrix;a.uniformMatrix4fv(this._uViewMatrix,!1,c),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$l);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),a.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,p),a.drawArrays(a.POINTS,0,n.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points batching silhouette vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 color;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let i,s;const r=t.sectionPlanes.length>0,o=[];if(o.push("// Points batching silhouette vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("uniform bool sectionPlaneActive"+i+";"),o.push("uniform vec3 sectionPlanePos"+i+";"),o.push("uniform vec3 sectionPlaneDir"+i+";");if(o.push("uniform vec4 color;"),o.push("void main(void) {"),e.pointsMaterial.roundPoints&&(o.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("  float r = dot(cxy, cxy);"),o.push("  if (r > 1.0) {"),o.push("       discard;"),o.push("  }")),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("if (sectionPlaneActive"+i+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("gl_FragColor = color;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$k=math.vec3();class PointsBatchingPickMeshRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin,l=r.pointsMaterial._state;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const c=e.pickViewMatrix||o.viewMatrix,u=h?createRTCViewMat(c,h):c;if(a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,u),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*p,o=s.renderFlags;for(let t=0;t<p;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$k);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(n.pickColorsBuf),a.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,d),a.drawArrays(a.POINTS,0,n.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points batching pick mesh vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 pickColor;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("gl_PointSize += 10.0;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points batching pick mesh vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   gl_FragColor = vPickColor; "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$j=math.vec3();class PointsBatchingPickDepthRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=t._state.origin,l=r.pointsMaterial._state;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniform1i(this._uPickInvisible,e.pickInvisible);const c=e.pickViewMatrix||o.viewMatrix,u=h?createRTCViewMat(c,h):c;if(a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,u),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),a.uniform1f(this._uPickZNear,e.pickZNear),a.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*p,o=s.renderFlags;for(let t=0;t<p;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$j);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),a.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,d),a.drawArrays(a.POINTS,0,n.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points batched pick depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("gl_PointSize += 10.0;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points batched pick depth fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    gl_FragColor = packDepth(zNormalizedDepth); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$i=math.vec3();class PointsBatchingOcclusionRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.canvas.gl,a=t._state,n=r.camera,h=t._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?createRTCViewMat(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*c,a=s.renderFlags;for(let t=0;t<c;t++){const s=this._uSectionPlanes[t];if(s){const r=a.sectionPlanesActivePerLayer[i+t];if(o.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$i);o.uniform3fv(s.pos,e)}else o.uniform3fv(s.pos,i.pos);o.uniform3fv(s.dir,i.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),o.uniform1f(this._uPointSize,l.pointSize);const u="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,u),o.drawArrays(o.POINTS,0,a.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points batching occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("  gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points batching occlusion fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("      if (sectionPlaneActive"+e+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class PointsBatchingRenderers{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new PointsBatchingColorRenderer(this._scene)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new PointsBatchingSilhouetteRenderer(this._scene)),this._silhouetteRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new PointsBatchingPickMeshRenderer(this._scene)),this._pickMeshRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new PointsBatchingPickDepthRenderer(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new PointsBatchingOcclusionRenderer(this._scene)),this._occlusionRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy()}}const cachedRenderers$1={};function getPointsBatchingRenderers(e){const t=e.id;let i=cachedRenderers$1[t];return i||(i=new PointsBatchingRenderers(e),cachedRenderers$1[t]=i,i._compile(),e.on("compile",(()=>{i._compile()})),e.on("destroyed",(()=>{delete cachedRenderers$1[t],i._destroy()}))),i}const bigIndicesSupported$2=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint;class PointsBatchingBuffer{constructor(e=5e6){bigIndicesSupported$2?e>5e6&&(e=5e6):e>65530&&(e=65530),this.maxVerts=e,this.maxIndices=3*e,this.positions=[],this.colors=[],this.intensities=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[]}}const tempVec3a$h=math.vec4(),tempVec3b$6=math.vec4(),tempVec4a$5=math.vec4([0,0,0,1]),tempVec4b$5=math.vec4([0,0,0,1]),tempVec4c$3=math.vec4([0,0,0,1]),tempOBB3=math.OBB3();class PointsBatchingLayer{constructor(e){this.model=e.model,this.sortId="PointsBatchingLayer",this.layerIndex=e.layerIndex,this._pointsBatchingRenderers=getPointsBatchingRenderers(e.model.scene),this._buffer=new PointsBatchingBuffer(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new RenderState({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,positionsDecodeMatrix:math.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=math.collapseAABB3(),this._portions=[],this._finalized=!1,this._positionsDecodeMatrix=e.positionsDecodeMatrix,this._preCompressed=!!this._positionsDecodeMatrix,e.origin&&(this._state.origin=math.vec3(e.origin)),this.aabb=math.collapseAABB3()}canCreatePortion(e){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts}createPortion(e){if(this._finalized)throw"Already finalized";const t=e.positions,i=e.color,s=e.colorsCompressed,r=e.colors,o=e.meshMatrix,a=e.worldMatrix,n=e.worldAABB,h=e.pickColor,l=this._buffer,c=l.positions.length/3,u=t.length/3,p=t.length;if(this._preCompressed){for(let e=0,i=t.length;e<i;e++)l.positions.push(t[e]);const e=geometryCompressionUtils.getPositionsBounds(t),i=geometryCompressionUtils.decompressPosition(e.min,this._positionsDecodeMatrix,tempVec3a$h),s=geometryCompressionUtils.decompressPosition(e.max,this._positionsDecodeMatrix,tempVec3b$6);n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=s[0],n[4]=s[1],n[5]=s[2],a&&(math.AABB3ToOBB3(n,tempOBB3),math.transformOBB3(a,tempOBB3),math.OBB3ToAABB3(tempOBB3,n))}else{const e=l.positions.length;for(let e=0,i=t.length;e<i;e++)l.positions.push(t[e]);if(o)for(let t=e,i=e+p;t<i;t+=3)tempVec4a$5[0]=l.positions[t+0],tempVec4a$5[1]=l.positions[t+1],tempVec4a$5[2]=l.positions[t+2],math.transformPoint4(o,tempVec4a$5,tempVec4b$5),l.positions[t+0]=tempVec4b$5[0],l.positions[t+1]=tempVec4b$5[1],l.positions[t+2]=tempVec4b$5[2],math.expandAABB3Point3(this._modelAABB,tempVec4b$5),a?(math.transformPoint4(a,tempVec4b$5,tempVec4c$3),math.expandAABB3Point3(n,tempVec4c$3)):math.expandAABB3Point3(n,tempVec4b$5);else for(let t=e,i=e+p;t<i;t+=3)tempVec4a$5[0]=l.positions[t+0],tempVec4a$5[1]=l.positions[t+1],tempVec4a$5[2]=l.positions[t+2],math.expandAABB3Point3(this._modelAABB,tempVec4a$5),a?(math.transformPoint4(a,tempVec4a$5,tempVec4b$5),math.expandAABB3Point3(n,tempVec4b$5)):math.expandAABB3Point3(n,tempVec4a$5)}if(this._state.origin){const e=this._state.origin;n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[0],n[4]+=e[1],n[5]+=e[2]}if(math.expandAABB3(this.aabb,n),s)for(let e=0,t=s.length;e<t;e++)l.colors.push(s[e]);else if(r)for(let e=0,t=r.length;e<t;e++)l.colors.push(255*r[e]);else if(i){const e=i[0],t=i[1],s=i[2],r=1;for(let i=0;i<u;i++)l.colors.push(e),l.colors.push(t),l.colors.push(s),l.colors.push(r)}{const e=l.pickColors.length;for(let t=e,i=e+4*u;t<i;t+=4)l.pickColors.push(h[0]),l.pickColors.push(h[1]),l.pickColors.push(h[2]),l.pickColors.push(h[3])}if(this.model.scene.entityOffsetsEnabled)for(let e=0;e<u;e++)l.offsets.push(0),l.offsets.push(0),l.offsets.push(0);const d=this._portions.length/2;return this._portions.push(c),this._portions.push(u),this._numPortions++,this.model.numPortions++,d}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this.model.scene.canvas.gl,i=this._buffer;if(i.positions.length>0)if(this._preCompressed){e.positionsDecodeMatrix=this._positionsDecodeMatrix;const s=new Uint16Array(i.positions);e.positionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.positions.length,3,t.STATIC_DRAW)}else{const s=quantizePositions(new Float32Array(i.positions),this._modelAABB,e.positionsDecodeMatrix);e.positionsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.positions.length,3,t.STATIC_DRAW)}if(i.colors.length>0){const s=new Uint8Array(i.colors);let r=!1;e.colorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.colors.length,4,t.STATIC_DRAW,r)}if(i.positions.length>0){const s=i.positions.length/3*4,r=new Uint8Array(s),o=new Uint8Array(s);let a=!1,n=!0;e.flagsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,r,r.length,4,t.DYNAMIC_DRAW,a),e.flags2Buf=new ArrayBuf(t,t.ARRAY_BUFFER,o,o.length,4,t.DYNAMIC_DRAW,n)}if(i.pickColors.length>0){const s=new Uint8Array(i.pickColors);let r=!1;e.pickColorsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.pickColors.length,4,t.STATIC_DRAW,r)}if(this.model.scene.entityOffsetsEnabled&&i.offsets.length>0){const s=new Float32Array(i.offsets);e.offsetsBuf=new ArrayBuf(t,t.ARRAY_BUFFER,s,i.offsets.length,3,t.DYNAMIC_DRAW)}this._buffer=null,this._finalized=!0}initFlags(e,t,i){t&ENTITY_FLAGS.VISIBLE&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&ENTITY_FLAGS.HIGHLIGHTED&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&ENTITY_FLAGS.XRAYED&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&ENTITY_FLAGS.SELECTED&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&ENTITY_FLAGS.CLIPPABLE&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ENTITY_FLAGS.PICKABLE&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ENTITY_FLAGS.CULLED&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}setVisible(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.VISIBLE?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}setHighlighted(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.HIGHLIGHTED?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}setXRayed(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.XRAYED?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}setSelected(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.SELECTED?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}setEdges(e,t,i){if(!this._finalized)throw"Not finalized"}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CLIPPABLE?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCulled(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CULLED?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.PICKABLE?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}setColor(e,t){if(!this._finalized)throw"Not finalized";const i=2*e,s=4*this._portions[i],r=4*this._portions[i+1],o=this._scratchMemory.getUInt8Array(r),a=t[0],n=t[1],h=t[2];for(let e=0;e<r;e+=4)o[e+0]=a,o[e+1]=n,o[e+2]=h;this._state.colorsBuf.setData(o,s,r)}setTransparent(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}_setFlags(e,t,i){if(!this._finalized)throw"Not finalized";const s=2*e,r=4*this._portions[s],o=4*this._portions[s+1],a=this._scratchMemory.getUInt8Array(o),n=!!(t&ENTITY_FLAGS.VISIBLE),h=!!(t&ENTITY_FLAGS.XRAYED),l=!!(t&ENTITY_FLAGS.CULLED);let c,u;c=!n||l||h?RENDER_PASSES.NOT_RENDERED:i?RENDER_PASSES.COLOR_TRANSPARENT:RENDER_PASSES.COLOR_OPAQUE,u=!n||l?RENDER_PASSES.NOT_RENDERED:!!(t&ENTITY_FLAGS.SELECTED)?RENDER_PASSES.SILHOUETTE_SELECTED:!!(t&ENTITY_FLAGS.HIGHLIGHTED)?RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:h?RENDER_PASSES.SILHOUETTE_XRAYED:RENDER_PASSES.NOT_RENDERED;let p=n&&!l&&!!(t&ENTITY_FLAGS.PICKABLE)?RENDER_PASSES.PICK:RENDER_PASSES.NOT_RENDERED;for(let e=0;e<o;e+=4)a[e+0]=c,a[e+1]=u,a[e+2]=0,a[e+3]=p;this._state.flagsBuf.setData(a,r,o)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const i=2*e,s=4*this._portions[i],r=4*this._portions[i+1],o=this._scratchMemory.getUInt8Array(r),a=t&ENTITY_FLAGS.CLIPPABLE?255:0;for(let e=0;e<r;e+=4)o[e+0]=a;this._state.flags2Buf.setData(o,s,r)}setOffset(e,t){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const i=2*e,s=3*this._portions[i],r=3*this._portions[i+1],o=this._scratchMemory.getFloat32Array(r),a=t[0],n=t[1],h=t[2];for(let e=0;e<r;e+=3)o[e+0]=a,o[e+1]=n,o[e+2]=h;this._state.offsetsBuf.setData(o,s,r)}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_XRAYED)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_HIGHLIGHTED)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_SELECTED)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawEdgesXRayed(e,t){}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickMeshRenderer&&this._pointsBatchingRenderers.pickMeshRenderer.drawLayer(t,this,RENDER_PASSES.PICK)}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickDepthRenderer&&this._pointsBatchingRenderers.pickDepthRenderer.drawLayer(t,this,RENDER_PASSES.PICK)}drawPickNormals(e,t){}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.occlusionRenderer&&this._pointsBatchingRenderers.occlusionRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}drawShadow(e,t){}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}const tempVec3a$g=math.vec3();class PointsInstancingColorRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin,c=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aColor.bindArrayBuffer(n.colorsBuf),c.filterIntensity&&a.uniform2f(this._uIntensityRange,c.minIntensity,c.maxIntensity);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$g);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.uniform1f(this._uPointSize,c.pointSize);const p="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,p),h.drawArraysInstancedANGLE(a.POINTS,0,n.positionsBuf.numItems,n.numInstances),e.drawArrays++,h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.pointsMaterial._state,i=e.canvas.gl;if(this._program=new Program(i,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=i.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.filterIntensity&&(this._uIntensityRange=s.getLocation("intensityRange")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points instancing color vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),i.filterIntensity&&s.push("uniform vec2 intensityRange;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),i.filterIntensity&&(s.push("float intensity = float(color.a) / 255.0;"),s.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {")),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),i.filterIntensity&&s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points instancing color fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   gl_FragColor = vColor;"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$f=math.vec3();class PointsInstancingSilhouetteRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin,c=r.pointsMaterial._state;if(!this._program&&(this._allocate(t.model.scene),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),i===RENDER_PASSES.SILHOUETTE_XRAYED){const e=r.xrayMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_HIGHLIGHTED){const e=r.highlightMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else if(i===RENDER_PASSES.SILHOUETTE_SELECTED){const e=r.selectedMaterial._state,t=e.fillColor,i=e.fillAlpha;a.uniform4f(this._uColor,t[0],t[1],t[2],i)}else a.uniform4fv(this._uColor,math.vec3([1,1,1]));a.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$f);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf,a.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf,a.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.uniform1f(this._uPointSize,c.pointSize);const p="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,p),h.drawArraysInstancedANGLE(a.POINTS,0,n.positionsBuf.numItems,n.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points instancing silhouette vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),s.push("uniform vec4 color;"),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points instancing silhouette fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("uniform vec4 color;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = color;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$e=math.vec3();class PointsInstancingPickMeshRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin,c=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i);const u=e.pickViewMatrix||o.viewMatrix,p=l?createRTCViewMat(u,l):u;if(a.uniformMatrix4fv(this._uViewMatrix,!1,p),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);a.uniform1f(this._uLogDepthBufFC,e)}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(n.pickColorsBuf),h.vertexAttribDivisorANGLE(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.uniform1f(this._uPointSize,c.pointSize);const d="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,d);const m=r._sectionPlanesState.sectionPlanes.length;if(m>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*m,o=s.renderFlags;for(let t=0;t<m;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$e);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}h.drawArraysInstancedANGLE(a.POINTS,0,n.positionsBuf.numItems,n.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aPickColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._uRenderPass=s.getLocation("renderPass"),this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points instancing pick mesh vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 pickColor;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points instancing pick mesh fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("gl_FragColor = vPickColor; "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$d=math.vec3();class PointsInstancingPickDepthRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.canvas.gl,a=t._state,n=this._instanceExt,h=t._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram());const c=r.camera;o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||c.viewMatrix,p=h?createRTCViewMat(u,h):u;if(o.uniformMatrix4fv(this._uViewMatrix,!1,p),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,t)}const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*d,a=s.renderFlags;for(let t=0;t<d;t++){const s=this._uSectionPlanes[t];if(s){const r=a.sectionPlanesActivePerLayer[i+t];if(o.uniform1i(s.active,r?1:0),r){const i=e[t];if(h){const e=getPlaneRTCPos(i.dist,i.dir,h,tempVec3a$d);o.uniform3fv(s.pos,e)}else o.uniform3fv(s.pos,i.pos);o.uniform3fv(s.dir,i.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisorANGLE(this._aOffset.location,1)),o.uniform1f(this._uPointSize,l.pointSize);const m="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,m),n.drawArraysInstancedANGLE(o.POINTS,0,a.positionsBuf.numItems,a.numInstances),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),n.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points instancing pick depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("  vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points instancing pick depth fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    gl_FragColor = packDepth(zNormalizedDepth); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$c=math.vec3();class PointsInstancingOcclusionRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin,c=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$c);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(n.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1)),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(n.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),a.uniform1f(this._uPointSize,c.pointSize);const p="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,p),h.drawArraysInstancedANGLE(a.POINTS,0,n.positionsBuf.numItems,n.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),this._aColor&&h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points instancing occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Points instancing occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$b=math.vec3();class PointsInstancingDepthRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,i){const s=t.model,r=s.scene,o=r.camera,a=r.canvas.gl,n=t._state,h=this._instanceExt,l=t._state.origin,c=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),a.uniformMatrix4fv(this._uViewMatrix,!1,l?createRTCViewMat(o.viewMatrix,l):o.viewMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,i=t.layerIndex*u,o=s.renderFlags;for(let t=0;t<u;t++){const s=this._uSectionPlanes[t];if(s){const r=o.sectionPlanesActivePerLayer[i+t];if(a.uniform1i(s.active,r?1:0),r){const i=e[t];if(l){const e=getPlaneRTCPos(i.dist,i.dir,l,tempVec3a$b);a.uniform3fv(s.pos,e)}else a.uniform3fv(s.pos,i.pos);a.uniform3fv(s.dir,i.dir)}}}}this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(n.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),a.uniform1f(this._uPointSize,c.pointSize);const p="ortho"===r.camera.projection?1:a.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));a.uniform1f(this._uNearPlaneHeight,p),h.drawArraysInstancedANGLE(a.POINTS,0,n.positionsBuf.numItems,n.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("// Points instancing depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let i,s;const r=t.sectionPlanes.length>0,o=[];if(o.push("// Points instancing depth vertex shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("uniform bool sectionPlaneActive"+i+";"),o.push("uniform vec3 sectionPlanePos"+i+";"),o.push("uniform vec3 sectionPlaneDir"+i+";");if(o.push("const float   packUpScale = 256. / 255.;"),o.push("const float   unpackDownscale = 255. / 256.;"),o.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),o.push("const float   shiftRight8 = 1.0 / 256.;"),o.push("vec4 packDepthToRGBA( const in float v ) {"),o.push("    vec4 r = vec4( fract( v * packFactors ), v );"),o.push("    r.yzw -= r.xyz * shiftRight8;"),o.push("    return r * packUpScale;"),o.push("}"),o.push("void main(void) {"),e.pointsMaterial.roundPoints&&(o.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("  float r = dot(cxy, cxy);"),o.push("  if (r > 1.0) {"),o.push("       discard;"),o.push("  }")),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),i=0,s=t.sectionPlanes.length;i<s;i++)o.push("if (sectionPlaneActive"+i+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return o.push("    gl_FragColor = packDepthToRGBA( gl_FragCoord.z); "),e.logarithmicDepthBufferEnabled&&WEBGL_INFO$1.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tempVec3a$a=math.vec3();class PointsInstancingShadowRenderer{constructor(e){this._scene=e,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){const i=t.model,s=i.scene,r=s.canvas.gl,o=t._state,a=this._instanceExt;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,t)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),a.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),a.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),a.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),a.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aColor.bindArrayBuffer(o.colorsBuf),a.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(o.flagsBuf),a.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),a.vertexAttribDivisorANGLE(this._aFlags2.location,1));const n=s._sectionPlanesState.sectionPlanes.length;if(n>0){const e=s._sectionPlanesState.sectionPlanes,o=t.layerIndex*n,a=i.renderFlags,h=t._state.origin;for(let t=0;t<n;t++){const i=this._uSectionPlanes[t];if(i){const s=a.sectionPlanesActivePerLayer[o+t];if(r.uniform1i(i.active,s?1:0),s){const s=e[t];if(h){const e=getPlaneRTCPos(s.dist,s.dir,h,tempVec3a$a);r.uniform3fv(i.pos,e)}else r.uniform3fv(i.pos,s.pos);r.uniform3fv(i.dir,s.dir)}}}}r.uniform1f(this._uPointSize,10),a.drawArraysInstancedANGLE(r.POINTS,0,o.positionsBuf.numItems,o.numInstances),a.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),a.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),a.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),a.vertexAttribDivisorANGLE(this._aColor.location,0),a.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Program(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=t.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize")}_bindProgram(e,t){const i=this._scene.canvas.gl;this._program.bind(),i.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),i.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Instancing geometry shadow drawing vertex shader"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("bool visible      = (float(flags.x) > 0.0);"),i.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),i.push("if (!visible || transparent) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("  gl_Position = shadowProjMatrix * viewPosition;"),i.push("}"),i.push("gl_PointSize = pointSize;"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Instancing geometry depth drawing fragment shader"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("void main(void) {"),s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(let e=0,i=t.sectionPlanes.length;e<i;e++)s.push("if (sectionPlaneActive"+e+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class PointsInstancingRenderers{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new PointsInstancingColorRenderer(this._scene,!1)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new PointsInstancingSilhouetteRenderer(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new PointsInstancingDepthRenderer(this._scene)),this._depthRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new PointsInstancingPickMeshRenderer(this._scene)),this._pickMeshRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new PointsInstancingPickDepthRenderer(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new PointsInstancingOcclusionRenderer(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new PointsInstancingShadowRenderer(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const cachedRenderers={};function getPointsInstancingRenderers(e){const t=e.id;let i=cachedRenderers[t];return i||(i=new PointsInstancingRenderers(e),cachedRenderers[t]=i,i._compile(),e.on("compile",(()=>{i._compile()})),e.on("destroyed",(()=>{delete cachedRenderers[t],i._destroy()}))),i}const tempUint8Vec4=new Uint8Array(4),tempVec4a$4=math.vec4([0,0,0,1]),tempVec4b$4=math.vec4([0,0,0,1]),tempVec4c$2=math.vec4([0,0,0,1]),tempVec3fa=new Float32Array(3);class PointsInstancingLayer{constructor(e){this.model=e.model,this.geometry=e.geometry,this.material=e.material,this.sortId="PointsInstancingLayer",this.layerIndex=e.layerIndex,this._pointsInstancingRenderers=getPointsInstancingRenderers(e.model.scene),this._aabb=math.collapseAABB3(),this._state=new RenderState({obb:math.OBB3(),numInstances:0,origin:e.origin?math.vec3(e.origin):null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.geometry.numIndices,this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],this._finalized=!1,this.aabb=math.collapseAABB3()}createPortion(e){const t=e.meshMatrix,i=e.worldMatrix,s=e.aabb,r=e.pickColor;if(this._finalized)throw"Already finalized";this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(t[0]),this._modelMatrixCol0.push(t[4]),this._modelMatrixCol0.push(t[8]),this._modelMatrixCol0.push(t[12]),this._modelMatrixCol1.push(t[1]),this._modelMatrixCol1.push(t[5]),this._modelMatrixCol1.push(t[9]),this._modelMatrixCol1.push(t[13]),this._modelMatrixCol2.push(t[2]),this._modelMatrixCol2.push(t[6]),this._modelMatrixCol2.push(t[10]),this._modelMatrixCol2.push(t[14]),this._pickColors.push(r[0]),this._pickColors.push(r[1]),this._pickColors.push(r[2]),this._pickColors.push(r[3]),math.collapseAABB3(s);const o=this._state.obb,a=o.length;for(let e=0;e<a;e+=4)tempVec4a$4[0]=o[e+0],tempVec4a$4[1]=o[e+1],tempVec4a$4[2]=o[e+2],math.transformPoint4(t,tempVec4a$4,tempVec4b$4),i?(math.transformPoint4(i,tempVec4b$4,tempVec4c$2),math.expandAABB3Point3(s,tempVec4c$2)):math.expandAABB3Point3(s,tempVec4b$4);if(this._state.origin){const e=this._state.origin;s[0]+=e[0],s[1]+=e[1],s[2]+=e[2],s[3]+=e[0],s[4]+=e[1],s[5]+=e[2]}math.expandAABB3(this.aabb,s),this._state.numInstances++;const n=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,n}finalize(){if(this._finalized)throw"Already finalized";const e=this.model.scene.canvas.gl,t=this._pickColors.length;if(t>0){let i=!1,s=!0;this._state.flagsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Uint8Array(t),t,4,e.DYNAMIC_DRAW,i),this._state.flags2Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Uint8Array(t),t,4,e.DYNAMIC_DRAW,s)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const t=!1;this._state.offsetsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,e.DYNAMIC_DRAW,t),this._offsets=[]}if(this._modelMatrixCol0.length>0){const t=!1;this._state.modelMatrixCol0Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol1Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol2Buf=new ArrayBuf(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,e.STATIC_DRAW,t),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}if(this._pickColors.length>0){const t=!1;this._state.pickColorsBuf=new ArrayBuf(e,e.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,e.STATIC_DRAW,t),this._pickColors=[]}this._finalized=!0}initFlags(e,t,i){t&ENTITY_FLAGS.VISIBLE&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&ENTITY_FLAGS.HIGHLIGHTED&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&ENTITY_FLAGS.XRAYED&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&ENTITY_FLAGS.SELECTED&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&ENTITY_FLAGS.CLIPPABLE&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ENTITY_FLAGS.EDGES&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ENTITY_FLAGS.PICKABLE&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ENTITY_FLAGS.CULLED&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}setVisible(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.VISIBLE?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}setHighlighted(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.HIGHLIGHTED?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}setXRayed(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.XRAYED?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}setSelected(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.SELECTED?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}setEdges(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.EDGES?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CLIPPABLE?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.PICKABLE?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,i)}setCulled(e,t,i){if(!this._finalized)throw"Not finalized";t&ENTITY_FLAGS.CULLED?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}setColor(e,t){if(!this._finalized)throw"Not finalized";tempUint8Vec4[0]=t[0],tempUint8Vec4[1]=t[1],tempUint8Vec4[2]=t[2],this._state.colorsBuf.setData(tempUint8Vec4,3*e,3)}setTransparent(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}_setFlags(e,t,i){if(!this._finalized)throw"Not finalized";const s=!!(t&ENTITY_FLAGS.VISIBLE),r=!!(t&ENTITY_FLAGS.XRAYED),o=!!(t&ENTITY_FLAGS.HIGHLIGHTED),a=!!(t&ENTITY_FLAGS.SELECTED),n=!!(t&ENTITY_FLAGS.CULLED);let h,l;h=!s||n||r?RENDER_PASSES.NOT_RENDERED:i?RENDER_PASSES.COLOR_TRANSPARENT:RENDER_PASSES.COLOR_OPAQUE,l=!s||n?RENDER_PASSES.NOT_RENDERED:a?RENDER_PASSES.SILHOUETTE_SELECTED:o?RENDER_PASSES.SILHOUETTE_HIGHLIGHTED:r?RENDER_PASSES.SILHOUETTE_XRAYED:RENDER_PASSES.NOT_RENDERED;let c=0;c=!s||n?RENDER_PASSES.NOT_RENDERED:a?RENDER_PASSES.EDGES_SELECTED:o?RENDER_PASSES.EDGES_HIGHLIGHTED:r?RENDER_PASSES.EDGES_XRAYED:!!(t&ENTITY_FLAGS.EDGES)?i?RENDER_PASSES.EDGES_COLOR_TRANSPARENT:RENDER_PASSES.EDGES_COLOR_OPAQUE:RENDER_PASSES.NOT_RENDERED;let u=s&&!n&&!!(t&ENTITY_FLAGS.PICKABLE)?RENDER_PASSES.PICK:RENDER_PASSES.NOT_RENDERED;tempUint8Vec4[0]=h,tempUint8Vec4[1]=l,tempUint8Vec4[2]=c,tempUint8Vec4[3]=u,this._state.flagsBuf.setData(tempUint8Vec4,4*e,4)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const i=t&ENTITY_FLAGS.CLIPPABLE?255:0;tempUint8Vec4[0]=i,this._state.flags2Buf.setData(tempUint8Vec4,4*e,4)}setOffset(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(tempVec3fa[0]=t[0],tempVec3fa[1]=t[1],tempVec3fa[2]=t[2],this._state.offsetsBuf.setData(tempVec3fa,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_TRANSPARENT)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_XRAYED)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_HIGHLIGHTED)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,RENDER_PASSES.SILHOUETTE_SELECTED)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawEdgesXRayed(e,t){}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.occlusionRenderer&&this._pointsInstancingRenderers.occlusionRenderer.drawLayer(t,this,RENDER_PASSES.COLOR_OPAQUE)}drawShadow(e,t){}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickMeshRenderer&&this._pointsInstancingRenderers.pickMeshRenderer.drawLayer(t,this,RENDER_PASSES.PICK)}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickDepthRenderer&&this._pointsInstancingRenderers.pickDepthRenderer.drawLayer(t,this,RENDER_PASSES.PICK)}drawPickNormals(e,t){}destroy(){const e=this._state;e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}class PerformanceTextureSet{constructor(e){this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.normalsTexture=e.normalsTexture,this.emissiveTexture=e.emissiveTexture,this.aoTexture=e.aoTexture}destroy(){}}const bigIndicesSupported$1=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint;class PerformanceGeometry{constructor(e,t,i){this.id=i.id,this.model=i.model,this.primitive=i.primitive,this.positions=null,this.positionsCompressed=null,this.quantizedPositions=null,this.positionsDecodeMatrix=math.mat4(),this.normals=null,this.normalsCompressed=null,this.colors=null,this.colorsCompressed=null,this.uv=null,this.uvCompressed=null,this.uvDecodeMatrix=null,this.indices=null,this.numIndices=0,this.obb=math.OBB3(),this.positionsBuf=null,this.normalsBuf=null,this.edgeIndicesBuf=null,this.uvBuf=null,this.colorsBuf=null;const s=t.scene.pickSurfacePrecisionEnabled,r=t.scene.canvas.gl;if(i.positionsCompressed&&i.positionsCompressed.length>0){const e=!1;this.positionsBuf=new ArrayBuf(r,r.ARRAY_BUFFER,i.positionsCompressed,i.positionsCompressed.length,3,r.STATIC_DRAW,e),this.positionsDecodeMatrix.set(i.positionsDecodeMatrix);const t=math.collapseAABB3();math.expandAABB3Points3(t,i.positionsCompressed),geometryCompressionUtils.decompressAABB(t,this.positionsDecodeMatrix),math.AABB3ToOBB3(t,this.obb),s&&(this.quantizedPositions=i.positionsCompressed)}else if(i.positions&&i.positions.length>0){const e=i.positions.length,t=math.collapseAABB3();math.expandAABB3Points3(t,i.positions),math.AABB3ToOBB3(t,this.obb);const o=quantizePositions(i.positions,t,this.positionsDecodeMatrix);let a=!1;this.positionsBuf=new ArrayBuf(r,r.ARRAY_BUFFER,o,e,3,r.STATIC_DRAW,a),s&&(this.quantizedPositions=o)}if(i.normalsCompressed&&i.normalsCompressed.length>0){const e=!0;this.normalsBuf=new ArrayBuf(r,r.ARRAY_BUFFER,i.normalsCompressed,i.normalsCompressed.length,3,r.STATIC_DRAW,e)}else if(i.normals&&i.normals.length>0){const e=octEncodeNormals(i.normals),t=!0;this.normalsBuf=new ArrayBuf(r,r.ARRAY_BUFFER,e,e.length,3,r.STATIC_DRAW,t)}if(i.colorsCompressed&&i.colorsCompressed.length>0){const e=new Uint8Array(i.colorsCompressed),t=!1;this.colorsBuf=new ArrayBuf(r,r.ARRAY_BUFFER,e,e.length,4,r.STATIC_DRAW,t)}else if(i.colors&&i.colors.length>0){const e=i.colors,t=new Uint8Array(e.length);for(let i=0,s=e.length;i<s;i++)t[i]=255*e[i];const s=!1;this.colorsBuf=new ArrayBuf(r,r.ARRAY_BUFFER,t,t.length,4,r.STATIC_DRAW,s)}if(i.uvCompressed&&i.uvCompressed.length>0){const e=new Uint16Array(i.uvCompressed);this.uvDecodeMatrix=math.mat4(i.uvDecodeMatrix),this.uvBuf=new ArrayBuf(r,r.ARRAY_BUFFER,i.uvCompressed,e.length,2,r.STATIC_DRAW,!1)}else if(i.uv&&i.uv.length>0){const e=geometryCompressionUtils.getUVBounds(i.uv),t=geometryCompressionUtils.compressUVs(i.uv,e.min,e.max),s=t.quantized;this.uvDecodeMatrix=t.decodeMatrix,this.uvBuf=new ArrayBuf(r,r.ARRAY_BUFFER,s,s.length,2,r.STATIC_DRAW,!1)}if(i.indices&&i.indices.length>0&&(this.indicesBuf=new ArrayBuf(r,r.ELEMENT_ARRAY_BUFFER,bigIndicesSupported$1?new Uint32Array(i.indices):new Uint16Array(i.indices),i.indices.length,1,r.STATIC_DRAW),s&&(this.indices=i.indices),this.numIndices=i.indices.length),"triangles"===i.primitive||"solid"===i.primitive||"surface"===i.primitive){let e=i.edgeIndices;e||(e=buildEdgeIndices(i.positions,i.indices,null,i.edgeThreshold||10)),this.edgeIndicesBuf=new ArrayBuf(r,r.ELEMENT_ARRAY_BUFFER,bigIndicesSupported$1?new Uint32Array(e):new Uint16Array(e),e.length,1,r.STATIC_DRAW)}}destroy(){}}const webglEnums={funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipmapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipmapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipmapLinear:"NEAREST_MIPMAP_LINEAR",linearMipmapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"};function getGLEnum(e,t,i){if(void 0===t)return i;const s=webglEnums[t];return void 0===s?i:e[s]}const color$2=new Uint8Array([0,0,0,1]);class Texture2D{constructor(e,t){this.gl=e,this.target=t||e.TEXTURE_2D,this.texture=e.createTexture(),this.setPreloadColor([0,0,0,0]),this.allocated=!0}setPreloadColor(e){e?(color$2[0]=Math.floor(255*e[0]),color$2[1]=Math.floor(255*e[1]),color$2[2]=Math.floor(255*e[2]),color$2[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(color$2[0]=0,color$2[1]=0,color$2[2]=0,color$2[3]=255);const t=this.gl;if(t.bindTexture(this.target,this.texture),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,t.NEAREST),this.target===t.TEXTURE_CUBE_MAP){const e=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let i=0,s=e.length;i<s;i++)t.texImage2D(e[i],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,color$2)}else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,color$2);t.bindTexture(this.target,null)}setTarget(e){this.target=e||this.gl.TEXTURE_2D}setImage(e,t){const i=this.gl;if(i.bindTexture(this.target,this.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),this.target===i.TEXTURE_CUBE_MAP){if(utils.isArray(e)){const t=e,s=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let e=0,r=s.length;e<r;e++)i.texImage2D(s[e],0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t[e])}}else i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e);i.bindTexture(this.target,null)}setProps(e){const t=this.gl;if(t.bindTexture(this.target,this.texture),e.minFilter){const i=getGLEnum(t,e.minFilter);i&&(t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,i),i!==t.NEAREST_MIPMAP_NEAREST&&i!==t.LINEAR_MIPMAP_NEAREST&&i!==t.NEAREST_MIPMAP_LINEAR&&i!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(e.magFilter){const i=getGLEnum(t,e.magFilter);i&&t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,i)}if(e.wrapS){const i=getGLEnum(t,e.wrapS);i&&t.texParameteri(this.target,t.TEXTURE_WRAP_S,i)}if(e.wrapT){const i=getGLEnum(t,e.wrapT);i&&t.texParameteri(this.target,t.TEXTURE_WRAP_T,i)}t.bindTexture(this.target,null)}bind(e){if(this.allocated){if(this.texture){const t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1}}unbind(e){if(this.allocated&&this.texture){const t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}}destroy(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}class PerformanceTexture{constructor(e){this.id=e.id,this.texture=new Texture2D(e.model.scene.canvas.gl);const t=e.model.scene;if(e.preloadColor&&(this.texture.setPreloadColor(e.preloadColor),t.glRedraw()),e.image){const i=ensureImageSizePowerOfTwo$2(e.image);i.crossOrigin="Anonymous",this.texture.setImage(i,{}),this.texture.setProps({minFilter:e.minFilter||"linearMipmapLinear",magFilter:e.magFilter||"linear",wrapS:e.wrapS||"repeat",wrapT:e.wrapT||"repeat",flipY:e.flipY||!1,encoding:e.encoding||"linear"}),t.glRedraw()}else if(e.src){t.loading++,t.canvas.spinner.processes++;const i=new Image;i.onload=()=>{i.crossOrigin="Anonymous",this.texture.setImage(ensureImageSizePowerOfTwo$2(i),{}),this.texture.setProps({minFilter:e.minFilter||"linearMipmapLinear",magFilter:e.magFilter||"linear",wrapS:e.wrapS||"repeat",wrapT:e.wrapT||"repeat",flipY:e.flipY||!1,encoding:e.encoding||"linear"}),t.glRedraw(),t.loading--,t.canvas.spinner.processes--},i.src=e.src}}destroy(){this.texture&&(this.texture.destroy(),this.texture=null)}}function ensureImageSizePowerOfTwo$2(e){if(!isPowerOfTwo$2(e.width)||!isPowerOfTwo$2(e.height)){const t=document.createElement("canvas");t.width=nextHighestPowerOfTwo$2(e.width),t.height=nextHighestPowerOfTwo$2(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function isPowerOfTwo$2(e){return 0==(e&e-1)}function nextHighestPowerOfTwo$2(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}const instancedArraysSupported=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.ANGLE_instanced_arrays,tempVec3a$9=math.vec3(),tempMat4$1=math.mat4(),defaultScale=math.vec3([1,1,1]),defaultPosition=math.vec3([0,0,0]),defaultRotation=math.vec3([0,0,0]),defaultQuaternion=math.identityQuaternion(),defaultColorTextureId="defaultColorTexture",defaultMetalRoughTextureId="defaultMetalRoughTexture",defaultNormalsTextureId="defaultNormalsTexture",defaultEmissiveTextureId="defaultEmissiveTexture",defaultAOTextureId="defaultAOTexture",defaultTextureSetId="defaultTextureSet";class PerformanceModel extends Component{constructor(e,t={}){super(e,t),this._maxGeometryBatchSize=t.maxGeometryBatchSize,this._aabb=math.collapseAABB3(),this._aabbDirty=!1,this._layerList=[],this._nodeList=[],this._lastOrigin=null,this._lastPositionsDecodeMatrix=null,this._lastNormals=null,this._instancingLayers={},this._currentBatchingLayers={},this._scratchMemory=getScratchMemory(),this._geometries={},this._textures={},this._textureSets={},this._meshes={},this._nodes={},this.renderFlags=new RenderFlags,this.numGeometries=0,this.numPortions=0,this.numVisibleLayerPortions=0,this.numTransparentLayerPortions=0,this.numXRayedLayerPortions=0,this.numHighlightedLayerPortions=0,this.numSelectedLayerPortions=0,this.numEdgesLayerPortions=0,this.numPickableLayerPortions=0,this.numClippableLayerPortions=0,this.numCulledLayerPortions=0,this.numEntities=0,this._numTriangles=0,this._numLines=0,this._numPoints=0,this._edgeThreshold=t.edgeThreshold||10,this._origin=math.vec3(t.origin||[0,0,0]),this._position=math.vec3(t.position||[0,0,0]),this._rotation=math.vec3(t.rotation||[0,0,0]),this._quaternion=math.vec4(t.quaternion||[0,0,0,1]),t.rotation&&math.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._scale=math.vec3(t.scale||[1,1,1]),this._worldMatrix=math.mat4(),math.composeMat4(this._position,this._quaternion,this._scale,this._worldMatrix),this._worldNormalMatrix=math.mat4(),math.inverseMat4(this._worldMatrix,this._worldNormalMatrix),math.transposeMat4(this._worldNormalMatrix),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(this._viewMatrix=math.mat4(),this._viewNormalMatrix=math.mat4(),this._viewMatrixDirty=!0,this._worldMatrixNonIdentity=!0),this._opacity=1,this._colorize=[1,1,1],this._saoEnabled=!1!==t.saoEnabled,this._pbrEnabled=!!t.pbrEnabled,this._colorTextureEnabled=!1!==t.colorTextureEnabled,this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewMatrixDirty=!0})),this._createDefaultTextureSet(),this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.backfaces=t.backfaces}_createDefaultTextureSet(){const e=new PerformanceTexture({id:"defaultColorTexture",model:this,preloadColor:[.7,.7,.7,1]}),t=new PerformanceTexture({id:"defaultMetalRoughTexture",model:this,preloadColor:[0,1,1,1]}),i=new PerformanceTexture({id:"defaultNormalsTexture",model:this,preloadColor:[1,1,1,1]}),s=new PerformanceTexture({id:"defaultEmissiveTexture",model:this,preloadColor:[0,0,0,1]}),r=new PerformanceTexture({id:"defaultAOTexture",model:this,preloadColor:[1,1,1,1]});this._textures.defaultColorTexture=e,this._textures.defaultMetalRoughTexture=t,this._textures.defaultNormalsTexture=i,this._textures.defaultEmissiveTexture=s,this._textureSets.defaultTextureSet=new PerformanceTextureSet({id:"defaultTextureSet",model:this,colorTexture:e,metallicRoughnessTexture:t,normalsTexture:i,emissiveTexture:s,aoTexture:r})}get isPerformanceModel(){return!0}get objects(){return this._nodes}get origin(){return this._origin}get position(){return this._position}get rotation(){return this._rotation}get quaternion(){return this._quaternion}get scale(){return this._scale}get matrix(){return this._worldMatrix}get worldMatrix(){return this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrix}get viewMatrix(){return this._viewMatrix?(this._viewMatrixDirty&&(math.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),math.inverseMat4(this._viewMatrix,this._viewNormalMatrix),math.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewMatrix):this.scene.camera.viewMatrix}get viewNormalMatrix(){return this._viewNormalMatrix?(this._viewMatrixDirty&&(math.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),math.inverseMat4(this._viewMatrix,this._viewNormalMatrix),math.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}get backfaces(){return this._backfaces}set backfaces(e){e=!!e,this._backfaces=e,this.glRedraw()}get entityList(){return this._nodeList}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return!1}get aabb(){return this._aabbDirty&&this._rebuildAABB(),this._aabb}get numTriangles(){return this._numTriangles}get numLines(){return this._numLines}get numPoints(){return this._numPoints}get visible(){return this.numVisibleLayerPortions>0}set visible(e){e=!1!==e,this._visible=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].visible=e;this.glRedraw()}get xrayed(){return this.numXRayedLayerPortions>0}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].xrayed=e;this.glRedraw()}get highlighted(){return this.numHighlightedLayerPortions>0}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].highlighted=e;this.glRedraw()}get selected(){return this.numSelectedLayerPortions>0}set selected(e){e=!!e,this._selected=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].selected=e;this.glRedraw()}get edges(){return this.numEdgesLayerPortions>0}set edges(e){e=!!e,this._edges=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].edges=e;this.glRedraw()}get culled(){return this._culled}set culled(e){e=!!e,this._culled=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].culled=e;this.glRedraw()}get clippable(){return this._clippable}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].clippable=e;this.glRedraw()}get collidable(){return this._collidable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].collidable=e}get pickable(){return this.numPickableLayerPortions>0}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].pickable=e}get colorize(){return this._colorize}set colorize(e){this._colorize=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].colorize=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;for(let t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].opacity=e}get castsShadow(){return this._castsShadow}set castsShadow(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}get receivesShadow(){return this._receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}get saoEnabled(){return this._saoEnabled}get pbrEnabled(){return this._pbrEnabled}get colorTextureEnabled(){return this._colorTextureEnabled}get isDrawable(){return!0}get isStateSortable(){return!1}get xrayMaterial(){return this.scene.xrayMaterial}get highlightMaterial(){return this.scene.highlightMaterial}get selectedMaterial(){return this.scene.selectedMaterial}get edgeMaterial(){return this.scene.edgeMaterial}getPickViewMatrix(e){return this._viewMatrix?this._viewMatrix:e}createGeometry(e){if(!instancedArraysSupported)return void this.error("WebGL instanced arrays not supported");const t=e.id;if(null==t)return void this.error("Config missing: id");if(this._geometries[t])return void this.error("Geometry already created: "+t);const i=e.primitive;if(null==i)return void this.error("Param expected: primitive");if("points"!==i&&"lines"!==i&&"triangles"!==i&&"solid"!==i&&"surface"!==i)return void this.error(`Unsupported value for 'primitive': '${i}' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.`);if(!e.positions&&!e.positionsCompressed)return this.error("Param expected: `positions` or `positionsCompressed'"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix)return this.error("Param expected: `positionsDecodeMatrix` (required for `positionsCompressed')"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: `uvDecodeMatrix` (required for `uvCompressed')"),null;if(!e.indices&&"points"!==i)return this.error(`Param expected: indices (required for '${i}' primitive type)`),null;const s=new PerformanceGeometry(t,this,e);this._geometries[t]=s,this._numTriangles+=e.indices?Math.round(e.indices.length/3):0,this.numGeometries++}createTexture(e){const t=e.id;if(null==t)return void this.error("Config missing: id");if(this._textures[t])return void this.error("Texture already created: "+t);if(!e.src&&!e.image)return this.error("Param expected: `src` or `image'"),null;let i=e.minFilter||"linearMipmapLinear";"linear"!==i&&"linearMipmapNearest"!==i&&"linearMipmapLinear"!==i&&"nearestMipmapLinear"!==i&&"nearestMipmapNearest"!==i&&(this.error(`[createTexture] Unsupported value for 'minFilter': ${i} - \n            supported values are 'linear', 'linearMipmapNearest', 'nearestMipmapNearest', \n            'nearestMipmapLinear' and 'linearMipmapLinear'. Defaulting to 'linearMipmapLinear'.`),i="linearMipmapLinear");let s=e.magFilter||"linear";"linear"!==s&&"nearest"!==s&&(this.error(`Unsupported value for 'magFilter': ${value} - supported values are 'linear' and 'nearest'. Defaulting to 'linear'.`),s="linear");let r=e.wrapS||"repeat";"clampToEdge"!==r&&"mirroredRepeat"!==r&&"repeat"!==r&&(this.error(`Unsupported value for 'wrapS': '${r}' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'.`),r="repeat");let o=e.wrapT||"repeat";"clampToEdge"!==o&&"mirroredRepeat"!==o&&"repeat"!==o&&(this.error(`Unsupported value for 'wrapT': '${o}' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'.`),o="repeat");let a=e.encoding||"linear";"linear"!==a&&"sRGB"!==a&&"gamma"!==a&&(this.error("Unsupported value for 'encoding': '${encoding}' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),a="linear");const n=new PerformanceTexture({id:t,model:this,src:e.src,image:e.image,magFilter:s,minFilter:i,wrapS:r,wrapT:o,encoding:a});this._textures[t]=n}createTextureSet(e){const t=e.id;if(null==t)return void this.error("Config missing: id");if(this._textureSets[t])return void this.error(`Texture set already created: ${t}`);let i,s,r,o,a;if(void 0!==e.colorTextureId){if(i=this._textures[e.colorTextureId],!i)return void this.error(`Texture not found: ${e.colorTextureId} - ensure that you create it first with createTexture()`)}else i=this._textures.defaultColorTexture;if(void 0!==e.metallicRoughnessTextureId){if(s=this._textures[e.metallicRoughnessTextureId],!s)return void this.error(`Texture not found: ${e.metallicRoughnessTextureId} - ensure that you create it first with createTexture()`)}else s=this._textures.defaultMetalRoughTexture;if(void 0!==e.normalsTextureId){if(r=this._textures[e.normalsTextureId],!r)return void this.error(`Texture not found: ${e.normalsTextureId} - ensure that you create it first with createTexture()`)}else r=this._textures.defaultNormalsTexture;if(void 0!==e.emissiveTextureId){if(o=this._textures[e.emissiveTextureId],!o)return void this.error(`Texture not found: ${e.emissiveTextureId} - ensure that you create it first with createTexture()`)}else o=this._textures.defaultEmissiveTexture;if(void 0!==e.aoTextureId){if(a=this._textures[e.aoTextureId],!a)return void this.error(`Texture not found: ${e.aoTextureId} - ensure that you create it first with createTexture()`)}else a=this._textures.defaultAOTexture;const n=new PerformanceTextureSet({id:t,model:this,colorTexture:i,metallicRoughnessTexture:s,normalsTexture:r,emissiveTexture:o,aoTexture:a});this._textureSets[t]=n}createMesh(e){let t=e.id;if(null==t)return void this.error("Config missing: id");if(this._meshes[t])return void this.error(`PerformanceModel already has a mesh with this ID: ${t}`);const i=e.geometryId,s=void 0!==e.geometryId;if(s&&!this._geometries[e.geometryId])return void this.error(`Geometry not found: ${e.geometryId} - ensure that you create it first with createGeometry()`);const r=e.textureSetId||"defaultTextureSet";if(e.textureSetId&&!this._textureSets[e.textureSetId])return void this.error(`Texture set not found: ${e.textureSetId} - ensure that you create it first with createTextureSet()`);let o;const a=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],n=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,h=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,l=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,c=new PerformanceMesh(this,t,a,n),u=c.pickId,p=new Uint8Array([255&u,u>>8&255,u>>16&255,u>>24&255]),d=math.collapseAABB3();let m;if(s){let t,s=this._worldMatrixNonIdentity?this._worldMatrix:null;if(e.matrix)t=e.matrix;else{const i=e.scale||defaultScale,s=e.position||defaultPosition,r=e.rotation||defaultRotation;math.eulerToQuaternion(r,"XYZ",defaultQuaternion),t=math.composeMat4(s,defaultQuaternion,i,tempMat4$1)}const u=e.origin||e.rtcCenter,f=u?math.addVec3(this._origin,u,tempVec3a$9):this._origin,g=this._getInstancingLayer(f,r,i);m=g,o=g.createPortion({color:a,metallic:h,roughness:l,opacity:n,meshMatrix:t,worldMatrix:s,aabb:d,pickColor:p}),math.expandAABB3(this._aabb,d);const _=Math.round(g.numIndices/3);this._numTriangles+=_,c.numTriangles=_,c.origin=f}else{let t=e.primitive;if(null==t&&(t="triangles"),"points"!==t&&"lines"!==t&&"triangles"!==t&&"solid"!==t&&"surface"!==t)return void this.error(`Unsupported value for 'primitive': '${t}'  ('geometryId' is absent) - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'.`);if(!e.positions&&!e.positionsCompressed)return this.error("Param expected: 'positions' or 'positionsCompressed'  ('geometryId' is absent)"),null;if(e.positions&&e.positionsCompressed)return this.error("Only one param expected, not both: 'positions' or 'positionsCompressed' ('geometryId' is absent)"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix)return this.error("Param expected: 'positionsDecodeMatrix' (required for 'positionsCompressed'; 'geometryId' is absent)"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: `uvDecodeMatrix` (required for `uvCompressed'; 'geometryId' is absent)"),null;if(!e.indices&&"points"!==t)return this.error(`Param expected: indices (required for '${t}' primitive type)`),null;if(!e.indices&&"points"!==t)return this.error("Config expected: indices (no meshIds provided, so expecting geometry arrays instead)"),null;let i=e.indices,s=e.edgeIndices,u=e.origin||e.rtcCenter?math.addVec3(this._origin,e.origin||e.rtcCenter,tempVec3a$9):this._origin,f=e.positions;if(f){const e=math.vec3(),t=[];worldToRTCPositions(f,t,e)&&(f=t,u=math.addVec3(u,e,e))}let g=!1;if(this._lastOrigin?math.compareVec3(this._lastOrigin,u)||(g=!0,this._lastOrigin.set(u)):(g=!0,this._lastOrigin=math.vec3(u)),e.positionsDecodeMatrix&&(this._lastPositionsDecodeMatrix?math.compareMat4(this._lastPositionsDecodeMatrix,e.positionsDecodeMatrix)||(g=!0,this._lastPositionsDecodeMatrix.set(e.positionsDecodeMatrix)):(g=!0,this._lastPositionsDecodeMatrix=math.mat4(e.positionsDecodeMatrix))),e.uvDecodeMatrix&&(this._lastUVDecodeMatrix?math.compareMat4(this._lastUVDecodeMatrix,e.uvDecodeMatrix)||(g=!0,this._lastUVDecodeMatrix.set(e.uvDecodeMatrix)):(g=!0,this._lastUVDecodeMatrix=math.mat4(e.uvDecodeMatrix))),e.textureSetId&&this._lastTextureSetId!==e.textureSetId&&(g=!0,this._lastTextureSetId=e.textureSetId),g){for(let e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].finalize();this._currentBatchingLayers={}}const _=!!e.normals&&e.normals.length>0;"triangles"!==t&&"solid"!==t&&"surface"!==t||(null!==this._lastNormals&&_!==this._lastNormals&&["triangles","solid","surface"].map((e=>{this._currentBatchingLayers[e]&&(this._currentBatchingLayers[e].finalize(),delete this._currentBatchingLayers[e])})),this._lastNormals=_);const y=this._worldMatrixNonIdentity?this._worldMatrix:null;let T;if(!e.positionsDecodeMatrix)if(e.matrix)T=e.matrix;else{const t=e.scale||defaultScale,i=e.position||defaultPosition,s=e.rotation||defaultRotation;math.eulerToQuaternion(s,"XYZ",defaultQuaternion),T=math.composeMat4(i,defaultQuaternion,t,tempMat4$1)}const v=r?this._textureSets[r]:null;m=this._currentBatchingLayers[t];const I=(f||e.positionsCompressed).length;switch(t){case"triangles":case"solid":case"surface":m&&(m.canCreatePortion(I,i.length)||(m.finalize(),delete this._currentBatchingLayers[t],m=null)),m||(m=new TrianglesBatchingLayer({model:this,textureSet:v,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,uvDecodeMatrix:e.uvDecodeMatrix,origin:u,maxGeometryBatchSize:this._maxGeometryBatchSize,solid:"solid"===t,autoNormals:!_}),this._layerList.push(m),this._currentBatchingLayers[t]=m),s||(s=buildEdgeIndices(f||e.positionsCompressed,i,null,this._edgeThreshold)),o=m.createPortion({positions:f,positionsCompressed:e.positionsCompressed,normals:e.normals,normalsCompressed:e.normalsCompressed,colors:e.colors,colorsCompressed:e.colorsCompressed,uv:e.uv,uvCompressed:e.uvCompressed,indices:i,edgeIndices:s,color:a,opacity:n,metallic:h,roughness:l,meshMatrix:T,worldMatrix:y,worldAABB:d,pickColor:p});const r=Math.round(i.length/3);this._numTriangles+=r,c.numTriangles=r;break;case"lines":m&&(m.canCreatePortion(I,i.length)||(m.finalize(),delete this._currentBatchingLayers[t],m=null)),m||(m=new LinesBatchingLayer({model:this,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,origin:u,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(m),this._currentBatchingLayers[t]=m),o=m.createPortion({positions:f,positionsCompressed:e.positionsCompressed,indices:i,colors:e.colors,colorsCompressed:e.colorsCompressed,color:a,opacity:n,meshMatrix:T,worldMatrix:y,worldAABB:d,pickColor:p}),this._numLines+=Math.round(i.length/2);break;case"points":m&&(m.canCreatePortion(I)||(m.finalize(),delete this._currentBatchingLayers[t],m=null)),m||(m=new PointsBatchingLayer({model:this,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,origin:u,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(m),this._currentBatchingLayers[t]=m),o=m.createPortion({positions:f,positionsCompressed:e.positionsCompressed,colors:e.colors,colorsCompressed:e.colorsCompressed,color:a,opacity:n,meshMatrix:T,worldMatrix:y,worldAABB:d,pickColor:p}),this._numPoints+=Math.round(I/3)}math.expandAABB3(this._aabb,d),this.numGeometries++,c.origin=u}c.parent=null,c._layer=m,c._portionId=o,c.aabb=d,this._meshes[t]=c}_getInstancingLayer(e,t,i){const s=`${e[0]}.${e[1]}.${e[2]}.${t}.${i}`;console.log("instancingLayer ID: "+s);let r,o=this._instancingLayers[s];if(o)return o;if(void 0!==t&&(r=this._textureSets[t],!r))return void this.error(`TextureSet not found: ${t} - ensure that you create it first with createTextureSet()`);const a=this._geometries[i];if(this._geometries[i]){switch(a.primitive){case"triangles":case"surface":o=new TrianglesInstancingLayer({model:this,textureSet:r,geometry:a,origin:e,layerIndex:0,solid:!1});break;case"solid":o=new TrianglesInstancingLayer({model:this,textureSet:r,geometry:a,origin:e,layerIndex:0,solid:!0});break;case"lines":o=new LinesInstancingLayer({model:this,textureSet:r,geometry:a,origin:e,layerIndex:0});break;case"points":o=new PointsInstancingLayer({model:this,textureSet:r,geometry:a,origin:e,layerIndex:0})}return this._instancingLayers[s]=o,this._layerList.push(o),o}this.error(`Geometry not found: ${i} - ensure that you create it first with createGeometry()`)}createEntity(e){let t=e.id;void 0===t?t=math.createUUID():this.scene.components[t]&&(this.error("Scene already has a Component with this ID: "+t+" - will assign random ID"),t=math.createUUID());const i=e.meshIds;if(void 0===i)return void this.error("Config missing: meshIds");let s=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],r=this._meshes[t];r?r.parent?this.error("Mesh with ID "+t+" already belongs to object with ID "+r.parent.id+" - ignoring this mesh"):s.push(r):this.error("Mesh with this ID not found: "+t+" - ignoring this mesh")}let r,o=0;if(this._visible&&!1!==e.visible&&(o|=ENTITY_FLAGS.VISIBLE),this._pickable&&!1!==e.pickable&&(o|=ENTITY_FLAGS.PICKABLE),this._culled&&!1!==e.culled&&(o|=ENTITY_FLAGS.CULLED),this._clippable&&!1!==e.clippable&&(o|=ENTITY_FLAGS.CLIPPABLE),this._collidable&&!1!==e.collidable&&(o|=ENTITY_FLAGS.COLLIDABLE),this._edges&&!1!==e.edges&&(o|=ENTITY_FLAGS.EDGES),this._xrayed&&!1!==e.xrayed&&(o|=ENTITY_FLAGS.XRAYED),this._highlighted&&!1!==e.highlighted&&(o|=ENTITY_FLAGS.HIGHLIGHTED),this._selected&&!1!==e.selected&&(o|=ENTITY_FLAGS.SELECTED),1===s.length)r=s[0].aabb;else{r=math.collapseAABB3();for(let e=0,t=s.length;e<t;e++)math.expandAABB3(r,s[e].aabb)}const a=new PerformanceNode(this,e.isObject,t,s,o,r);return this._nodeList.push(a),this._nodes[t]=a,this.numEntities++,a}finalize(){if(!this.destroyed){for(const e in this._instancingLayers)this._instancingLayers.hasOwnProperty(e)&&this._instancingLayers[e].finalize();for(let e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].finalize();this._currentBatchingLayers={};for(let e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize()}for(let e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize2()}this._layerList.sort(((e,t)=>e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0));for(let e=0,t=this._layerList.length;e<t;e++){this._layerList[e].layerIndex=e}this.glRedraw(),this.scene._aabbDirty=!0}}_rebuildAABB(){math.collapseAABB3(this._aabb);for(let e=0,t=this._nodeList.length;e<t;e++){const t=this._nodeList[e];math.expandAABB3(this._aabb,t.aabb)}this._aabbDirty=!1}stateSortCompare(e,t){}rebuildRenderFlags(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}_updateRenderFlagsVisibleLayers(){const e=this.renderFlags;e.numLayers=this._layerList.length,e.numVisibleLayers=0;for(let t=0,i=this._layerList.length;t<i;t++){const i=this._layerList[t];this._getActiveSectionPlanesForLayer(i)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}_getActiveSectionPlanesForLayer(e){const t=this.renderFlags,i=this.scene._sectionPlanesState.sectionPlanes,s=i.length,r=e.layerIndex*s;if(s>0)for(let e=0;e<s;e++){i[e].active?(t.sectionPlanesActivePerLayer[r+e]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[r+e]=!1}return!0}_updateRenderFlags(){if(0===this.numVisibleLayerPortions)return;if(this.numCulledLayerPortions===this.numPortions)return;const e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){const t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0){this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0))}if(this.numSelectedLayerPortions>0){const t=this.scene.selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){const t=this.scene.highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}drawColorOpaque(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawColorOpaque(t,e)}}drawColorTransparent(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawColorTransparent(t,e)}}drawDepth(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawDepth(t,e)}}drawNormals(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawNormals(t,e)}}drawSilhouetteXRayed(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawSilhouetteXRayed(t,e)}}drawSilhouetteHighlighted(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawSilhouetteHighlighted(t,e)}}drawSilhouetteSelected(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawSilhouetteSelected(t,e)}}drawEdgesColorOpaque(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawEdgesColorOpaque(t,e)}}drawEdgesColorTransparent(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawEdgesColorTransparent(t,e)}}drawEdgesXRayed(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawEdgesXRayed(t,e)}}drawEdgesHighlighted(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawEdgesHighlighted(t,e)}}drawEdgesSelected(e){const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawEdgesSelected(t,e)}}drawOcclusion(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawOcclusion(t,e)}}drawShadow(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawShadow(t,e)}}drawPickMesh(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawPickMesh(t,e)}}drawPickDepths(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawPickDepths(t,e)}}drawPickNormals(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let i=0,s=t.visibleLayers.length;i<s;i++){const s=t.visibleLayers[i];this._layerList[s].drawPickNormals(t,e)}}destroy(){for(let e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].destroy();this._currentBatchingLayers={},this.scene.camera.off(this._onCameraViewMatrix);for(let e=0,t=this._layerList.length;e<t;e++)this._layerList[e].destroy();for(let e=0,t=this._nodeList.length;e<t;e++)this._nodeList[e]._destroy();Object.entries(this._geometries).forEach((([e,t])=>{t.destroy()})),this._geometries={},this._textures={},this._textureSets={},this._meshes={},this._nodes={},this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),putScratchMemory(),super.destroy()}}const angleAxis=math.vec4(4),q1=math.vec4(),q2=math.vec4(),xAxis=math.vec3([1,0,0]),yAxis=math.vec3([0,1,0]),zAxis=math.vec3([0,0,1]),veca=math.vec3(3),vecb=math.vec3(3),identityMat=math.identityMat4();class Node$1 extends Component{constructor(e,t={}){if(super(e,t),this._parentNode=null,this._children=[],this._aabb=null,this._aabbDirty=!0,this.scene._aabbDirty=!0,this._numTriangles=0,this._scale=math.vec3(),this._quaternion=math.identityQuaternion(),this._rotation=math.vec3(),this._position=math.vec3(),this._offset=math.vec3(),this._localMatrix=math.identityMat4(),this._worldMatrix=math.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._isObject=t.isObject,this._isObject&&this.scene._registerObject(this),this.origin=t.origin,this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.offset=t.offset,t.children){const e=t.children;for(let i=0,s=e.length;i<s;i++)this.addChild(e[i],t.inheritStates)}if(t.parentId){const e=this.scene.components[t.parentId];e?e.isNode?e.addChild(this):this.error("Parent is not a Node: '"+t.parentId+"'"):this.error("Parent not found: '"+t.parentId+"'")}else t.parent&&(t.parent.isNode||this.error("Parent is not a Node"),t.parent.addChild(this))}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}set origin(e){e?(this._origin||(this._origin=math.vec3()),this._origin.set(e)):this._origin&&(this._origin=null);for(let t=0,i=this._children.length;t<i;t++)this._children[t].origin=e;this.glRedraw()}get origin(){return this._origin}set rtcCenter(e){this.origin=e}get rtcCenter(){return this.origin}get numTriangles(){return this._numTriangles}set visible(e){e=!1!==e,this._visible=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].visible=e;this._isObject&&this.scene._objectVisibilityUpdated(this,e)}get visible(){return this._visible}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].xrayed=e;this._isObject&&this.scene._objectXRayedUpdated(this,e)}get xrayed(){return this._xrayed}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].highlighted=e;this._isObject&&this.scene._objectHighlightedUpdated(this,e)}get highlighted(){return this._highlighted}set selected(e){e=!!e,this._selected=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].selected=e;this._isObject&&this.scene._objectSelectedUpdated(this,e)}get selected(){return this._selected}set edges(e){e=!!e,this._edges=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].edges=e}get edges(){return this._edges}set culled(e){e=!!e,this._culled=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].culled=e}get culled(){return this._culled}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].clippable=e}get clippable(){return this._clippable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].collidable=e}get collidable(){return this._collidable}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].pickable=e}get pickable(){return this._pickable}set colorize(e){let t=this._colorize;t||(t=this._colorize=new Float32Array(4),t[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);for(let e=0,i=this._children.length;e<i;e++)this._children[e].colorize=t;if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t)}}get colorize(){return this._colorize.slice(0,3)}set opacity(e){let t=this._colorize;t||(t=this._colorize=new Float32Array(4),t[0]=1,t[1]=1,t[2]=1),t[3]=null!=e?e:1;for(let t=0,i=this._children.length;t<i;t++)this._children[t].opacity=e;if(this._isObject){const t=null!=e;this.scene._objectOpacityUpdated(this,t)}}get opacity(){return this._colorize[3]}set castsShadow(e){e=!!e,this._castsShadow=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].castsShadow=e}get castsShadow(){return this._castsShadow}set receivesShadow(e){e=!!e,this._receivesShadow=e;for(let t=0,i=this._children.length;t<i;t++)this._children[t].receivesShadow=e}get receivesShadow(){return this._receivesShadow}get saoEnabled(){return!1}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this._children.length;e<t;e++)this._children[e].offset=this._offset;this._isObject&&this.scene._objectOffsetUpdated(this,e)}get offset(){return this._offset}get isNode(){return!0}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0;for(let e=0,t=this._children.length;e<t;e++)this._children[e]._setWorldMatrixDirty()}_buildWorldMatrix(){const e=this.matrix;if(this._parentNode)math.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(let t=0,i=e.length;t<i;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_setSubtreeAABBsDirty(e){if(e._aabbDirty=!0,e._children)for(let t=0,i=e._children.length;t<i;t++)this._setSubtreeAABBsDirty(e._children[t])}_setAABBDirty(){if(this._setSubtreeAABBsDirty(this),this.collidable)for(let e=this;e;e=e._parentNode)e._aabbDirty=!0}_updateAABB(){if(this.scene._aabbDirty=!0,this._aabb||(this._aabb=math.AABB3()),this._buildAABB)this._buildAABB(this.worldMatrix,this._aabb);else{let e;math.collapseAABB3(this._aabb);for(let t=0,i=this._children.length;t<i;t++)e=this._children[t],e.collidable&&math.expandAABB3(this._aabb,e.aabb)}this._aabbDirty=!1}addChild(e,t){if(utils.isNumeric(e)||utils.isString(e)){const t=e;if(!(e=this.scene.component[t]))return void this.warn("Component not found: "+utils.inQuotes(t));if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+t)}else{if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+e.id);if(e._parentNode){if(e._parentNode.id===this.id)return void this.warn("Already a child: "+e.id);e._parentNode.removeChild(e)}}if(e.id,e.scene.id===this.scene.id)return this._children.push(e),e._parentNode=this,t&&(e.visible=this.visible,e.culled=this.culled,e.xrayed=this.xrayed,e.highlited=this.highlighted,e.selected=this.selected,e.edges=this.edges,e.clippable=this.clippable,e.pickable=this.pickable,e.collidable=this.collidable,e.castsShadow=this.castsShadow,e.receivesShadow=this.receivesShadow,e.colorize=this.colorize,e.opacity=this.opacity,e.offset=this.offset),e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles+=e.numTriangles,e;this.error("Child not in same Scene: "+e.id)}removeChild(e){for(let t=0,i=this._children.length;t<i;t++)if(this._children[t].id===e.id)return e._parentNode=null,this._children=this._children.splice(t,1),e._setWorldMatrixDirty(),e._setAABBDirty(),this._setAABBDirty(),void(this._numTriangles-=e.numTriangles)}removeChildren(){let e;for(let t=0,i=this._children.length;t<i;t++)e=this._children[t],e._parentNode=null,e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles-=e.numTriangles;this._children=[],this._setAABBDirty()}get numChildren(){return this._children.length}get children(){return this._children}set parent(e){if(utils.isNumeric(e)||utils.isString(e)){const t=e;if(!(e=this.scene.components[t]))return void this.warn("Node not found: "+utils.inQuotes(t));if(!e.isNode)return void this.error("Not a Node: "+e.id)}e.scene.id===this.scene.id?this._parentNode&&this._parentNode.id===e.id?this.warn("Already a child of Node: "+e.id):e.addChild(this):this.error("Node not in same Scene: "+e.id)}get parent(){return this._parentNode}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),math.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),math.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set matrix(e){this._localMatrix||(this._localMatrix=math.identityMat4()),this._localMatrix.set(e||identityMat),math.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=math.identityMat4()),math.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}rotate(e,t){return angleAxis[0]=e[0],angleAxis[1]=e[1],angleAxis[2]=e[2],angleAxis[3]=t*math.DEGTORAD,math.angleAxisToQuaternion(angleAxis,q1),math.mulQuaternions(this.quaternion,q1,q2),this.quaternion=q2,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(e,t){return angleAxis[0]=e[0],angleAxis[1]=e[1],angleAxis[2]=e[2],angleAxis[3]=t*math.DEGTORAD,math.angleAxisToQuaternion(angleAxis,q1),math.mulQuaternions(q1,this.quaternion,q1),this}rotateX(e){return this.rotate(xAxis,e)}rotateY(e){return this.rotate(yAxis,e)}rotateZ(e){return this.rotate(zAxis,e)}translate(e,t){return math.vec3ApplyQuaternion(this.quaternion,e,veca),math.mulVec3Scalar(veca,t,vecb),math.addVec3(this.position,vecb,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(e){return this.translate(xAxis,e)}translateY(e){return this.translate(yAxis,e)}translateZ(e){return this.translate(zAxis,e)}get type(){return"Node"}destroy(){if(super.destroy(),this._parentNode&&this._parentNode.removeChild(this),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this._children.length){const e=this._children.splice();let t;for(let i=0,s=e.length;i<s;i++)t=e[i],t.destroy()}this._children=[],this._setAABBDirty(),this.scene._aabbDirty=!0}}const memoryStats=stats.memory,bigIndicesSupported=WEBGL_INFO$1.SUPPORTED_EXTENSIONS.OES_element_index_uint,IndexArrayType=bigIndicesSupported?Uint32Array:Uint16Array,tempAABB$1=math.AABB3();class VBOGeometry extends Geometry{get type(){return"VBOGeometry"}get isVBOGeometry(){return!0}constructor(e,t={}){super(e,t),this._state=new RenderState({compressGeometry:!0,primitive:null,primitiveName:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this._aabb=null,this._obb=math.OBB3();const i=this._state,s=this.scene.canvas.gl;switch(t.primitive=t.primitive||"triangles",t.primitive){case"points":i.primitive=s.POINTS,i.primitiveName=t.primitive;break;case"lines":i.primitive=s.LINES,i.primitiveName=t.primitive;break;case"line-loop":i.primitive=s.LINE_LOOP,i.primitiveName=t.primitive;break;case"line-strip":i.primitive=s.LINE_STRIP,i.primitiveName=t.primitive;break;case"triangles":i.primitive=s.TRIANGLES,i.primitiveName=t.primitive;break;case"triangle-strip":i.primitive=s.TRIANGLE_STRIP,i.primitiveName=t.primitive;break;case"triangle-fan":i.primitive=s.TRIANGLE_FAN,i.primitiveName=t.primitive;break;default:this.error("Unsupported value for 'primitive': '"+t.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),i.primitive=s.TRIANGLES,i.primitiveName=t.primitive}if(t.positions)if(t.indices){var r;if(t.positionsDecodeMatrix);else{const e=geometryCompressionUtils.getPositionsBounds(t.positions),o=geometryCompressionUtils.compressPositions(t.positions,e.min,e.max);r=o.quantized,i.positionsDecodeMatrix=o.decodeMatrix,i.positionsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,r,r.length,3,s.STATIC_DRAW),memoryStats.positions+=i.positionsBuf.numItems,math.positions3ToAABB3(t.positions,this._aabb),math.positions3ToAABB3(r,tempAABB$1,i.positionsDecodeMatrix),math.AABB3ToOBB3(tempAABB$1,this._obb)}if(t.colors){const e=t.colors.constructor===Float32Array?t.colors:new Float32Array(t.colors);i.colorsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,e,e.length,4,s.STATIC_DRAW),memoryStats.colors+=i.colorsBuf.numItems}if(t.uv){const e=geometryCompressionUtils.getUVBounds(t.uv),r=geometryCompressionUtils.compressUVs(t.uv,e.min,e.max),o=r.quantized;i.uvDecodeMatrix=r.decodeMatrix,i.uvBuf=new ArrayBuf(s,s.ARRAY_BUFFER,o,o.length,2,s.STATIC_DRAW),memoryStats.uvs+=i.uvBuf.numItems}if(t.normals){const e=geometryCompressionUtils.compressNormals(t.normals);let r=i.compressGeometry;i.normalsBuf=new ArrayBuf(s,s.ARRAY_BUFFER,e,e.length,3,s.STATIC_DRAW,r),memoryStats.normals+=i.normalsBuf.numItems}if(bigIndicesSupported||t.indices.constructor!==Uint32Array){{const e=t.indices.constructor===Uint32Array||t.indices.constructor===Uint16Array?t.indices:new IndexArrayType(t.indices);i.indicesBuf=new ArrayBuf(s,s.ELEMENT_ARRAY_BUFFER,e,e.length,1,s.STATIC_DRAW),memoryStats.indices+=i.indicesBuf.numItems;const o=buildEdgeIndices(r,e,i.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new ArrayBuf(s,s.ELEMENT_ARRAY_BUFFER,o,o.length,1,s.STATIC_DRAW),"triangles"===this._state.primitiveName&&(this._numTriangles=t.indices.length/3)}this._buildHash(),memoryStats.meshes++}else this.error("This WebGL implementation does not support Uint32Array")}else this.error("Config expected: indices");else this.error("Config expected: positions")}_buildHash(){const e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positionsBuf&&t.push("p"),e.colorsBuf&&t.push("c"),(e.normalsBuf||e.autoVertexNormals)&&t.push("n"),e.uvBuf&&t.push("u"),t.push("cp"),t.push(";"),e.hash=t.join("")}_getEdgeIndices(){return this._edgeIndicesBuf}get primitive(){return this._state.primitiveName}get aabb(){return this._aabb}get obb(){return this._obb}get numTriangles(){return this._numTriangles}_getState(){return this._state}destroy(){super.destroy();const e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),e.destroy(),memoryStats.meshes--}}const modes={opaque:0,mask:1,blend:2},modeNames=["opaque","mask","blend"];class MetallicMaterial extends Material{get type(){return"MetallicMaterial"}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"MetallicMaterial",baseColor:math.vec4([1,1,1]),emissive:math.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.baseColor=t.baseColor,this.metallic=t.metallic,this.roughness=t.roughness,this.specularF0=t.specularF0,this.emissive=t.emissive,this.alpha=t.alpha,t.baseColorMap&&(this._baseColorMap=this._checkComponent("Texture",t.baseColorMap)),t.metallicMap&&(this._metallicMap=this._checkComponent("Texture",t.metallicMap)),t.roughnessMap&&(this._roughnessMap=this._checkComponent("Texture",t.roughnessMap)),t.metallicRoughnessMap&&(this._metallicRoughnessMap=this._checkComponent("Texture",t.metallicRoughnessMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this._makeHash()}_makeHash(){const e=this._state,t=["/met"];this._baseColorMap&&(t.push("/bm"),this._baseColorMap._state.hasMatrix&&t.push("/mat"),t.push("/"+this._baseColorMap._state.encoding)),this._metallicMap&&(t.push("/mm"),this._metallicMap._state.hasMatrix&&t.push("/mat")),this._roughnessMap&&(t.push("/rm"),this._roughnessMap._state.hasMatrix&&t.push("/mat")),this._metallicRoughnessMap&&(t.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap._state.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap._state.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/am"),this._alphaMap._state.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap._state.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}set baseColor(e){let t=this._state.baseColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.baseColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get baseColor(){return this._state.baseColor}get baseColorMap(){return this._baseColorMap}set metallic(e){e=null!=e?e:1,this._state.metallic!==e&&(this._state.metallic=e,this.glRedraw())}get metallic(){return this._state.metallic}get metallicMap(){return this._attached.metallicMap}set roughness(e){e=null!=e?e:1,this._state.roughness!==e&&(this._state.roughness=e,this.glRedraw())}get roughness(){return this._state.roughness}get roughnessMap(){return this._attached.roughnessMap}get metallicRoughnessMap(){return this._attached.metallicRoughnessMap}set specularF0(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._attached.emissiveMap}get occlusionMap(){return this._attached.occlusionMap}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._attached.alphaMap}get normalMap(){return this._attached.normalMap}set alphaMode(e){let t=modes[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return modeNames[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}const alphaModes={opaque:0,mask:1,blend:2},alphaModeNames=["opaque","mask","blend"];class SpecularMaterial extends Material{get type(){return"SpecularMaterial"}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"SpecularMaterial",diffuse:math.vec3([1,1,1]),emissive:math.vec3([0,0,0]),specular:math.vec3([1,1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.diffuse=t.diffuse,this.specular=t.specular,this.glossiness=t.glossiness,this.specularF0=t.specularF0,this.emissive=t.emissive,this.alpha=t.alpha,t.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",t.diffuseMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.specularMap&&(this._specularMap=this._checkComponent("Texture",t.specularMap)),t.glossinessMap&&(this._glossinessMap=this._checkComponent("Texture",t.glossinessMap)),t.specularGlossinessMap&&(this._specularGlossinessMap=this._checkComponent("Texture",t.specularGlossinessMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this._makeHash()}_makeHash(){const e=this._state,t=["/spe"];this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat")),this._glossinessMap&&(t.push("/gm"),this._glossinessMap.hasMatrix&&t.push("/mat")),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._specularGlossinessMap&&(t.push("/sgm"),this._specularGlossinessMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}set diffuse(e){let t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}get diffuseMap(){return this._diffuseMap}set specular(e){let t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get specular(){return this._state.specular}get specularMap(){return this._specularMap}get specularGlossinessMap(){return this._specularGlossinessMap}set glossiness(e){e=null!=e?e:1,this._state.glossiness!==e&&(this._state.glossiness=e,this.glRedraw())}get glossiness(){return this._state.glossiness}get glossinessMap(){return this._glossinessMap}set specularF0(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._emissiveMap}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._alphaMap}get normalMap(){return this._normalMap}get occlusionMap(){return this._occlusionMap}set alphaMode(e){let t=alphaModes[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return alphaModeNames[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}function ensureImageSizePowerOfTwo$1(e){if(!isPowerOfTwo$1(e.width)||!isPowerOfTwo$1(e.height)){const t=document.createElement("canvas");t.width=nextHighestPowerOfTwo$1(e.width),t.height=nextHighestPowerOfTwo$1(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function isPowerOfTwo$1(e){return 0==(e&e-1)}function nextHighestPowerOfTwo$1(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}class Texture extends Component{get type(){return"Texture"}constructor(e,t={}){super(e,t),this._state=new RenderState({texture:new Texture2D(this.scene.canvas.gl),matrix:math.identityMat4(),hasMatrix:t.translate&&(0!==t.translate[0]||0!==t.translate[1])||!!t.rotate||t.scale&&(0!==t.scale[0]||0!==t.scale[1]),minFilter:this._checkMinFilter(t.minFilter),magFilter:this._checkMagFilter(t.magFilter),wrapS:this._checkWrapS(t.wrapS),wrapT:this._checkWrapT(t.wrapT),flipY:this._checkFlipY(t.flipY),encoding:this._checkEncoding(t.encoding)}),this._src=null,this._image=null,this._translate=math.vec2([0,0]),this._scale=math.vec2([1,1]),this._rotate=math.vec2([0,0]),this._matrixDirty=!1,this.translate=t.translate,this.scale=t.scale,this.rotate=t.rotate,t.src?this.src=t.src:t.image&&(this.image=t.image),stats.memory.textures++}_checkMinFilter(e){return"linear"!==(e=e||"linearMipmapLinear")&&"linearMipmapNearest"!==e&&"linearMipmapLinear"!==e&&"nearestMipmapLinear"!==e&&"nearestMipmapNearest"!==e&&(this.error("Unsupported value for 'minFilter': '"+e+"' - supported values are 'linear', 'linearMipmapNearest', 'nearestMipmapNearest', 'nearestMipmapLinear' and 'linearMipmapLinear'. Defaulting to 'linearMipmapLinear'."),e="linearMipmapLinear"),e}_checkMagFilter(e){return"linear"!==(e=e||"linear")&&"nearest"!==e&&(this.error("Unsupported value for 'magFilter': '"+e+"' - supported values are 'linear' and 'nearest'. Defaulting to 'linear'."),e="linear"),e}_checkFilter(e){return"linear"!==(e=e||"linear")&&"nearest"!==e&&(this.error("Unsupported value for 'magFilter': '"+e+"' - supported values are 'linear' and 'nearest'. Defaulting to 'linear'."),e="linear"),e}_checkWrapS(e){return"clampToEdge"!==(e=e||"repeat")&&"mirroredRepeat"!==e&&"repeat"!==e&&(this.error("Unsupported value for 'wrapS': '"+e+"' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'."),e="repeat"),e}_checkWrapT(e){return"clampToEdge"!==(e=e||"repeat")&&"mirroredRepeat"!==e&&"repeat"!==e&&(this.error("Unsupported value for 'wrapT': '"+e+"' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'."),e="repeat"),e}_checkFlipY(e){return!!e}_checkEncoding(e){return"linear"!==(e=e||"linear")&&"sRGB"!==e&&"gamma"!==e&&(this.error("Unsupported value for 'encoding': '"+e+"' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),e="linear"),e}_webglContextRestored(){this._state.texture=new Texture2D(this.scene.canvas.gl),this._image?this.image=this._image:this._src&&(this.src=this._src)}_update(){const e=this._state;if(this._matrixDirty){let t,i;0===this._translate[0]&&0===this._translate[1]||(t=math.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix)),1===this._scale[0]&&1===this._scale[1]||(i=math.scalingMat4v([this._scale[0],this._scale[1],1]),t=t?math.mulMat4(t,i):i),0!==this._rotate&&(i=math.rotationMat4v(.0174532925*this._rotate,[0,0,1]),t=t?math.mulMat4(t,i):i),t&&(e.matrix=t),this._matrixDirty=!1}this.glRedraw()}set image(e){this._image=ensureImageSizePowerOfTwo$1(e),this._image.crossOrigin="Anonymous",this._state.texture.setImage(this._image,this._state),this._state.texture.setProps(this._state),this._src=null,this.glRedraw()}get image(){return this._image}set src(e){this.scene.loading++,this.scene.canvas.spinner.processes++;const t=this;let i=new Image;i.onload=function(){i=ensureImageSizePowerOfTwo$1(i),t._state.texture.setImage(i,t._state),t._state.texture.setProps(t._state),t.scene.loading--,t.glRedraw(),t.scene.canvas.spinner.processes--},i.src=e,this._src=e,this._image=null}get src(){return this._src}set translate(e){this._translate.set(e||[0,0]),this._matrixDirty=!0,this._needUpdate()}get translate(){return this._translate}set scale(e){this._scale.set(e||[1,1]),this._matrixDirty=!0,this._needUpdate()}get scale(){return this._scale}set rotate(e){e=e||0,this._rotate!==e&&(this._rotate=e,this._matrixDirty=!0,this._needUpdate())}get rotate(){return this._rotate}get minFilter(){return this._state.minFilter}get magFilter(){return this._state.magFilter}get wrapS(){return this._state.wrapS}get wrapT(){return this._state.wrapT}get flipY(){return this._state.flipY}get encoding(){return this._state.encoding}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),this._state.destroy(),stats.memory.textures--}}class GLTFSceneGraphLoader{constructor(e){}load(e,t,i,s,r,o){s=s||{};var a=t.scene.canvas.spinner;a.processes++,loadGLTF$1(e,t,i,s,(function(){a.processes--,core.scheduleTask((function(){t.scene.fire("modelLoaded",t.id),t.fire("loaded",!0,!1)})),r&&r()}),(function(e){a.processes--,t.error(e),o&&o(e),t.fire("error",e)}))}parse(e,t,i,s,r,o){s=s||{};var a=t.scene.canvas.spinner;a.processes++,parseGLTF$1(e,i,"",s,t,(function(){a.processes--,t.scene.fire("modelLoaded",t.id),t.fire("loaded",!0,!1),r&&r()}),(function(e){a.processes--,t.error(e),t.fire("error",e),o&&o(e)}))}}var loadGLTF$1=function(e,t,i,s,r,o){e.dataSource.getGLTF(i,(function(a){s.basePath=function(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(i),parseGLTF$1(e,a,i,s,t,r,o)}),o)},parseGLTF$1=function(){const e={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};return function(e,t,c,u,p,d){p.clear();var m={src:c,loadBuffer:u.loadBuffer,basePath:u.basePath,prioritizeGLTFNode:u.prioritizeGLTFNode,handleGLTFNode:u.handleGLTFNode,ignoreMaterials:!!u.ignoreMaterials,edgeThreshold:u.edgeThreshold,readableGeometry:!!u.readableGeometry,json:t,scene:p.scene,plugin:e,modelNode:p,modelNodeProps:{visible:p.visible,culled:p.culled,xrayed:p.xrayed,highlighted:p.highlighted,selected:p.selected,outlined:p.outlined,clippable:p.clippable,pickable:p.pickable,collidable:p.collidable,castsShadow:p.castsShadow,receivesShadow:p.receivesShadow,colorize:p.colorize,opacity:p.opacity,edges:p.edges}};p.scene.loading++,function(e,t){var s=e.json.buffers;if(s)for(var r=s.length,o=0,a=s.length;o<a;o++)i(e,s[o],(function(){0==--r&&t()}),(function(i){e.plugin.error(i),0==--r&&t()}));else t()}(m,(function(){!function(e){var t=e.json.bufferViews;if(t)for(var i=0,r=t.length;i<r;i++)s(e,t[i])}(m),function(e){var t=e.json.accessors;if(t)for(var i=0,s=t.length;i<s;i++)r(e,t[i])}(m),function(e){var t=e.json.textures;if(t)for(var i=0,s=t.length;i<s;i++)o(e,t[i])}(m),function(e){var t,i,s=e.json.materials;if(s)for(var r=0,o=s.length;r<o;r++)i=a(e,t=s[r]),t._material=i}(m),function(e){var t=e.json.meshes;if(t)for(var i=0,s=t.length;i<s;i++)n(e,t[i])}(m),function(e){var t=e.json,i=t.scene||0,s=t.scenes[i];if(!s)return void l(e,"glTF has no default scene");!function(e,t){var i=t.nodes;if(!i)return;for(var s,r=e.json,o=0,a=i.length;o<a;o++)(s=r.nodes[i[o]])?h(e,s,null,null):l(e,"Node not found: "+o)}(e,s)}(m),p.scene.loading--,d()}))};function i(e,t,i,s){var r=t.uri;r?e.plugin.dataSource.getArrayBuffer(e.src,r,(function(e){t._buffer=e,i()}),s):s("gltf/handleBuffer missing uri in "+JSON.stringify(t))}function s(e,t){var i=e.json.buffers[t.buffer];t._typedArray=null;var s=t.byteLength||0,r=t.byteOffset||0;t._buffer=i._buffer.slice(r,r+s)}function r(i,s){var r=i.json.bufferViews[s.bufferView],o=t[s.type],a=e[s.componentType],n=a.BYTES_PER_ELEMENT*o;s.byteStride&&s.byteStride!==n||(s._typedArray=new a(r._buffer,s.byteOffset||0,s.count*o),s._itemSize=o)}function o(e,t){let i=e.json.images[t.source].uri;i&&!i.match(/^data:(.*?)(;base64)?,(.*)$/)&&(i=e.basePath+i),t._texture=new Texture(e.modelNode,{src:i,flipY:!!t.flipY,encoding:"linear"})}function a(e,t){var i,s=e.json,r={},o=t.normalTexture;o&&(i=s.textures[o.index])&&(r.normalMap=i._texture);var a=t.occlusionTexture;a&&(i=s.textures[a.index])&&(r.occlusionMap=i._texture);var n=t.emissiveTexture;n&&(i=s.textures[n.index])&&(r.emissiveMap=i._texture);var h=t.emissiveFactor;switch(h&&(r.emissive=h),r.backfaces=!!t.doubleSided,t.alphaMode){case"NORMAL_OPAQUE":r.alphaMode="opaque";break;case"MASK":r.alphaMode="mask";break;case"BLEND":r.alphaMode="blend"}var l=t.alphaCutoff;void 0!==l&&(r.alphaCutoff=l);var c=t.extensions;if(c){var u=c.KHR_materials_pbrSpecularGlossiness;if(u){var p=u.diffuseFactor;null!=p&&(r.diffuse=p.slice(0,3),r.alpha=p[3]);var d=u.diffuseTexture;d&&(i=s.textures[d.index])&&(r.diffuseMap=i._texture);var m=u.specularFactor;null!=m&&(r.specular=m.slice(0,3));var f=u.glossinessFactor;null!=f&&(r.glossiness=f);var g=u.specularGlossinessTexture;return g&&(i=s.textures[g.index])&&(r.specularGlossinessMap=i._texture),new SpecularMaterial(e.modelNode,r)}var _=c.KHR_materials_common;if(_){var y,T=_.technique,v=_.values||{},I="BLINN"===T,E="PHONG"===T,P="LAMBERT"===T,b=v.shininess;r.shininess=(I||E)&&null!=b?b:0;var D=v.diffuse;D&&(I||E||P)?utils.isString(D)?(y=s.textures[D])&&(r.diffuseMap=y):r.diffuse=D.slice(0,3):r.diffuse=[0,0,0];var w=v.specular;w&&(I||E)?utils.isString(w)?(y=s.textures[w])&&(r.specularMap=y):r.specular=w.slice(0,3):r.specular=[0,0,0];var C=v.emission;C?utils.isString(C)?(y=s.textures[C])&&(r.emissiveMap=y):r.emissive=C.slice(0,3):r.emissive=[0,0,0];var R=v.transparency;return r.alpha=null!=R?R:1,v.transparent,new PhongMaterial(e.scene,r)}}var F=t.pbrMetallicRoughness;if(F){var S=F.baseColorFactor;S&&(r.baseColor=S.slice(0,3),r.alpha=S[3]);var x=F.colorTexture;x&&(i=s.textures[x.index])&&(r.baseColorMap=i._texture);var M=F.metallicFactor;null!=M&&(r.metallic=M);var A=F.roughnessFactor;null!=A&&(r.roughness=A);var L=F.metallicRoughnessTexture;return L&&(i=s.textures[L.index])&&(r.metallicRoughnessMap=i._texture),new MetallicMaterial(e.scene,r)}return new PhongMaterial(e.scene,r)}function n(e,t){var i,s,r,o,a=e.json,n=[],h=t.primitives;if(h)for(var l,c,u,p,d,m,f,g,_=0,y=h.length;_<y;_++)(l=h[_]).mode<4||(m={primitive:"triangles",compressGeometry:!0,edgeThreshold:e.edgeThreshold},null!=(c=l.indices)&&(r=a.accessors[c],m.indices=r._typedArray),(o=l.attributes)&&(null!=(u=o.POSITION)&&(r=a.accessors[u],m.positions=r._typedArray),null!=(p=o.NORMAL)&&(r=a.accessors[p],m.normals=r._typedArray),null!=(d=o.TEXCOORD_0)&&(r=a.accessors[d],m.uv=r._typedArray),f={},g=e.readableGeometry?new ReadableGeometry(e.modelNode,m):new VBOGeometry(e.modelNode,m),f.geometry=g,null!=(i=l.material)&&(s=a.materials[i])&&(f.material=s._material),n.push(f)));t._mesh=n}function h(e,t,i,s){var r;if(s=s||e.modelNode,e.prioritizeGLTFNode){const i=e.prioritizeGLTFNode(e.modelNode.id,t);if(null==i)return}if(e.handleGLTFNode){var o={};if(!e.handleGLTFNode(e.modelNode.id,t,o))return;o.createEntity&&(r=o.createEntity)}const a=e.json,n=e.modelNode,c=t.children&&t.children.length>0;var u;if(t.matrix&&(u=t.matrix,i=i?math.mulMat4(i,u,math.mat4()):u),t.translation&&(u=math.translationMat4v(t.translation),i=i?math.mulMat4(i,u,u):u),t.rotation&&(u=math.quaternionToMat4(t.rotation),i=i?math.mulMat4(i,u,u):u),t.scale&&(u=math.scalingMat4v(t.scale),i=i?math.mulMat4(i,u,u):u),void 0!==t.mesh){var p=a.meshes[t.mesh];if(p){var d,m,f=p._mesh,g=f.length;if(!r&&g>0&&!c){for(var _=0,y=g;_<y;_++){let t={geometry:(d=f[_]).geometry,matrix:i};utils.apply(e.modelNodeProps,t),t.material=d.material,m=new Mesh(n,t),s.addChild(m,!1)}return}if(r&&1===g&&!c){let t={geometry:(d=f[0]).geometry,matrix:i};return utils.apply(e.modelNodeProps,t),t.material=d.material,utils.apply(r,t),m=new Mesh(n,t),void s.addChild(m,!1)}if(r&&g>0&&!c){let t={matrix:i};utils.apply(e.modelNodeProps,t),utils.apply(r,t);let o=new Node$1(n,t);s.addChild(o,!1);for(let t=0,i=g;t<i;t++){d=f[t];let i={geometry:d.geometry};utils.apply(e.modelNodeProps,i),i.material=d.material,utils.apply(r,i),i.id=null,m=new Mesh(n,i),o.addChild(m,!1)}return}if(!r&&g>0&&c){let t={matrix:i};utils.apply(e.modelNodeProps,t);let r=new Node$1(n,t);s.addChild(r,!1);for(let e=0,i=g;e<i;e++){d=f[e];let i={geometry:d.geometry};utils.apply(t,i),i.id=null,i.matrix=null,i.material=d.material,m=new Mesh(n,i),r.addChild(m,!1)}i=null,s=r}if(r&&0===g&&c){let t={matrix:i};utils.apply(e.modelNodeProps,t),utils.apply(r,t),r.matrix=i;let o=new Node$1(n,t);s.addChild(o,!1),i=null,s=o}if(r&&g>0||c){let t={matrix:i};utils.apply(e.modelNodeProps,t),r&&utils.apply(r,t);let o=new Node$1(n,t);s.addChild(o,!1);for(let t=0,i=g;t<i;t++){d=f[t];let i={geometry:d.geometry};utils.apply(e.modelProps,i),i.material=d.material,r&&utils.apply(r,i),i.id=null,m=new Mesh(n,i),o.addChild(m,!1)}i=null,s=o}}}if(t.children){var T,v,I=t.children;for(let t=0,r=I.length;t<r;t++)v=I[t],(T=a.nodes[v])?h(e,T,i,s):l(e,"Node not found: "+t)}}function l(e,t){e.plugin.error(t)}}();class GLTFPerformanceModelLoader{constructor(e){}load(e,t,i,s,r,o){loadGLTF(e,t,i,s=s||{},(function(){core.scheduleTask((function(){t.scene.fire("modelLoaded",t.id),t.fire("loaded",!0,!1)})),r&&r()}),(function(i){e.error(i),o&&o(i),t.fire("error",i)}))}parse(e,t,i,s,r,o){parseGLTF(e,i,"",s=s||{},t,(function(){t.scene.fire("modelLoaded",t.id),t.fire("loaded",!0,!1),r&&r()}),(function(e){t.error(e),t.fire("error",e),o&&o(e)}))}}const loadGLTF=function(e,t,i,s,r,o){const a=e.viewer.scene.canvas.spinner;a.processes++,e.dataSource.getGLTF(i,(function(n){a.processes--,s.basePath=function(e){const t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(i),parseGLTF(e,n,i,s,t,r,o)}),o)},parseGLTF=function(){const e={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};return function(e,t,l,c,p,d){const m={src:l,loadBuffer:c.loadBuffer,basePath:c.basePath,handleGLTFNode:c.handleGLTFNode,json:t,scene:p.scene,plugin:e,performanceModel:p,geometryCreated:{},numObjects:0,nodes:[],nextId:0},f=e.viewer.scene.canvas.spinner;f.processes++,function(e,t){const s=e.json.buffers;if(s){let r=s.length;for(let o=0,a=s.length;o<a;o++)i(e,s[o],(function(){0==--r&&t()}),(function(i){e.plugin.error(i),0==--r&&t()}))}else t()}(m,(function(){!function(e){const t=e.json.bufferViews;if(t)for(let i=0,r=t.length;i<r;i++)s(e,t[i])}(m),function(e){const t=e.json.buffers;if(t)for(let e=0,i=t.length;e<i;e++)t[e]._buffer=null}(m),function(e){const t=e.json.textures;if(t)for(let i=0,s=t.length;i<s;i++)r(e,t[i])}(m),function(e){const t=e.json.materials;if(t)for(let i=0,s=t.length;i<s;i++){const s=t[i];s._textureSetId=o(e,s),s._attributes=a(e,s)}}(m),f.processes--,function(e){const t=e.json,i=t.scene||0,s=t.scenes[i];if(!s)return void u(e,"glTF has no default scene");(function(e,t){const i=t.nodes;if(!i)return;const s=e.json;for(let t=0,r=i.length;t<r;t++){s.nodes[i[t]]?n(e,t):u(e,"Node not found: "+t)}})(e,s),function(e,t){const i=t.nodes;if(!i)return;const s=e.json;for(let t=0,r=i.length;t<r;t++){const r=s.nodes[i[t]];r?n(e,r):u(e,"Node not found: "+t)}e.plugin.viewer.scene.canvas.spinner.processes++;for(let t=0,r=i.length;t<r;t++){h(e,s.nodes[i[t]],null)}e.plugin.viewer.scene.canvas.spinner.processes--}(e,s)}(m),p.finalize(),d()}))};function i(e,t,i,s){const r=t.uri;r?e.plugin.dataSource.getArrayBuffer(e.src,r,(function(e){t._buffer=e,i()}),s):s("gltf/handleBuffer missing uri in "+JSON.stringify(t))}function s(e,t){const i=e.json.buffers[t.buffer];t._typedArray=null;const s=t.byteLength||0,r=t.byteOffset||0;t._buffer=i._buffer.slice(r,r+s)}function r(e,t){const i="texture-"+e.nextId++;let s=e.json.images[t.source].uri;s&&!s.match(/^data:(.*?)(;base64)?,(.*)$/)&&(s=e.basePath+s),e.performanceModel.createTexture({id:i,src:s,flipY:!!t.flipY}),t._textureId=i}function o(e,t){const i=e.json,s={id:"textureSet-"+e.nextId++},r=t.normalTexture;if(r){const e=i.textures[r.index];e&&(s.normalTextureId=e._textureId)}const o=t.pbrMetallicRoughness;if(o){const e=o.baseColorTexture||o.colorTexture;if(e){const t=i.textures[e.index];t&&(s.colorTextureId=t._textureId)}const t=o.metallicRoughnessTexture;if(t){const e=i.textures[t.index];e&&(s.metallicRoughnessTextureId=e._textureId)}}return e.performanceModel.createTextureSet(s),s.id}function a(e,t){const i=t.extensions,s={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1};if(i){const e=i.KHR_materials_pbrSpecularGlossiness;if(e){const t=e.diffuseFactor;null!=t&&s.color.set(t)}const t=i.KHR_materials_common;if(t){const e=t.technique,i=t.values||{},r="BLINN"===e,o="PHONG"===e,a="LAMBERT"===e,n=i.diffuse;n&&(r||o||a)&&(utils.isString(n)||s.color.set(n));const h=i.transparency;null!=h&&(s.opacity=h);const l=i.transparent;null!=l&&(s.opacity=l)}}const r=t.pbrMetallicRoughness;if(r){const e=r.baseColorFactor;e&&(s.color[0]=e[0],s.color[1]=e[1],s.color[2]=e[2],s.opacity=e[3]);const t=r.metallicFactor;null!=t&&(s.metallic=t);const i=r.roughnessFactor;null!=i&&(s.roughness=i)}return s}function n(e,t){const i=e.json;if(void 0!==t.mesh){const e=i.meshes[t.mesh];e&&(e.instances=e.instances?e.instances+1:1)}if(t.children){const s=t.children;for(let t=0,r=s.length;t<r;t++){const r=s[t],o=i.nodes[r];o?n(e,o):u(e,"Node not found: "+t)}}}function h(e,t,i){const s=e.json;let r;if(t.matrix&&(r=t.matrix,i=i?math.mulMat4(i,r,math.mat4()):r),t.translation&&(r=math.translationMat4v(t.translation),i=i?math.mulMat4(i,r,math.mat4()):r),t.rotation&&(r=math.quaternionToMat4(t.rotation),i=i?math.mulMat4(i,r,math.mat4()):r),t.scale&&(r=math.scalingMat4v(t.scale),i=i?math.mulMat4(i,r,math.mat4()):r),void 0!==t.mesh){const r=s.meshes[t.mesh];if(r){let o;if(e.handleGLTFNode){const i={};if(!e.handleGLTFNode(e.performanceModel.id,t,i))return;i.createEntity&&(o=i.createEntity)}const a=e.performanceModel,n=i?i.slice():math.identityMat4(),h=r.primitives.length;if(h>0){const t=[];for(let i=0;i<h;i++){const h=r.primitives[i];if(h.mode<4)continue;const c={id:a.id+"."+e.numObjects++},u=h.material;let p;null!=u&&(p=s.materials[u]),p?(c.textureSetId=p._textureSetId,c.color=p._attributes.color,c.opacity=p._attributes.opacity,c.metallic=p._attributes.metallic,c.roughness=p._attributes.roughness):(c.color=new Float32Array([1,1,1]),c.opacity=1),o&&(o.colorize&&(c.color=o.colorize),void 0!==o.opacity&&null!==o.opacity&&(c.opacity=o.opacity)),l(e,h,c),math.transformPositions3(n,c.localPositions,c.positions);const d=math.vec3();worldToRTCPositions(c.positions,c.positions,d)&&(c.origin=d),a.createMesh(c),t.push(c.id)}o?a.createEntity(utils.apply(o,{meshIds:t})):a.createEntity({meshIds:t})}}}if(t.children){const r=t.children;for(let t=0,o=r.length;t<o;t++){const o=r[t],a=s.nodes[o];a?h(e,a,i):u(e,"Node not found: "+t)}}}function l(e,t,i){const s=t.attributes;if(!s)return;i.primitive="triangles";const r=t.indices;if(null!=r){const t=e.json.accessors[r];i.indices=c(e,t)}const o=s.POSITION;if(null!=o){const t=e.json.accessors[o];i.localPositions=c(e,t),i.positions=new Float64Array(i.localPositions.length)}const a=s.NORMAL;if(null!=a){const t=e.json.accessors[a];i.normals=c(e,t)}const n=s.TEXCOORD_0;if(null!=n){const t=e.json.accessors[n];i.uv=c(e,t)}i.indices&&(i.edgeIndices=buildEdgeIndices(i.localPositions,i.indices,null,10))}function c(i,s){const r=i.json.bufferViews[s.bufferView],o=t[s.type],a=e[s.componentType],n=a.BYTES_PER_ELEMENT*o;if(!s.byteStride||s.byteStride===n)return new a(r._buffer,s.byteOffset||0,s.count*o);u("interleaved buffer!")}function u(e,t){e.plugin.error(t)}}(),IFCObjectDefaults={IfcOpeningElement:{pickable:!1,visible:!1},IfcSpace:{colorize:[.137255,.403922,.870588],pickable:!1,visible:!1,opacity:.4},IfcWindow:{colorize:[.137255,.403922,.870588],opacity:.3},IfcPlate:{colorize:[.8470588235,.427450980392,0,.5],opacity:.3},DEFAULT:{}};class GLTFLoaderPlugin extends Plugin{constructor(e,t={}){super("GLTFLoader",e,t),this._sceneGraphLoader=new GLTFSceneGraphLoader(this,t),this._performanceModelLoader=new GLTFPerformanceModelLoader(this,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults}set dataSource(e){this._dataSource=e||new GLTFDefaultDataSource}get dataSource(){return this._dataSource}set objectDefaults(e){this._objectDefaults=e||IFCObjectDefaults}get objectDefaults(){return this._objectDefaults}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=!1!==e.performance,i=t?new PerformanceModel(this.viewer.scene,utils.apply(e,{isModel:!0})):new Node$1(this.viewer.scene,utils.apply(e,{isModel:!0})),s=i.id;if(!e.src&&!e.gltf)return this.error("load() param expected: src or gltf"),i;const r=t?this._performanceModelLoader:this._sceneGraphLoader;if(e.metaModelSrc||e.metaModelData){const t=e.objectDefaults||this._objectDefaults||IFCObjectDefaults,o=o=>{var a;if(this.viewer.metaScene.createMetaModel(s,o,{includeTypes:e.includeTypes,excludeTypes:e.excludeTypes}),this.viewer.scene.canvas.spinner.processes--,e.includeTypes){a={};for(let t=0,i=e.includeTypes.length;t<i;t++)a[e.includeTypes[t]]=!0}if(e.excludeTypes){a||(a={});for(let t=0,i=e.excludeTypes.length;t<i;t++)a[e.excludeTypes[t]]=!0}e.readableGeometry=!1,e.handleGLTFNode=(e,i,s)=>{const r=i.name;if(!r)return!0;const o=r,a=this.viewer.metaScene.metaObjects[o],n=(a?a.type:"DEFAULT")||"DEFAULT";s.createEntity={id:o,isObject:!0};const h=t[n];return h&&(!1===h.visible&&(s.createEntity.visible=!1),h.colorize&&(s.createEntity.colorize=h.colorize),!1===h.pickable&&(s.createEntity.pickable=!1),void 0!==h.opacity&&null!==h.opacity&&(s.createEntity.opacity=h.opacity)),!0},e.src?r.load(this,i,e.src,e):r.parse(this,i,e.gltf,e)};if(e.metaModelSrc){const t=e.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(t,(e=>{this.viewer.scene.canvas.spinner.processes--,o(e)}),(e=>{this.error(`load(): Failed to load model metadata for model '${s} from  '${t}' - ${e}`),this.viewer.scene.canvas.spinner.processes--}))}else e.metaModelData&&o(e.metaModelData)}else e.handleGLTFNode=(e,t,i)=>{const s=t.name;if(!s)return!0;const r=s;return i.createEntity={id:r,isObject:!0},!0},e.src?r.load(this,i,e.src,e):r.parse(this,i,e.gltf,e);return i.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),i}destroy(){super.destroy()}}function CubeTextureCanvas(e,t={}){const i="lightgrey",s=t.hoverColor||"rgba(0,0,0,0.4)",r=500,o=r+r/3,a=o/24,n=[{boundary:[6,6,6,6],color:t.frontColor||t.color||"#55FF55"},{boundary:[18,6,6,6],color:t.backColor||t.color||"#55FF55"},{boundary:[12,6,6,6],color:t.leftColor||t.color||"#FF5555"},{boundary:[0,6,6,6],color:t.rightColor||t.color||"#FF5555"},{boundary:[6,0,6,6],color:t.topColor||t.color||"#7777FF"},{boundary:[6,12,6,6],color:t.bottomColor||t.color||"#7777FF"}],h=[{label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,1,0],up:[0,0,1]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,-1,0],up:[0,0,1]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,0,1]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,0,1]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,0,1],up:[0,-1,0]},{boundaries:[[7,5,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,0,-1],up:[1,0,1]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-1,-1],up:[0,-1,1]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,0,-1],up:[-1,0,1]},{boundaries:[[7,11,4,2]],dir:[0,1,1],up:[0,-1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,0,1],up:[-1,0,1]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,-1,1],up:[0,1,1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,0,1],up:[1,0,1]},{boundaries:[[5,7,2,4]],dir:[1,1,0],up:[0,0,1]},{boundaries:[[11,7,2,4]],dir:[-1,1,0],up:[0,0,1]},{boundaries:[[17,7,2,4]],dir:[-1,-1,0],up:[0,0,1]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,-1,0],up:[0,0,1]},{boundaries:[[5,11,2,2]],dir:[1,1,1],up:[-1,-1,1]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[1,-1,1],up:[-1,1,1]},{boundaries:[[5,5,2,2]],dir:[1,1,-1],up:[1,1,1]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-1,-1,1],up:[1,1,1]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-1,-1,-1],up:[-1,-1,1]},{boundaries:[[11,11,2,2]],dir:[-1,1,1],up:[1,-1,1]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[1,-1,-1],up:[1,-1,1]},{boundaries:[[11,5,2,2]],dir:[-1,1,-1],up:[-1,1,1]}];t.frontColor||t.color,t.backColor||t.color,t.leftColor||t.color,t.rightColor||t.color,t.topColor||t.color,t.bottomColor||t.color;const l=[{yUp:"",label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,0,1],up:[0,1,0]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,1,0]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,1,0]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,-1,0],up:[0,0,-1]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,1,0],up:[0,0,1]},{boundaries:[[7,5,4,2]],dir:[0,-.7071,-.7071],up:[0,.7071,-.7071]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,-1,0],up:[1,1,0]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-.7071,.7071],up:[0,.7071,.7071]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,-1,0],up:[-1,1,0]},{boundaries:[[7,11,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,1,0],up:[-1,1,0]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,1,1],up:[0,1,-1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,1,0],up:[1,1,0]},{boundaries:[[5,7,2,4]],dir:[1,0,-1],up:[0,1,0]},{boundaries:[[11,7,2,4]],dir:[-1,0,-1],up:[0,1,0]},{boundaries:[[17,7,2,4]],dir:[-1,0,1],up:[0,1,0]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,0,1],up:[0,1,0]},{boundaries:[[5,11,2,2]],dir:[.5,.7071,-.5],up:[-.5,.7071,.5]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[.5,.7071,.5],up:[-.5,.7071,-.5]},{boundaries:[[5,5,2,2]],dir:[.5,-.7071,-.5],up:[.5,.7071,-.5]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-.5,.7071,.5],up:[.5,.7071,-.5]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-.5,-.7071,.5],up:[-.5,.7071,.5]},{boundaries:[[11,11,2,2]],dir:[-.5,.7071,-.5],up:[.5,.7071,.5]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[.5,-.7071,.5],up:[.5,.7071,.5]},{boundaries:[[11,5,2,2]],dir:[-.5,-.7071,-.5],up:[-.5,.7071,-.5]}];for(let e=0,t=h.length;e<t;e++)math.normalizeVec3(h[e].dir,h[e].dir),math.normalizeVec3(h[e].up,h[e].up);for(let e=0,t=l.length;e<t;e++)math.normalizeVec3(l[e].dir,l[e].dir),math.normalizeVec3(l[e].up,l[e].up);var c=l;this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=o,this._textureCanvas.height=r,this._textureCanvas.style.width=o+"px",this._textureCanvas.style.height="500px",this._textureCanvas.style.padding="0",this._textureCanvas.style.margin="0",this._textureCanvas.style.top="0",this._textureCanvas.style.background=i,this._textureCanvas.style.position="absolute",this._textureCanvas.style.opacity="1.0",this._textureCanvas.style.visibility="hidden",this._textureCanvas.style["z-index"]=2e6;document.getElementsByTagName("body")[0].appendChild(this._textureCanvas);const u=this._textureCanvas.getContext("2d");let p=!1;function d(){for(let e=0,t=n.length;e<t;e++){const t=n[e],i=t.boundary,s=Math.round(i[0]*a),r=Math.round(i[1]*a),o=Math.round(i[2]*a),h=Math.round(i[3]*a);u.fillStyle=t.color,u.fillRect(s,r,o,h)}for(let e=0,n=c.length;e<n;e++){let n,l,p,d;const f=c[e],g=f.boundaries;for(var t=0,r=g.length;t<r;t++){const e=g[t];n=Math.round(e[0]*a),l=Math.round(e[1]*a),p=Math.round(e[2]*a),d=Math.round(e[3]*a),f.highlighted&&(u.fillStyle=f.highlighted?s:f.color||i,u.fillRect(n,l,p,d))}if(f.label){u.fillStyle="black",u.font="60px sans-serif",u.textAlign="center";var o=n+.5*p,h=l+.7*d;u.fillText(m(f.label),o,h,80)}}e.scene.glRedraw()}const m=function(){const t={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},i={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},s={"NavCube.front":"FRONT","NavCube.back":"BACK","NavCube.right":"RIGHT","NavCube.left":"LEFT","NavCube.top":"TOP","NavCube.bottom":"BOTTOM"};return function(r){const o=p?i:t,a=o?o[r]:null;return a?e.localeService.translate(a)||s[a]||a:r}}();this.setZUp=function(){p=!0,c=h,this.clear()},this.setYUp=function(){p=!1,c=l,this.clear()},this.clear=function(){u.fillStyle=i,u.fillRect(0,0,o,r);for(var e=0,t=c.length;e<t;e++){c[e].highlighted=!1}d()},this.getArea=function(e){const t=e[0]*o,i=r-e[1]*r;for(var s=0,n=c.length;s<n;s++){const e=c[s].boundaries;for(var h=0,l=e.length;h<l;h++){const r=e[h];if(t>=r[0]*a&&t<=(r[0]+r[2])*a&&i>=r[1]*a&&i<=(r[1]+r[3])*a)return s}}return-1},this.setAreaHighlighted=function(e,t){var i=c[e];if(!i)throw"Area not found: "+e;i.highlighted=!!t,d()},this.getAreaDir=function(e){var t=c[e];if(!t)throw"Unknown area: "+e;return t.dir},this.getAreaUp=function(e){var t=c[e];if(!t)throw"Unknown area: "+e;return t.up},this.getImage=function(){return this._textureCanvas},this.destroy=function(){this._textureCanvas&&(this._textureCanvas.parentNode.removeChild(this._textureCanvas),this._textureCanvas=null)}}class NavCubePlugin extends Plugin{constructor(e,t={}){super("NavCube",e,t),e.navCube=this;try{this._navCubeScene=new Scene(e,{canvasId:t.canvasId,canvasElement:t.canvasElement,transparent:!0}),this._navCubeCanvas=this._navCubeScene.canvas.canvas,this._navCubeScene.input.keyboardEnabled=!1}catch(e){return void this.error(e)}const i=this._navCubeScene;i.clearLights(),new DirLight(i,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new DirLight(i,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new DirLight(i,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._navCubeCamera=i.camera,this._navCubeCamera.ortho.scale=7,this._navCubeCamera.ortho.near=.1,this._navCubeCamera.ortho.far=2e3,i.edgeMaterial.edgeColor=[.2,.2,.2],i.edgeMaterial.edgeAlpha=.6,this._zUp=Boolean(e.camera.zUp);var s=this;this._synchCamera=function(){var t=math.rotationMat4c(-90*math.DEGTORAD,1,0,0),i=math.vec3(),r=math.vec3(),o=math.vec3();return function(){var a=e.camera.eye,n=e.camera.look,h=e.camera.up;i=math.mulVec3Scalar(math.normalizeVec3(math.subVec3(a,n,i)),5),s._zUp?(math.transformVec3(t,i,r),math.transformVec3(t,h,o),s._navCubeCamera.look=[0,0,0],s._navCubeCamera.eye=math.transformVec3(t,i,r),s._navCubeCamera.up=math.transformPoint3(t,h,o)):(s._navCubeCamera.look=[0,0,0],s._navCubeCamera.eye=i,s._navCubeCamera.up=h)}}(),this._cubeTextureCanvas=new CubeTextureCanvas(e,t),this._cubeSampler=new Texture(i,{image:this._cubeTextureCanvas.getImage(),flipY:!0,wrapS:"clampToEdge",wrapT:"clampToEdge"}),this._cubeMesh=new Mesh(i,{geometry:new ReadableGeometry(i,{primitive:"triangles",normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),material:new PhongMaterial(i,{diffuse:[.4,.4,.4],specular:[.4,.4,.4],emissive:[.6,.6,.6],diffuseMap:this._cubeSampler,emissiveMap:this._cubeSampler}),visible:!0,edges:!0}),this._shadow=!1===t.shadowVisible?null:new Mesh(i,{geometry:new ReadableGeometry(i,buildCylinderGeometry({center:[0,0,0],radiusTop:.001,radiusBottom:1.4,height:.01,radialSegments:20,heightSegments:1,openEnded:!0})),material:new PhongMaterial(i,{diffuse:[0,0,0],specular:[0,0,0],emissive:[0,0,0],alpha:.5}),position:[0,-1.5,0],visible:!0,pickable:!1,backfaces:!1}),this._onCameraMatrix=e.camera.on("matrix",this._synchCamera),this._onCameraWorldAxis=e.camera.on("worldAxis",(()=>{e.camera.zUp?(this._zUp=!0,this._cubeTextureCanvas.setZUp(),this._repaint(),this._synchCamera()):e.camera.yUp&&(this._zUp=!1,this._cubeTextureCanvas.setYUp(),this._repaint(),this._synchCamera())})),this._onCameraFOV=e.camera.perspective.on("fov",(e=>{this._synchProjection&&(this._navCubeCamera.perspective.fov=e)})),this._onCameraProjection=e.camera.on("projection",(e=>{this._synchProjection&&(this._navCubeCamera.projection="ortho"===e||"perspective"===e?e:"perspective")}));var r=-1;function o(e){var t=[0,0];if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t}var a,n,h=null,l=null,c=!1,u=!1,p=.5;s._navCubeCanvas.addEventListener("mouseenter",s._onMouseEnter=function(e){u=!0}),s._navCubeCanvas.addEventListener("mouseleave",s._onMouseLeave=function(e){u=!1}),s._navCubeCanvas.addEventListener("mousedown",s._onMouseDown=function(e){if(1===e.which){h=e.x,l=e.y,a=e.clientX,n=e.clientY;var t=o(e),s=i.pick({canvasPos:t});c=!!s}}),document.addEventListener("mouseup",s._onMouseUp=function(e){if(1===e.which&&(c=!1,null!==h)){var t=o(e),a=i.pick({canvasPos:t,pickSurface:!0});if(a&&a.uv){var n=s._cubeTextureCanvas.getArea(a.uv);if(n>=0&&(document.body.style.cursor="pointer",r>=0&&(s._cubeTextureCanvas.setAreaHighlighted(r,!1),s._repaint(),r=-1),n>=0)){if(s._cubeTextureCanvas.setAreaHighlighted(n,!0),r=n,s._repaint(),e.x<h-3||e.x>h+3||e.y<l-3||e.y>l+3)return;var u=s._cubeTextureCanvas.getAreaDir(n);if(u){var p=s._cubeTextureCanvas.getAreaUp(n);d(u,p,(function(){r>=0&&(s._cubeTextureCanvas.setAreaHighlighted(r,!1),s._repaint(),r=-1),document.body.style.cursor="pointer",r>=0&&(s._cubeTextureCanvas.setAreaHighlighted(r,!1),s._repaint(),r=-1),n>=0&&(s._cubeTextureCanvas.setAreaHighlighted(n,!1),r=-1,s._repaint())}))}}}}}),document.addEventListener("mousemove",s._onMouseMove=function(t){if(r>=0&&(s._cubeTextureCanvas.setAreaHighlighted(r,!1),s._repaint(),r=-1),1!==t.buttons||c){if(c){var h=t.clientX,l=t.clientY;return document.body.style.cursor="move",void function(t,i){var s=(t-a)*-p,r=(i-n)*-p;e.camera.orbitYaw(s),e.camera.orbitPitch(-r),a=t,n=i}(h,l)}if(u){var d=o(t),m=i.pick({canvasPos:d,pickSurface:!0});if(m){if(m.uv){document.body.style.cursor="pointer";var f=s._cubeTextureCanvas.getArea(m.uv);if(f===r)return;r>=0&&s._cubeTextureCanvas.setAreaHighlighted(r,!1),f>=0&&(s._cubeTextureCanvas.setAreaHighlighted(f,!0),s._repaint(),r=f)}}else document.body.style.cursor="default",r>=0&&(s._cubeTextureCanvas.setAreaHighlighted(r,!1),s._repaint(),r=-1)}}});var d=function(){var t=math.vec3();return function(i,r,o){var a=s._fitVisible?e.scene.getAABB(e.scene.visibleObjectIds):e.scene.aabb,n=math.getAABB3Diag(a);math.getAABB3Center(a,t);var h=Math.abs(n/Math.tan(s._cameraFitFOV*math.DEGTORAD));e.cameraControl.pivotPos=t,s._cameraFly?e.cameraFlight.flyTo({look:t,eye:[t[0]-h*i[0],t[1]-h*i[1],t[2]-h*i[2]],up:r||[0,1,0],orthoScale:1.1*n,fitFOV:s._cameraFitFOV,duration:s._cameraFlyDuration},o):e.cameraFlight.jumpTo({look:t,eye:[t[0]-h*i[0],t[1]-h*i[1],t[2]-h*i[2]],up:r||[0,1,0],orthoScale:1.1*n,fitFOV:s._cameraFitFOV},o)}}();this._onUpdated=e.localeService.on("updated",(()=>{this._cubeTextureCanvas.clear(),this._repaint()})),this.setVisible(t.visible),this.setCameraFitFOV(t.cameraFitFOV),this.setCameraFly(t.cameraFly),this.setCameraFlyDuration(t.cameraFlyDuration),this.setFitVisible(t.fitVisible),this.setSynchProjection(t.synchProjection)}send(e,t){if("language"===e)this._cubeTextureCanvas.clear(),this._repaint()}_repaint(){const e=this._cubeTextureCanvas.getImage();this._cubeMesh.material.diffuseMap.image=e,this._cubeMesh.material.emissiveMap.image=e}setVisible(e=!0){this._navCubeCanvas&&(this._cubeMesh.visible=e,this._shadow&&(this._shadow.visible=e),this._navCubeCanvas.style.visibility=e?"visible":"hidden")}getVisible(){return!!this._navCubeCanvas&&this._cubeMesh.visible}setFitVisible(e=!1){this._fitVisible=e}getFitVisible(){return this._fitVisible}setCameraFly(e=!0){this._cameraFly=e}getCameraFly(){return this._cameraFly}setCameraFitFOV(e=45){this._cameraFitFOV=e}getCameraFitFOV(){return this._cameraFitFOV}setCameraFlyDuration(e=.5){this._cameraFlyDuration=e}getCameraFlyDuration(){return this._cameraFlyDuration}setSynchProjection(e=!1){this._synchProjection=e}getSynchProjection(){return this._synchProjection}destroy(){this._navCubeCanvas&&(this.viewer.localeService.off(this._onUpdated),this.viewer.camera.off(this._onCameraMatrix),this.viewer.camera.off(this._onCameraWorldAxis),this.viewer.camera.perspective.off(this._onCameraFOV),this.viewer.camera.off(this._onCameraProjection),this._navCubeCanvas.removeEventListener("mouseenter",this._onMouseEnter),this._navCubeCanvas.removeEventListener("mouseleave",this._onMouseLeave),this._navCubeCanvas.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._navCubeCanvas=null,this._cubeTextureCanvas.destroy(),this._cubeTextureCanvas=null,this._onMouseEnter=null,this._onMouseLeave=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null),this._navCubeScene.destroy(),this._navCubeScene=null,this._cubeMesh=null,this._shadow=null,super.destroy()}}const tempVec3a$8=math.vec3();class OBJSceneGraphLoader{load(e,t,i={}){var s=e.scene.canvas.spinner;s.processes++,loadOBJ(e,t,(function(t){loadMTLs(e,t,(function(){createMeshes(e,t),s.processes--,core.scheduleTask((function(){e.fire("loaded",!0,!1)}))}))}))}parse(e,t,i,s){if(t){var r=parseOBJ(e,t,null);i&&parseMTL(e,i,s),createMeshes(e,r),e.src=null,e.fire("loaded",!0,!1)}else this.warn("load() param expected: objText")}}var loadOBJ=function(e,t,i){loadFile(t,(function(s){var r=parseOBJ(e,s,t);i(r)}),(function(t){e.error(t)}))},parseOBJ=function(){const e={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};return function(i,s,r){var o,a,n={src:r=r||"",basePath:(o=r,a=o.lastIndexOf("/"),-1===a?o:o.substring(0,a+1)),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};t(n,"",!1),-1!==s.indexOf("\r\n")&&(s=s.replace("\r\n","\n"));for(var h=s.split("\n"),l="",p="",d="",m=[],f="function"==typeof"".trimLeft,g=0,_=h.length;g<_;g++)if(l=h[g],0!==(l=f?l.trimLeft():l.trim()).length&&"#"!==(p=l.charAt(0)))if("v"===p)if(" "===(d=l.charAt(1))&&null!==(m=e.vertex_pattern.exec(l)))n.positions.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));else if("n"===d&&null!==(m=e.normal_pattern.exec(l)))n.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));else{if("t"!==d||null===(m=e.uv_pattern.exec(l)))return void i.error("Unexpected vertex/normal/uv line: '"+l+"'");n.uv.push(parseFloat(m[1]),parseFloat(m[2]))}else if("f"===p)if(null!==(m=e.face_vertex_uv_normal.exec(l)))c(n,m[1],m[4],m[7],m[10],m[2],m[5],m[8],m[11],m[3],m[6],m[9],m[12]);else if(null!==(m=e.face_vertex_uv.exec(l)))c(n,m[1],m[3],m[5],m[7],m[2],m[4],m[6],m[8]);else if(null!==(m=e.face_vertex_normal.exec(l)))c(n,m[1],m[3],m[5],m[7],void 0,void 0,void 0,void 0,m[2],m[4],m[6],m[8]);else{if(null===(m=e.face_vertex.exec(l)))return void i.error("Unexpected face line: '"+l+"'");c(n,m[1],m[2],m[3],m[4])}else if("l"===p){var y=l.substring(1).trim().split(" "),T=[],v=[];if(-1===l.indexOf("/"))T=y;else for(var I=0,E=y.length;I<E;I++){var P=y[I].split("/");""!==P[0]&&T.push(P[0]),""!==P[1]&&v.push(P[1])}u(n,T,v)}else if(null!==(m=e.object_pattern.exec(l))){t(n,b=m[0].substr(1).trim(),!0)}else if(e.material_use_pattern.test(l)){var b=l.substring(7).trim();n.object.material.id=b}else if(e.material_library_pattern.test(l))n.materialLibraries[l.substring(7).trim()]=!0;else{if(null===(m=e.smoothing_pattern.exec(l))){if("\0"===l)continue;return void i.error("Unexpected line: '"+l+"'")}var D=m[1].trim().toLowerCase();n.object.material.smooth="1"===D||"on"===D}return n};function t(e,t,i){if(e.object&&!1===e.object.fromDeclaration)return e.object.id=t,void(e.object.fromDeclaration=!1!==i);e.object={id:t||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==i},e.objects.push(e.object)}function i(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)}function s(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)}function r(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)}function o(e,t,i,s){var r=e.positions,o=e.object.geometry.positions;o.push(r[t+0]),o.push(r[t+1]),o.push(r[t+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[s+2])}function a(e,t){var i=e.positions,s=e.object.geometry.positions;s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2])}function n(e,t,i,s){var r=e.normals,o=e.object.geometry.normals;o.push(r[t+0]),o.push(r[t+1]),o.push(r[t+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[s+2])}function h(e,t,i,s){var r=e.uv,o=e.object.geometry.uv;o.push(r[t+0]),o.push(r[t+1]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[s+0]),o.push(r[s+1])}function l(e,t){var i=e.uv,s=e.object.geometry.uv;s.push(i[t+0]),s.push(i[t+1])}function c(e,t,a,l,c,u,p,d,m,f,g,_,y){var T,v=e.positions.length,I=i(t,v),E=i(a,v),P=i(l,v);if(void 0===c?o(e,I,E,P):(o(e,I,E,T=i(c,v)),o(e,E,P,T)),void 0!==u){var b=e.uv.length;I=r(u,b),E=r(p,b),P=r(d,b),void 0===c?h(e,I,E,P):(h(e,I,E,T=r(m,b)),h(e,E,P,T))}if(void 0!==f){var D=e.normals.length;I=s(f,D),E=f===g?I:s(g,D),P=f===_?I:s(_,D),void 0===c?n(e,I,E,P):(n(e,I,E,T=s(y,D)),n(e,E,P,T))}}function u(e,t,s){e.object.geometry.type="Line";for(var o=e.positions.length,n=e.uv.length,h=0,c=t.length;h<c;h++)a(e,i(t[h],o));for(var u=0,p=s.length;u<p;u++)l(e,r(s[u],n))}}();function loadMTLs(e,t,i){for(var s=t.basePath,r=Object.keys(t.materialLibraries),o=r.length,a=0,n=o;a<n;a++)loadMTL(e,s,s+r[a],(function(){0==--o&&i()}))}var loadMTL=function(e,t,i,s){loadFile(i,(function(i){parseMTL(e,i,t),s()}),(function(t){e.error(t),s()}))},parseMTL=function(){var e=/\s+/;return function(e,r,o){var a,n,h,l,c,u=r.split("\n"),p={id:"Default"},d=!1;o=o||"";for(var m=0;m<u.length;m++)if(0!==(a=u[m].trim()).length&&"#"!==a.charAt(0))switch(h=(h=(n=a.indexOf(" "))>=0?a.substring(0,n):a).toLowerCase(),l=(l=n>=0?a.substring(n+1):"").trim(),h.toLowerCase()){case"newmtl":i(e,p),p={id:l},d=!0;break;case"ka":p.ambient=s(l);break;case"kd":p.diffuse=s(l);break;case"ks":p.specular=s(l);break;case"map_kd":p.diffuseMap||(p.diffuseMap=t(e,o,l,"sRGB"));break;case"map_ks":p.specularMap||(p.specularMap=t(e,o,l,"linear"));break;case"map_bump":case"bump":p.normalMap||(p.normalMap=t(e,o,l));break;case"ns":p.shininess=parseFloat(l);break;case"d":(c=parseFloat(l))<1&&(p.alpha=c,p.alphaMode="blend");break;case"tr":(c=parseFloat(l))>0&&(p.alpha=1-c,p.alphaMode="blend")}d&&i(e,p)};function t(e,t,i,s){var r={},o=i.split(/\s+/),a=o.indexOf("-bm");return a>=0&&o.splice(a,2),(a=o.indexOf("-s"))>=0&&(r.scale=[parseFloat(o[a+1]),parseFloat(o[a+2])],o.splice(a,4)),(a=o.indexOf("-o"))>=0&&(r.translate=[parseFloat(o[a+1]),parseFloat(o[a+2])],o.splice(a,4)),r.src=t+o.join(" ").trim(),r.flipY=!0,r.encoding=s||"linear",new Texture(e,r).id}function i(e,t){new PhongMaterial(e,t)}function s(t){var i=t.split(e,3);return[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])]}}();function createMeshes(e,t){for(var i=0,s=t.objects.length;i<s;i++){var r=t.objects[i],o=r.geometry;if(o.type,0===o.positions.length)continue;var a={primitive:"triangles",compressGeometry:!1};a.positions=o.positions,o.normals.length>0&&(a.normals=o.normals),o.uv.length>0&&(a.uv=o.uv);for(var n=new Array(a.positions.length/3),h=0;h<n.length;h++)n[h]=h;a.indices=n;const s=tempVec3a$8;worldToRTCPositions(o.positions,o.positions,s);var l,c=new ReadableGeometry(e,a),u=r.material.id;u&&""!==u?(l=e.scene.components[u])||e.error("Material not found: "+u):l=new PhongMaterial(e,{diffuse:[.6,.6,.6],backfaces:!0});var p=new Mesh(e,{id:e.id+"#"+r.id,origin:0!==s[0]||0!==s[1]||0!==s[2]?s:null,isObject:!0,geometry:c,material:l,pickable:!0});e.addChild(p)}}function loadFile(e,t,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",(function(e){var s=e.target.response;200===this.status?t&&t(s):0===this.status?(console.warn("loadFile: HTTP Status 0 received."),t&&t(s)):i&&i(e)}),!1),s.addEventListener("error",(function(e){i&&i(e)}),!1),s.send(null)}class OBJLoaderPlugin extends Plugin{constructor(e,t){super("OBJLoader",e,t),this._sceneGraphLoader=new OBJSceneGraphLoader}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new Node$1(this.viewer.scene,utils.apply(e,{isModel:!0}));const i=t.id,s=e.src;if(!s)return this.error("load() param expected: src"),t;if(e.metaModelSrc){const r=e.metaModelSrc;utils.loadJSON(r,(r=>{this.viewer.metaScene.createMetaModel(i,r),this._sceneGraphLoader.load(t,s,e)}),(e=>{this.error(`load(): Failed to load model modelMetadata for model '${i} from  '${r}' - ${e}`)}))}else this._sceneGraphLoader.load(t,s,e);return t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(i)})),t}destroy(){super.destroy()}}function buildTorusGeometry(e={}){let t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;let i=e.tube||.3;i<0&&(console.error("negative tube not allowed - will invert"),i*=-1);let s=e.radialSegments||32;s<0&&(console.error("negative radialSegments not allowed - will invert"),s*=-1),s<4&&(s=4);let r=e.tubeSegments||24;r<0&&(console.error("negative tubeSegments not allowed - will invert"),r*=-1),r<4&&(r=4);let o=e.arc||2*Math.PI;o<0&&(console.warn("negative arc not allowed - will invert"),o*=-1),o>360&&(o=360);const a=e.center;let n=a?a[0]:0,h=a?a[1]:0;const l=a?a[2]:0,c=[],u=[],p=[],d=[];let m,f,g,_,y,T,v,I,E,P,b,D;for(I=0;I<=r;I++)for(v=0;v<=s;v++)m=v/s*o,f=.785398+I/r*Math.PI*2,n=t*Math.cos(m),h=t*Math.sin(m),g=(t+i*Math.cos(f))*Math.cos(m),_=(t+i*Math.cos(f))*Math.sin(m),y=i*Math.sin(f),c.push(g+n),c.push(_+h),c.push(y+l),p.push(1-v/s),p.push(I/r),T=math.normalizeVec3(math.subVec3([g,_,y],[n,h,l],[]),[]),u.push(T[0]),u.push(T[1]),u.push(T[2]);for(I=1;I<=r;I++)for(v=1;v<=s;v++)E=(s+1)*I+v-1,P=(s+1)*(I-1)+v-1,b=(s+1)*(I-1)+v,D=(s+1)*I+v,d.push(E),d.push(P),d.push(b),d.push(b),d.push(D),d.push(E);return utils.apply(e,{positions:c,normals:u,uv:p,indices:d})}const zeroVec$1=new Float64Array([0,0,1]),quat=new Float64Array(4);class Control{constructor(e){this.id=null,this._viewer=e.viewer,this._visible=!1,this._pos=math.vec3(),this._origin=math.vec3(),this._rtcPos=math.vec3(),this._baseDir=math.vec3(),this._rootNode=null,this._displayMeshes=null,this._affordanceMeshes=null,this._ignoreNextSectionPlaneDirUpdate=!1,this._createNodes(),this._bindEvents()}_setSectionPlane(e){this._sectionPlane&&(this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._onSectionPlanePos=null,this._onSectionPlaneDir=null,this._sectionPlane=null),e&&(this.id=e.id,this._setPos(e.pos),this._setDir(e.dir),this._sectionPlane=e,this._onSectionPlanePos=e.on("pos",(()=>{this._setPos(this._sectionPlane.pos)})),this._onSectionPlaneDir=e.on("dir",(()=>{this._ignoreNextSectionPlaneDirUpdate?this._ignoreNextSectionPlaneDirUpdate=!1:this._setDir(this._sectionPlane.dir)})))}get sectionPlane(){return this._sectionPlane}_setPos(e){this._pos.set(e),worldToRTCPos(this._pos,this._origin,this._rtcPos),this._rootNode.origin=this._origin,this._rootNode.position=this._rtcPos}_setDir(e){this._baseDir.set(e),this._rootNode.quaternion=math.vec3PairToQuaternion(zeroVec$1,e,quat)}_setSectionPlaneDir(e){this._sectionPlane&&(this._ignoreNextSectionPlaneDirUpdate=!0,this._sectionPlane.dir=e)}setVisible(e=!0){if(this._visible!==e){var t;for(t in this._visible=e,this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].visible=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].visible=e)}}getVisible(){return this._visible}setCulled(e){var t;for(t in this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].culled=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].culled=e)}_createNodes(){const e=!1,t=this._viewer.scene,i=.01;this._rootNode=new Node$1(t,{position:[0,0,0],scale:[5,5,5]});const s=this._rootNode,r={arrowHead:new ReadableGeometry(s,buildCylinderGeometry({radiusTop:.001,radiusBottom:.07,radialSegments:32,heightSegments:1,height:.2,openEnded:!1})),arrowHeadBig:new ReadableGeometry(s,buildCylinderGeometry({radiusTop:.001,radiusBottom:.09,radialSegments:32,heightSegments:1,height:.25,openEnded:!1})),arrowHeadHandle:new ReadableGeometry(s,buildCylinderGeometry({radiusTop:.09,radiusBottom:.09,radialSegments:8,heightSegments:1,height:.37,openEnded:!1})),curve:new ReadableGeometry(s,buildTorusGeometry({radius:.8,tube:i,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),curveHandle:new ReadableGeometry(s,buildTorusGeometry({radius:.8,tube:.06,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),hoop:new ReadableGeometry(s,buildTorusGeometry({radius:.8,tube:i,radialSegments:64,tubeSegments:8,arc:2*Math.PI})),axis:new ReadableGeometry(s,buildCylinderGeometry({radiusTop:i,radiusBottom:i,radialSegments:20,heightSegments:1,height:1,openEnded:!1})),axisHandle:new ReadableGeometry(s,buildCylinderGeometry({radiusTop:.08,radiusBottom:.08,radialSegments:20,heightSegments:1,height:1,openEnded:!1}))},o={pickable:new PhongMaterial(s,{diffuse:[1,1,0],alpha:0,alphaMode:"blend"}),red:new PhongMaterial(s,{diffuse:[1,0,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightRed:new EmphasisMaterial(s,{edges:!1,fill:!0,fillColor:[1,0,0],fillAlpha:.6}),green:new PhongMaterial(s,{diffuse:[0,1,0],emissive:[0,1,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightGreen:new EmphasisMaterial(s,{edges:!1,fill:!0,fillColor:[0,1,0],fillAlpha:.6}),blue:new PhongMaterial(s,{diffuse:[0,0,1],emissive:[0,0,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightBlue:new EmphasisMaterial(s,{edges:!1,fill:!0,fillColor:[0,0,1],fillAlpha:.2}),center:new PhongMaterial(s,{diffuse:[0,0,0],emissive:[0,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80}),highlightBall:new EmphasisMaterial(s,{edges:!1,fill:!0,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1}),highlightPlane:new EmphasisMaterial(s,{edges:!0,edgeWidth:3,fill:!1,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1})};this._displayMeshes={plane:s.addChild(new Mesh(s,{geometry:new ReadableGeometry(s,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new PhongMaterial(s,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,ghostMaterial:new EmphasisMaterial(s,{edges:!1,filled:!0,fillColor:[1,1,0],edgeColor:[0,0,0],fillAlpha:.1,backfaces:!0}),pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1]}),e),planeFrame:s.addChild(new Mesh(s,{geometry:new ReadableGeometry(s,buildTorusGeometry({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new PhongMaterial(s,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),highlightMaterial:new EmphasisMaterial(s,{edges:!1,edgeColor:[0,0,0],filled:!0,fillColor:[.8,.8,.8],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45]}),e),xCurve:s.addChild(new Mesh(s,{geometry:r.curve,material:o.red,matrix:function(){const e=math.rotationMat4v(90*math.DEGTORAD,[0,1,0],math.identityMat4()),t=math.rotationMat4v(270*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xCurveHandle:s.addChild(new Mesh(s,{geometry:r.curveHandle,material:o.pickable,matrix:function(){const e=math.rotationMat4v(90*math.DEGTORAD,[0,1,0],math.identityMat4()),t=math.rotationMat4v(270*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xCurveArrow1:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.red,matrix:function(){const e=math.translateMat4c(0,-.07,-.8,math.identityMat4()),t=math.scaleMat4v([.6,.6,.6],math.identityMat4()),i=math.rotationMat4v(0*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(math.mulMat4(e,t,math.identityMat4()),i,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),xCurveArrow2:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.red,matrix:function(){const e=math.translateMat4c(0,-.8,-.07,math.identityMat4()),t=math.scaleMat4v([.6,.6,.6],math.identityMat4()),i=math.rotationMat4v(90*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(math.mulMat4(e,t,math.identityMat4()),i,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yCurve:s.addChild(new Mesh(s,{geometry:r.curve,material:o.green,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),yCurveHandle:s.addChild(new Mesh(s,{geometry:r.curveHandle,material:o.pickable,rotation:[-90,0,0],pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),yCurveArrow1:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.green,matrix:function(){const e=math.translateMat4c(.07,0,-.8,math.identityMat4()),t=math.scaleMat4v([.6,.6,.6],math.identityMat4()),i=math.rotationMat4v(90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(math.mulMat4(e,t,math.identityMat4()),i,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yCurveArrow2:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.green,matrix:function(){const e=math.translateMat4c(.8,0,-.07,math.identityMat4()),t=math.scaleMat4v([.6,.6,.6],math.identityMat4()),i=math.rotationMat4v(90*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(math.mulMat4(e,t,math.identityMat4()),i,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurve:s.addChild(new Mesh(s,{geometry:r.curve,material:o.blue,matrix:math.rotationMat4v(180*math.DEGTORAD,[1,0,0],math.identityMat4()),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zCurveHandle:s.addChild(new Mesh(s,{geometry:r.curveHandle,material:o.pickable,matrix:math.rotationMat4v(180*math.DEGTORAD,[1,0,0],math.identityMat4()),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurveCurveArrow1:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.blue,matrix:function(){const e=math.translateMat4c(.8,-.07,0,math.identityMat4()),t=math.scaleMat4v([.6,.6,.6],math.identityMat4());return math.mulMat4(e,t,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurveArrow2:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.blue,matrix:function(){const e=math.translateMat4c(.05,-.8,0,math.identityMat4()),t=math.scaleMat4v([.6,.6,.6],math.identityMat4()),i=math.rotationMat4v(90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(math.mulMat4(e,t,math.identityMat4()),i,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),center:s.addChild(new Mesh(s,{geometry:new ReadableGeometry(s,buildSphereGeometry({radius:.05})),material:o.center,pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisArrow:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.red,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisArrowHandle:s.addChild(new Mesh(s,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),xAxis:s.addChild(new Mesh(s,{geometry:r.axis,material:o.red,matrix:function(){const e=math.translateMat4c(0,.5,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisHandle:s.addChild(new Mesh(s,{geometry:r.axisHandle,material:o.pickable,matrix:function(){const e=math.translateMat4c(0,.5,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrow:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.green,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(180*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrowHandle:s.addChild(new Mesh(s,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(180*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1,opacity:.2}),e),yShaft:s.addChild(new Mesh(s,{geometry:r.axis,material:o.green,position:[0,-.5,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yShaftHandle:s.addChild(new Mesh(s,{geometry:r.axisHandle,material:o.pickable,position:[0,-.5,0],pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:s.addChild(new Mesh(s,{geometry:r.arrowHead,material:o.blue,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[.8,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrowHandle:s.addChild(new Mesh(s,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[.8,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zShaft:s.addChild(new Mesh(s,{geometry:r.axis,material:o.blue,matrix:function(){const e=math.translateMat4c(0,.5,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),clippable:!1,pickable:!1,collidable:!0,visible:!1}),e),zAxisHandle:s.addChild(new Mesh(s,{geometry:r.axisHandle,material:o.pickable,matrix:function(){const e=math.translateMat4c(0,.5,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),clippable:!1,pickable:!0,collidable:!0,visible:!1}),e)},this._affordanceMeshes={planeFrame:s.addChild(new Mesh(s,{geometry:new ReadableGeometry(s,buildTorusGeometry({center:[0,0,0],radius:2,tube:i,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new PhongMaterial(s,{ambient:[1,1,1],diffuse:[0,0,0],emissive:[1,1,0]}),highlighted:!0,highlightMaterial:new EmphasisMaterial(s,{edges:!1,filled:!0,fillColor:[1,1,0],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,1],rotation:[0,0,45]}),e),xHoop:s.addChild(new Mesh(s,{geometry:r.hoop,material:o.red,highlighted:!0,highlightMaterial:o.highlightRed,matrix:function(){const e=math.rotationMat4v(90*math.DEGTORAD,[0,1,0],math.identityMat4()),t=math.rotationMat4v(270*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yHoop:s.addChild(new Mesh(s,{geometry:r.hoop,material:o.green,highlighted:!0,highlightMaterial:o.highlightGreen,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zHoop:s.addChild(new Mesh(s,{geometry:r.hoop,material:o.blue,highlighted:!0,highlightMaterial:o.highlightBlue,matrix:math.rotationMat4v(180*math.DEGTORAD,[1,0,0],math.identityMat4()),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xAxisArrow:s.addChild(new Mesh(s,{geometry:r.arrowHeadBig,material:o.red,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[0,0,1],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrow:s.addChild(new Mesh(s,{geometry:r.arrowHeadBig,material:o.green,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(180*math.DEGTORAD,[1,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:s.addChild(new Mesh(s,{geometry:r.arrowHeadBig,material:o.blue,matrix:function(){const e=math.translateMat4c(0,1.1,0,math.identityMat4()),t=math.rotationMat4v(-90*math.DEGTORAD,[.8,0,0],math.identityMat4());return math.mulMat4(t,e,math.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e)}}_bindEvents(){const e=this;var t=!1;const i=-1,s=0,r=1,o=2,a=3,n=4,h=5,l=this._rootNode;var c=null,u=null;const p=math.vec2(),d=math.vec3([1,0,0]),m=math.vec3([0,1,0]),f=math.vec3([0,0,1]),g=this._viewer.scene.canvas.canvas,_=this._viewer.camera,y=this._viewer.scene;{const e=math.vec3([0,0,0]);let t=-1;this._onCameraViewMatrix=y.camera.on("viewMatrix",(()=>{})),this._onCameraProjMatrix=y.camera.on("projMatrix",(()=>{})),this._onSceneTick=y.on("tick",(()=>{const i=Math.abs(math.lenVec3(math.subVec3(y.camera.eye,this._pos,e)));if(i!==t&&"perspective"===_.projection){const e=.07*(Math.tan(_.perspective.fov*math.DEGTORAD)*i);l.scale=[e,e,e],t=i}if("ortho"===_.projection){const e=_.ortho.scale/10;l.scale=[e,e,e],t=i}}))}const T=function(){const e=new Float64Array(2);return function(t){if(t){for(var i=t.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;e[0]=t.pageX-s,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e}}(),v=function(){const t=math.mat4();return function(i,s){return math.quaternionToMat4(e._rootNode.quaternion,t),math.transformVec3(t,i,s),math.normalizeVec3(s),s}}();var I=function(){const e=math.vec3();return function(t){const i=Math.abs(t[0]);return i>Math.abs(t[1])&&i>Math.abs(t[2])?math.cross3Vec3(t,[0,1,0],e):math.cross3Vec3(t,[1,0,0],e),math.cross3Vec3(e,t,e),math.normalizeVec3(e),e}}();const E=function(){const t=math.vec3(),i=math.vec3(),s=math.vec4();return function(r,o,a){v(r,s);const n=I(s,o,a);b(o,n,t),b(a,n,i),math.subVec3(i,t);const h=math.dotVec3(i,s);e._pos[0]+=s[0]*h,e._pos[1]+=s[1]*h,e._pos[2]+=s[2]*h,e._rootNode.position=e._pos,e._sectionPlane&&(e._sectionPlane.pos=e._pos)}}();var P=function(){const t=math.vec4(),i=math.vec4(),s=math.vec4(),r=math.vec4();return function(o,a,n){v(o,r);if(!(b(a,r,t)&&b(n,r,i))){const e=I(r,a,n);b(a,e,t,1),b(n,e,i,1);var h=math.dotVec3(t,r);t[0]-=h*r[0],t[1]-=h*r[1],t[2]-=h*r[2],h=math.dotVec3(i,r),i[0]-=h*r[0],i[1]-=h*r[1],i[2]-=h*r[2]}math.normalizeVec3(t),math.normalizeVec3(i),h=math.dotVec3(t,i),h=math.clamp(h,-1,1);var l=Math.acos(h)*math.RADTODEG;math.cross3Vec3(t,i,s),math.dotVec3(s,r)<0&&(l=-l),e._rootNode.rotate(o,l),D()}}(),b=function(){const t=math.vec4([0,0,0,1]),i=math.mat4();return function(s,r,o,a){a=a||0,t[0]=s[0]/g.width*2-1,t[1]=-(s[1]/g.height*2-1),t[2]=0,t[3]=1,math.mulMat4(_.projMatrix,_.viewMatrix,i),math.inverseMat4(i),math.transformVec4(i,t,t),math.mulVec4Scalar(t,1/t[3]);var n=_.eye;math.subVec4(t,n,t);const h=e._sectionPlane.pos;var l=-math.dotVec3(h,r)-a,c=math.dotVec3(r,t);if(Math.abs(c)>.005){var u=-(math.dotVec3(r,n)+l)/c;return math.mulVec3Scalar(t,u,o),math.addVec3(o,n),math.subVec3(o,h,o),!0}return!1}}();const D=function(){const t=math.vec3(),i=math.mat4();return function(){e.sectionPlane&&(math.quaternionToMat4(l.quaternion,i),math.transformVec3(i,[0,0,1],t),e._setSectionPlaneDir(t))}}();var w,C=!1;this._onCameraControlHover=this._viewer.cameraControl.on("hoverEnter",(e=>{if(!this._visible)return;if(C)return;var l;t=!1,w&&(w.visible=!1);switch(e.entity.id){case this._displayMeshes.xAxisArrowHandle.id:case this._displayMeshes.xAxisHandle.id:l=this._affordanceMeshes.xAxisArrow,c=s;break;case this._displayMeshes.yAxisArrowHandle.id:case this._displayMeshes.yShaftHandle.id:l=this._affordanceMeshes.yAxisArrow,c=r;break;case this._displayMeshes.zAxisArrowHandle.id:case this._displayMeshes.zAxisHandle.id:l=this._affordanceMeshes.zAxisArrow,c=o;break;case this._displayMeshes.xCurveHandle.id:l=this._affordanceMeshes.xHoop,c=a;break;case this._displayMeshes.yCurveHandle.id:l=this._affordanceMeshes.yHoop,c=n;break;case this._displayMeshes.zCurveHandle.id:l=this._affordanceMeshes.zHoop,c=h;break;default:return void(c=i)}l&&(l.visible=!0),w=l,t=!0})),this._onCameraControlHoverLeave=this._viewer.cameraControl.on("hoverOut",(e=>{this._visible&&(w&&(w.visible=!1),w=null,c=i)})),g.addEventListener("mousedown",this._canvasMouseDownListener=e=>{if(e.preventDefault(),this._visible&&t&&(this._viewer.cameraControl.pointerEnabled=!1,1===e.which)){C=!0;var i=T(e);u=c,p[0]=i[0],p[1]=i[1]}}),g.addEventListener("mousemove",this._canvasMouseMoveListener=e=>{if(!this._visible)return;if(!C)return;var t=T(e);const i=t[0],l=t[1];switch(u){case s:E(d,p,t);break;case r:E(m,p,t);break;case o:E(f,p,t);break;case a:P(d,p,t);break;case n:P(m,p,t);break;case h:P(f,p,t)}p[0]=i,p[1]=l}),g.addEventListener("mouseup",this._canvasMouseUpListener=e=>{this._visible&&(this._viewer.cameraControl.pointerEnabled=!0,C&&(e.which,C=!1,t=!1))}),g.addEventListener("wheel",this._canvasWheelListener=e=>{if(this._visible)Math.max(-1,Math.min(1,40*-e.deltaY))})}_destroy(){this._unbindEvents(),this._destroyNodes()}_unbindEvents(){const e=this._viewer,t=e.scene,i=t.canvas.canvas,s=e.camera,r=e.cameraControl;t.off(this._onSceneTick),i.removeEventListener("mousedown",this._canvasMouseDownListener),i.removeEventListener("mousemove",this._canvasMouseMoveListener),i.removeEventListener("mouseup",this._canvasMouseUpListener),i.removeEventListener("wheel",this._canvasWheelListener),s.off(this._onCameraViewMatrix),s.off(this._onCameraProjMatrix),r.off(this._onCameraControlHover),r.off(this._onCameraControlHoverLeave)}_destroyNodes(){this._setSectionPlane(null),this._rootNode.destroy(),this._displayMeshes={},this._affordanceMeshes={}}}class Plane{constructor(e,t,i){this.id=i.id,this._sectionPlane=i,this._mesh=new Mesh(t,{id:i.id,geometry:new ReadableGeometry(t,buildBoxGeometry({xSize:.5,ySize:.5,zSize:.001})),material:new PhongMaterial(t,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new EdgeMaterial(t,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new EmphasisMaterial(t,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new EmphasisMaterial(t,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});{const e=math.vec3([0,0,0]),t=math.vec3(),i=math.vec3([0,0,1]),s=math.vec4(4),r=math.vec3(),o=()=>{const o=this._sectionPlane.scene.center,a=[-this._sectionPlane.dir[0],-this._sectionPlane.dir[1],-this._sectionPlane.dir[2]];math.subVec3(o,this._sectionPlane.pos,e);const n=-math.dotVec3(a,e);math.normalizeVec3(a),math.mulVec3Scalar(a,n,t);const h=math.vec3PairToQuaternion(i,this._sectionPlane.dir,s);r[0]=.1*t[0],r[1]=.1*t[1],r[2]=.1*t[2],this._mesh.quaternion=h,this._mesh.position=r};this._onSectionPlanePos=this._sectionPlane.on("pos",o),this._onSectionPlaneDir=this._sectionPlane.on("dir",o)}this._highlighted=!1,this._selected=!1}setHighlighted(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}getHighlighted(){return this._highlighted}setSelected(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}getSelected(){return this._selected}destroy(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}class Overview{constructor(e,t){if(!(t.onHoverEnterPlane&&t.onHoverLeavePlane&&t.onClickedNothing&&t.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=e,this._viewer=e.viewer,this._onHoverEnterPlane=t.onHoverEnterPlane,this._onHoverLeavePlane=t.onHoverLeavePlane,this._onClickedNothing=t.onClickedNothing,this._onClickedPlane=t.onClickedPlane,this._visible=!0,this._planes={},this._canvas=t.overviewCanvas,this._scene=new Scene(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new DirLight(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new DirLight(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new DirLight(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;{const e=this._scene.camera,t=math.rotationMat4c(-90*math.DEGTORAD,1,0,0),i=math.vec3(),s=math.vec3(),r=math.vec3();this._synchCamera=()=>{const o=this._viewer.camera.eye,a=this._viewer.camera.look,n=this._viewer.camera.up;math.mulVec3Scalar(math.normalizeVec3(math.subVec3(o,a,i)),7),this._zUp?(math.transformVec3(t,i,s),math.transformVec3(t,n,r),e.look=[0,0,0],e.eye=math.transformVec3(t,i,s),e.up=math.transformPoint3(t,n,r)):(e.look=[0,0,0],e.eye=i,e.up=n)}}this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(e=>{this._scene.camera.perspective.fov=e}));var i=null;this._onInputMouseMove=this._scene.input.on("mousemove",(e=>{const t=this._scene.pick({canvasPos:e});if(t){if(!i||t.entity.id!==i.id){if(i){this._planes[i.id]&&this._onHoverLeavePlane(i.id)}i=t.entity;this._planes[i.id]&&this._onHoverEnterPlane(i.id)}}else i&&(this._onHoverLeavePlane(i.id),i=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=()=>{if(i){this._planes[i.id]&&this._onClickedPlane(i.id)}else this._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=()=>{i&&(this._onHoverLeavePlane(i.id),i=null)}),this.setVisible(t.overviewVisible)}addSectionPlane(e){this._planes[e.id]=new Plane(this,this._scene,e)}setPlaneHighlighted(e,t){const i=this._planes[e];i&&i.setHighlighted(t)}setPlaneSelected(e,t){const i=this._planes[e];i&&i.setSelected(t)}removeSectionPlane(e){const t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}setVisible(e=!0){this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}getVisible(){return this._visible}destroy(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}const tempAABB=math.AABB3(),tempVec3$3=math.vec3();class SectionPlanesPlugin extends Plugin{constructor(e,t={}){if(super("SectionPlanes",e),this._freeControls=[],this._sectionPlanes=e.scene.sectionPlanes,this._controls={},this._shownControlId=null,null!==t.overviewCanvasId&&void 0!==t.overviewCanvasId){const e=document.getElementById(t.overviewCanvasId);e?this._overview=new Overview(this,{overviewCanvas:e,visible:t.overviewVisible,onHoverEnterPlane:e=>{this._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:e=>{this._overview.setPlaneHighlighted(e,!1)},onClickedPlane:e=>{if(this.getShownControl()===e)return void this.hideControl();this.showControl(e);const t=this.sectionPlanes[e].pos;tempAABB.set(this.viewer.scene.aabb),math.getAABB3Center(tempAABB,tempVec3$3),tempAABB[0]+=t[0]-tempVec3$3[0],tempAABB[1]+=t[1]-tempVec3$3[1],tempAABB[2]+=t[2]-tempVec3$3[2],tempAABB[3]+=t[0]-tempVec3$3[0],tempAABB[4]+=t[1]-tempVec3$3[1],tempAABB[5]+=t[2]-tempVec3$3[2],this.viewer.cameraFlight.flyTo({aabb:tempAABB,fitFOV:65})},onClickedNothing:()=>{this.hideControl()}}):this.warn("Can't find overview canvas: '"+t.overviewCanvasId+"' - will create plugin without overview")}this._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(e=>{this._sectionPlaneCreated(e)}))}setOverviewVisible(e){this._overview&&this._overview.setVisible(e)}getOverviewVisible(){if(this._overview)return this._overview.getVisible()}get sectionPlanes(){return this._sectionPlanes}createSectionPlane(e={}){void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);return new SectionPlane(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0})}_sectionPlaneCreated(e){const t=this._freeControls.length>0?this._freeControls.pop():new Control(this);t._setSectionPlane(e),t.setVisible(!1),this._controls[e.id]=t,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(()=>{this._sectionPlaneDestroyed(e)}))}flipSectionPlanes(){const e=this.viewer.scene.sectionPlanes;for(let t in e){e[t].flipDir()}}showControl(e){const t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}getShownControl(){return this._shownControlId}hideControl(){for(var e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}destroySectionPlane(e){var t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}_sectionPlaneDestroyed(e){this._overview&&this._overview.removeSectionPlane(e);const t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}clear(){const e=Object.keys(this._sectionPlanes);for(var t=0,i=e.length;t<i;t++)this.destroySectionPlane(e[t])}send(e,t){switch(e){case"snapshotStarting":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!0);break;case"snapshotFinished":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}destroy(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),super.destroy()}_destroyFreeControls(){for(var e=this._freeControls.pop();e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}}class Skybox extends Component{constructor(e,t={}){super(e,t),this._skyboxMesh=new Mesh(this,{geometry:new ReadableGeometry(this,{primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),background:!0,scale:[2e3,2e3,2e3],rotation:[0,-90,0],material:new PhongMaterial(this,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:new Texture(this,{src:t.src,flipY:!0,wrapS:"clampToEdge",wrapT:"clampToEdge",encoding:t.encoding||"sRGB"}),backfaces:!0}),visible:!1,pickable:!1,clippable:!1,collidable:!1}),this.size=t.size,this.active=t.active}set size(e){this._size=e||1e3,this._skyboxMesh.scale=[this._size,this._size,this._size]}get size(){return this._size}set active(e){this._skyboxMesh.visible=e}get active(){return this._skyboxMesh.visible}}class SkyboxesPlugin extends Plugin{constructor(e){super("skyboxes",e),this.skyboxes={}}send(e,t){if("clear"===e)this.clear()}createSkybox(e,t){if(this.viewer.scene.components[e])return this.error("Component with this ID already exists: "+e),this;var i=new Skybox(this.viewer.scene,{id:e,pos:t.pos,dir:t.dir,active:!0});return this.skyboxes[e]=i,i}destroySkybox(e){var t=this.skyboxes[e];t?t.destroy():this.error("Skybox not found: "+e)}clear(){for(var e=Object.keys(this.viewer.scene.skyboxes),t=0,i=e.length;t<i;t++)this.destroySkybox(e[t])}destroy(){this.clear(),super.clear()}}class STLDefaultDataSource{getSTL(e,t,i){const s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i(s.statusText))},s.send(null)}}const tempVec3a$7=math.vec3();class STLSceneGraphLoader{load(e,t,i,s,r,o){s=s||{};const a=e.viewer.scene.canvas.spinner;a.processes++,e.dataSource.getSTL(i,(function(i){parse$1(e,t,i,s);try{const o=ensureBinary(i);isBinary(o)?parseBinary(e,o,t,s):parseASCII(e,ensureString(i),t,s),a.processes--,core.scheduleTask((function(){t.fire("loaded",!0,!1)})),r&&r()}catch(i){a.processes--,e.error(i),o&&o(i),t.fire("error",i)}}),(function(i){a.processes--,e.error(i),o&&o(i),t.fire("error",i)}))}parse(e,t,i,s){const r=e.viewer.scene.canvas.spinner;r.processes++;try{const o=ensureBinary(i);isBinary(o)?parseBinary(e,o,t,s):parseASCII(e,ensureString(i),t,s),r.processes--,core.scheduleTask((function(){t.fire("loaded",!0,!1)}))}catch(e){r.processes--,t.fire("error",e)}}}function parse$1(e,t,i,s){try{const r=ensureBinary(i);isBinary(r)?parseBinary(e,r,t,s):parseASCII(e,ensureString(i),t,s)}catch(e){t.fire("error",e)}}function isBinary(e){const t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const i=[115,111,108,105,100];for(var s=0;s<5;s++)if(i[s]!==t.getUint8(s,!1))return!0;return!1}function parseBinary(e,t,i,s){const r=new DataView(t),o=r.getUint32(80,!0);let a,n,h,l,c,u,p,d=!1,m=null,f=null,g=null,_=!1;for(let e=0;e<70;e++)1129270351===r.getUint32(e,!1)&&82===r.getUint8(e+4)&&61===r.getUint8(e+5)&&(d=!0,l=[],c=r.getUint8(e+6)/255,u=r.getUint8(e+7)/255,p=r.getUint8(e+8)/255,r.getUint8(e+9));const y=new MetallicMaterial(i,{roughness:.5});let T=[],v=[],I=s.splitMeshes;for(let e=0;e<o;e++){let t=84+50*e,o=r.getFloat32(t,!0),E=r.getFloat32(t+4,!0),P=r.getFloat32(t+8,!0);if(d){let e=r.getUint16(t+48,!0);0==(32768&e)?(a=(31&e)/31,n=(e>>5&31)/31,h=(e>>10&31)/31):(a=c,n=u,h=p),(I&&a!==m||n!==f||h!==g)&&(null!==m&&(_=!0),m=a,f=n,g=h)}for(let e=1;e<=3;e++){let i=t+12*e;T.push(r.getFloat32(i,!0)),T.push(r.getFloat32(i+4,!0)),T.push(r.getFloat32(i+8,!0)),v.push(o,E,P),d&&l.push(a,n,h,1)}I&&_&&(addMesh(i,T,v,l,y,s),T=[],v=[],l=l?[]:null,_=!1)}T.length>0&&addMesh(i,T,v,l,y,s)}function parseASCII(e,t,i,s){const r=/facet([\s\S]*?)endfacet/g;let o=0;const a=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,n=new RegExp("vertex"+a+a+a,"g"),h=new RegExp("normal"+a+a+a,"g"),l=[],c=[];let u,p,d,m,f,g,_;for(;null!==(m=r.exec(t));){for(f=0,g=0,_=m[0];null!==(m=h.exec(_));)u=parseFloat(m[1]),p=parseFloat(m[2]),d=parseFloat(m[3]),g++;for(;null!==(m=n.exec(_));)l.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),c.push(u,p,d),f++;1!==g&&e.error("Error in normal of face "+o),3!==f&&e.error("Error in positions of face "+o),o++}addMesh(i,l,c,null,new MetallicMaterial(i,{roughness:.5}),s)}function addMesh(e,t,i,s,r,o){const a=new Int32Array(t.length/3);for(let e=0,t=a.length;e<t;e++)a[e]=e;i=i&&i.length>0?i:null,s=s&&s.length>0?s:null,o.smoothNormals&&math.faceToVertexNormals(t,i,o);const n=tempVec3a$7;worldToRTCPositions(t,t,n);const h=new ReadableGeometry(e,{primitive:"triangles",positions:t,normals:i,colors:s,indices:a}),l=new Mesh(e,{origin:0!==n[0]||0!==n[1]||0!==n[2]?n:null,geometry:h,material:r,edges:o.edges});e.addChild(l)}function ensureString(e){return"string"!=typeof e?decodeText(new Uint8Array(e)):e}function ensureBinary(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}function decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);return decodeURIComponent(escape(t))}class STLLoaderPlugin extends Plugin{constructor(e,t={}){super("STLLoader",e,t),this._sceneGraphLoader=new STLSceneGraphLoader,this.dataSource=t.dataSource}set dataSource(e){this._dataSource=e||new STLDefaultDataSource}get dataSource(){return this._dataSource}load(e){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Node$1(this.viewer.scene,utils.apply(e,{isModel:!0})),i=e.src,s=e.stl;return i||s?(i?this._sceneGraphLoader.load(this,t,i,e):this._sceneGraphLoader.parse(this,t,s,e),t):(this.error("load() param expected: either 'src' or 'stl'"),t)}}class Storey{constructor(e,t,i,s,r){this.plugin=e,this.storeyId=s,this.modelId=i,this.aabb=t.slice(),this.numObjects=r}}const IFCStoreyPlanObjectStates={IfcSlab:{visible:!0,edges:!1,colorize:[1,1,1,1]},IfcWall:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcWallStandardCase:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcDoor:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcWindow:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcColumn:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcCurtainWall:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcStair:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcStairFlight:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcRamp:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFurniture:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFooting:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFloor:{visible:!0,edges:!1,colorize:[1,1,1,1]},DEFAULT:{visible:!1}},color$1=math.vec3();class ObjectsMemento{constructor(){this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsHasColorize=[],this.objectsOpacity=[],this.numObjects=0}saveObjects(e,t){this.numObjects=0,this._mask=t?utils.apply(t,{}):null;const i=e.objects,s=!t||t.visible,r=!t||t.edges,o=!t||t.xrayed,a=!t||t.highlighted,n=!t||t.selected,h=!t||t.clippable,l=!t||t.pickable,c=!t||t.colorize,u=!t||t.opacity;for(let e in i)if(i.hasOwnProperty(e)){const t=i[e],p=this.numObjects;if(s&&(this.objectsVisible[p]=t.visible),r&&(this.objectsEdges[p]=t.edges),o&&(this.objectsXrayed[p]=t.xrayed),a&&(this.objectsHighlighted[p]=t.highlighted),n&&(this.objectsSelected[p]=t.selected),h&&(this.objectsClippable[p]=t.clippable),l&&(this.objectsPickable[p]=t.pickable),c){const e=t.colorize;e?(this.objectsColorize[3*p+0]=e[0],this.objectsColorize[3*p+1]=e[1],this.objectsColorize[3*p+2]=e[2],this.objectsHasColorize[p]=!0):this.objectsHasColorize[p]=!1}u&&(this.objectsOpacity[p]=t.opacity),this.numObjects++}}restoreObjects(e){const t=this._mask,i=!t||t.visible,s=!t||t.edges,r=!t||t.xrayed,o=!t||t.highlighted,a=!t||t.selected,n=!t||t.clippable,h=!t||t.pickable,l=!t||t.colorize,c=!t||t.opacity;var u=0;const p=e.objects;for(let e in p)if(p.hasOwnProperty(e)){const t=p[e];i&&(t.visible=this.objectsVisible[u]),s&&(t.edges=this.objectsEdges[u]),r&&(t.xrayed=this.objectsXrayed[u]),o&&(t.highlighted=this.objectsHighlighted[u]),a&&(t.selected=this.objectsSelected[u]),n&&(t.clippable=this.objectsClippable[u]),h&&(t.pickable=this.objectsPickable[u]),l&&(this.objectsHasColorize[u]?(color$1[0]=this.objectsColorize[3*u+0],color$1[1]=this.objectsColorize[3*u+1],color$1[2]=this.objectsColorize[3*u+2],t.colorize=color$1):t.colorize=null),c&&(t.opacity=this.objectsOpacity[u]),u++}}}class CameraMemento{constructor(e){this._eye=math.vec3(),this._look=math.vec3(),this._up=math.vec3(),this._projection={},e&&this.saveCamera(e)}saveCamera(e){const t=e.camera,i=t.project;switch(this._eye.set(t.eye),this._look.set(t.look),this._up.set(t.up),t.projection){case"perspective":this._projection={projection:"perspective",fov:i.fov,fovAxis:i.fovAxis,near:i.near,far:i.far};break;case"ortho":this._projection={projection:"ortho",scale:i.scale,near:i.near,far:i.far};break;case"frustum":this._projection={projection:"frustum",left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far};break;case"custom":this._projection={projection:"custom",matrix:i.matrix.slice()}}}restoreCamera(e,t){const i=e.camera,s=this._projection;function r(){switch(s.type){case"perspective":i.perspective.fov=s.fov,i.perspective.fovAxis=s.fovAxis,i.perspective.near=s.near,i.perspective.far=s.far;break;case"ortho":i.ortho.scale=s.scale,i.ortho.near=s.near,i.ortho.far=s.far;break;case"frustum":i.frustum.left=s.left,i.frustum.right=s.right,i.frustum.top=s.top,i.frustum.bottom=s.bottom,i.frustum.near=s.near,i.frustum.far=s.far;break;case"custom":i.customProjection.matrix=s.matrix}}t?e.viewer.cameraFlight.flyTo({eye:this._eye,look:this._look,up:this._up,orthoScale:s.scale,projection:s.projection},(()=>{r(),t()})):(i.eye=this._eye,i.look=this._look,i.up=this._up,r(),i.projection=s.projection)}}class StoreyMap{constructor(e,t,i,s,r,o){this.storeyId=e,this.imageData=t,this.format=i,this.width=s,this.height=r}}const tempVec3a$6=math.vec3(),tempMat4=math.mat4(),EMPTY_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==";class StoreyViewsPlugin extends Plugin{constructor(e,t={}){super("StoreyViews",e),this._objectsMemento=new ObjectsMemento,this._cameraMemento=new CameraMemento,this.storeys={},this.modelStoreys={},this.objectStates=t.objectStates,this._onModelLoaded=this.viewer.scene.on("modelLoaded",(e=>{this._registerModelStoreys(e),this.fire("storeys",this.storeys)}))}_registerModelStoreys(e){const t=this.viewer,i=t.scene,s=t.metaScene,r=s.metaModels[e],o=i.models[e];if(!r||!r.rootMetaObject)return;const a=r.rootMetaObject.getObjectIDsInSubtreeByType(["IfcBuildingStorey"]);for(let t=0,r=a.length;t<r;t++){const r=a[t],n=s.metaObjects[r].getObjectIDsInSubtree(),h=i.getAABB(n),l=Math.random()>.5?n.length:0,c=new Storey(this,h,e,r,l);c._onModelDestroyed=o.once("destroyed",(()=>{this._deregisterModelStoreys(e),this.fire("storeys",this.storeys)})),this.storeys[r]=c,this.modelStoreys[e]||(this.modelStoreys[e]={}),this.modelStoreys[e][r]=c}}_deregisterModelStoreys(e){const t=this.modelStoreys[e];if(t){const i=this.viewer.scene;for(let e in t)if(t.hasOwnProperty(e)){const s=t[e],r=i.models[s.modelId];r&&r.off(s._onModelDestroyed),delete this.storeys[e]}delete this.modelStoreys[e]}}set objectStates(e){this._objectStates=e||IFCStoreyPlanObjectStates}get objectStates(){return this._objectStates}gotoStoreyCamera(e,t={}){const i=this.storeys[e];if(!i)return this.error("IfcBuildingStorey not found with this ID: "+e),void(t.done&&t.done());const s=this.viewer,r=s.scene.camera,o=i.aabb;if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])return void(t.done&&t.done());if(o[3]===o[0]&&o[4]===o[1]&&o[5]===o[2])return void(t.done&&t.done());const a=math.getAABB3Center(o),n=math.getAABB3Diag(o),h=Math.abs(n/Math.tan(45*math.DEGTORAD)),l=1.3*n,c=tempVec3a$6;c[0]=a[0]+r.worldUp[0]*h,c[1]=a[1]+r.worldUp[1]*h,c[2]=a[2]+r.worldUp[2]*h;const u=r.worldForward;t.done?s.cameraFlight.flyTo(utils.apply(t,{eye:c,look:a,up:u,orthoScale:l}),(()=>{t.done()})):(s.cameraFlight.jumpTo(utils.apply(t,{eye:c,look:a,up:u,orthoScale:l})),s.camera.ortho.scale=l)}showStoreyObjects(e,t={}){if(!this.storeys[e])return void this.error("IfcBuildingStorey not found with this ID: "+e);const i=this.viewer,s=i.scene;i.metaScene.metaObjects[e]&&(t.hideOthers&&s.setObjectsVisible(i.scene.visibleObjectIds,!1),this.withStoreyObjects(e,((e,i)=>{if(e)if(t.useObjectStates){const t=this._objectStates[i.type]||this._objectStates.DEFAULT;t&&(e.visible=t.visible,e.edges=t.edges,t.colorize&&(e.colorize=t.colorize),null!==t.opacity&&void 0!==t.opacity&&(e.opacity=t.opacity))}else e.visible=!0})))}withStoreyObjects(e,t){const i=this.viewer,s=i.scene,r=i.metaScene,o=r.metaObjects[e];if(!o)return;const a=o.getObjectIDsInSubtree();for(var n=0,h=a.length;n<h;n++){const e=a[n],i=r.metaObjects[e],o=s.objects[e];o&&t(o,i)}}createStoreyMap(e,t={}){const i=this.storeys[e];if(!i)return this.error("IfcBuildingStorey not found with this ID: "+e),EMPTY_IMAGE;const s=this.viewer,r=s.scene,o=t.format||"png",a=i.aabb,n=(a[5]-a[2])/(a[3]-a[0]),h=t.padding||0;let l,c;t.width&&t.height?(l=t.width,c=t.height):t.height?(c=t.height,l=c/n):t.width?(l=t.width,c=l*n):(l=300,c=l*n),this._objectsMemento.saveObjects(r),this._cameraMemento.saveCamera(r),s.beginSnapshot(),this.showStoreyObjects(e,utils.apply(t,{useObjectStates:!0,hideOthers:!0})),this._arrangeStoreyMapCamera(i);const u=s.getSnapshot({width:l,height:c,format:o});return this._objectsMemento.restoreObjects(r),this._cameraMemento.restoreCamera(r),s.endSnapshot(),new StoreyMap(e,u,o,l,c,h)}_arrangeStoreyMapCamera(e){const t=this.viewer,i=t.scene.camera,s=e.aabb,r=math.getAABB3Center(s),o=tempVec3a$6;o[0]=r[0]+.5*i.worldUp[0],o[1]=r[1]+.5*i.worldUp[1],o[2]=r[2]+.5*i.worldUp[2];const a=i.worldForward;t.cameraFlight.jumpTo({eye:o,look:r,up:a});const n=(s[3]-s[0])/2,h=(s[4]-s[1])/2,l=(s[5]-s[2])/2,c=-n,u=+n,p=-h,d=+h,m=-l,f=+l;t.camera.customProjection.matrix=math.orthoMat4c(c,u,m,f,p,d,tempMat4),t.camera.projection="customProjection"}pickStoreyMap(e,t,i={}){const s=e.storeyId,r=this.storeys[s];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+s),null;const o=1-t[0]/e.width,a=1-t[1]/e.height,n=r.aabb,h=n[0],l=n[1],c=n[2],u=n[3]-h,p=n[4]-l,d=n[5]-c,m=math.vec3([h+u*o,l+.5*p,c+d*a]),f=math.vec3([0,-1,0]),g=math.addVec3(m,f,tempVec3a$6),_=this.viewer.camera.worldForward,y=math.lookAtMat4v(m,g,_,tempMat4),T=this.viewer.scene.pick({pickSurface:i.pickSurface,pickInvisible:!0,matrix:y});if(T){const e=this.viewer.metaScene.metaObjects[T.entity.id],t=this.objectStates[e.type];if(!t||!t.visible)return null}return T}getStoreyContainingWorldPos(e){for(var t in this.storeys){const i=this.storeys[t];if(math.point3AABB3Intersect(i.aabb,e))return t}return null}worldPosToStoreyMap(e,t,i){const s=e.storeyId,r=this.storeys[s];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+s),!1;const o=r.aabb,a=o[0],n=o[1],h=o[2],l=o[3]-a,c=o[4]-n,u=o[5]-h,p=this.viewer.camera.worldUp,d=p[0]>p[1]&&p[0]>p[2],m=!d&&p[1]>p[0]&&p[1]>p[2];!d&&!m&&p[2]>p[0]&&(p[2],p[1]);const f=e.width/l,g=m?e.height/u:e.height/c;return i[0]=Math.floor(e.width-(t[0]-a)*f),i[1]=Math.floor(e.height-(t[2]-h)*g),i[0]>=0&&i[0]<e.width&&i[1]>=0&&i[1]<=e.height}worldDirToStoreyMap(e,t,i){const s=this.viewer.camera,r=s.eye,o=s.look,a=math.subVec3(o,r,tempVec3a$6),n=s.worldUp,h=n[0]>n[1]&&n[0]>n[2],l=!h&&n[1]>n[0]&&n[1]>n[2];!h&&!l&&n[2]>n[0]&&(n[2],n[1]),h?(i[0]=a[1],i[1]=a[2]):l?(i[0]=a[0],i[1]=a[2]):(i[0]=a[0],i[1]=a[1]),math.normalizeVec2(i)}destroy(){this.viewer.scene.off(this._onModelLoaded),super.destroy()}}function validateMetaModelForTreeViewTypesHierarchy(e,t){return!!e.rootMetaObject||(t.push("Can't build types hierarchy: model is empty"),!1)}function validateMetaModelForTreeViewStoreysHierarchy(e,t){const i=e.rootMetaObject;return i?_validateMetaModelForStoreysHierarchy(i,t):(t.push("Can't build storeys hierarchy: model is empty"),!1)}function validateMetaModelForTreeViewContainmentHierarchy(e,t){return!!e.rootMetaObject||(t.push("Can't build containment hierarchy: model is empty"),!1)}function _validateMetaModelForStoreysHierarchy(e,t,i=0,s,r){s=s||{foundIFCBuildingStoreys:!1};const o=e.type,a=e.children;if("IfcBuilding"===o)r=!0;else if("IfcBuildingStorey"===o){if(!r)return t.push("Can't build storeys hierarchy: IfcBuildingStorey found without parent IfcBuilding"),!1;s.foundIFCBuildingStoreys=!0}if(a)for(let e=0,o=a.length;e<o;e++){if(!_validateMetaModelForStoreysHierarchy(a[e],t,i+1,s,r))return!1}return 0===i&&s.foundIFCBuildingStoreys,!0}const idMap=new Map$1;class ModelTreeView{constructor(e,t,i,s,r){if(!r.containerElement)throw"Config expected: containerElement";const o=s.rootMetaObject;o&&(this.errors=[],this.valid=!0,this.metaModel=s,this._id=idMap.addItem(),this._baseId=""+this._id,this._viewer=e,this._treeViewPlugin=t,this._rootMetaObject=o,this._containerElement=r.containerElement,this._rootElement=null,this._muteSceneEvents=!1,this._muteTreeEvents=!1,this._rootNodes=[],this._objectNodes={},this._rootName=r.rootName,this._sortNodes=r.sortNodes,this._pruneEmptyNodes=r.pruneEmptyNodes,this._showListItemElementId=null,this._containerElement.oncontextmenu=e=>{e.preventDefault()},this._onObjectVisibility=this._viewer.scene.on("objectVisibility",(e=>{if(this._muteSceneEvents)return;const t=e.id,i=this._objectNodes[t];if(!i)return;const s=e.visible;if(!(s!==i.checked))return;this._muteTreeEvents=!0,i.checked=s,s?i.numVisibleEntities++:i.numVisibleEntities--;const r=document.getElementById(i.nodeId);r&&(r.checked=s);let o=i.parent;for(;o;){o.checked=s,s?o.numVisibleEntities++:o.numVisibleEntities--;const e=document.getElementById(o.nodeId);if(e){const t=o.numVisibleEntities>0;t!==e.checked&&(e.checked=t)}o=o.parent}this._muteTreeEvents=!1})),this.switchExpandHandler=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this._expandSwitchElement(t)},this.switchCollapseHandler=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this._collapseSwitchElement(t)},this._checkboxChangeHandler=e=>{if(this._muteTreeEvents)return;this._muteSceneEvents=!0;const t=e.target,i=t.checked,s=t.id,r=this._nodeToObjectID(s),o=this._objectNodes[r],a=this._viewer.scene.objects;let n=0;this._withNodeTree(o,(e=>{const t=e.objectId,s=e.nodeId,r=a[t],o=0===e.children.length;e.numVisibleEntities=i?e.numEntities:0,o&&i!==e.checked&&n++,e.checked=i;const h=document.getElementById(s);h&&(h.checked=i),r&&(r.visible=i)}));let h=o.parent;for(;h;){h.checked=i;const e=document.getElementById(h.nodeId);i?h.numVisibleEntities+=n:h.numVisibleEntities-=n;const t=h.numVisibleEntities>0;t!==e.checked&&(e.checked=t),h=h.parent}this._muteSceneEvents=!1},this._hierarchy=r.hierarchy||"containment",this._autoExpandDepth=r.autoExpandDepth||0,this._createNodes())}_nodeToObjectID(e){return e.substring(this._baseId.length)}_objectToNodeID(e){return this._baseId+e}setAutoExpandDepth(e=0){this._autoExpandDepth=e}setHierarchy(e){this._hierarchy!==e&&(this._hierarchy=e,this._createNodes())}_createNodes(){this._rootElement&&(this._rootElement.parentNode.removeChild(this._rootElement),this._rootElement=null),this._rootNodes=[],this._objectNodes={},this._validate(),this.valid||"storeys"!==this._hierarchy?this._createEnabledNodes():this._createDisabledNodes()}_validate(){switch(this.errors=[],this._hierarchy){case"storeys":this.valid=validateMetaModelForTreeViewStoreysHierarchy(this.metaModel,this.errors);break;case"types":this.valid=validateMetaModelForTreeViewTypesHierarchy(this.metaModel,this.errors);break;default:this.valid=validateMetaModelForTreeViewContainmentHierarchy(this.metaModel,this.errors)}return this.valid}_createEnabledNodes(){switch(this._pruneEmptyNodes&&this._findEmptyNodes(),this._hierarchy){case"storeys":this._createStoreysNodes(),0===this._rootNodes.length&&this._treeViewPlugin.error("Failed to build storeys hierarchy for model '"+this.metaModel.id+"' - perhaps this model is not an IFC model?");break;case"types":this._createTypesNodes();break;default:this._createContainmentNodes()}this._sortNodes&&this._doSortNodes(),this._synchNodesToEntities(),this._createTrees(),this.expandToDepth(this._autoExpandDepth)}_createDisabledNodes(){const e=this._rootMetaObject,t=e.type,i=e.name,s=i&&""!==i&&"Undefined"!==i&&"Default"!==i?i:t,r=document.createElement("ul"),o=document.createElement("li");r.appendChild(o),this._containerElement.appendChild(r),this._rootElement=r;const a=document.createElement("a");a.href="#",a.textContent="!",a.classList.add("warn"),a.classList.add("warning"),o.appendChild(a);const n=document.createElement("span");n.textContent=s,o.appendChild(n)}_findEmptyNodes(e=this._rootMetaObject,t=0){const i=this._treeViewPlugin.viewer.scene,s=e.children,r=e.id,o=i.objects[r];if(e._countEntities=0,o&&e._countEntities++,s)for(let t=0,i=s.length;t<i;t++){const i=s[t];i._countEntities=this._findEmptyNodes(i),e._countEntities+=i._countEntities}return e._countEntities}_createStoreysNodes(e=this._rootMetaObject,t,i,s){if(this._pruneEmptyNodes&&0===e._countEntities)return;const r=e.type,o=e.name,a=e.children,n=e.id;if("IfcBuilding"===r)t={nodeId:this._objectToNodeID(n),objectId:n,title:this._rootName||(o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r),type:r,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t;else if("IfcBuildingStorey"===r){if(!t)return void this._treeViewPlugin.error("Failed to build storeys hierarchy for model '"+this.metaModel.id+"' - model does not have an IfcBuilding object, or is not an IFC model");i={nodeId:this._objectToNodeID(n),objectId:n,title:o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,type:r,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},t.children.push(i),this._objectNodes[i.objectId]=i,s={}}else if(i){if(this._viewer.scene.objects[n]){let e=(s=s||{})[r];if(!e){const t=i.objectId+"."+r;e={nodeId:this._objectToNodeID(t),objectId:t,title:r,type:r,parent:i,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},i.children.push(e),this._objectNodes[t]=e,s[r]=e}const t={nodeId:this._objectToNodeID(n),objectId:n,title:o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,type:r,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,children:[]};e.children.push(t),this._objectNodes[t.objectId]=t}}if(a)for(let e=0,r=a.length;e<r;e++){const r=a[e];this._createStoreysNodes(r,t,i,s)}}_createTypesNodes(e=this._rootMetaObject,t,i){if(this._pruneEmptyNodes&&0===e._countEntities)return;const s=e.type,r=e.name,o=e.children,a=e.id;if(e.id===this._rootMetaObject.id)t={nodeId:this._objectToNodeID(a),objectId:a,title:this._rootName||(r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:s),type:s,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,i={};else if(t){if(this._viewer.scene.objects[a]){let e=i[s];e||(e={nodeId:this._objectToNodeID(t.objectId+"."+s),objectId:t.objectId+"."+s,title:s,type:s,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},t.children.push(e),this._objectNodes[e.objectId]=e,i[s]=e);const o={nodeId:this._objectToNodeID(a),objectId:a,title:r&&""!==r&&"Default"!==r?r:s,type:s,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,children:[]};e.children.push(o),this._objectNodes[o.objectId]=o}}if(o)for(let e=0,s=o.length;e<s;e++){const s=o[e];this._createTypesNodes(s,t,i)}}_createContainmentNodes(e=this._rootMetaObject,t){if(this._pruneEmptyNodes&&0===e._countEntities)return;const i=e.type,s=e.name||i,r=e.children,o=e.id,a={nodeId:this._objectToNodeID(o),objectId:o,title:t?s&&""!==s&&"Undefined"!==s&&"Default"!==s?s:i:this._rootName||s,type:i,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,children:[]};if(t?t.children.push(a):this._rootNodes.push(a),this._objectNodes[a.objectId]=a,r)for(let e=0,t=r.length;e<t;e++){const t=r[e];this._createContainmentNodes(t,a)}}_doSortNodes(){for(let e=0,t=this._rootNodes.length;e<t;e++){const t=this._rootNodes[e];this._sortChildren(t)}}_sortChildren(e){const t=e.children;if(t&&0!==t.length){"storeys"===this._hierarchy&&"IfcBuilding"===e.type?t.sort(this._getSpatialSortFunc()):t.sort(this._alphaSortFunc);for(let e=0,i=t.length;e<i;e++){const i=t[e];this._sortChildren(i)}}}_getSpatialSortFunc(){const e=this._treeViewPlugin.viewer,t=e.scene,i=t.camera,s=e.metaScene;return this._spatialSortFunc||(this._spatialSortFunc=(e,r)=>{e.aabb&&r.aabb||(e.aabb||(e.aabb=t.getAABB(s.getObjectIDsInSubtree(e.objectId))),r.aabb||(r.aabb=t.getAABB(s.getObjectIDsInSubtree(r.objectId))));let o=0;return o=i.xUp?0:i.yUp?1:2,e.aabb[o]>r.aabb[o]?-1:e.aabb[o]<r.aabb[o]?1:0})}_alphaSortFunc(e,t){const i=e.title.toUpperCase(),s=t.title.toUpperCase();return i<s?-1:i>s?1:0}_synchNodesToEntities(){const e=this._rootMetaObject.getObjectIDsInSubtree(),t=this._viewer.metaScene.metaObjects,i=this._viewer.scene.objects;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(t[r]){const e=this._objectNodes[r];if(e){const t=i[r];if(t){const i=t.visible;e.numEntities=1,i?(e.numVisibleEntities=1,e.checked=!0):(e.numVisibleEntities=0,e.checked=!1);let s=e.parent;for(;s;)s.numEntities++,i&&(s.numVisibleEntities++,s.checked=!0),s=s.parent}}}}}_withNodeTree(e,t){t(e);const i=e.children;if(i)for(let e=0,s=i.length;e<s;e++)this._withNodeTree(i[e],t)}_createTrees(){if(0===this._rootNodes.length)return;const e=this._rootNodes.map((e=>this._createNodeElement(e))),t=document.createElement("ul");e.forEach((e=>{t.appendChild(e)})),this._containerElement.appendChild(t),this._rootElement=t}_createNodeElement(e){const t=document.createElement("li"),i=e.nodeId;if(t.id="node-"+i,e.children.length>0){const e="switch-"+i,s=document.createElement("a");s.href="#",s.id=e,s.textContent="+",s.classList.add("plus"),s.addEventListener("click",this.switchExpandHandler),t.appendChild(s)}const s=document.createElement("input");s.id=i,s.type="checkbox",s.checked=e.checked,s.style["pointer-events"]="all",s.addEventListener("change",this._checkboxChangeHandler),t.appendChild(s);const r=document.createElement("span");return r.textContent=e.title,t.appendChild(r),r.oncontextmenu=t=>{this._treeViewPlugin.fire("contextmenu",{event:t,viewer:this._viewer,treeViewPlugin:this._treeViewPlugin,treeViewNode:e}),t.preventDefault()},r.onclick=t=>{this._treeViewPlugin.fire("nodeTitleClicked",{event:t,viewer:this._viewer,treeViewPlugin:this._treeViewPlugin,treeViewNode:e}),t.preventDefault()},t}expandToDepth(e){const t=(i,s)=>{if(s===e)return;const r="switch-"+i.nodeId,o=document.getElementById(r);if(o){this._expandSwitchElement(o);const e=i.children;for(var a=0,n=e.length;a<n;a++){const i=e[a];t(i,s+1)}}};for(let e=0,i=this._rootNodes.length;e<i;e++){const i=this._rootNodes[e];t(i,0)}}collapse(){for(let e=0,t=this._rootNodes.length;e<t;e++){const t=this._rootNodes[e].objectId;this._collapseNode(t)}}showNode(e){this._showListItemElementId&&this.unShowNode();const t=this._objectNodes[e];if(!t)return;const i=t.nodeId,s="switch-"+i,r=document.getElementById(s);if(r)return this._expandSwitchElement(r),void r.scrollIntoView();const o=[];o.unshift(t);let a=t.parent;for(;a;)o.unshift(a),a=a.parent;for(let e=0,t=o.length;e<t;e++){const t="switch-"+o[e].nodeId,i=document.getElementById(t);i&&this._expandSwitchElement(i)}const n="node-"+i,h=document.getElementById(n);h.scrollIntoView({block:"center"}),h.classList.add("highlighted-node"),this._showListItemElementId=n}unShowNode(){if(!this._showListItemElementId)return;const e=document.getElementById(this._showListItemElementId);e?(e.classList.remove("highlighted-node"),this._showListItemElementId=null):this._showListItemElementId=null}_expandSwitchElement(e){const t=e.parentElement;if(t.getElementsByTagName("li")[0])return;const i=t.id.replace("node-",""),s=this._nodeToObjectID(i),r=this._objectNodes[s].children.map((e=>this._createNodeElement(e))),o=document.createElement("ul");r.forEach((e=>{o.appendChild(e)})),t.appendChild(o),e.classList.remove("plus"),e.classList.add("minus"),e.textContent="-",e.removeEventListener("click",this.switchExpandHandler),e.addEventListener("click",this.switchCollapseHandler)}_collapseNode(e){const t="switch-"+this._objectToNodeID(e),i=document.getElementById(t);this._collapseSwitchElement(i)}_collapseSwitchElement(e){if(!e)return;const t=e.parentElement;if(!t)return;const i=t.querySelector("ul");i&&(t.removeChild(i),e.classList.remove("minus"),e.classList.add("plus"),e.textContent="+",e.removeEventListener("click",this.switchCollapseHandler),e.addEventListener("click",this.switchExpandHandler))}destroy(){this._rootElement&&!this._destroyed&&(this._rootElement.parentNode.removeChild(this._rootElement),this._viewer.scene.off(this._onObjectVisibility),this._destroyed=!0,idMap.removeItem(this._id))}}class TreeViewPlugin extends Plugin{constructor(e,t={}){if(super("TreeViewPlugin",e),t.containerElement){if(this._containerElement=t.containerElement,this._modelTreeViews={},this._autoAddModels=!1!==t.autoAddModels,this._autoExpandDepth=t.autoExpandDepth||0,this._sortNodes=!1!==t.sortNodes,this._pruneEmptyNodes=!1!==t.pruneEmptyNodes,this._autoAddModels){const e=Object.keys(this.viewer.metaScene.metaModels);for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addModel(i)}this.viewer.scene.on("modelLoaded",(e=>{this.viewer.metaScene.metaModels[e]&&this.addModel(e)}))}this.hierarchy=t.hierarchy}else this.error("Config expected: containerElement")}get modelTreeViews(){return this._modelTreeViews}set hierarchy(e){"containment"!==(e=e||"containment")&&"storeys"!==e&&"types"!==e&&(this.error("Unsupported value for `hierarchy' - defaulting to 'containment'"),e="containment"),this._hierarchy=e;for(let e in this._modelTreeViews)this._modelTreeViews.hasOwnProperty(e)&&this._modelTreeViews[e].setHierarchy(this._hierarchy)}get hierarchy(){return this._hierarchy}addModel(e,t={}){if(!this._containerElement)return;const i=this.viewer.scene.models[e];if(!i)throw"Model not found: "+e;const s=this.viewer.metaScene.metaModels[e];if(!s)return void this.error("MetaModel not found: "+e);if(this._modelTreeViews[e])return void this.warn("Model already added: "+e);const r=new ModelTreeView(this.viewer,this,i,s,{containerElement:this._containerElement,autoExpandDepth:this._autoExpandDepth,hierarchy:this._hierarchy,sortNodes:this._sortNodes,pruneEmptyNodes:this._pruneEmptyNodes,rootName:t.rootName});return this._modelTreeViews[e]=r,i.on("destroyed",(()=>{this.removeModel(i.id)})),r}removeModel(e){if(!this._containerElement)return;const t=this._modelTreeViews[e];t&&(t.destroy(),delete this._modelTreeViews[e])}collapse(){for(let e in this._modelTreeViews)if(this._modelTreeViews.hasOwnProperty(e)){this._modelTreeViews[e].collapse()}}showNode(e){this.unShowNode();const t=this.viewer.metaScene.metaObjects[e];if(!t)return void this.error("MetaObject not found: "+e);const i=t.metaModel.id,s=this._modelTreeViews[i];s?s.showNode(e):this.error("Object not in this TreeView: "+e)}unShowNode(){for(let e in this._modelTreeViews)if(this._modelTreeViews.hasOwnProperty(e)){this._modelTreeViews[e].unShowNode()}}expandToDepth(e){for(let t in this._modelTreeViews)if(this._modelTreeViews.hasOwnProperty(t)){const i=this._modelTreeViews[t];i.collapse(),i.expandToDepth(e)}}withNodeTree(e,t){t(e);const i=e.children;if(i)for(let e=0,s=i.length;e<s;e++)this.withNodeTree(i[e],t)}destroy(){if(this._containerElement){for(let e in this._modelTreeViews)this._modelTreeViews.hasOwnProperty(e)&&this._modelTreeViews[e].destroy();this._modelTreeViews={},super.destroy()}}}const tempVec3a$5=math.vec3(),tempVec3b$5=math.vec3(),tempMat4a=math.mat4();class FrustumPlane{constructor(){this.normal=math.vec3(),this.offset=0,this.testVertex=math.vec3()}set(e,t,i,s){const r=1/Math.sqrt(e*e+t*t+i*i);this.normal[0]=e*r,this.normal[1]=t*r,this.normal[2]=i*r,this.offset=s*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0}}class Frustum{constructor(){this.planes=[new FrustumPlane,new FrustumPlane,new FrustumPlane,new FrustumPlane,new FrustumPlane,new FrustumPlane]}}function setFrustum(e,t,i){const s=math.mulMat4(i,t,tempMat4a),r=s[0],o=s[1],a=s[2],n=s[3],h=s[4],l=s[5],c=s[6],u=s[7],p=s[8],d=s[9],m=s[10],f=s[11],g=s[12],_=s[13],y=s[14],T=s[15];e.planes[0].set(n-r,u-h,f-p,T-g),e.planes[1].set(n+r,u+h,f+p,T+g),e.planes[2].set(n-o,u-l,f-d,T-_),e.planes[3].set(n+o,u+l,f+d,T+_),e.planes[4].set(n-a,u-c,f-m,T-y),e.planes[5].set(n+a,u+c,f+m,T+y)}function frustumIntersectsAABB3(e,t){let i=Frustum.INSIDE;const s=tempVec3a$5,r=tempVec3b$5;s[0]=t[0],s[1]=t[1],s[2]=t[2],r[0]=t[3],r[1]=t[4],r[2]=t[5];const o=[s,r];for(let t=0;t<6;++t){const s=e.planes[t];if(s.normal[0]*o[s.testVertex[0]][0]+s.normal[1]*o[s.testVertex[1]][1]+s.normal[2]*o[s.testVertex[2]][2]+s.offset<0)return Frustum.OUTSIDE;s.normal[0]*o[1-s.testVertex[0]][0]+s.normal[1]*o[1-s.testVertex[1]][1]+s.normal[2]*o[1-s.testVertex[2]][2]+s.offset<0&&(i=Frustum.INTERSECT)}return i}Frustum.INSIDE=0,Frustum.INTERSECT=1,Frustum.OUTSIDE=2;class ObjectCullStates{constructor(e){this._scene=e,this._objects=[],this._objectsViewCulled=[],this._objectsDetailCulled=[],this._objectsChanged=[],this._objectsChangedList=[],this._modelInfos={},this._numObjects=0,this._lenObjectsChangedList=0,this._dirty=!0,this._onModelLoaded=e.on("modelLoaded",(t=>{const i=e.models[t];i&&this._addModel(i)})),this._onTick=e.on("tick",(()=>{this._dirty&&this._build(),this._applyChanges()}))}_addModel(e){const t={model:e,onDestroyed:e.on("destroyed",(()=>{this._removeModel(e)}))};this._modelInfos[e.id]=t,this._dirty=!0}_removeModel(e){const t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._dirty=!0)}_build(){if(!this._dirty)return;this._applyChanges();const e=this._scene.objects;for(let e=0;e<this._numObjects;e++)this._objects[e]=null;this._numObjects=0;for(let t in e){const i=e[t];this._objects[this._numObjects++]=i}this._lenObjectsChangedList=0,this._dirty=!1}_applyChanges(){if(this._lenObjectsChangedList>0){for(let e=0;e<this._lenObjectsChangedList;e++){const t=this._objectsChangedList[e],i=this._objects[t],s=this._objectsViewCulled[t],r=this._objectsDetailCulled[t],o=s||r;i.culled=o,this._objectsChanged[t]=!1}this._lenObjectsChangedList=0}}get objects(){return this._dirty&&this._build(),this._objects}get numObjects(){return this._dirty&&this._build(),this._numObjects}setObjectViewCulled(e,t){this._dirty&&this._build(),this._objectsViewCulled[e]!==t&&(this._objectsViewCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}setObjectDetailCulled(e,t){this._dirty&&this._build(),this._objectsDetailCulled[e]!==t&&(this._objectsDetailCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}_destroy(){this._clear(),this._scene.off(this._onModelLoaded),this._scene.off(this._onTick)}_clear(){for(let e in this._modelInfos){const t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._dirty=!0}}const sceneObjectCullStates={};function getObjectCullStates(e){const t=e.id;let i=sceneObjectCullStates[t];return i||(i=new ObjectCullStates(e),sceneObjectCullStates[t]=i,e.on("destroyed",(()=>{delete sceneObjectCullStates[t],i._destroy()}))),i}const MAX_KD_TREE_DEPTH=8,kdTreeDimLength=new Float32Array(3);class ViewCullPlugin extends Plugin{constructor(e,t={}){super("ViewCull",e),this._objectCullStates=getObjectCullStates(e.scene),this._maxTreeDepth=t.maxTreeDepth||8,this._modelInfos={},this._frustum=new Frustum,this._kdRoot=null,this._frustumDirty=!1,this._kdTreeDirty=!1,this._onViewMatrix=e.scene.camera.on("viewMatrix",(()=>{this._frustumDirty=!0})),this._onProjMatrix=e.scene.camera.on("projMatMatrix",(()=>{this._frustumDirty=!0})),this._onModelLoaded=e.scene.on("modelLoaded",(e=>{const t=this.viewer.scene.models[e];t&&this._addModel(t)})),this._onSceneTick=e.scene.on("tick",(()=>{this._doCull()}))}set enabled(e){this._enabled=e}get enabled(){return this._enabled}_addModel(e){const t={model:e,onDestroyed:e.on("destroyed",(()=>{this._removeModel(e)}))};this._modelInfos[e.id]=t,this._kdTreeDirty=!0}_removeModel(e){const t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._kdTreeDirty=!0)}_doCull(){const e=this._frustumDirty||this._kdTreeDirty;if(this._frustumDirty&&this._buildFrustum(),this._kdTreeDirty&&this._buildKDTree(),e){const e=this._kdRoot;e&&this._visitKDNode(e)}}_buildFrustum(){const e=this.viewer.scene.camera;setFrustum(this._frustum,e.viewMatrix,e.projMatrix),this._frustumDirty=!1}_buildKDTree(){const e=this.viewer.scene;this._kdRoot,this._kdRoot={aabb:e.getAABB(),intersection:Frustum.INTERSECT};for(let e=0,t=this._objectCullStates.numObjects;e<t;e++){const t=this._objectCullStates.objects[e];this._insertEntityIntoKDTree(this._kdRoot,t,e,1)}this._kdTreeDirty=!1}_insertEntityIntoKDTree(e,t,i,s){const r=t.aabb;if(s>=this._maxTreeDepth)return e.objects=e.objects||[],e.objects.push(i),void math.expandAABB3(e.aabb,r);if(e.left&&math.containsAABB3(e.left.aabb,r))return void this._insertEntityIntoKDTree(e.left,t,i,s+1);if(e.right&&math.containsAABB3(e.right.aabb,r))return void this._insertEntityIntoKDTree(e.right,t,i,s+1);const o=e.aabb;kdTreeDimLength[0]=o[3]-o[0],kdTreeDimLength[1]=o[4]-o[1],kdTreeDimLength[2]=o[5]-o[2];let a=0;if(kdTreeDimLength[1]>kdTreeDimLength[a]&&(a=1),kdTreeDimLength[2]>kdTreeDimLength[a]&&(a=2),!e.left){const n=o.slice();if(n[a+3]=(o[a]+o[a+3])/2,e.left={aabb:n,intersection:Frustum.INTERSECT},math.containsAABB3(n,r))return void this._insertEntityIntoKDTree(e.left,t,i,s+1)}if(!e.right){const n=o.slice();if(n[a]=(o[a]+o[a+3])/2,e.right={aabb:n,intersection:Frustum.INTERSECT},math.containsAABB3(n,r))return void this._insertEntityIntoKDTree(e.right,t,i,s+1)}e.objects=e.objects||[],e.objects.push(i),math.expandAABB3(e.aabb,r)}_visitKDNode(e,t=Frustum.INTERSECT){if(t!==Frustum.INTERSECT&&e.intersects===t)return;t===Frustum.INTERSECT&&(t=frustumIntersectsAABB3(this._frustum,e.aabb),e.intersects=t);const i=t===Frustum.OUTSIDE,s=e.objects;if(s&&s.length>0)for(let e=0,t=s.length;e<t;e++){const t=s[e];this._objectCullStates.setObjectViewCulled(t,i)}e.left&&this._visitKDNode(e.left,t),e.right&&this._visitKDNode(e.right,t)}send(e,t){}destroy(){super.destroy(),this._clear();const e=this.viewer.scene,t=e.camera;e.off(this._onModelLoaded),e.off(this._onSceneTick),t.off(this._onViewMatrix),t.off(this._onProjMatrix)}_clear(){for(let e in this._modelInfos){const t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._kdRoot=null,this._kdTreeDirty=!0}}class XKTDefaultDataSource{constructor(){}getMetaModel(e,t,i){utils.loadJSON(e,(e=>{t(e)}),(function(e){i(e)}))}getXKT(e,t,i){var s=()=>{};t=t||s,i=i||s;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),i=new Uint8Array(e);for(var a=0;a<o.length;a++)i[a]=o.charCodeAt(a);t(e)}catch(e){i(e)}}else{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i("getXKT error : "+s.response))},s.send(null)}}}!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=e()}}((function(){return function e(t,i,s){function r(a,n){if(!i[a]){if(!t[a]){var h="function"==typeof require&&require;if(!n&&h)return h(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[a]={exports:{}};t[a][0].call(c.exports,(function(e){return r(t[a][1][e]||e)}),c,c.exports,e,t,i,s)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(e,t,i){var s=e("./zlib/deflate"),r=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),n=e("./zlib/zstream"),h=Object.prototype.toString;function l(e){if(!(this instanceof l))return new l(e);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var i=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==i)throw new Error(a[i]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===h.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(i=s.deflateSetDictionary(this.strm,c)))throw new Error(a[i]);this._dict_set=!0}}function c(e,t){var i=new l(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}l.prototype.push=function(e,t){var i,a,n=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=o.string2buf(e):"[object ArrayBuffer]"===h.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new r.Buf8(l),n.next_out=0,n.avail_out=l),1!==(i=s.deflate(n,a))&&0!==i)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(n.output,n.next_out))):this.onData(r.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==i);return 4===a?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==a||(this.onEnd(0),n.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=l,i.deflate=c,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(e,t,i){var s=e("./zlib/inflate"),r=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),n=e("./zlib/messages"),h=e("./zlib/zstream"),l=e("./zlib/gzheader"),c=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var i=s.inflateInit2(this.strm,t.windowBits);if(i!==a.Z_OK)throw new Error(n[i]);if(this.header=new l,s.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=s.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(n[i])}function p(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg||n[i.err];return i.result}u.prototype.push=function(e,t){var i,n,h,l,u,p=this.strm,d=this.options.chunkSize,m=this.options.dictionary,f=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(d),p.next_out=0,p.avail_out=d),(i=s.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(i=s.inflateSetDictionary(this.strm,m)),i===a.Z_BUF_ERROR&&!0===f&&(i=a.Z_OK,f=!1),i!==a.Z_STREAM_END&&i!==a.Z_OK)return this.onEnd(i),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&i!==a.Z_STREAM_END&&(0!==p.avail_in||n!==a.Z_FINISH&&n!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(h=o.utf8border(p.output,p.next_out),l=p.next_out-h,u=o.buf2string(p.output,h),p.next_out=l,p.avail_out=d-l,l&&r.arraySet(p.output,p.output,h,l,0),this.onData(u)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(f=!0)}while((p.avail_in>0||0===p.avail_out)&&i!==a.Z_STREAM_END);return i===a.Z_STREAM_END&&(n=a.Z_FINISH),n===a.Z_FINISH?(i=s.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===a.Z_OK):n!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=u,i.inflate=p,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,p(e,t)},i.ungzip=p},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(e,t,i){var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)r(i,s)&&(e[s]=i[s])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,i,s,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),r);else for(var o=0;o<s;o++)e[r+o]=t[i+o]},flattenChunks:function(e){var t,i,s,r,o,a;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(a=new Uint8Array(s),r=0,t=0,i=e.length;t<i;t++)o=e[t],a.set(o,r),r+=o.length;return a}},a={arraySet:function(e,t,i,s,r){for(var o=0;o<s;o++)e[r+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],4:[function(e,t,i){var s=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new s.Buf8(256),n=0;n<256;n++)a[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;function h(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(e,t));for(var i="",a=0;a<t;a++)i+=String.fromCharCode(e[a]);return i}a[254]=a[254]=1,i.string2buf=function(e){var t,i,r,o,a,n=e.length,h=0;for(o=0;o<n;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),h+=i<128?1:i<2048?2:i<65536?3:4;for(t=new s.Buf8(h),a=0,o=0;a<h;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<n&&56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),i<128?t[a++]=i:i<2048?(t[a++]=192|i>>>6,t[a++]=128|63&i):i<65536?(t[a++]=224|i>>>12,t[a++]=128|i>>>6&63,t[a++]=128|63&i):(t[a++]=240|i>>>18,t[a++]=128|i>>>12&63,t[a++]=128|i>>>6&63,t[a++]=128|63&i);return t},i.buf2binstring=function(e){return h(e,e.length)},i.binstring2buf=function(e){for(var t=new s.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,s,r,o,n=t||e.length,l=new Array(2*n);for(s=0,i=0;i<n;)if((r=e[i++])<128)l[s++]=r;else if((o=a[r])>4)l[s++]=65533,i+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&i<n;)r=r<<6|63&e[i++],o--;o>1?l[s++]=65533:r<65536?l[s++]=r:(r-=65536,l[s++]=55296|r>>10&1023,l[s++]=56320|1023&r)}return h(l,s)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+a[e[i]]>t?i:t}},{"./common":3}],5:[function(e,t,i){t.exports=function(e,t,i,s){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==i;){i-=a=i>2e3?2e3:i;do{o=o+(r=r+t[s++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}},{}],6:[function(e,t,i){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(e,t,i){var s=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,r){var o=s,a=r+i;e^=-1;for(var n=r;n<a;n++)e=e>>>8^o[255&(e^t[n])];return-1^e}},{}],8:[function(e,t,i){var s,r=e("../utils/common"),o=e("./trees"),a=e("./adler32"),n=e("./crc32"),h=e("./messages"),l=-2,c=258,u=262,p=103,d=113,m=666;function f(e,t){return e.msg=h[t],t}function g(e){return(e<<1)-(e>4?9:0)}function _(e){for(var t=e.length;--t>=0;)e[t]=0}function y(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(r.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function T(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,y(e.strm)}function v(e,t){e.pending_buf[e.pending++]=t}function I(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function E(e,t){var i,s,r=e.max_chain_length,o=e.strstart,a=e.prev_length,n=e.nice_match,h=e.strstart>e.w_size-u?e.strstart-(e.w_size-u):0,l=e.window,p=e.w_mask,d=e.prev,m=e.strstart+c,f=l[o+a-1],g=l[o+a];e.prev_length>=e.good_match&&(r>>=2),n>e.lookahead&&(n=e.lookahead);do{if(l[(i=t)+a]===g&&l[i+a-1]===f&&l[i]===l[o]&&l[++i]===l[o+1]){o+=2,i++;do{}while(l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&o<m);if(s=c-(m-o),o=m-c,s>a){if(e.match_start=t,a=s,s>=n)break;f=l[o+a-1],g=l[o+a]}}}while((t=d[t&p])>h&&0!=--r);return a<=e.lookahead?a:e.lookahead}function P(e){var t,i,s,o,h,l,c,p,d,m,f=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-u)){r.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=f?s-f:0}while(--i);t=i=f;do{s=e.prev[--t],e.prev[t]=s>=f?s-f:0}while(--i);o+=f}if(0===e.strm.avail_in)break;if(l=e.strm,c=e.window,p=e.strstart+e.lookahead,d=o,m=void 0,(m=l.avail_in)>d&&(m=d),i=0===m?0:(l.avail_in-=m,r.arraySet(c,l.input,l.next_in,m,p),1===l.state.wrap?l.adler=a(l.adler,c,m,p):2===l.state.wrap&&(l.adler=n(l.adler,c,m,p)),l.next_in+=m,l.total_in+=m,m),e.lookahead+=i,e.lookahead+e.insert>=3)for(h=e.strstart-e.insert,e.ins_h=e.window[h],e.ins_h=(e.ins_h<<e.hash_shift^e.window[h+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[h+3-1])&e.hash_mask,e.prev[h&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=h,h++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<u&&0!==e.strm.avail_in)}function b(e,t){for(var i,s;;){if(e.lookahead<u){if(P(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-u&&(e.match_length=E(e,i)),e.match_length>=3)if(s=o._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(T(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(T(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(T(e,!1),0===e.strm.avail_out)?1:2}function D(e,t){for(var i,s,r;;){if(e.lookahead<u){if(P(e),e.lookahead<u&&0===t)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-u&&(e.match_length=E(e,i),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,s=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(T(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((s=o._tr_tally(e,0,e.window[e.strstart-1]))&&T(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(T(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(T(e,!1),0===e.strm.avail_out)?1:2}function w(e,t,i,s,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=r}function C(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),_(this.dyn_ltree),_(this.dyn_dtree),_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),_(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function R(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:d,e.adler=2===t.wrap?0:1,t.last_flush=0,o._tr_init(t),0):f(e,l)}function F(e){var t,i=R(e);return 0===i&&((t=e.state).window_size=2*t.w_size,_(t.head),t.max_lazy_match=s[t.level].max_lazy,t.good_match=s[t.level].good_length,t.nice_match=s[t.level].nice_length,t.max_chain_length=s[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),i}function S(e,t,i,s,o,a){if(!e)return l;var n=1;if(-1===t&&(t=6),s<0?(n=0,s=-s):s>15&&(n=2,s-=16),o<1||o>9||8!==i||s<8||s>15||t<0||t>9||a<0||a>4)return f(e,l);8===s&&(s=9);var h=new C;return e.state=h,h.strm=e,h.wrap=n,h.gzhead=null,h.w_bits=s,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=o+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new r.Buf8(2*h.w_size),h.head=new r.Buf16(h.hash_size),h.prev=new r.Buf16(h.w_size),h.lit_bufsize=1<<o+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new r.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=t,h.strategy=a,h.method=i,F(e)}s=[new w(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(P(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,T(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-u&&(T(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(T(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(T(e,!1),e.strm.avail_out),1)})),new w(4,4,8,4,b),new w(4,5,16,8,b),new w(4,6,32,32,b),new w(4,4,16,16,D),new w(8,16,32,32,D),new w(8,16,128,128,D),new w(8,32,128,256,D),new w(32,128,258,1024,D),new w(32,258,258,4096,D)],i.deflateInit=function(e,t){return S(e,t,8,15,8,0)},i.deflateInit2=S,i.deflateReset=F,i.deflateResetKeep=R,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?l:(e.state.gzhead=t,0):l},i.deflate=function(e,t){var i,r,a,h;if(!e||!e.state||t>5||t<0)return e?f(e,l):l;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===m&&4!==t)return f(e,0===e.avail_out?-5:l);if(r.strm=e,i=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,v(r,31),v(r,139),v(r,8),r.gzhead?(v(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),v(r,255&r.gzhead.time),v(r,r.gzhead.time>>8&255),v(r,r.gzhead.time>>16&255),v(r,r.gzhead.time>>24&255),v(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),v(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(v(r,255&r.gzhead.extra.length),v(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=n(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(v(r,0),v(r,0),v(r,0),v(r,0),v(r,0),v(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),v(r,3),r.status=d);else{var u=8+(r.w_bits-8<<4)<<8;u|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(u|=32),u+=31-u%31,r.status=d,I(r,u),0!==r.strstart&&(I(r,e.adler>>>16),I(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=n(e.adler,r.pending_buf,r.pending-a,a)),y(e),a=r.pending,r.pending!==r.pending_buf_size));)v(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=n(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=n(e.adler,r.pending_buf,r.pending-a,a)),y(e),a=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,v(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>a&&(e.adler=n(e.adler,r.pending_buf,r.pending-a,a)),0===h&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=n(e.adler,r.pending_buf,r.pending-a,a)),y(e),a=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,v(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>a&&(e.adler=n(e.adler,r.pending_buf,r.pending-a,a)),0===h&&(r.status=p)}else r.status=p;if(r.status===p&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&y(e),r.pending+2<=r.pending_buf_size&&(v(r,255&e.adler),v(r,e.adler>>8&255),e.adler=0,r.status=d)):r.status=d),0!==r.pending){if(y(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(i)&&4!==t)return f(e,-5);if(r.status===m&&0!==e.avail_in)return f(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&r.status!==m){var E=2===r.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(P(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(T(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(T(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(T(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var i,s,r,a,n=e.window;;){if(e.lookahead<=c){if(P(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=n[r=e.strstart-1])===n[++r]&&s===n[++r]&&s===n[++r]){a=e.strstart+c;do{}while(s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&r<a);e.match_length=c-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=o._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(T(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(T(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(T(e,!1),0===e.strm.avail_out)?1:2}(r,t):s[r.level].func(r,t);if(3!==E&&4!==E||(r.status=m),1===E||3===E)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===E&&(1===t?o._tr_align(r):5!==t&&(o._tr_stored_block(r,0,0,!1),3===t&&(_(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),y(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(v(r,255&e.adler),v(r,e.adler>>8&255),v(r,e.adler>>16&255),v(r,e.adler>>24&255),v(r,255&e.total_in),v(r,e.total_in>>8&255),v(r,e.total_in>>16&255),v(r,e.total_in>>24&255)):(I(r,e.adler>>>16),I(r,65535&e.adler)),y(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},i.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==p&&t!==d&&t!==m?f(e,l):(e.state=null,t===d?f(e,-3):0):l},i.deflateSetDictionary=function(e,t){var i,s,o,n,h,c,u,p,d=t.length;if(!e||!e.state)return l;if(2===(n=(i=e.state).wrap)||1===n&&42!==i.status||i.lookahead)return l;for(1===n&&(e.adler=a(e.adler,t,d,0)),i.wrap=0,d>=i.w_size&&(0===n&&(_(i.head),i.strstart=0,i.block_start=0,i.insert=0),p=new r.Buf8(i.w_size),r.arraySet(p,t,d-i.w_size,i.w_size,0),t=p,d=i.w_size),h=e.avail_in,c=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,P(i);i.lookahead>=3;){s=i.strstart,o=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+3-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--o);i.strstart=s,i.lookahead=2,P(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=c,e.input=u,e.avail_in=h,i.wrap=n,0},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(e,t,i){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(e,t,i){t.exports=function(e,t){var i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I,E,P,b,D,w;i=e.state,s=e.next_in,D=e.input,r=s+(e.avail_in-5),o=e.next_out,w=e.output,a=o-(t-e.avail_out),n=o+(e.avail_out-257),h=i.dmax,l=i.wsize,c=i.whave,u=i.wnext,p=i.window,d=i.hold,m=i.bits,f=i.lencode,g=i.distcode,_=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;e:do{m<15&&(d+=D[s++]<<m,m+=8,d+=D[s++]<<m,m+=8),T=f[d&_];t:for(;;){if(d>>>=v=T>>>24,m-=v,0===(v=T>>>16&255))w[o++]=65535&T;else{if(!(16&v)){if(0==(64&v)){T=f[(65535&T)+(d&(1<<v)-1)];continue t}if(32&v){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}I=65535&T,(v&=15)&&(m<v&&(d+=D[s++]<<m,m+=8),I+=d&(1<<v)-1,d>>>=v,m-=v),m<15&&(d+=D[s++]<<m,m+=8,d+=D[s++]<<m,m+=8),T=g[d&y];i:for(;;){if(d>>>=v=T>>>24,m-=v,!(16&(v=T>>>16&255))){if(0==(64&v)){T=g[(65535&T)+(d&(1<<v)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(E=65535&T,m<(v&=15)&&(d+=D[s++]<<m,(m+=8)<v&&(d+=D[s++]<<m,m+=8)),(E+=d&(1<<v)-1)>h){e.msg="invalid distance too far back",i.mode=30;break e}if(d>>>=v,m-=v,E>(v=o-a)){if((v=E-v)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(P=0,b=p,0===u){if(P+=l-v,v<I){I-=v;do{w[o++]=p[P++]}while(--v);P=o-E,b=w}}else if(u<v){if(P+=l+u-v,(v-=u)<I){I-=v;do{w[o++]=p[P++]}while(--v);if(P=0,u<I){I-=v=u;do{w[o++]=p[P++]}while(--v);P=o-E,b=w}}}else if(P+=u-v,v<I){I-=v;do{w[o++]=p[P++]}while(--v);P=o-E,b=w}for(;I>2;)w[o++]=b[P++],w[o++]=b[P++],w[o++]=b[P++],I-=3;I&&(w[o++]=b[P++],I>1&&(w[o++]=b[P++]))}else{P=o-E;do{w[o++]=w[P++],w[o++]=w[P++],w[o++]=w[P++],I-=3}while(I>2);I&&(w[o++]=w[P++],I>1&&(w[o++]=w[P++]))}break}}break}}while(s<r&&o<n);s-=I=m>>3,d&=(1<<(m-=I<<3))-1,e.next_in=s,e.next_out=o,e.avail_in=s<r?r-s+5:5-(s-r),e.avail_out=o<n?n-o+257:257-(o-n),i.hold=d,i.bits=m}},{}],11:[function(e,t,i){var s=e("../utils/common"),r=e("./adler32"),o=e("./crc32"),a=e("./inffast"),n=e("./inftrees"),h=-2,l=12,c=30;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function p(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new s.Buf32(852),t.distcode=t.distdyn=new s.Buf32(592),t.sane=1,t.back=-1,0):h}function m(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):h}function f(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,m(e))):h}function g(e,t){var i,s;return e?(s=new p,e.state=s,s.window=null,0!==(i=f(e,t))&&(e.state=null),i):h}var _,y,T=!0;function v(e){if(T){var t;for(_=new s.Buf32(512),y=new s.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(n(1,e.lens,0,288,_,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;n(2,e.lens,0,32,y,0,e.work,{bits:5}),T=!1}e.lencode=_,e.lenbits=9,e.distcode=y,e.distbits=5}function I(e,t,i,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new s.Buf8(a.wsize)),r>=a.wsize?(s.arraySet(a.window,t,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),s.arraySet(a.window,t,i-r,o,a.wnext),(r-=o)?(s.arraySet(a.window,t,i-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}i.inflateReset=m,i.inflateReset2=f,i.inflateResetKeep=d,i.inflateInit=function(e){return g(e,15)},i.inflateInit2=g,i.inflate=function(e,t){var i,p,d,m,f,g,_,y,T,E,P,b,D,w,C,R,F,S,x,M,A,L,O,N,B=0,k=new s.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;(i=e.state).mode===l&&(i.mode=13),f=e.next_out,d=e.output,_=e.avail_out,m=e.next_in,p=e.input,g=e.avail_in,y=i.hold,T=i.bits,E=g,P=_,L=0;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;T<16;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(2&i.wrap&&35615===y){i.check=0,k[0]=255&y,k[1]=y>>>8&255,i.check=o(i.check,k,2,0),y=0,T=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=c;break}if(8!=(15&y)){e.msg="unknown compression method",i.mode=c;break}if(T-=4,A=8+(15&(y>>>=4)),0===i.wbits)i.wbits=A;else if(A>i.wbits){e.msg="invalid window size",i.mode=c;break}i.dmax=1<<A,e.adler=i.check=1,i.mode=512&y?10:l,y=0,T=0;break;case 2:for(;T<16;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(i.flags=y,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=c;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=c;break}i.head&&(i.head.text=y>>8&1),512&i.flags&&(k[0]=255&y,k[1]=y>>>8&255,i.check=o(i.check,k,2,0)),y=0,T=0,i.mode=3;case 3:for(;T<32;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}i.head&&(i.head.time=y),512&i.flags&&(k[0]=255&y,k[1]=y>>>8&255,k[2]=y>>>16&255,k[3]=y>>>24&255,i.check=o(i.check,k,4,0)),y=0,T=0,i.mode=4;case 4:for(;T<16;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&i.flags&&(k[0]=255&y,k[1]=y>>>8&255,i.check=o(i.check,k,2,0)),y=0,T=0,i.mode=5;case 5:if(1024&i.flags){for(;T<16;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}i.length=y,i.head&&(i.head.extra_len=y),512&i.flags&&(k[0]=255&y,k[1]=y>>>8&255,i.check=o(i.check,k,2,0)),y=0,T=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((b=i.length)>g&&(b=g),b&&(i.head&&(A=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),s.arraySet(i.head.extra,p,m,b,A)),512&i.flags&&(i.check=o(i.check,p,b,m)),g-=b,m+=b,i.length-=b),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===g)break e;b=0;do{A=p[m+b++],i.head&&A&&i.length<65536&&(i.head.name+=String.fromCharCode(A))}while(A&&b<g);if(512&i.flags&&(i.check=o(i.check,p,b,m)),g-=b,m+=b,A)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===g)break e;b=0;do{A=p[m+b++],i.head&&A&&i.length<65536&&(i.head.comment+=String.fromCharCode(A))}while(A&&b<g);if(512&i.flags&&(i.check=o(i.check,p,b,m)),g-=b,m+=b,A)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;T<16;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=c;break}y=0,T=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=l;break;case 10:for(;T<32;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}e.adler=i.check=u(y),y=0,T=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=f,e.avail_out=_,e.next_in=m,e.avail_in=g,i.hold=y,i.bits=T,2;e.adler=i.check=1,i.mode=l;case l:if(5===t||6===t)break e;case 13:if(i.last){y>>>=7&T,T-=7&T,i.mode=27;break}for(;T<3;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}switch(i.last=1&y,T-=1,3&(y>>>=1)){case 0:i.mode=14;break;case 1:if(v(i),i.mode=20,6===t){y>>>=2,T-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=c}y>>>=2,T-=2;break;case 14:for(y>>>=7&T,T-=7&T;T<32;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=c;break}if(i.length=65535&y,y=0,T=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(b=i.length){if(b>g&&(b=g),b>_&&(b=_),0===b)break e;s.arraySet(d,p,m,b,f),g-=b,m+=b,_-=b,f+=b,i.length-=b;break}i.mode=l;break;case 17:for(;T<14;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(i.nlen=257+(31&y),y>>>=5,T-=5,i.ndist=1+(31&y),y>>>=5,T-=5,i.ncode=4+(15&y),y>>>=4,T-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=c;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;T<3;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}i.lens[G[i.have++]]=7&y,y>>>=3,T-=3}for(;i.have<19;)i.lens[G[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,O={bits:i.lenbits},L=n(0,i.lens,0,19,i.lencode,0,i.work,O),i.lenbits=O.bits,L){e.msg="invalid code lengths set",i.mode=c;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;R=(B=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,F=65535&B,!((C=B>>>24)<=T);){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(F<16)y>>>=C,T-=C,i.lens[i.have++]=F;else{if(16===F){for(N=C+2;T<N;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(y>>>=C,T-=C,0===i.have){e.msg="invalid bit length repeat",i.mode=c;break}A=i.lens[i.have-1],b=3+(3&y),y>>>=2,T-=2}else if(17===F){for(N=C+3;T<N;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}T-=C,A=0,b=3+(7&(y>>>=C)),y>>>=3,T-=3}else{for(N=C+7;T<N;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}T-=C,A=0,b=11+(127&(y>>>=C)),y>>>=7,T-=7}if(i.have+b>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=c;break}for(;b--;)i.lens[i.have++]=A}}if(i.mode===c)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=c;break}if(i.lenbits=9,O={bits:i.lenbits},L=n(1,i.lens,0,i.nlen,i.lencode,0,i.work,O),i.lenbits=O.bits,L){e.msg="invalid literal/lengths set",i.mode=c;break}if(i.distbits=6,i.distcode=i.distdyn,O={bits:i.distbits},L=n(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,O),i.distbits=O.bits,L){e.msg="invalid distances set",i.mode=c;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(g>=6&&_>=258){e.next_out=f,e.avail_out=_,e.next_in=m,e.avail_in=g,i.hold=y,i.bits=T,a(e,P),f=e.next_out,d=e.output,_=e.avail_out,m=e.next_in,p=e.input,g=e.avail_in,y=i.hold,T=i.bits,i.mode===l&&(i.back=-1);break}for(i.back=0;R=(B=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,F=65535&B,!((C=B>>>24)<=T);){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(R&&0==(240&R)){for(S=C,x=R,M=F;R=(B=i.lencode[M+((y&(1<<S+x)-1)>>S)])>>>16&255,F=65535&B,!(S+(C=B>>>24)<=T);){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}y>>>=S,T-=S,i.back+=S}if(y>>>=C,T-=C,i.back+=C,i.length=F,0===R){i.mode=26;break}if(32&R){i.back=-1,i.mode=l;break}if(64&R){e.msg="invalid literal/length code",i.mode=c;break}i.extra=15&R,i.mode=22;case 22:if(i.extra){for(N=i.extra;T<N;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,T-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;R=(B=i.distcode[y&(1<<i.distbits)-1])>>>16&255,F=65535&B,!((C=B>>>24)<=T);){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(0==(240&R)){for(S=C,x=R,M=F;R=(B=i.distcode[M+((y&(1<<S+x)-1)>>S)])>>>16&255,F=65535&B,!(S+(C=B>>>24)<=T);){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}y>>>=S,T-=S,i.back+=S}if(y>>>=C,T-=C,i.back+=C,64&R){e.msg="invalid distance code",i.mode=c;break}i.offset=F,i.extra=15&R,i.mode=24;case 24:if(i.extra){for(N=i.extra;T<N;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,T-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=c;break}i.mode=25;case 25:if(0===_)break e;if(b=P-_,i.offset>b){if((b=i.offset-b)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=c;break}b>i.wnext?(b-=i.wnext,D=i.wsize-b):D=i.wnext-b,b>i.length&&(b=i.length),w=i.window}else w=d,D=f-i.offset,b=i.length;b>_&&(b=_),_-=b,i.length-=b;do{d[f++]=w[D++]}while(--b);0===i.length&&(i.mode=21);break;case 26:if(0===_)break e;d[f++]=i.length,_--,i.mode=21;break;case 27:if(i.wrap){for(;T<32;){if(0===g)break e;g--,y|=p[m++]<<T,T+=8}if(P-=_,e.total_out+=P,i.total+=P,P&&(e.adler=i.check=i.flags?o(i.check,d,P,f-P):r(i.check,d,P,f-P)),P=_,(i.flags?y:u(y))!==i.check){e.msg="incorrect data check",i.mode=c;break}y=0,T=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;T<32;){if(0===g)break e;g--,y+=p[m++]<<T,T+=8}if(y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=c;break}y=0,T=0}i.mode=29;case 29:L=1;break e;case c:L=-3;break e;case 31:return-4;default:return h}return e.next_out=f,e.avail_out=_,e.next_in=m,e.avail_in=g,i.hold=y,i.bits=T,(i.wsize||P!==e.avail_out&&i.mode<c&&(i.mode<27||4!==t))&&I(e,e.output,e.next_out,P-e.avail_out),E-=e.avail_in,P-=e.avail_out,e.total_in+=E,e.total_out+=P,i.total+=P,i.wrap&&P&&(e.adler=i.check=i.flags?o(i.check,d,P,e.next_out-P):r(i.check,d,P,e.next_out-P)),e.data_type=i.bits+(i.last?64:0)+(i.mode===l?128:0)+(20===i.mode||15===i.mode?256:0),(0===E&&0===P||4===t)&&0===L&&(L=-5),L},i.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,0},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?h:(i.head=t,t.done=!1,0):h},i.inflateSetDictionary=function(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?h:11===i.mode&&r(1,t,s,0)!==i.check?-3:I(e,t,s,s)?(i.mode=31,-4):(i.havedict=1,0):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(e,t,i){var s=e("../utils/common"),r=15,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,l,c,u,p,d){var m,f,g,_,y,T,v,I,E,P=d.bits,b=0,D=0,w=0,C=0,R=0,F=0,S=0,x=0,M=0,A=0,L=null,O=0,N=new s.Buf16(16),B=new s.Buf16(16),k=null,G=0;for(b=0;b<=r;b++)N[b]=0;for(D=0;D<l;D++)N[t[i+D]]++;for(R=P,C=r;C>=1&&0===N[C];C--);if(R>C&&(R=C),0===C)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(w=1;w<C&&0===N[w];w++);for(R<w&&(R=w),x=1,b=1;b<=r;b++)if(x<<=1,(x-=N[b])<0)return-1;if(x>0&&(0===e||1!==C))return-1;for(B[1]=0,b=1;b<r;b++)B[b+1]=B[b]+N[b];for(D=0;D<l;D++)0!==t[i+D]&&(p[B[t[i+D]]++]=D);if(0===e?(L=k=p,T=19):1===e?(L=o,O-=257,k=a,G-=257,T=256):(L=n,k=h,T=-1),A=0,D=0,b=w,y=u,F=R,S=0,g=-1,_=(M=1<<R)-1,1===e&&M>852||2===e&&M>592)return 1;for(;;){v=b-S,p[D]<T?(I=0,E=p[D]):p[D]>T?(I=k[G+p[D]],E=L[O+p[D]]):(I=96,E=0),m=1<<b-S,w=f=1<<F;do{c[y+(A>>S)+(f-=m)]=v<<24|I<<16|E|0}while(0!==f);for(m=1<<b-1;A&m;)m>>=1;if(0!==m?(A&=m-1,A+=m):A=0,D++,0==--N[b]){if(b===C)break;b=t[i+p[D]]}if(b>R&&(A&_)!==g){for(0===S&&(S=R),y+=w,x=1<<(F=b-S);F+S<C&&!((x-=N[F+S])<=0);)F++,x<<=1;if(M+=1<<F,1===e&&M>852||2===e&&M>592)return 1;c[g=A&_]=R<<24|F<<16|y-u|0}}return 0!==A&&(c[y+A]=b-S<<24|64<<16|0),d.bits=R,0}},{"../utils/common":3}],13:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(e,t,i){var s=e("../utils/common");function r(e){for(var t=e.length;--t>=0;)e[t]=0}var o=256,a=286,n=30,h=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],p=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=new Array(576);r(d);var m=new Array(60);r(m);var f=new Array(512);r(f);var g=new Array(256);r(g);var _=new Array(29);r(_);var y,T,v,I=new Array(n);function E(e,t,i,s,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=e&&e.length}function P(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function b(e){return e<256?f[e]:f[256+(e>>>7)]}function D(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function w(e,t,i){e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,D(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function C(e,t,i){w(e,i[2*t],i[2*t+1])}function R(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function F(e,t,i){var s,r,o=new Array(16),a=0;for(s=1;s<=h;s++)o[s]=a=a+i[s-1]<<1;for(r=0;r<=t;r++){var n=e[2*r+1];0!==n&&(e[2*r]=R(o[n]++,n))}}function S(e){var t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<n;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function x(e){e.bi_valid>8?D(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function M(e,t,i,s){var r=2*t,o=2*i;return e[r]<e[o]||e[r]===e[o]&&s[t]<=s[i]}function A(e,t,i){for(var s=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&M(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!M(t,s,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=s}function L(e,t,i){var s,r,a,n,h=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*h]<<8|e.pending_buf[e.d_buf+2*h+1],r=e.pending_buf[e.l_buf+h],h++,0===s?C(e,r,t):(C(e,(a=g[r])+o+1,t),0!==(n=l[a])&&w(e,r-=_[a],n),C(e,a=b(--s),i),0!==(n=c[a])&&w(e,s-=I[a],n))}while(h<e.last_lit);C(e,256,t)}function O(e,t){var i,s,r,o=t.dyn_tree,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<l;i++)0!==o[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,n&&(e.static_len-=a[2*r+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)A(e,o,i);r=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],A(e,o,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,o[2*r]=o[2*i]+o[2*s],e.depth[r]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,o[2*i+1]=o[2*s+1]=r,e.heap[1]=r++,A(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,s,r,o,a,n,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,p=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,m=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=h;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)(o=l[2*l[2*(s=e.heap[i])+1]+1]+1)>f&&(o=f,g++),l[2*s+1]=o,s>c||(e.bl_count[o]++,a=0,s>=m&&(a=d[s-m]),n=l[2*s],e.opt_len+=n*(o+a),p&&(e.static_len+=n*(u[2*s+1]+a)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(s=e.bl_count[o];0!==s;)(r=e.heap[--i])>c||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),s--)}}(e,t),F(o,c,e.bl_count)}function N(e,t,i){var s,r,o=-1,a=t[1],n=0,h=7,l=4;for(0===a&&(h=138,l=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)r=a,a=t[2*(s+1)+1],++n<h&&r===a||(n<l?e.bl_tree[2*r]+=n:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):n<=10?e.bl_tree[34]++:e.bl_tree[36]++,n=0,o=r,0===a?(h=138,l=3):r===a?(h=6,l=3):(h=7,l=4))}function B(e,t,i){var s,r,o=-1,a=t[1],n=0,h=7,l=4;for(0===a&&(h=138,l=3),s=0;s<=i;s++)if(r=a,a=t[2*(s+1)+1],!(++n<h&&r===a)){if(n<l)do{C(e,r,e.bl_tree)}while(0!=--n);else 0!==r?(r!==o&&(C(e,r,e.bl_tree),n--),C(e,16,e.bl_tree),w(e,n-3,2)):n<=10?(C(e,17,e.bl_tree),w(e,n-3,3)):(C(e,18,e.bl_tree),w(e,n-11,7));n=0,o=r,0===a?(h=138,l=3):r===a?(h=6,l=3):(h=7,l=4)}}r(I);var k=!1;function G(e,t,i,r){w(e,0+(r?1:0),3),function(e,t,i,r){x(e),r&&(D(e,i),D(e,~i)),s.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}i._tr_init=function(e){k||(!function(){var e,t,i,s,r,o=new Array(16);for(i=0,s=0;s<28;s++)for(_[s]=i,e=0;e<1<<l[s];e++)g[i++]=s;for(g[i-1]=s,r=0,s=0;s<16;s++)for(I[s]=r,e=0;e<1<<c[s];e++)f[r++]=s;for(r>>=7;s<n;s++)for(I[s]=r<<7,e=0;e<1<<c[s]-7;e++)f[256+r++]=s;for(t=0;t<=h;t++)o[t]=0;for(e=0;e<=143;)d[2*e+1]=8,e++,o[8]++;for(;e<=255;)d[2*e+1]=9,e++,o[9]++;for(;e<=279;)d[2*e+1]=7,e++,o[7]++;for(;e<=287;)d[2*e+1]=8,e++,o[8]++;for(F(d,287,o),e=0;e<n;e++)m[2*e+1]=5,m[2*e]=R(e,5);y=new E(d,l,257,a,h),T=new E(m,c,0,n,h),v=new E(new Array(0),u,0,19,7)}(),k=!0),e.l_desc=new P(e.dyn_ltree,y),e.d_desc=new P(e.dyn_dtree,T),e.bl_desc=new P(e.bl_tree,v),e.bi_buf=0,e.bi_valid=0,S(e)},i._tr_stored_block=G,i._tr_flush_block=function(e,t,i,s){var r,a,n=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<o;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),O(e,e.l_desc),O(e,e.d_desc),n=function(e){var t;for(N(e,e.dyn_ltree,e.l_desc.max_code),N(e,e.dyn_dtree,e.d_desc.max_code),O(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*p[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==t?G(e,t,i,s):4===e.strategy||a===r?(w(e,2+(s?1:0),3),L(e,d,m)):(w(e,4+(s?1:0),3),function(e,t,i,s){var r;for(w(e,t-257,5),w(e,i-1,5),w(e,s-4,4),r=0;r<s;r++)w(e,e.bl_tree[2*p[r]+1],3);B(e,e.dyn_ltree,t-1),B(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,n+1),L(e,e.dyn_ltree,e.dyn_dtree)),S(e),s&&x(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(g[i]+o+1)]++,e.dyn_dtree[2*b(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){w(e,2,3),C(e,256,d),function(e){16===e.bi_valid?(D(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":3}],15:[function(e,t,i){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(e,t,i){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=s},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}));var p=Object.freeze({__proto__:null});let pako$8=window.pako||p;pako$8.inflate||(pako$8=pako$8.default);const decompressColor$8=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function extract$8(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11]}}function inflate$8(e){return{positions:new Uint16Array(pako$8.inflate(e.positions).buffer),normals:new Int8Array(pako$8.inflate(e.normals).buffer),indices:new Uint32Array(pako$8.inflate(e.indices).buffer),edgeIndices:new Uint32Array(pako$8.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(pako$8.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(pako$8.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(pako$8.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(pako$8.inflate(e.meshColors).buffer),entityIDs:pako$8.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(pako$8.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(pako$8.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(pako$8.inflate(e.positionsDecodeMatrix).buffer)}}function load$8(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";const r=i.positions,o=i.normals,a=i.indices,n=i.edgeIndices,h=i.meshPositions,l=i.meshIndices,c=i.meshEdgesIndices,u=i.meshColors,p=JSON.parse(i.entityIDs),d=i.entityMeshes,m=i.entityIsObjects,f=h.length,g=d.length;for(let _=0;_<g;_++){const y=p[_],T=t.globalizeObjectIds?math.globalizeObjectId(s.id,y):y,v=e.metaScene.metaObjects[T],I={},E={};if(v){if(t.excludeTypesMap&&v.type&&t.excludeTypesMap[v.type])continue;if(t.includeTypesMap&&v.type&&!t.includeTypesMap[v.type])continue;const e=t.objectDefaults?t.objectDefaults[v.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(I.visible=!1),!1===e.pickable&&(I.pickable=!1),e.colorize&&(E.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(E.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const P=_===g-1,b=[];for(let e=d[_],t=P?d.length:d[_+1];e<t;e++){const t=e===f-1,p=T+".mesh."+e,d=decompressColor$8(u.subarray(4*e,4*e+3)),m=u[4*e+3]/255;s.createMesh(utils.apply(E,{id:p,primitive:"triangles",positionsCompressed:r.subarray(h[e],t?r.length:h[e+1]),normalsCompressed:o.subarray(h[e],t?r.length:h[e+1]),indices:a.subarray(l[e],t?a.length:l[e+1]),edgeIndices:n.subarray(c[e],t?n.length:c[e+1]),positionsDecodeMatrix:i.positionsDecodeMatrix,color:d,opacity:m})),b.push(p)}s.createEntity(utils.apply(I,{id:T,isObject:1===m[_],meshIds:b}))}}const ParserV1={version:1,parse:function(e,t,i,s){load$8(e,t,inflate$8(extract$8(i)),s)}};let pako$7=window.pako||p;function extract$7(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11],entityMeshIds:e[12],entityMatrices:e[13],entityUsesInstancing:e[14]}}function inflate$7(e){return{positions:new Uint16Array(pako$7.inflate(e.positions).buffer),normals:new Int8Array(pako$7.inflate(e.normals).buffer),indices:new Uint32Array(pako$7.inflate(e.indices).buffer),edgeIndices:new Uint32Array(pako$7.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(pako$7.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(pako$7.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(pako$7.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(pako$7.inflate(e.meshColors).buffer),entityIDs:pako$7.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(pako$7.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(pako$7.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(pako$7.inflate(e.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(pako$7.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(pako$7.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(pako$7.inflate(e.entityUsesInstancing).buffer)}}pako$7.inflate||(pako$7=pako$7.default);const decompressColor$7=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function load$7(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";const r=i.positions,o=i.normals,a=i.indices,n=i.edgeIndices,h=i.meshPositions,l=i.meshIndices,c=i.meshEdgesIndices,u=i.meshColors,p=JSON.parse(i.entityIDs),d=i.entityMeshes,m=i.entityIsObjects,f=i.entityMeshIds,g=i.entityMatrices,_=i.entityUsesInstancing,y=h.length,T=d.length,v={};for(let I=0;I<T;I++){const E=p[I],P=t.globalizeObjectIds?math.globalizeObjectId(s.id,E):E,b=e.metaScene.metaObjects[P],D={},w={},C=g.subarray(16*I,16*I+16);if(b){if(t.excludeTypesMap&&b.type&&t.excludeTypesMap[b.type])continue;if(t.includeTypesMap&&b.type&&!t.includeTypesMap[b.type])continue;const e=t.objectDefaults?t.objectDefaults[b.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(D.visible=!1),!1===e.pickable&&(D.pickable=!1),e.colorize&&(w.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(w.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const R=I===T-1,F=[];for(let e=d[I],t=R?f.length:d[I+1];e<t;e++){const t=f[e],p=t===y-1,d=P+".mesh."+t,m=decompressColor$7(u.subarray(4*t,4*t+3)),g=u[4*t+3]/255,T=r.subarray(h[t],p?r.length:h[t+1]),E=o.subarray(h[t],p?r.length:h[t+1]),b=a.subarray(l[t],p?a.length:l[t+1]),D=n.subarray(c[t],p?n.length:c[t+1]);if(1===_[I]){const e="geometry."+t;e in v||(s.createGeometry({id:e,positionsCompressed:T,normalsCompressed:E,indices:b,edgeIndices:D,primitive:"triangles",positionsDecodeMatrix:i.positionsDecodeMatrix}),v[e]=!0),s.createMesh(utils.apply(w,{id:d,color:m,opacity:g,matrix:C,geometryId:e})),F.push(d)}else s.createMesh(utils.apply(w,{id:d,primitive:"triangles",positionsCompressed:T,normalsCompressed:E,indices:b,edgeIndices:D,positionsDecodeMatrix:i.positionsDecodeMatrix,color:m,opacity:g})),F.push(d)}F.length&&s.createEntity(utils.apply(D,{id:P,isObject:1===m[I],meshIds:F}))}}const ParserV2={version:2,parse:function(e,t,i,s){load$7(e,t,inflate$7(extract$7(i)),s)}};let pako$6=window.pako||p;function extract$6(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],instancedPositionsDecodeMatrix:e[11],batchedPositionsDecodeMatrix:e[12],entityMeshIds:e[13],entityMatrices:e[14],entityUsesInstancing:e[15]}}function inflate$6(e){return{positions:new Uint16Array(pako$6.inflate(e.positions).buffer),normals:new Int8Array(pako$6.inflate(e.normals).buffer),indices:new Uint32Array(pako$6.inflate(e.indices).buffer),edgeIndices:new Uint32Array(pako$6.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(pako$6.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(pako$6.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(pako$6.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(pako$6.inflate(e.meshColors).buffer),entityIDs:pako$6.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(pako$6.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(pako$6.inflate(e.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(pako$6.inflate(e.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(pako$6.inflate(e.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(pako$6.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(pako$6.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(pako$6.inflate(e.entityUsesInstancing).buffer)}}pako$6.inflate||(pako$6=pako$6.default);const decompressColor$6=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function load$6(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";const r=i.positions,o=i.normals,a=i.indices,n=i.edgeIndices,h=i.meshPositions,l=i.meshIndices,c=i.meshEdgesIndices,u=i.meshColors,p=JSON.parse(i.entityIDs),d=i.entityMeshes,m=i.entityIsObjects,f=i.entityMeshIds,g=i.entityMatrices,_=i.entityUsesInstancing,y=h.length,T=d.length,v={};for(let C=0;C<T;C++){const R=p[C],F=t.globalizeObjectIds?math.globalizeObjectId(s.id,R):R,S=e.metaScene.metaObjects[F],x={},M={},A=g.subarray(16*C,16*C+16);if(S){if(t.excludeTypesMap&&S.type&&t.excludeTypesMap[S.type])continue;if(t.includeTypesMap&&S.type&&!t.includeTypesMap[S.type])continue;const e=t.objectDefaults?t.objectDefaults[S.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(x.visible=!1),!1===e.pickable&&(x.pickable=!1),e.colorize&&(M.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(M.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const L=C===T-1,O=[];for(let e=d[C],t=L?f.length:d[C+1];e<t;e++){var I=f[e];const t=I===y-1,p=F+".mesh."+I,d=decompressColor$6(u.subarray(4*I,4*I+3)),m=u[4*I+3]/255;var E=r.subarray(h[I],t?r.length:h[I+1]),P=o.subarray(h[I],t?r.length:h[I+1]),b=a.subarray(l[I],t?a.length:l[I+1]),D=n.subarray(c[I],t?n.length:c[I+1]);if(1===_[C]){var w="geometry."+I;w in v||(s.createGeometry({id:w,positionsCompressed:E,normalsCompressed:P,indices:b,edgeIndices:D,primitive:"triangles",positionsDecodeMatrix:i.instancedPositionsDecodeMatrix}),v[w]=!0),s.createMesh(utils.apply(M,{id:p,color:d,opacity:m,matrix:A,geometryId:w})),O.push(p)}else s.createMesh(utils.apply(M,{id:p,primitive:"triangles",positionsCompressed:E,normalsCompressed:P,indices:b,edgeIndices:D,positionsDecodeMatrix:i.batchedPositionsDecodeMatrix,color:d,opacity:m})),O.push(p)}O.length&&s.createEntity(utils.apply(x,{id:F,isObject:1===m[C],meshIds:O}))}}const ParserV3={version:3,parse:function(e,t,i,s){load$6(e,t,inflate$6(extract$6(i)),s)}};let pako$5=window.pako||p;function extract$5(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],decodeMatrices:e[4],matrices:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveDecodeMatricesPortion:e[9],eachPrimitiveColor:e[10],primitiveInstances:e[11],eachEntityId:e[12],eachEntityPrimitiveInstancesPortion:e[13],eachEntityMatricesPortion:e[14],eachEntityMatrix:e[15]}}function inflate$5(e){return{positions:new Uint16Array(pako$5.inflate(e.positions).buffer),normals:new Int8Array(pako$5.inflate(e.normals).buffer),indices:new Uint32Array(pako$5.inflate(e.indices).buffer),edgeIndices:new Uint32Array(pako$5.inflate(e.edgeIndices).buffer),decodeMatrices:new Float32Array(pako$5.inflate(e.decodeMatrices).buffer),matrices:new Float32Array(pako$5.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(pako$5.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(pako$5.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(pako$5.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(pako$5.inflate(e.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(pako$5.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(pako$5.inflate(e.primitiveInstances).buffer),eachEntityId:pako$5.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(pako$5.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(pako$5.inflate(e.eachEntityMatricesPortion).buffer)}}pako$5.inflate||(pako$5=pako$5.default);const decompressColor$5=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function load$5(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";const r=i.positions,o=i.normals,a=i.indices,n=i.edgeIndices,h=i.decodeMatrices,l=i.matrices,c=i.eachPrimitivePositionsAndNormalsPortion,u=i.eachPrimitiveIndicesPortion,p=i.eachPrimitiveEdgeIndicesPortion,d=i.eachPrimitiveDecodeMatricesPortion,m=i.eachPrimitiveColor,f=i.primitiveInstances,g=JSON.parse(i.eachEntityId),_=i.eachEntityPrimitiveInstancesPortion,y=i.eachEntityMatricesPortion,T=c.length,v=f.length,I=new Uint8Array(T),E=new Uint32Array(T),P=g.length;for(let e=0;e<T;e++)E[e]=e;E.sort(((e,t)=>d[e]<d[t]?-1:d[e]>d[t]?1:0));for(let e=0;e<v;e++){I[f[e]]++}const b={};for(let e=0;e<P;e++){const t=P-1,i=e===t,s=_[e],r=i?_[t]:_[e+1];for(let t=s;t<r;t++){const i=f[t];I[i]>1||(b[i]=e)}}for(let e=0;e<T;e++){const t=E[e],i=t===T-1,l=I[t]>1,f=decompressColor$5(m.subarray(4*t,4*t+3)),_=m[4*t+3]/255,y=r.subarray(c[t],i?r.length:c[t+1]),v=o.subarray(c[t],i?o.length:c[t+1]),P=a.subarray(u[t],i?a.length:u[t+1]),w=n.subarray(p[t],i?n.length:p[t+1]),C=h.subarray(d[t],d[t]+16);if(l){var D="geometry"+t;s.createGeometry({id:D,primitive:"triangles",positionsCompressed:y,normalsCompressed:v,indices:P,edgeIndices:w,positionsDecodeMatrix:C})}else{const e=t;g[b[t]];const i={};s.createMesh(utils.apply(i,{id:e,primitive:"triangles",positionsCompressed:y,normalsCompressed:v,indices:P,edgeIndices:w,positionsDecodeMatrix:C,color:f,opacity:_}))}}let w=0;for(let e=0;e<P;e++){const t=P-1,i=e===t,r=g[e],o=_[e],a=i?_[t]:_[e+1],n=[];for(let t=o;t<a;t++){const i=f[t];if(I[i]>1){const t={},r="instance."+w++,o="geometry"+i,a=16*y[e],h=l.subarray(a,a+16);s.createMesh(utils.apply(t,{id:r,geometryId:o,matrix:h})),n.push(r)}else n.push(i)}if(n.length>0){const e={};s.createEntity(utils.apply(e,{id:r,isObject:!0,meshIds:n}))}}}const ParserV4={version:4,parse:function(e,t,i,s){load$5(e,t,inflate$5(extract$5(i)),s)}};let pako$4=window.pako||p;function extract$4(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],eachPrimitivePositionsAndNormalsPortion:e[5],eachPrimitiveIndicesPortion:e[6],eachPrimitiveEdgeIndicesPortion:e[7],eachPrimitiveColor:e[8],primitiveInstances:e[9],eachEntityId:e[10],eachEntityPrimitiveInstancesPortion:e[11],eachEntityMatricesPortion:e[12]}}function inflate$4(e){return{positions:new Float32Array(pako$4.inflate(e.positions).buffer),normals:new Int8Array(pako$4.inflate(e.normals).buffer),indices:new Uint32Array(pako$4.inflate(e.indices).buffer),edgeIndices:new Uint32Array(pako$4.inflate(e.edgeIndices).buffer),matrices:new Float32Array(pako$4.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(pako$4.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(pako$4.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(pako$4.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(pako$4.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(pako$4.inflate(e.primitiveInstances).buffer),eachEntityId:pako$4.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(pako$4.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(pako$4.inflate(e.eachEntityMatricesPortion).buffer)}}pako$4.inflate||(pako$4=pako$4.default);const decompressColor$4=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function load$4(e,t,i,s){s.positionsCompression="disabled",s.normalsCompression="precompressed";const r=i.positions,o=i.normals,a=i.indices,n=i.edgeIndices,h=i.matrices,l=i.eachPrimitivePositionsAndNormalsPortion,c=i.eachPrimitiveIndicesPortion,u=i.eachPrimitiveEdgeIndicesPortion,p=i.eachPrimitiveColor,d=i.primitiveInstances,m=JSON.parse(i.eachEntityId),f=i.eachEntityPrimitiveInstancesPortion,g=i.eachEntityMatricesPortion,_=l.length,y=d.length,T=new Uint8Array(_),v=m.length;for(let e=0;e<y;e++){T[d[e]]++}const I={};for(let e=0;e<v;e++){const t=v-1,i=e===t,s=f[e],r=i?f[t]:f[e+1];for(let t=s;t<r;t++){const i=d[t];T[i]>1||(I[i]=e)}}for(let e=0;e<_;e++){const t=e===_-1,i=T[e]>1,h=decompressColor$4(p.subarray(4*e,4*e+3)),d=p[4*e+3]/255,f=r.subarray(l[e],t?r.length:l[e+1]),g=o.subarray(l[e],t?o.length:l[e+1]),y=a.subarray(c[e],t?a.length:c[e+1]),v=n.subarray(u[e],t?n.length:u[e+1]);if(i){var E="geometry"+e;s.createGeometry({id:E,primitive:"triangles",positionsCompressed:f,normalsCompressed:g,indices:y,edgeIndices:v})}else{const t=e;m[I[e]];const i={};s.createMesh(utils.apply(i,{id:t,primitive:"triangles",positionsCompressed:f,normalsCompressed:g,indices:y,edgeIndices:v,color:h,opacity:d}))}}let P=0;for(let e=0;e<v;e++){const t=v-1,i=e===t,r=m[e],o=f[e],a=i?f[t]:f[e+1],n=[];for(let t=o;t<a;t++){const i=d[t];if(T[i]>1){const t={},r="instance."+P++,o="geometry"+i,a=16*g[e],l=h.subarray(a,a+16);s.createMesh(utils.apply(t,{id:r,geometryId:o,matrix:l})),n.push(r)}else n.push(i)}if(n.length>0){const e={};s.createEntity(utils.apply(e,{id:r,isObject:!0,meshIds:n}))}}}const ParserV5={version:5,parse:function(e,t,i,s){load$4(e,t,inflate$4(extract$4(i)),s)}};let pako$3=window.pako||p;function extract$3(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],reusedPrimitivesDecodeMatrix:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveColorAndOpacity:e[9],primitiveInstances:e[10],eachEntityId:e[11],eachEntityPrimitiveInstancesPortion:e[12],eachEntityMatricesPortion:e[13],eachTileAABB:e[14],eachTileEntitiesPortion:e[15]}}function inflate$3(e){function t(e,t){return 0===e.length?[]:pako$3.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(t(e.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(t(e.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(t(e.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(t(e.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(t(e.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(t(e.primitiveInstances)),eachEntityId:pako$3.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(t(e.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(t(e.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}pako$3.inflate||(pako$3=pako$3.default);const decompressColor$3=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function load$3(e,t,i,s){const r=i.positions,o=i.normals,a=i.indices,n=i.edgeIndices,h=i.matrices,l=i.reusedPrimitivesDecodeMatrix,c=i.eachPrimitivePositionsAndNormalsPortion,u=i.eachPrimitiveIndicesPortion,p=i.eachPrimitiveEdgeIndicesPortion,d=i.eachPrimitiveColorAndOpacity,m=i.primitiveInstances,f=JSON.parse(i.eachEntityId),g=i.eachEntityPrimitiveInstancesPortion,_=i.eachEntityMatricesPortion,y=i.eachTileAABB,T=i.eachTileEntitiesPortion,v=c.length,I=m.length,E=f.length,P=T.length;let b=0;const D=new Uint32Array(v);for(let e=0;e<I;e++){const t=m[e];void 0!==D[t]?D[t]++:D[t]=1}const w=math.vec3(),C=math.AABB3();for(let i=0;i<P;i++){const I=i===P-1,R=T[i],F=I?E:T[i+1],S=6*i,x=y.subarray(S,S+6);math.getAABB3Center(x,w),C[0]=x[0]-w[0],C[1]=x[1]-w[1],C[2]=x[2]-w[2],C[3]=x[3]-w[0],C[4]=x[4]-w[1],C[5]=x[5]-w[2];const M=geometryCompressionUtils.createPositionsDecodeMatrix(C),A={};for(let y=R;y<F;y++){const T=f[y],I=t.globalizeObjectIds?math.globalizeObjectId(s.id,T):T,P=_[y],C=h.slice(P,P+16),R=y===E-1,F=g[y],S=R?m.length:g[y+1],x=[],L=e.metaScene.metaObjects[I],O={},N={};if(L){if(t.excludeTypesMap&&L.type&&t.excludeTypesMap[L.type])continue;if(t.includeTypesMap&&L.type&&!t.includeTypesMap[L.type])continue;const e=t.objectDefaults?t.objectDefaults[L.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(O.visible=!1),!1===e.pickable&&(O.pickable=!1),e.colorize&&(N.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(N.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(let e=F;e<S;e++){const t=m[e],h=D[t]>1,f=t===v-1,g=r.subarray(c[t],f?r.length:c[t+1]),_=o.subarray(c[t],f?o.length:c[t+1]),y=a.subarray(u[t],f?a.length:u[t+1]),T=n.subarray(p[t],f?n.length:p[t+1]),I=decompressColor$3(d.subarray(4*t,4*t+3)),E=d[4*t+3]/255,P=b++;if(h){const e="geometry."+i+"."+t;A[e]||(s.createGeometry({id:e,origin:w,primitive:"triangles",positionsCompressed:g,normalsCompressed:_,indices:y,edgeIndices:T,positionsDecodeMatrix:l}),A[e]=!0),s.createMesh(utils.apply(N,{id:P,geometryId:e,matrix:C,color:I,opacity:E})),x.push(P)}else s.createMesh(utils.apply(N,{id:P,origin:w,primitive:"triangles",positionsCompressed:g,normalsCompressed:_,indices:y,edgeIndices:T,positionsDecodeMatrix:M,color:I,opacity:E})),x.push(P)}x.length>0&&s.createEntity(utils.apply(O,{id:I,isObject:!0,meshIds:x}))}}}const ParserV6={version:6,parse:function(e,t,i,s){load$3(e,t,inflate$3(extract$3(i)),s)}};let pako$2=window.pako||p;function extract$2(e){return{positions:e[0],normals:e[1],colors:e[2],indices:e[3],edgeIndices:e[4],matrices:e[5],reusedGeometriesDecodeMatrix:e[6],eachGeometryPrimitiveType:e[7],eachGeometryPositionsPortion:e[8],eachGeometryNormalsPortion:e[9],eachGeometryColorsPortion:e[10],eachGeometryIndicesPortion:e[11],eachGeometryEdgeIndicesPortion:e[12],eachMeshGeometriesPortion:e[13],eachMeshMatricesPortion:e[14],eachMeshMaterial:e[15],eachEntityId:e[16],eachEntityMeshesPortion:e[17],eachTileAABB:e[18],eachTileEntitiesPortion:e[19]}}function inflate$2(e){function t(e,t){return 0===e.length?[]:pako$2.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:pako$2.inflate(e.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}pako$2.inflate||(pako$2=pako$2.default);const decompressColor$2=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function convertColorsRGBToRGBA$1(e){const t=[];for(let i=0,s=e.length;i<s;i+=3)t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(1);return t}function load$2(e,t,i,s){const r=i.positions,o=i.normals,a=i.colors,n=i.indices,h=i.edgeIndices,l=i.matrices,c=i.reusedGeometriesDecodeMatrix,u=i.eachGeometryPrimitiveType,p=i.eachGeometryPositionsPortion,d=i.eachGeometryNormalsPortion,m=i.eachGeometryColorsPortion,f=i.eachGeometryIndicesPortion,g=i.eachGeometryEdgeIndicesPortion,_=i.eachMeshGeometriesPortion,y=i.eachMeshMatricesPortion,T=i.eachMeshMaterial,v=JSON.parse(i.eachEntityId),I=i.eachEntityMeshesPortion,E=i.eachTileAABB,P=i.eachTileEntitiesPortion,b=p.length,D=_.length,w=v.length,C=P.length;let R=0;const F=new Uint32Array(b);for(let e=0;e<D;e++){const t=_[e];void 0!==F[t]?F[t]++:F[t]=1}const S=math.vec3(),x=math.AABB3();for(let i=0;i<C;i++){const D=i===C-1,M=P[i],A=D?w:P[i+1],L=6*i,O=E.subarray(L,L+6);math.getAABB3Center(O,S),x[0]=O[0]-S[0],x[1]=O[1]-S[1],x[2]=O[2]-S[2],x[3]=O[3]-S[0],x[4]=O[4]-S[1],x[5]=O[5]-S[2];const N=geometryCompressionUtils.createPositionsDecodeMatrix(x),B={};for(let E=M;E<A;E++){const P=v[E],D=t.globalizeObjectIds?math.globalizeObjectId(s.id,P):P,C=E===w-1,x=I[E],M=C?_.length:I[E+1],A=[],L=e.metaScene.metaObjects[D],O={},k={};if(L){if(t.excludeTypesMap&&L.type&&t.excludeTypesMap[L.type])continue;if(t.includeTypesMap&&L.type&&!t.includeTypesMap[L.type])continue;const e=t.objectDefaults?t.objectDefaults[L.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(O.visible=!1),!1===e.pickable&&(O.pickable=!1),e.colorize&&(k.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(k.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(k.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(k.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=x;e<M;e++){const t=_[e],v=F[t]>1,I=t===b-1,E=decompressColor$2(T.subarray(6*e,6*e+3)),P=T[6*e+3]/255,D=T[6*e+4]/255,w=T[6*e+5]/255,C=R++;if(v){const _=y[e],T=l.slice(_,_+16),v="geometry."+i+"."+t;if(!B[v]){let e,i,l,_,y,T;switch(u[t]){case 0:e="solid",i=r.subarray(p[t],I?r.length:p[t+1]),l=o.subarray(d[t],I?o.length:d[t+1]),y=n.subarray(f[t],I?n.length:f[t+1]),T=h.subarray(g[t],I?h.length:g[t+1]);break;case 1:e="surface",i=r.subarray(p[t],I?r.length:p[t+1]),l=o.subarray(d[t],I?o.length:d[t+1]),y=n.subarray(f[t],I?n.length:f[t+1]),T=h.subarray(g[t],I?h.length:g[t+1]);break;case 2:e="points",i=r.subarray(p[t],I?r.length:p[t+1]),_=convertColorsRGBToRGBA$1(a.subarray(m[t],I?a.length:m[t+1]));break;case 3:e="lines",i=r.subarray(p[t],I?r.length:p[t+1]),y=n.subarray(f[t],I?n.length:f[t+1]);break;default:continue}s.createGeometry({id:v,origin:S,primitive:e,positionsCompressed:i,normalsCompressed:l,colors:_,indices:y,edgeIndices:T,positionsDecodeMatrix:c}),B[v]=!0}s.createMesh(utils.apply(k,{id:C,geometryId:v,matrix:T,color:E,metallic:D,roughness:w,opacity:P})),A.push(C)}else{let e,i,l,c,_,y;switch(u[t]){case 0:e="solid",i=r.subarray(p[t],I?r.length:p[t+1]),l=o.subarray(d[t],I?o.length:d[t+1]),_=n.subarray(f[t],I?n.length:f[t+1]),y=h.subarray(g[t],I?h.length:g[t+1]);break;case 1:e="surface",i=r.subarray(p[t],I?r.length:p[t+1]),l=o.subarray(d[t],I?o.length:d[t+1]),_=n.subarray(f[t],I?n.length:f[t+1]),y=h.subarray(g[t],I?h.length:g[t+1]);break;case 2:e="points",i=r.subarray(p[t],I?r.length:p[t+1]),c=convertColorsRGBToRGBA$1(a.subarray(m[t],I?a.length:m[t+1]));break;case 3:e="lines",i=r.subarray(p[t],I?r.length:p[t+1]),_=n.subarray(f[t],I?n.length:f[t+1]);break;default:continue}s.createMesh(utils.apply(k,{id:C,origin:S,primitive:e,positionsCompressed:i,normalsCompressed:l,colors:c,indices:_,edgeIndices:y,positionsDecodeMatrix:N,color:E,metallic:D,roughness:w,opacity:P})),A.push(C)}}A.length>0&&s.createEntity(utils.apply(O,{id:D,isObject:!0,meshIds:A}))}}}const ParserV7={version:7,parse:function(e,t,i,s){load$2(e,t,inflate$2(extract$2(i)),s)}};let pako$1=window.pako||p;pako$1.inflate||(pako$1=pako$1.default);const tempVec4a$3=math.vec4(),tempVec4b$3=math.vec4();function extract$1(e){return{types:e[0],eachMetaObjectId:e[1],eachMetaObjectType:e[2],eachMetaObjectName:e[3],eachMetaObjectParent:e[4],positions:e[5],normals:e[6],colors:e[7],indices:e[8],edgeIndices:e[9],matrices:e[10],reusedGeometriesDecodeMatrix:e[11],eachGeometryPrimitiveType:e[12],eachGeometryPositionsPortion:e[13],eachGeometryNormalsPortion:e[14],eachGeometryColorsPortion:e[15],eachGeometryIndicesPortion:e[16],eachGeometryEdgeIndicesPortion:e[17],eachMeshGeometriesPortion:e[18],eachMeshMatricesPortion:e[19],eachMeshMaterial:e[20],eachEntityMetaObject:e[21],eachEntityMeshesPortion:e[22],eachTileAABB:e[23],eachTileEntitiesPortion:e[24]}}function inflate$1(e){function t(e,t){return 0===e.length?[]:pako$1.inflate(e,t).buffer}return{types:pako$1.inflate(e.types,{to:"string"}),eachMetaObjectId:pako$1.inflate(e.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(t(e.eachMetaObjectType)),eachMetaObjectName:pako$1.inflate(e.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(t(e.eachMetaObjectParent)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(t(e.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}const decompressColor$1=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function convertColorsRGBToRGBA(e){const t=[];for(let i=0,s=e.length;i<s;i+=3)t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(1);return t}function load$1(e,t,i,s){const r=JSON.parse(i.types),o=JSON.parse(i.eachMetaObjectId),a=i.eachMetaObjectType,n=JSON.parse(i.eachMetaObjectName),h=i.eachMetaObjectParent,l=i.positions,c=i.normals,u=i.colors,p=i.indices,d=i.edgeIndices,m=i.matrices,f=i.reusedGeometriesDecodeMatrix,g=i.eachGeometryPrimitiveType,_=i.eachGeometryPositionsPortion,y=i.eachGeometryNormalsPortion,T=i.eachGeometryColorsPortion,v=i.eachGeometryIndicesPortion,I=i.eachGeometryEdgeIndicesPortion,E=i.eachMeshGeometriesPortion,P=i.eachMeshMatricesPortion,b=i.eachMeshMaterial,D=i.eachEntityMetaObject,w=i.eachEntityMeshesPortion,C=i.eachTileAABB,R=i.eachTileEntitiesPortion,F=o.length,S=_.length,x=E.length,M=D.length,A=R.length;let L=0;const O=s.id;if(!e.metaScene.metaModels[O]){const i={metaObjects:[]};for(let e=0;e<F;e++){const t=o[e],s=r[a[e]]||"default",l=n[e],c=h[e],u=c!==e?o[c]:null;i.metaObjects.push({id:t,type:s,name:l,parent:u})}e.metaScene.createMetaModel(O,i,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),s.once("destroyed",(()=>{e.metaScene.destroyMetaModel(O)}))}const N=new Uint32Array(S);for(let e=0;e<x;e++){const t=E[e];void 0!==N[t]?N[t]++:N[t]=1}const B=math.vec3(),k=math.AABB3(),G={};for(let i=0;i<A;i++){const r=i===A-1,a=R[i],n=r?M:R[i+1],h=6*i,F=C.subarray(h,h+6);math.getAABB3Center(F,B),k[0]=F[0]-B[0],k[1]=F[1]-B[1],k[2]=F[2]-B[2],k[3]=F[3]-B[0],k[4]=F[4]-B[1],k[5]=F[5]-B[2];const x=geometryCompressionUtils.createPositionsDecodeMatrix(k),O={};for(let r=a;r<n;r++){const a=o[D[r]],n=t.globalizeObjectIds?math.globalizeObjectId(s.id,a):a,h=r===M-1,C=w[r],R=h?E.length:w[r+1],F=[],A=e.metaScene.metaObjects[n],U={},V={};if(A){if(t.excludeTypesMap&&A.type&&t.excludeTypesMap[A.type])continue;if(t.includeTypesMap&&A.type&&!t.includeTypesMap[A.type])continue;const e=t.objectDefaults?t.objectDefaults[A.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(U.visible=!1),!1===e.pickable&&(U.pickable=!1),e.colorize&&(V.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(V.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(V.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(V.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=C;e<R;e++){const r=E[e],o=N[r]>1,a=r===S-1,n=decompressColor$1(b.subarray(6*e,6*e+3)),h=b[6*e+3]/255,D=b[6*e+4]/255,w=b[6*e+5]/255,C=L++;if(o){const o=P[e],E=m.slice(o,o+16),b="geometry."+i+"."+r;let R=G[b];if(!R){R={batchThisMesh:!t.reuseGeometries};let e=!1;switch(g[r]){case 0:R.primitiveName="solid",R.geometryPositions=l.subarray(_[r],a?l.length:_[r+1]),R.geometryNormals=c.subarray(y[r],a?c.length:y[r+1]),R.geometryIndices=p.subarray(v[r],a?p.length:v[r+1]),R.geometryEdgeIndices=d.subarray(I[r],a?d.length:I[r+1]),e=R.geometryPositions.length>0&&R.geometryIndices.length>0;break;case 1:R.primitiveName="surface",R.geometryPositions=l.subarray(_[r],a?l.length:_[r+1]),R.geometryNormals=c.subarray(y[r],a?c.length:y[r+1]),R.geometryIndices=p.subarray(v[r],a?p.length:v[r+1]),R.geometryEdgeIndices=d.subarray(I[r],a?d.length:I[r+1]),e=R.geometryPositions.length>0&&R.geometryIndices.length>0;break;case 2:R.primitiveName="points",R.geometryPositions=l.subarray(_[r],a?l.length:_[r+1]),R.geometryColors=convertColorsRGBToRGBA(u.subarray(T[r],a?u.length:T[r+1])),e=R.geometryPositions.length>0;break;case 3:R.primitiveName="lines",R.geometryPositions=l.subarray(_[r],a?l.length:_[r+1]),R.geometryIndices=p.subarray(v[r],a?p.length:v[r+1]),e=R.geometryPositions.length>0&&R.geometryIndices.length>0;break;default:continue}if(e||(R=null),R&&(R.geometryPositions.length,R.batchThisMesh)){R.decompressedPositions=new Float32Array(R.geometryPositions.length);const e=R.geometryPositions,t=R.decompressedPositions;for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]*f[0]+f[12],t[i+1]=e[i+1]*f[5]+f[13],t[i+2]=e[i+2]*f[10]+f[14];R.geometryPositions=null,G[b]=R}}if(R)if(R.batchThisMesh){const e=R.decompressedPositions,t=new Uint16Array(e.length);for(let i=0,s=e.length;i<s;i+=3)tempVec4a$3[0]=e[i+0],tempVec4a$3[1]=e[i+1],tempVec4a$3[2]=e[i+2],tempVec4a$3[3]=1,math.transformVec4(E,tempVec4a$3,tempVec4b$3),geometryCompressionUtils.compressPosition(tempVec4b$3,k,tempVec4a$3),t[i+0]=tempVec4a$3[0],t[i+1]=tempVec4a$3[1],t[i+2]=tempVec4a$3[2];s.createMesh(utils.apply(V,{id:C,origin:B,primitive:R.primitiveName,positionsCompressed:t,normalsCompressed:R.geometryNormals,colorsCompressed:R.geometryColors,indices:R.geometryIndices,edgeIndices:R.geometryEdgeIndices,positionsDecodeMatrix:x,color:n,metallic:D,roughness:w,opacity:h})),F.push(C)}else O[b]||(s.createGeometry({id:b,origin:B,primitive:R.primitiveName,positionsCompressed:R.geometryPositions,normalsCompressed:R.geometryNormals,colorsCompressed:R.geometryColors,indices:R.geometryIndices,edgeIndices:R.geometryEdgeIndices,positionsDecodeMatrix:f}),O[b]=!0),s.createMesh(utils.apply(V,{id:C,geometryId:b,matrix:E,color:n,metallic:D,roughness:w,opacity:h})),F.push(C)}else{let e,t,i,o,m,f,E=!1;switch(g[r]){case 0:e="solid",t=l.subarray(_[r],a?l.length:_[r+1]),i=c.subarray(y[r],a?c.length:y[r+1]),m=p.subarray(v[r],a?p.length:v[r+1]),f=d.subarray(I[r],a?d.length:I[r+1]),E=t.length>0&&m.length>0;break;case 1:e="surface",t=l.subarray(_[r],a?l.length:_[r+1]),i=c.subarray(y[r],a?c.length:y[r+1]),m=p.subarray(v[r],a?p.length:v[r+1]),f=d.subarray(I[r],a?d.length:I[r+1]),E=t.length>0&&m.length>0;break;case 2:e="points",t=l.subarray(_[r],a?l.length:_[r+1]),o=convertColorsRGBToRGBA(u.subarray(T[r],a?u.length:T[r+1])),E=t.length>0;break;case 3:e="lines",t=l.subarray(_[r],a?l.length:_[r+1]),m=p.subarray(v[r],a?p.length:v[r+1]),E=t.length>0&&m.length>0;break;default:continue}E&&(s.createMesh(utils.apply(V,{id:C,origin:B,primitive:e,positionsCompressed:t,normalsCompressed:i,colorsCompressed:o,indices:m,edgeIndices:f,positionsDecodeMatrix:x,color:n,metallic:D,roughness:w,opacity:h})),F.push(C))}}F.length>0&&s.createEntity(utils.apply(U,{id:n,isObject:!0,meshIds:F}))}}}const ParserV8={version:8,parse:function(e,t,i,s){load$1(e,t,inflate$1(extract$1(i)),s)}};let pako=window.pako||p;pako.inflate||(pako=pako.default);const tempVec4a$2=math.vec4(),tempVec4b$2=math.vec4();function extract(e){return{metadata:e[0],positions:e[1],normals:e[2],colors:e[3],indices:e[4],edgeIndices:e[5],matrices:e[6],reusedGeometriesDecodeMatrix:e[7],eachGeometryPrimitiveType:e[8],eachGeometryPositionsPortion:e[9],eachGeometryNormalsPortion:e[10],eachGeometryColorsPortion:e[11],eachGeometryIndicesPortion:e[12],eachGeometryEdgeIndicesPortion:e[13],eachMeshGeometriesPortion:e[14],eachMeshMatricesPortion:e[15],eachMeshMaterial:e[16],eachEntityId:e[17],eachEntityMeshesPortion:e[18],eachTileAABB:e[19],eachTileEntitiesPortion:e[20]}}function inflate(e){function t(e,t){return 0===e.length?[]:pako.inflate(e,t).buffer}return{metadata:JSON.parse(pako.inflate(e.metadata,{to:"string"})),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:JSON.parse(pako.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}const decompressColor=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function load(e,t,i,s){const r=i.metadata,o=i.positions,a=i.normals,n=i.colors,h=i.indices,l=i.edgeIndices,c=i.matrices,u=i.reusedGeometriesDecodeMatrix,p=i.eachGeometryPrimitiveType,d=i.eachGeometryPositionsPortion,m=i.eachGeometryNormalsPortion,f=i.eachGeometryColorsPortion,g=i.eachGeometryIndicesPortion,_=i.eachGeometryEdgeIndicesPortion,y=i.eachMeshGeometriesPortion,T=i.eachMeshMatricesPortion,v=i.eachMeshMaterial,I=i.eachEntityId,E=i.eachEntityMeshesPortion,P=i.eachTileAABB,b=i.eachTileEntitiesPortion,D=d.length,w=y.length,C=E.length,R=b.length;let F=0;const S=s.id;e.metaScene.metaModels[S]||(e.metaScene.createMetaModel(S,r,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),s.once("destroyed",(()=>{e.metaScene.destroyMetaModel(S)})));const x=new Uint32Array(D);for(let e=0;e<w;e++){const t=y[e];void 0!==x[t]?x[t]++:x[t]=1}const M=math.vec3(),A=math.AABB3(),L={};for(let i=0;i<R;i++){const r=i===R-1,w=b[i],S=r?C-1:b[i+1]-1,O=6*i,N=P.subarray(O,O+6);math.getAABB3Center(N,M),A[0]=N[0]-M[0],A[1]=N[1]-M[1],A[2]=N[2]-M[2],A[3]=N[3]-M[0],A[4]=N[4]-M[1],A[5]=N[5]-M[2];const B=geometryCompressionUtils.createPositionsDecodeMatrix(A),k={};for(let r=w;r<=S;r++){const P=I[r],b=t.globalizeObjectIds?math.globalizeObjectId(s.id,P):P,w=r===C-1,R=E[r],S=w?y.length-1:E[r+1]-1,O=[],N=e.metaScene.metaObjects[b],G={},U={};if(N){if(t.excludeTypesMap&&N.type&&t.excludeTypesMap[N.type])continue;if(t.includeTypesMap&&N.type&&!t.includeTypesMap[N.type])continue;const e=t.objectDefaults?t.objectDefaults[N.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(G.visible=!1),!1===e.pickable&&(G.pickable=!1),e.colorize&&(U.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(U.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(U.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(U.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=R;e<=S;e++){const r=y[e],I=x[r]>1,E=r===D-1,P=decompressColor(v.subarray(6*e,6*e+3)),b=v[6*e+3]/255,w=v[6*e+4]/255,C=v[6*e+5]/255,R=F++;if(I){const y=T[e],v=c.slice(y,y+16),I="geometry."+i+"."+r;let D=L[I];if(!D){D={batchThisMesh:!t.reuseGeometries};let e=!1;switch(p[r]){case 0:D.primitiveName="solid",D.geometryPositions=o.subarray(d[r],E?o.length:d[r+1]),D.geometryNormals=a.subarray(m[r],E?a.length:m[r+1]),D.geometryIndices=h.subarray(g[r],E?h.length:g[r+1]),D.geometryEdgeIndices=l.subarray(_[r],E?l.length:_[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 1:D.primitiveName="surface",D.geometryPositions=o.subarray(d[r],E?o.length:d[r+1]),D.geometryNormals=a.subarray(m[r],E?a.length:m[r+1]),D.geometryIndices=h.subarray(g[r],E?h.length:g[r+1]),D.geometryEdgeIndices=l.subarray(_[r],E?l.length:_[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 2:D.primitiveName="points",D.geometryPositions=o.subarray(d[r],E?o.length:d[r+1]),D.geometryColors=n.subarray(f[r],E?n.length:f[r+1]),e=D.geometryPositions.length>0;break;case 3:D.primitiveName="lines",D.geometryPositions=o.subarray(d[r],E?o.length:d[r+1]),D.geometryIndices=h.subarray(g[r],E?h.length:g[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;default:continue}if(e||(D=null),D&&(D.geometryPositions.length,D.batchThisMesh)){D.decompressedPositions=new Float32Array(D.geometryPositions.length),D.transformedAndRecompressedPositions=new Uint16Array(D.geometryPositions.length);const e=D.geometryPositions,t=D.decompressedPositions;for(let i=0,s=e.length;i<s;i+=3)t[i+0]=e[i+0]*u[0]+u[12],t[i+1]=e[i+1]*u[5]+u[13],t[i+2]=e[i+2]*u[10]+u[14];D.geometryPositions=null,L[I]=D}}if(D)if(D.batchThisMesh){const e=D.decompressedPositions,t=D.transformedAndRecompressedPositions;for(let i=0,s=e.length;i<s;i+=3)tempVec4a$2[0]=e[i+0],tempVec4a$2[1]=e[i+1],tempVec4a$2[2]=e[i+2],tempVec4a$2[3]=1,math.transformVec4(v,tempVec4a$2,tempVec4b$2),geometryCompressionUtils.compressPosition(tempVec4b$2,A,tempVec4a$2),t[i+0]=tempVec4a$2[0],t[i+1]=tempVec4a$2[1],t[i+2]=tempVec4a$2[2];s.createMesh(utils.apply(U,{id:R,origin:M,primitive:D.primitiveName,positionsCompressed:t,normalsCompressed:D.geometryNormals,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:B,color:P,metallic:w,roughness:C,opacity:b})),O.push(R)}else k[I]||(s.createGeometry({id:I,primitive:D.primitiveName,positionsCompressed:D.geometryPositions,normalsCompressed:D.geometryNormals,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:u}),k[I]=!0),s.createMesh(utils.apply(U,{id:R,geometryId:I,origin:M,matrix:v,color:P,metallic:w,roughness:C,opacity:b})),O.push(R)}else{let e,t,i,c,u,y,T=!1;switch(p[r]){case 0:e="solid",t=o.subarray(d[r],E?o.length:d[r+1]),i=a.subarray(m[r],E?a.length:m[r+1]),u=h.subarray(g[r],E?h.length:g[r+1]),y=l.subarray(_[r],E?l.length:_[r+1]),T=t.length>0&&u.length>0;break;case 1:e="surface",t=o.subarray(d[r],E?o.length:d[r+1]),i=a.subarray(m[r],E?a.length:m[r+1]),u=h.subarray(g[r],E?h.length:g[r+1]),y=l.subarray(_[r],E?l.length:_[r+1]),T=t.length>0&&u.length>0;break;case 2:e="points",t=o.subarray(d[r],E?o.length:d[r+1]),c=n.subarray(f[r],E?n.length:f[r+1]),T=t.length>0;break;case 3:e="lines",t=o.subarray(d[r],E?o.length:d[r+1]),u=h.subarray(g[r],E?h.length:g[r+1]),T=t.length>0&&u.length>0;break;default:continue}T&&(s.createMesh(utils.apply(U,{id:R,origin:M,primitive:e,positionsCompressed:t,normalsCompressed:i,colorsCompressed:c,indices:u,edgeIndices:y,positionsDecodeMatrix:B,color:P,metallic:w,roughness:C,opacity:b})),O.push(R))}}O.length>0&&s.createEntity(utils.apply(G,{id:b,isObject:!0,meshIds:O}))}}}const ParserV9={version:9,parse:function(e,t,i,s){load(e,t,inflate(extract(i)),s)}},parsers={};parsers[ParserV1.version]=ParserV1,parsers[ParserV2.version]=ParserV2,parsers[ParserV3.version]=ParserV3,parsers[ParserV4.version]=ParserV4,parsers[ParserV5.version]=ParserV5,parsers[ParserV6.version]=ParserV6,parsers[ParserV7.version]=ParserV7,parsers[ParserV8.version]=ParserV8,parsers[ParserV9.version]=ParserV9;class XKTLoaderPlugin extends Plugin{constructor(e,t={}){super("XKTLoader",e,t),this._maxGeometryBatchSize=t.maxGeometryBatchSize,this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults,this.includeTypes=t.includeTypes,this.excludeTypes=t.excludeTypes,this.excludeUnclassifiedObjects=t.excludeUnclassifiedObjects,this.reuseGeometries=t.reuseGeometries}get supportedVersions(){return Object.keys(parsers)}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new XKTDefaultDataSource}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||IFCObjectDefaults}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}get reuseGeometries(){return this._reuseGeometries}set reuseGeometries(e){this._reuseGeometries=!1!==e}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new PerformanceModel(this.viewer.scene,utils.apply(e,{isModel:!0,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:e.origin})),i=t.id;if(!e.src&&!e.xkt)return this.error("load() param expected: src or xkt"),t;const s={},r=e.includeTypes||this._includeTypes,o=e.excludeTypes||this._excludeTypes,a=e.objectDefaults||this._objectDefaults;if(s.reuseGeometries=null!==e.reuseGeometries&&void 0!==e.reuseGeometries?e.reuseGeometries:!1!==this._reuseGeometries,r){s.includeTypesMap={};for(let e=0,t=r.length;e<t;e++)s.includeTypesMap[r[e]]=!0}if(o){s.excludeTypesMap={};for(let e=0,t=o.length;e<t;e++)s.excludeTypesMap[o[e]]=!0}if(a&&(s.objectDefaults=a),s.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,s.globalizeObjectIds=void 0!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds,e.metaModelSrc||e.metaModelData){const a=a=>!!this.viewer.metaScene.createMetaModel(i,a,{includeTypes:r,excludeTypes:o,globalizeObjectIds:this.globalizeObjectIds})&&(e.src?this._loadModel(e.src,e,s,t):this._parseModel(e.xkt,e,s,t),t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(t.id)})),!0);if(e.metaModelSrc){const s=e.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(s,(e=>{t.destroyed||(a(e)||(this.error(`load(): Failed to load model metadata for model '${i} from '${s}' - metadata not valid`),t.fire("error","Metadata not valid")),this.viewer.scene.canvas.spinner.processes--)}),(e=>{this.error(`load(): Failed to load model metadata for model '${i} from  '${s}' - ${e}`),t.fire("error",`Failed to load model metadata from  '${s}' - ${e}`),this.viewer.scene.canvas.spinner.processes--}))}else e.metaModelData&&(a(e.metaModelData)||(this.error(`load(): Failed to load model metadata for model '${i} from '${e.metaModelSrc}' - metadata not valid`),t.fire("error","Metadata not valid")))}else e.src?this._loadModel(e.src,e,s,t):this._parseModel(e.xkt,e,s,t);return t}_loadModel(e,t,i,s){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getXKT(t.src,(e=>{this._parseModel(e,t,i,s),r.processes--}),(e=>{r.processes--,this.error(e),s.fire("error",e)}))}_parseModel(e,t,i,s){if(s.destroyed)return;const r=new DataView(e),o=new Uint8Array(e),a=r.getUint32(0,!0),n=parsers[a];if(!n)return void this.error("Unsupported .XKT file version: "+a+" - this XKTLoaderPlugin supports versions "+Object.keys(parsers));this.log("Loading .xkt V"+a);const h=r.getUint32(4,!0),l=[];let c=4*(h+2);for(let e=0;e<h;e++){const t=r.getUint32(4*(e+2),!0);l.push(o.subarray(c,c+t)),c+=t}n.parse(this.viewer,i,l,s),s.finalize(),this._createDefaultMetaModelIfNeeded(s,t,i),s.scene.once("tick",(()=>{s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))}))}_createDefaultMetaModelIfNeeded(e,t,i){const s=e.id;if(!this.viewer.metaScene.metaModels[s]){const r={metaObjects:[]};r.metaObjects.push({id:s,type:"default",name:s,parent:null});const o=e.entityList;for(let e=0,t=o.length;e<t;e++){const t=o[e];t.isObject&&r.metaObjects.push({id:t.id,type:"default",name:t.id,parent:s})}const a=t.src;this.viewer.metaScene.createMetaModel(s,r,{includeTypes:i.includeTypes,excludeTypes:i.excludeTypes,globalizeObjectIds:i.globalizeObjectIds,getProperties:async e=>await this._dataSource.getProperties(a,e)}),e.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)}))}}}class LambertMaterial extends Material{get type(){return"LambertMaterial"}constructor(e,t={}){super(e,t),this._state=new RenderState({type:"LambertMaterial",ambient:math.vec3([1,1,1]),color:math.vec3([1,1,1]),emissive:math.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"}),this.ambient=t.ambient,this.color=t.color,this.emissive=t.emissive,this.alpha=t.alpha,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this.backfaces=t.backfaces,this.frontface=t.frontface}set ambient(e){let t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set color(e){let t=this._state.color;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.color=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get color(){return this._state.color}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this._state.alphaMode=e<1?2:0,this.glRedraw())}get alpha(){return this._state.alpha}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}var zipLib={};!function(e){var t,i="File format is not recognized.",s="Error while reading zip file.",r="Error while reading file data.",o=524288,a="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function n(){this.crc=-1}function h(){}function l(e,t){var i,s;return i=new ArrayBuffer(e),s=new Uint8Array(i),t&&s.set(t,0),{buffer:i,array:s,view:new DataView(i)}}function c(){}function u(e){var t,i=this;i.size=0,i.init=function(s,r){var o=new Blob([e],{type:a});(t=new d(o)).init((function(){i.size=t.size,s()}),r)},i.readUint8Array=function(e,i,s,r){t.readUint8Array(e,i,s,r)}}function p(t){var i,s=this;s.size=0,s.init=function(e){for(var r=t.length;"="==t.charAt(r-1);)r--;i=t.indexOf(",")+1,s.size=Math.floor(.75*(r-i)),e()},s.readUint8Array=function(s,r,o){var a,n=l(r),h=4*Math.floor(s/3),c=4*Math.ceil((s+r)/3),u=e.atob(t.substring(h+i,c+i)),p=s-3*Math.floor(h/4);for(a=p;a<p+r;a++)n.array[a-p]=u.charCodeAt(a);o(n.array)}}function d(e){var t=this;t.size=0,t.init=function(i){t.size=e.size,i()},t.readUint8Array=function(t,i,s,r){var o=new FileReader;o.onload=function(e){s(new Uint8Array(e.target.result))},o.onerror=r;try{o.readAsArrayBuffer(function(e,t,i){if(t<0||i<0||t+i>e.size)throw new RangeError("offset:"+t+", length:"+i+", size:"+e.size);return e.slice?e.slice(t,t+i):e.webkitSlice?e.webkitSlice(t,t+i):e.mozSlice?e.mozSlice(t,t+i):e.msSlice?e.msSlice(t,t+i):void 0}(e,t,i))}catch(e){r(e)}}}function m(){}function f(e){var i,s=this;s.init=function(e){i=new Blob([],{type:a}),e()},s.writeUint8Array=function(e,s){i=new Blob([i,t?e:e.buffer],{type:a}),s()},s.getData=function(t,s){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=s,r.readAsText(i,e)}}function g(t){var i=this,s="",r="";i.init=function(e){s+="data:"+(t||"")+";base64,",e()},i.writeUint8Array=function(t,i){var o,a=r.length,n=r;for(r="",o=0;o<3*Math.floor((a+t.length)/3)-a;o++)n+=String.fromCharCode(t[o]);for(;o<t.length;o++)r+=String.fromCharCode(t[o]);n.length>2?s+=e.btoa(n):r=n,i()},i.getData=function(t){t(s+e.btoa(r))}}function _(e){var i,s=this;s.init=function(t){i=new Blob([],{type:e}),t()},s.writeUint8Array=function(s,r){i=new Blob([i,t?s:s.buffer],{type:e}),r()},s.getData=function(e){e(i)}}function y(e,t,i,s,r,a,n,h,l,c){var u,p,d,m=0,f=t.sn;function g(){e.removeEventListener("message",_,!1),h(p,d)}function _(t){var i=t.data,r=i.data,o=i.error;if(o)return o.toString=function(){return"Error: "+this.message},void l(o);if(i.sn===f)switch("number"==typeof i.codecTime&&(e.codecTime+=i.codecTime),"number"==typeof i.crcTime&&(e.crcTime+=i.crcTime),i.type){case"append":r?(p+=r.length,s.writeUint8Array(r,(function(){y()}),c)):y();break;case"flush":d=i.crc,r?(p+=r.length,s.writeUint8Array(r,(function(){g()}),c)):g();break;case"progress":n&&n(u+i.loaded,a);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",i)}}function y(){(u=m*o)<=a?i.readUint8Array(r+u,Math.min(o,a-u),(function(i){n&&n(u,a);var s=0===u?t:{sn:f};s.type="append",s.data=i;try{e.postMessage(s,[i.buffer])}catch(t){e.postMessage(s)}m++}),l):e.postMessage({sn:f,type:"flush"})}p=0,e.addEventListener("message",_,!1),y()}function T(e,t,i,s,r,a,h,l,c,u){var p,d=0,m=0,f="input"===a,g="output"===a,_=new n;!function a(){var n;if((p=d*o)<r)t.readUint8Array(s+p,Math.min(o,r-p),(function(t){var s;try{s=e.append(t,(function(e){h&&h(p+e,r)}))}catch(e){return void c(e)}s?(m+=s.length,i.writeUint8Array(s,(function(){d++,setTimeout(a,1)}),u),g&&_.append(s)):(d++,setTimeout(a,1)),f&&_.append(t),h&&h(p,r)}),c);else{try{n=e.flush()}catch(e){return void c(e)}n?(g&&_.append(n),m+=n.length,i.writeUint8Array(n,(function(){l(m,_.get())}),u)):l(m,_.get())}}()}function v(t,i,s,r,o,a,n,l,c,u,p){var d="input";e.zip.useWebWorkers&&n?y(t,{sn:i,codecClass:"NOOP",crcType:d},s,r,o,a,c,l,u,p):T(new h,s,r,o,a,d,c,l,u,p)}function I(e){var t,i,s="",r=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)s+=(i=255&e.charCodeAt(t))>127?r[i-128]:String.fromCharCode(i);return s}function E(e){return decodeURIComponent(escape(e))}function P(e){var t,i="";for(t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return i}function b(e,t,i,s,r){e.version=t.view.getUint16(i,!0),e.bitFlag=t.view.getUint16(i+2,!0),e.compressionMethod=t.view.getUint16(i+4,!0),e.lastModDateRaw=t.view.getUint32(i+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,i=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&i)>>11,(2016&i)>>5,2*(31&i),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((s||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(i+10,!0),e.compressedSize=t.view.getUint32(i+14,!0),e.uncompressedSize=t.view.getUint32(i+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(i+22,!0),e.extraFieldLength=t.view.getUint16(i+24,!0)):r("File is using Zip64 (4gb+ file size).")):r("File contains encrypted entry.")}function D(t,o,a){var n=0;function h(){}h.prototype.getData=function(s,o,h,c){var u=this;function p(e,t){c&&!function(e){var t=l(4);return t.view.setUint32(0,e),u.crc32==t.view.getUint32(0)}(t)?a("CRC failed."):s.getData((function(e){o(e)}))}function d(e){a(e||r)}function m(e){a(e||"Error while writing file data.")}t.readUint8Array(u.offset,30,(function(r){var o,f=l(r.length,r);1347093252==f.view.getUint32(0)?(b(u,f,4,!1,a),o=u.offset+30+u.filenameLength+u.extraFieldLength,s.init((function(){0===u.compressionMethod?v(u._worker,n++,t,s,o,u.compressedSize,c,p,h,d,m):function(t,i,s,r,o,a,n,h,l,c,u){var p=n?"output":"none";e.zip.useWebWorkers?y(t,{sn:i,codecClass:"Inflater",crcType:p},s,r,o,a,l,h,c,u):T(new e.zip.Inflater,s,r,o,a,p,l,h,c,u)}(u._worker,n++,t,s,o,u.compressedSize,c,p,h,d,m)}),m)):a(i)}),d)};var c={getEntries:function(e){var r=this._worker;!function(e){t.size<22?a(i):r(22,(function(){r(Math.min(65558,t.size),(function(){a(i)}))}));function r(i,r){t.readUint8Array(t.size-i,i,(function(t){for(var i=t.length-22;i>=0;i--)if(80===t[i]&&75===t[i+1]&&5===t[i+2]&&6===t[i+3])return void e(new DataView(t.buffer,i,22));r()}),(function(){a(s)}))}}((function(o){var n,c;n=o.getUint32(16,!0),c=o.getUint16(8,!0),n<0||n>=t.size?a(i):t.readUint8Array(n,t.size-n,(function(t){var s,o,n,u,p=0,d=[],m=l(t.length,t);for(s=0;s<c;s++){if((o=new h)._worker=r,1347092738!=m.view.getUint32(p))return void a(i);b(o,m,p+6,!0,a),o.commentLength=m.view.getUint16(p+32,!0),o.directory=16==(16&m.view.getUint8(p+38)),o.offset=m.view.getUint32(p+42,!0),n=P(m.array.subarray(p+46,p+46+o.filenameLength)),o.filename=2048==(2048&o.bitFlag)?E(n):I(n),o.directory||"/"!=o.filename.charAt(o.filename.length-1)||(o.directory=!0),u=P(m.array.subarray(p+46+o.filenameLength+o.extraFieldLength,p+46+o.filenameLength+o.extraFieldLength+o.commentLength)),o.comment=2048==(2048&o.bitFlag)?E(u):I(u),d.push(o),p+=46+o.filenameLength+o.extraFieldLength+o.commentLength}e(d)}),(function(){a(s)}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?S("inflater",(function(e){c._worker=e,o(c)}),(function(e){a(e)})):o(c)}function w(e){return unescape(encodeURIComponent(e))}function C(e){var t,i=[];for(t=0;t<e.length;t++)i.push(e.charCodeAt(t));return i}function R(t,i,s,o){var a={},n=[],h=0,c=0;function u(e){s(e||"Error while writing zip file.")}function p(e){s(e||r)}var d={add:function(i,r,d,m,f){var g,_,I,E=this._worker;function P(e,i){var s=l(16);h+=e||0,s.view.setUint32(0,1347094280),void 0!==i&&(g.view.setUint32(10,i,!0),s.view.setUint32(4,i,!0)),r&&(s.view.setUint32(8,e,!0),g.view.setUint32(14,e,!0),s.view.setUint32(12,r.size,!0),g.view.setUint32(18,r.size,!0)),t.writeUint8Array(s.array,(function(){h+=16,d()}),u)}function b(){f=f||{},i=i.trim(),f.directory&&"/"!=i.charAt(i.length-1)&&(i+="/"),a.hasOwnProperty(i)?s("File already exists."):(_=C(w(i)),n.push(i),function(e){var s;I=f.lastModDate||new Date,g=l(26),a[i]={headerArray:g.array,directory:f.directory,filename:_,offset:h,comment:C(w(f.comment||""))},g.view.setUint32(0,335546376),f.version&&g.view.setUint8(0,f.version),o||0===f.level||f.directory||g.view.setUint16(4,2048),g.view.setUint16(6,(I.getHours()<<6|I.getMinutes())<<5|I.getSeconds()/2,!0),g.view.setUint16(8,(I.getFullYear()-1980<<4|I.getMonth()+1)<<5|I.getDate(),!0),g.view.setUint16(22,_.length,!0),(s=l(30+_.length)).view.setUint32(0,1347093252),s.array.set(g.array,4),s.array.set(_,30),h+=s.array.length,t.writeUint8Array(s.array,e,u)}((function(){r?o||0===f.level?v(E,c++,r,t,0,r.size,!0,P,m,p,u):function(t,i,s,r,o,a,n,h,l){var c="input";e.zip.useWebWorkers?y(t,{sn:i,options:{level:o},codecClass:"Deflater",crcType:c},s,r,0,s.size,n,a,h,l):T(new e.zip.Deflater,s,r,0,s.size,c,n,a,h,l)}(E,c++,r,t,f.level,P,m,p,u):P()})))}r?r.init(b,p):b()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var i,s,r,o=0,c=0;for(s=0;s<n.length;s++)o+=46+(r=a[n[s]]).filename.length+r.comment.length;for(i=l(o+22),s=0;s<n.length;s++)r=a[n[s]],i.view.setUint32(c,1347092738),i.view.setUint16(c+4,5120),i.array.set(r.headerArray,c+6),i.view.setUint16(c+32,r.comment.length,!0),r.directory&&i.view.setUint8(c+38,16),i.view.setUint32(c+42,r.offset,!0),i.array.set(r.filename,c+46),i.array.set(r.comment,c+46+r.filename.length),c+=46+r.filename.length+r.comment.length;i.view.setUint32(c,1347093766),i.view.setUint16(c+8,n.length,!0),i.view.setUint16(c+10,n.length,!0),i.view.setUint32(c+12,o,!0),i.view.setUint32(c+16,h,!0),t.writeUint8Array(i.array,(function(){t.getData(e)}),u)},_worker:null};e.zip.useWebWorkers?S("deflater",(function(e){d._worker=e,i(d)}),(function(e){s(e)})):i(d)}n.prototype.append=function(e){for(var t=0|this.crc,i=this.table,s=0,r=0|e.length;s<r;s++)t=t>>>8^i[255&(t^e[s])];this.crc=t},n.prototype.get=function(){return~this.crc},n.prototype.table=function(){var e,t,i,s=[];for(e=0;e<256;e++){for(i=e,t=0;t<8;t++)1&i?i=i>>>1^3988292384:i>>>=1;s[e]=i}return s}(),h.prototype.append=function(e,t){return e},h.prototype.flush=function(){},u.prototype=new c,u.prototype.constructor=u,p.prototype=new c,p.prototype.constructor=p,d.prototype=new c,d.prototype.constructor=d,m.prototype.getData=function(e){e(this.data)},f.prototype=new m,f.prototype.constructor=f,g.prototype=new m,g.prototype.constructor=g,_.prototype=new m,_.prototype.constructor=_;var F={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function S(t,i,s){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var r,o,a;if(e.zip.workerScripts){if(r=e.zip.workerScripts[t],!Array.isArray(r))return void s(new Error("zip.workerScripts."+t+" is not an array!"));o=r,a=document.createElement("a"),r=o.map((function(e){return a.href=e,a.href}))}else(r=F[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+r[0];var n=new Worker(r[0]);n.codecTime=n.crcTime=0,n.postMessage({type:"importScripts",scripts:r.slice(1)}),n.addEventListener("message",(function e(t){var r=t.data;if(r.error)return n.terminate(),void s(r.error);"importScripts"===r.type&&(n.removeEventListener("message",e),n.removeEventListener("error",h),i(n))})),n.addEventListener("error",h)}else s(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function h(e){n.terminate(),s(e)}}function x(e){console.error(e)}e.zip={Reader:c,Writer:m,BlobReader:d,Data64URIReader:p,TextReader:u,BlobWriter:_,Data64URIWriter:g,TextWriter:f,createReader:function(e,t,i){i=i||x,e.init((function(){D(e,t,i)}),i)},createWriter:function(e,t,i,s){i=i||x,s=!!s,e.init((function(){R(e,t,i,s)}),i)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(zipLib);const zipExt=function(e){var t,i,s=e.Reader,r=e.Writer;try{i=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(e){var t=this;function i(i,s){var r;t.data?i():((r=new XMLHttpRequest).addEventListener("load",(function(){t.size||(t.size=Number(r.getResponseHeader("Content-Length"))||Number(r.response.byteLength)),t.data=new Uint8Array(r.response),i()}),!1),r.addEventListener("error",s,!1),r.open("GET",e),r.responseType="arraybuffer",r.send())}t.size=0,t.init=function(s,r){if(function(e){var t=document.createElement("a");return t.href=e,"http:"===t.protocol||"https:"===t.protocol}(e)){var o=new XMLHttpRequest;o.addEventListener("load",(function(){t.size=Number(o.getResponseHeader("Content-Length")),t.size?s():i(s,r)}),!1),o.addEventListener("error",r,!1),o.open("HEAD",e),o.send()}else i(s,r)},t.readUint8Array=function(e,s,r,o){i((function(){r(new Uint8Array(t.data.subarray(e,e+s)))}),o)}}function a(e){var t=this;t.size=0,t.init=function(i,s){var r=new XMLHttpRequest;r.addEventListener("load",(function(){t.size=Number(r.getResponseHeader("Content-Length")),"bytes"==r.getResponseHeader("Accept-Ranges")?i():s("HTTP Range not supported.")}),!1),r.addEventListener("error",s,!1),r.open("HEAD",e),r.send()},t.readUint8Array=function(t,i,s,r){!function(t,i,s,r){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="arraybuffer",o.setRequestHeader("Range","bytes="+t+"-"+(t+i-1)),o.addEventListener("load",(function(){s(o.response)}),!1),o.addEventListener("error",r,!1),o.send()}(t,i,(function(e){s(new Uint8Array(e))}),r)}}function n(e){var t=this;t.size=0,t.init=function(i,s){t.size=e.byteLength,i()},t.readUint8Array=function(t,i,s,r){s(new Uint8Array(e.slice(t,t+i)))}}function h(){var e,t=this;t.init=function(t,i){e=new Uint8Array,t()},t.writeUint8Array=function(t,i,s){var r=new Uint8Array(e.length+t.length);r.set(e),r.set(t,e.length),e=r,i()},t.getData=function(t){t(e.buffer)}}function l(e,t){var s,r=this;r.init=function(t,i){e.createWriter((function(e){s=e,t()}),i)},r.writeUint8Array=function(e,r,o){var a=new Blob([i?e:e.buffer],{type:t});s.onwrite=function(){s.onwrite=null,r()},s.onerror=o,s.write(a)},r.getData=function(t){e.file(t)}}o.prototype=new s,o.prototype.constructor=o,a.prototype=new s,a.prototype.constructor=a,n.prototype=new s,n.prototype.constructor=n,h.prototype=new r,h.prototype.constructor=h,l.prototype=new r,l.prototype.constructor=l,e.FileWriter=l,e.HttpReader=o,e.HttpRangeReader=a,e.ArrayBufferReader=n,e.ArrayBufferWriter=h,e.fs&&((t=e.fs.ZipDirectoryEntry).prototype.addHttpContent=function(i,s,r){return function(i,s,r,o){if(i.directory)return o?new t(i.fs,s,r,i):new e.fs.ZipFileEntry(i.fs,s,r,i);throw"Parent entry is not a directory."}(this,i,{data:s,Reader:r?a:o})},t.prototype.importHttpContent=function(e,t,i,s){this.importZip(t?new a(e):new o(e),i,s)},e.fs.FS.prototype.importHttpContent=function(e,i,s,r){this.entries=[],this.root=new t(this),this.root.importHttpContent(e,i,s,r)})},zip=zipLib.zip;zipExt(zip);const supportedSchemas=["4.2"];class XML3DSceneGraphLoader{constructor(e,t={}){this.supportedSchemas=supportedSchemas,this._xrayOpacity=.7,this._src=null,this._options=t,this.viewpoint=null,t.workerScriptsPath?(zip.workerScriptsPath=t.workerScriptsPath,this.src=t.src,this.xrayOpacity=.7,this.displayEffect=t.displayEffect,this.createMetaModel=t.createMetaModel):e.error("Config expected: workerScriptsPath")}load(e,t,i,s,r,o){switch(s.materialType){case"MetallicMaterial":t._defaultMaterial=new MetallicMaterial(t,{baseColor:[1,1,1],metallic:.6,roughness:.6});break;case"SpecularMaterial":t._defaultMaterial=new SpecularMaterial(t,{diffuse:[1,1,1],specular:math.vec3([1,1,1]),glossiness:.5});break;default:t._defaultMaterial=new PhongMaterial(t,{reflectivity:.75,shiness:100,diffuse:[1,1,1]})}t._wireframeMaterial=new LambertMaterial(t,{color:[0,0,0],lineWidth:2});var a=t.scene.canvas.spinner;a.processes++,load3DXML(e,t,i,s,(function(){a.processes--,r&&r(),t.fire("loaded",!0,!1)}),(function(e){a.processes--,t.error(e),o&&o(e),t.fire("error",e)}),(function(e){console.log("Error, Will Robinson: "+e)}))}}var load3DXML=function(e,t,i,s,r,o){loadZIP(i,(function(i){parse3DXML(e,i,s,t,r,o)}),o)},parse3DXML=function(){return function(t,i,s,r,o){var a={plugin:t,zip:i,edgeThreshold:30,materialType:s.materialType,scene:r.scene,modelNode:r,info:{references:{}},materials:{}};s.createMetaModel&&(a.metaModelData={modelId:r.id,metaObjects:[{name:r.id,type:"Default",id:r.id}]}),r.scene.loading++,function(t,i){t.zip.getFile("Manifest.xml",(function(s,r){for(var o=r.children,a=0,n=o.length;a<n;a++){var h=o[a];if("Manifest"===h.type)e(t,h,i)}}))}(a,(function(){a.metaModelData&&t.viewer.metaScene.createMetaModel(r.id,a.metaModelData),r.scene.loading--,o()}))};function e(e,i,s){for(var r=i.children,o=0,a=r.length;o<a;o++){var n=r[o];if("Root"===n.type){var h=n.children[0];e.zip.getFile(h,(function(i,r){t(e,r,s)}))}}}function t(e,t,s){for(var r=t.children,o=0,a=r.length;o<a;o++){var n=r[o];if("Model_3dxml"===n.type)i(e,n,s)}}function i(e,t,i){for(var r=t.children,n=0,h=r.length;n<h;n++){var l=r[n];switch(l.type){case"Header":s(e,l);break;case"ProductStructure":o(e,l,i);break;case"DefaultView":a(e,l)}}}function s(e,t){for(var i=t.children,s={},o=0,a=i.length;o<a;o++){var n=i[o];switch(n.type){case"SchemaVersion":s.schemaVersion=n.children[0],r(e,s.schemaVersion)||e.plugin.error("Schema version not supported: "+s.schemaVersion+" - supported versions are: "+supportedSchemas.join(","));break;case"Title":s.title=n.children[0];break;case"Author":s.author=n.children[0];break;case"Created":s.created=n.children[0]}}e.modelNode.meta=s}function r(e,t){for(var i=0,s=supportedSchemas.length;i<s;i++)if(t===supportedSchemas[i])return!0;return!1}function o(e,t,i){!function(e,t,i){for(var s={},r=t.children,o=0,a=0,h=r.length;a<h;a++){"ReferenceRep"===(l=r[a]).type&&o++}for(a=0,h=r.length;a<h;a++){var l;if("ReferenceRep"===(l=r[a]).type)if(l.associatedFile){var c=stripURN(l.associatedFile);!function(){var t=l.id;e.zip.getFile(c,(function(r,a){var h=r.getElementsByTagName("MaterialId");loadCATMaterialRefDocuments(e,h,(function(){var r={id:t};n(e,a,r),s[t]=r,0==--o&&i(s)}))}),(function(e){}))}()}}}(e,t,(function(s){for(var r=t.children,o={},a={},n={},h=0,l=r.length;h<l;h++){var c=r[h];switch(c.type){case"Reference3D":o[c.id]={type:"Reference3D",id:c.id,name:c.name,instance3Ds:{},instanceReps:{}};break;case"InstanceRep":for(var u=0,p=c.children.length;u<p;u++){switch((_=c.children[u]).type){case"IsAggregatedBy":d=_.children[0];break;case"IsInstanceOf":m=_.children[0]}}a[c.id]={type:"InstanceRep",id:c.id,name:c.name,isAggregatedBy:d,isInstanceOf:m,referenceReps:{}};break;case"Instance3D":var d,m,g;for(u=0,p=c.children.length;u<p;u++){var _;switch((_=c.children[u]).type){case"IsAggregatedBy":d=_.children[0];break;case"IsInstanceOf":m=_.children[0];break;case"RelativeMatrix":g=_.children[0]}}n[c.id]={type:"Instance3D",id:c.id,name:c.name,isAggregatedBy:d,isInstanceOf:m,relativeMatrix:g,reference3Ds:{}}}}for(var y in n){(v=o[(T=n[y]).isAggregatedBy])?v.instance3Ds[T.id]=T:alert("foo")}for(var y in n){var T,v=o[(T=n[y]).isInstanceOf];T.reference3Ds[v.id]=v,v.instance3D=T}for(var y in a){var I=s[(E=a[y]).isInstanceOf];I&&(E.referenceReps[I.id]=I)}for(var y in a){var E;(v=o[(E=a[y]).isAggregatedBy])&&(v.instanceReps[E.id]=E)}function P(e,t,i){for(var s in t.instance3Ds)b(e,t.instance3Ds[s],i);for(var s in t.instanceReps)D(e,t.instanceReps[s],i)}function b(e,t,i){if(t.relativeMatrix){var s=f(t.relativeMatrix,12),r=[s[9],s[10],s[11]],o=s.slice(0,9),a=math.mat3ToMat4(o,math.identityMat4()),n=new Node$1(e.modelNode,{position:r});e.metaModelData&&e.metaModelData.metaObjects.push({id:n.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i?i.addChild(n,!0):e.modelNode.addChild(n,!0),i=n,n=new Node$1(e.modelNode,{matrix:a}),e.metaModelData&&e.metaModelData.metaObjects.push({id:n.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i.addChild(n,!0),i=n}else{n=new Node$1(e.modelNode,{});e.metaModelData&&e.metaModelData.metaObjects.push({id:n.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i?i.addChild(n,!0):e.modelNode.addChild(n,!0),i=n}for(var h in t.reference3Ds)P(e,t.reference3Ds[h],i)}function D(e,t,i){if(t.referenceReps)for(var s in t.referenceReps){var r=t.referenceReps[s];for(var o in r)if("id"!==o){var a=r[o],n="lines"===a.geometry.primitive?e.modelNode._wireframeMaterial:a.materialId?e.materials[a.materialId]:null,h=a.color,l=new Mesh(e.modelNode,{isObject:!0,geometry:a.geometry,material:n||e.modelNode._defaultMaterial,colorize:h,backfaces:!1});e.metaModelData&&e.metaModelData.metaObjects.push({id:l.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i?i.addChild(l,!0):e.modelNode.addChild(l,!0),l.colorize=h}}}for(var y in o){if(!(v=o[y]).instance3D)return P(e,v,null),void i()}alert("No root Reference3D element found in this modelNode - can't load."),i()}))}function a(e,t){for(var i=t.children,s=0,r=i.length;s<r;s++){var o=i[s];if("Viewpoint"===o.type){var a=o.children;e.modelNode.viewpoint={};for(var n=0,h=a.length;n<h;n++){var l=a[s];switch(l.type){case"Position":e.modelNode.viewpoint.eye=f(l.children[0],3);break;case"Sight":e.modelNode.viewpoint.look=f(l.children[0],3);break;case"Up":e.modelNode.viewpoint.up=f(l.children[0],3)}}}}}function n(e,t,i){for(var s=t.children,r=0,o=s.length;r<o;r++){var a=s[r];if("XMLRepresentation"===a.type)h(e,a,i)}}function h(e,t,i){for(var s=t.children,r=0,o=s.length;r<o;r++){var a=s[r];if("Root"===a.type)l(e,a,i)}}function l(e,t,i){t["xsi:type"];for(var s=t.children,r=0,o=s.length;r<o;r++){var a=s[r];if("Rep"===a.type)c(e,a,i)}}function c(e,t,i){t["xsi:type"];for(var s={edgeThreshold:e.edgeThreshold||30,compressGeometry:!0},r=t.children,o=0,a=r.length;o<a;o++){var n=r[o];switch(n.type){case"Rep":c(e,n,i);break;case"Edges":break;case"Faces":s.primitive="triangles",u(e,n,s);break;case"VertexBuffer":m(e,n,s);break;case"SurfaceAttributes":g(e,n,s)}}if(s.positions){var h=new ReadableGeometry(e.modelNode,s);i[h.id]={geometry:h,color:s.color||[1,1,1,1],materialId:s.materialId}}}function u(e,t,i){for(var s=t.children,r=0,o=s.length;r<o;r++){var a=s[r];if("Face"===a.type)p(e,a,i)}}function p(e,t,i){var s=t.strips;if(s){var r=function(e){for(var t=e.split(","),i=[],s=0,r=t.length;s<r;s++){var o=t[s].trim();if(o.length>0){for(var a=o.trim().split(" "),n=new Int16Array(a.length),h=0,l=0,c=a.length;l<c;l++)""!==a[l]&&(n[h++]=parseInt(a[l]));i.push(n)}}return i}(s);if(r.length>0){i.primitive="triangles";for(var o=[],a=0,n=r.length;a<n;a++)for(var h=d(r[a]),l=0,c=h.length;l<c;l++)o.push(h[l]);i.indices=o}}else{var u=t.triangles;u&&(i.primitive="triangles",i.indices=function(e){e=e.trim().split(" ");for(var t=new Int32Array(e.length),i=0,s=e.length;i<s;i++){var r=e[i];t[i]=parseInt(r)}return t}(u))}var p=t.children;for(a=0,n=p.length;a<n;a++){var m=p[a];if("SurfaceAttributes"===m.type)g(e,m,i)}}function d(e){for(var t=[],i=0,s=e.length;i<s-2;i++)1&i?(t.push(e[i]),t.push(e[i+2]),t.push(e[i+1])):(t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]));return t}function m(e,t,i){for(var s=t.children,r=0,o=s.length;r<o;r++){var a=s[r];switch(a.type){case"Positions":i.positions=f(a.children[0],3);break;case"Normals":i.normals=f(a.children[0],3);break;case"TextureCoordinates":i.uv=f(a.children[0],2)}}}function f(e,t){e=e.split(",");for(var i=new Float32Array(e.length*t),s=0,r=0,o=e.length;r<o;r++)for(var a=e[r],n=0,h=(a=a.split(" ")).length;n<h;n++)""!==a[n]&&(i[s++]=parseFloat(a[n]));return i}function g(e,t,i){i.color=[1,1,1,1];for(var s=t.children,r=0,o=s.length;r<o;r++){var a=s[r];switch(a.type){case"Color":i.color[0]=a.red,i.color[1]=a.green,i.color[2]=a.blue,i.color[3]=a.alpha;break;case"MaterialApplication":for(var n=a.children,h=0,l=n.length;h<l;h++){var c=n[h];if("MaterialId"===c.type){var u=getIDFromURI(c.id);e.materials[u]||e.plugin.error("material  not found: "+u),i.materialId=u}}}}}}();function loadCATMaterialRefDocuments(e,t,i){var s={};!function r(o,a){if(o>=t.length)i();else{var n=t[o].id,h=n.lastIndexOf(":");h>0&&(n=n.substring(h+1));var l=n.lastIndexOf("#");l>0&&(n=n.substring(0,l)),s[n]?r(o+1):loadCATMaterialRefDocument(e,n,(function(){s[n]=!0,r(o+1)}))}}(0)}function loadCATMaterialRefDocument(e,t,i){e.zip.getFile(t,(function(t,s){parseCATMaterialRefDocument(e,s,i)}))}function parseCATMaterialRefDocument(e,t,i){for(var s,r=t.children,o=0,a=r.length;o<a;o++)"Model_3dxml"===(s=r[o]).type&&parseModel_3dxml(e,s,i)}function parseModel_3dxml(e,t,i){for(var s,r=t.children,o=0,a=r.length;o<a;o++)"CATMaterialRef"===(s=r[o]).type&&parseCATMaterialRef(e,s,i)}function parseCATMaterialRef(e,t,i){for(var s={},r=t.children,o=0,a=0,n=r.length;a<n;a++){if("MaterialDomainInstance"===(d=r[a]).type){for(var h,l,c=0,u=d.children.length;c<u;c++){var p=d.children[c];switch(p.type){case"IsAggregatedBy":h=p.children[0];break;case"IsInstanceOf":l=p.children[0]}}s[l]=h}}for(a=0,n=r.length;a<n;a++){if("MaterialDomain"===(d=r[a]).type)o++}for(a=0,n=r.length;a<n;a++){var d;if("MaterialDomain"===(d=r[a]).type)d.associatedFile&&function(){var t=d.id,r=stripURN(d.associatedFile);e.zip.getFile(r,(function(r,a){e.materials[s[t]]=parseMaterialDefDocument(e,a),0==--o&&i()}),(function(e){}))}()}}function parseMaterialDefDocument(e,t){for(var i=t.children,s=0,r=i.length;s<r;s++){var o=i[s];if("Osm"===o.type)return parseMaterialDefDocumentOsm(e,o)}}function parseMaterialDefDocumentOsm(e,t){for(var i=t.children,s=0,r=i.length;s<r;s++){var o=i[s];switch(o.type){case"RenderingRootFeature":break;case"Feature":if("RenderingFeature"===o.Alias){var a,n,h,l,c={},u={},p=o.children;for(a=0,n=p.length;a<n;a++)switch((h=p[a]).Name){case"AmbientCoef":c.ambient=parseFloat(h.Value);break;case"DiffuseCoef":c.diffuse=parseFloat(h.Value);break;case"EmissiveCoef":c.emissive=parseFloat(h.Value);break;case"SpecularExponent":c.specular=parseFloat(h.Value)}for(a=0,n=p.length;a<n;a++)switch((h=p[a]).Name){case"AmbientColor":u.ambient=parseRGB(h.Value,c.ambient);break;case"DiffuseColor":u.diffuse=parseRGB(h.Value,c.diffuse);break;case"EmissiveColor":u.emissive=parseRGB(h.Value,c.emissive);break;case"SpecularColor":u.specular=parseRGB(h.Value,c.specular);break;case"Transparency":var d=1-parseFloat(h.Value);d<1&&(u.alpha=d,u.alphaMode="blend")}switch(e.materialType){case"MetallicMaterial":l=new MetallicMaterial(e.modelNode,{baseColor:u.diffuse,metallic:.7,roughness:.5,emissive:u.emissive,alpha:u.alpha,alphaMode:u.alphaMode});break;case"SpecularMaterial":l=new SpecularMaterial(e.modelNode,{diffuse:u.diffuse,specular:u.specular,glossiness:.5,emissive:u.emissive,alpha:u.alpha,alphaMode:u.alphaMode});break;default:l=new PhongMaterial(e.modelNode,{reflectivity:.5,ambient:u.ambient,diffuse:u.diffuse,specular:u.specular,emissive:u.emissive,alphaMode:u.alphaMode,alpha:t.alpha})}return l}}}}function parseRGB(e,t){t=void 0!==t?t:.5;var i=e.indexOf("["),s=e.indexOf("]");e=(e=e.substring(i+1,s-i)).split(",");for(var r=new Float32Array(e.length),o=0,a=0,n=e.length;a<n;a++)for(var h=e[a],l=0,c=(h=h.trim().split(" ")).length;l<c;l++)""!==h[l]&&(r[o++]=parseFloat(h[l])*t);return r}var ZIP=function(){var e={};function t(e,i){if(e.nodeType===e.TEXT_NODE){var s=e.nodeValue;if(null===s.match(/^\s+$/))return s}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var r={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var o=0;o<e.attributes.length;o++){var a=e.attributes[o];r[i[a.nodeName]||a.nodeName]=a.nodeValue}for(var n=0;n<e.childNodes.length;n++){(o=t(e.childNodes[n],i))&&r.children.push(o)}return r}}this.load=function(t,i,s){zip.createReader(new zip.HttpReader(t),(function(t){t.getEntries((function(t){if(t.length>0)for(var s=0,r=t.length;s<r;s++){var o=t[s];e[o.filename]=o}i()}))}),s)},this.getFile=function(i,s,r){var o=e[i];if(!o){var a="ZIP entry not found: "+i;return console.error(a),void(r&&r(a))}o.getData(new zip.TextWriter,(function(e){var i=(new DOMParser).parseFromString(e,"text/xml"),r=t(i,{});s(i,r)}))},this.destroy=function(){undefined.close((function(){}))}};function loadZIP(e,t,i){var s=new ZIP;s.load(e,(function(){t(s)}),(function(e){i("Error loading ZIP archive: "+e)}))}function stripURN(e){var t="urn:3DXML:";return 0===e.indexOf(t)?e.substring(t.length):e}function getIDFromURI(e){var t=e.lastIndexOf("#");return-1!==t?e.substring(t+1):e}class XML3DLoaderPlugin extends Plugin{constructor(e,t={}){super("XML3DLoader",e,t),t.workerScriptsPath?(this._workerScriptsPath=t.workerScriptsPath,this._loader=new XML3DSceneGraphLoader(this,t),this.supportedSchemas=this._loader.supportedSchemas):this.error("Config expected: workerScriptsPath")}load(e={}){e.workerScriptsPath=this._workerScriptsPath,e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Node$1(this.viewer.scene,utils.apply(e,{isModel:!0})),i=e.src;return i?(this._loader.load(this,t,i,e),t):(this.error("load() param expected: src"),t)}}var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__spreadValues=(e,t)=>{for(var i in t||(t={}))__hasOwnProp.call(t,i)&&__defNormalProp(e,i,t[i]);if(__getOwnPropSymbols)for(var i of __getOwnPropSymbols(t))__propIsEnum.call(t,i)&&__defNormalProp(e,i,t[i]);return e},__require=e=>{if("undefined"!=typeof require)return require(e);throw new Error('Dynamic require of "'+e+'" is not supported')},__commonJS=(e,t)=>function(){return t||(0,e[Object.keys(e)[0]])((t={exports:{}}).exports,t),t.exports},__async=(e,t,i)=>new Promise(((s,r)=>{var o=e=>{try{n(i.next(e))}catch(e){r(e)}},a=e=>{try{n(i.throw(e))}catch(e){r(e)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,a);n((i=i.apply(e,t)).next())})),require_crypto=__commonJS({"(disabled):crypto"(){}}),require_web_ifc_mt=__commonJS({"dist/web-ifc-mt.js"(e,t){var i,s=(i="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(i=i||__filename),function(e){function t(){return S.buffer!=O&&re(S.buffer),N}function s(){return S.buffer!=O&&re(S.buffer),B}function r(){return S.buffer!=O&&re(S.buffer),k}function o(){return S.buffer!=O&&re(S.buffer),G}function a(){return S.buffer!=O&&re(S.buffer),U}function n(){return S.buffer!=O&&re(S.buffer),V}function h(){return S.buffer!=O&&re(S.buffer),j}var l,c,u=void 0!==(e=e||{})?e:{};u.ready=new Promise((function(e,t){l=e,c=t}));var p,d={};for(p in u)u.hasOwnProperty(p)&&(d[p]=u[p]);var m,f,g,_,y="./this.program",T=function(e,t){throw t};m="object"==typeof window,f="function"==typeof importScripts,g="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,_=!m&&!g&&!f;var v=u.ENVIRONMENT_IS_PTHREAD||!1;v&&(O=u.buffer);var I,E,P,b,D="";function w(e){return u.locateFile?u.locateFile(e,D):D+e}if(g){var C;D=f?__require("path").dirname(D)+"/":__dirname+"/",I=function(e,t){return P||(P=__require("fs")),b||(b=__require("path")),e=b.normalize(e),P.readFileSync(e,t?null:"utf8")},E=function(e){var t=I(e,!0);return t.buffer||(t=new Uint8Array(t)),$(t.buffer),t},process.argv.length>1&&(y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof vs))throw e})),process.on("unhandledRejection",fe),T=function(e){process.exit(e)},u.inspect=function(){return"[Emscripten Module object]"};try{C=__require("worker_threads")}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}global.Worker=C.Worker}else _?("undefined"!=typeof read&&(I=function(e){return read(e)}),E=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):($("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(T=function(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(m||f)&&(f?D=self.location.href:"undefined"!=typeof document&&document.currentScript&&(D=document.currentScript.src),i&&(D=i),D=0!==D.indexOf("blob:")?D.substr(0,D.lastIndexOf("/")+1):"",g?(I=function(e,t){return P||(P=__require("fs")),b||(b=__require("path")),e=b.normalize(e),P.readFileSync(e,t?null:"utf8")},E=function(e){var t=I(e,!0);return t.buffer||(t=new Uint8Array(t)),$(t.buffer),t}):(I=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(E=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})));g&&"undefined"==typeof performance&&(global.performance=__require("perf_hooks").performance);var R,F,S,x,M=u.print||console.log.bind(console),A=u.printErr||console.warn.bind(console);for(p in d)d.hasOwnProperty(p)&&(u[p]=d[p]);function L(e){L.shown||(L.shown={}),L.shown[e]||(L.shown[e]=1,A(e))}d=null,u.arguments&&u.arguments,u.thisProgram&&(y=u.thisProgram),u.quit&&(T=u.quit),u.wasmBinary&&(R=u.wasmBinary),u.noExitRuntime&&(F=u.noExitRuntime),"object"!=typeof WebAssembly&&fe("no native wasm support detected");var O,N,B,k,G,U,V,H,j,z=0,W=!1;function $(e,t){e||fe("Assertion failed: "+t)}function X(e,t,i){for(var s=(t>>>=0)+i,r="";!(t>=s);){var o=e[t++>>>0];if(!o)return r;if(128&o){var a=63&e[t++>>>0];if(192!=(224&o)){var n=63&e[t++>>>0];if((o=224==(240&o)?(15&o)<<12|a<<6|n:(7&o)<<18|a<<12|n<<6|63&e[t++>>>0])<65536)r+=String.fromCharCode(o);else{var h=o-65536;r+=String.fromCharCode(55296|h>>10,56320|1023&h)}}else r+=String.fromCharCode((31&o)<<6|a)}else r+=String.fromCharCode(o)}return r}function Y(e,t){return(e>>>=0)?X(s(),e,t):""}function K(e,t,i,s){if(!(s>0))return 0;for(var r=i>>>=0,o=i+s-1,a=0;a<e.length;++a){var n=e.charCodeAt(a);if(n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++a)),n<=127){if(i>=o)break;t[i++>>>0]=n}else if(n<=2047){if(i+1>=o)break;t[i++>>>0]=192|n>>6,t[i++>>>0]=128|63&n}else if(n<=65535){if(i+2>=o)break;t[i++>>>0]=224|n>>12,t[i++>>>0]=128|n>>6&63,t[i++>>>0]=128|63&n}else{if(i+3>=o)break;t[i++>>>0]=240|n>>18,t[i++>>>0]=128|n>>12&63,t[i++>>>0]=128|n>>6&63,t[i++>>>0]=128|63&n}}return t[i>>>0]=0,i-r}function q(e,t,i){return K(e,s(),t,i)}function Z(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127?++t:t+=s<=2047?2:s<=65535?3:4}return t}function Q(e,t){for(var i="",s=0;!(s>=t/2);++s){var o=r()[e+2*s>>1];if(0==o)break;i+=String.fromCharCode(o)}return i}function J(e,t,i){if(void 0===i&&(i=2147483647),i<2)return 0;for(var s=t,o=(i-=2)<2*e.length?i/2:e.length,a=0;a<o;++a){var n=e.charCodeAt(a);r()[t>>1]=n,t+=2}return r()[t>>1]=0,t-s}function ee(e){return 2*e.length}function te(e,t){for(var i=0,s="";!(i>=t/4);){var r=a()[e+4*i>>2];if(0==r)break;if(++i,r>=65536){var o=r-65536;s+=String.fromCharCode(55296|o>>10,56320|1023&o)}else s+=String.fromCharCode(r)}return s}function ie(e,t,i){if(void 0===i&&(i=2147483647),i<4)return 0;for(var s=t>>>=0,r=s+i-4,o=0;o<e.length;++o){var n=e.charCodeAt(o);if(n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++o)),a()[t>>2]=n,(t+=4)+4>r)break}return a()[t>>2]=0,t-s}function se(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&++i,t+=4}return t}function re(e){O=e,u.HEAP8=N=new Int8Array(e),u.HEAP16=k=new Int16Array(e),u.HEAP32=U=new Int32Array(e),u.HEAPU8=B=new Uint8Array(e),u.HEAPU16=G=new Uint16Array(e),u.HEAPU32=V=new Uint32Array(e),u.HEAPF32=H=new Float32Array(e),u.HEAPF64=j=new Float64Array(e)}var oe,ae=u.INITIAL_MEMORY||16777216;if(v)S=u.wasmMemory,O=u.buffer;else if(u.wasmMemory)S=u.wasmMemory;else if(!((S=new WebAssembly.Memory({initial:ae/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw A("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),g&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");S&&(O=S.buffer),ae=O.byteLength,re(O);var ne=[],he=[],le=[],ce=[],ue=0,pe=null;function de(e){$(!v,"addRunDependency cannot be used in a pthread worker"),ue++,u.monitorRunDependencies&&u.monitorRunDependencies(ue)}function me(e){if(ue--,u.monitorRunDependencies&&u.monitorRunDependencies(ue),0==ue&&pe){var t=pe;pe=null,t()}}function fe(e){u.onAbort&&u.onAbort(e),v&&console.error("Pthread aborting at "+(new Error).stack),A(e+=""),W=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw c(t),t}function ge(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function _e(e){return ge(e,"data:application/octet-stream;base64,")}function ye(e){return ge(e,"file://")}u.preloadedImages={},u.preloadedAudios={};var Te,ve,Ie="web-ifc-mt.wasm";function Ee(){try{if(R)return new Uint8Array(R);if(E)return E(Ie);throw"both async and sync fetching of the wasm failed"}catch(e){fe(e)}}_e(Ie)||(Ie=w(Ie));var Pe={41793:function(e,t){setTimeout((function(){ms(e,t)}),0)},41871:function(){throw"Canceled!"}};function be(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?oe.get(i)():oe.get(i)(t.arg):i(void 0===t.arg?null:t.arg)}else t(u)}}function De(e,t,i){return-1!=e.indexOf("j")?function(e,t,i){return i&&i.length?u["dynCall_"+e].apply(null,[t].concat(i)):u["dynCall_"+e].call(null,t)}(e,t,i):oe.get(t).apply(null,i)}u.dynCall=De;var we=0,Ce=0,Re=0;function Fe(e,t,i){we=e|=0,Re=t|=0,Ce=i|=0}u.registerPthreadPtr=Fe;var Se=71,xe=28;function Me(e,i){if(e<=0||e>t().length||!0&e||i<0)return-28;if(0==i)return 0;i>=2147483647&&(i=1/0);var s=Atomics.load(a(),Le.mainThreadFutex>>2),r=0;if(s==e&&Atomics.compareExchange(a(),Le.mainThreadFutex>>2,s,0)==s&&(r=1,--i<=0))return 1;var o=Atomics.notify(a(),e>>2,i);if(o>=0)return o+r;throw"Atomics.notify returned an unexpected value "+o}u._emscripten_futex_wake=Me;var Ae,Le={MAIN_THREAD_ID:1,mainThreadInfo:{schedPolicy:0,schedPrio:0},unusedWorkers:[],runningWorkers:[],initMainThreadBlock:function(){for(var e=navigator.hardwareConcurrency,t=0;t<e;++t)Le.allocateUnusedWorker()},initRuntime:function(){Le.mainThreadBlock=ts(232);for(var e=0;e<58;++e)n()[Le.mainThreadBlock/4+e]=0;a()[Le.mainThreadBlock+12>>2]=Le.mainThreadBlock;var t=Le.mainThreadBlock+156;a()[t>>2]=t;var i=ts(512);for(e=0;e<128;++e)n()[i/4+e]=0;Atomics.store(n(),Le.mainThreadBlock+104>>2,i),Atomics.store(n(),Le.mainThreadBlock+40>>2,Le.mainThreadBlock),Atomics.store(n(),Le.mainThreadBlock+44>>2,42),Le.initShared(),Fe(Le.mainThreadBlock,!f,1),ds(Le.mainThreadBlock)},initWorker:function(){Le.initShared(),l(u)},initShared:function(){Le.mainThreadFutex=Ts},pthreads:{},threadExitHandlers:[],setThreadStatus:function(){},runExitHandlers:function(){for(;Le.threadExitHandlers.length>0;)Le.threadExitHandlers.pop()();v&&z&&us()},threadExit:function(e){var t=Ui();t&&(Atomics.store(n(),t+4>>2,e),Atomics.store(n(),t+0>>2,1),Atomics.store(n(),t+60>>2,1),Atomics.store(n(),t+64>>2,0),Le.runExitHandlers(),Me(t+0,2147483647),Fe(0,0,0),z=0,v&&postMessage({cmd:"exit"}))},threadCancel:function(){Le.runExitHandlers(),Atomics.store(n(),z+4>>2,-1),Atomics.store(n(),z+0>>2,1),Me(z+0,2147483647),z=0,Fe(0,0,0),postMessage({cmd:"cancelDone"})},terminateAllThreads:function(){for(var e in Le.pthreads)(s=Le.pthreads[e])&&s.worker&&Le.returnWorkerToPool(s.worker);Le.pthreads={};for(var t=0;t<Le.unusedWorkers.length;++t)(i=Le.unusedWorkers[t]).terminate();for(Le.unusedWorkers=[],t=0;t<Le.runningWorkers.length;++t){var i,s=(i=Le.runningWorkers[t]).pthread;Le.freeThreadData(s),i.terminate()}Le.runningWorkers=[]},freeThreadData:function(e){if(e){if(e.threadInfoStruct){var t=a()[e.threadInfoStruct+104>>2];a()[e.threadInfoStruct+104>>2]=0,is(t),is(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&is(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function(e){delete Le.pthreads[e.pthread.thread],Le.unusedWorkers.push(e),Le.runningWorkers.splice(Le.runningWorkers.indexOf(e),1),Le.freeThreadData(e.pthread),e.pthread=void 0},receiveObjectTransfer:function(e){},loadWasmModuleToWorker:function(e,t){e.onmessage=function(i){var s=i.data,r=s.cmd;if(e.pthread&&(Le.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),s.targetThread&&s.targetThread!=Ui()){var o=Le.pthreads[s.targetThread];return o?o.worker.postMessage(i.data,s.transferList):console.error('Internal error! Worker sent a message "'+r+'" to target pthread '+s.targetThread+", but that thread no longer exists!"),void(Le.currentProxiedOperationCallerThread=void 0)}"processQueuedMainThreadWork"===r?ps():"spawnThread"===r?Gi(i.data):"cleanupThread"===r?function(e){if(v)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cleanupThread!";a()[e+12>>2]=0;var t=Le.pthreads[e];if(t){var i=t.worker;Le.returnWorkerToPool(i)}}(s.thread):"killThread"===r?function(e){if(v)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in killThread!";a()[e+12>>2]=0;var t=Le.pthreads[e];t.worker.terminate(),Le.freeThreadData(t),Le.runningWorkers.splice(Le.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}(s.thread):"cancelThread"===r?function(e){if(v)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cancelThread!";Le.pthreads[e].worker.postMessage({cmd:"cancel"})}(s.thread):"loaded"===r?(e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread)):"print"===r?M("Thread "+s.threadId+": "+s.text):"printErr"===r?A("Thread "+s.threadId+": "+s.text):"alert"===r?alert("Thread "+s.threadId+": "+s.text):"exit"===r?e.pthread&&Atomics.load(n(),e.pthread.thread+68>>2)&&Le.returnWorkerToPool(e):"cancelDone"===r?Le.returnWorkerToPool(e):"objectTransfer"===r?Le.receiveObjectTransfer(i.data):"setimmediate"===i.data.target?e.postMessage(i.data):A("worker sent an unknown command "+r),Le.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){A("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},g&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){}))),e.postMessage({cmd:"load",urlOrBlob:u.mainScriptUrlOrBlob||i,wasmMemory:S,wasmModule:x})},allocateUnusedWorker:function(){var e=w("web-ifc-mt.worker.js");Le.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==Le.unusedWorkers.length&&(Le.allocateUnusedWorker(),Le.loadWasmModuleToWorker(Le.unusedWorkers[0])),Le.unusedWorkers.length>0?Le.unusedWorkers.pop():null},busySpinWait:function(e){for(var t=performance.now()+e;performance.now()<t;);}};u.establishStackSpace=function(e,t){ls(e,t),ns(e)},u.getNoExitRuntime=function(){return F},Ae=g?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:v?function(){return performance.now()-u.__performance_now_clock_drift}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Oe=0,Ne=4,Be=8,ke=12,Ge=13,Ue=16;function Ve(e){this.excPtr=e,this.ptr=e-Ue,this.set_type=function(e){a()[this.ptr+Be>>2]=e},this.get_type=function(){return a()[this.ptr+Be>>2]},this.set_destructor=function(e){a()[this.ptr+Oe>>2]=e},this.get_destructor=function(){return a()[this.ptr+Oe>>2]},this.set_refcount=function(e){a()[this.ptr+Ne>>2]=e},this.set_caught=function(e){e=e?1:0,t()[this.ptr+ke>>0]=e},this.get_caught=function(){return 0!=t()[this.ptr+ke>>0]},this.set_rethrown=function(e){e=e?1:0,t()[this.ptr+Ge>>0]=e},this.get_rethrown=function(){return 0!=t()[this.ptr+Ge>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){Atomics.add(a(),this.ptr+Ne>>2,1)},this.release_ref=function(){return 1===Atomics.sub(a(),this.ptr+Ne>>2,1)}}var He={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var i=0,s=e.length-1;s>=0;s--){var r=e[s];"."===r?e.splice(s,1):".."===r?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(t)for(;i;i--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),i="/"===e.substr(-1);return e=He.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),e||t||(e="."),e&&i&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=He.splitPath(e),i=t[0],s=t[1];return i||s?(s&&(s=s.substr(0,s.length-1)),i+s):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=He.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return He.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return He.normalize(e.join("/"))},join2:function(e,t){return He.normalize(e+"/"+t)}},je={resolve:function(){for(var e="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var s=i>=0?arguments[i]:Xe.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";e=s+"/"+e,t="/"===s.charAt(0)}return e=He.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=je.resolve(e).substr(1),t=je.resolve(t).substr(1);for(var s=i(e.split("/")),r=i(t.split("/")),o=Math.min(s.length,r.length),a=o,n=0;n<o;n++)if(s[n]!==r[n]){a=n;break}var h=[];for(n=a;n<s.length;n++)h.push("..");return(h=h.concat(r.slice(a))).join("/")}},ze={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){ze.ttys[e]={input:[],output:[],ops:t},Xe.registerDevice(e,ze.stream_ops)},stream_ops:{open:function(e){var t=ze.ttys[e.node.rdev];if(!t)throw new Xe.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.get_char)throw new Xe.ErrnoError(60);for(var o=0,a=0;a<s;a++){var n;try{n=e.tty.ops.get_char(e.tty)}catch(e){throw new Xe.ErrnoError(29)}if(void 0===n&&0===o)throw new Xe.ErrnoError(6);if(null==n)break;o++,t[i+a]=n}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.put_char)throw new Xe.ErrnoError(60);try{for(var o=0;o<s;o++)e.tty.ops.put_char(e.tty,t[i+o])}catch(e){throw new Xe.ErrnoError(29)}return s&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(g){var i=Buffer.alloc?Buffer.alloc(256):new Buffer(256),s=0;try{s=P.readSync(process.stdin.fd,i,0,256,null)}catch(e){if(-1==e.toString().indexOf("EOF"))throw e;s=0}t=s>0?i.slice(0,s).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=Qi(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(M(X(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(M(X(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(A(X(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(A(X(e.output,0)),e.output=[])}}};function We(e){for(var i=function(e,t){return t||(t=16),Math.ceil(e/t)*t}(e,16384),s=ts(i);e<i;)t()[s+e++]=0;return s}var $e={ops_table:null,mount:function(e){return $e.createNode(null,"/",16895,0)},createNode:function(e,t,i,s){if(Xe.isBlkdev(i)||Xe.isFIFO(i))throw new Xe.ErrnoError(63);$e.ops_table||($e.ops_table={dir:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr,lookup:$e.node_ops.lookup,mknod:$e.node_ops.mknod,rename:$e.node_ops.rename,unlink:$e.node_ops.unlink,rmdir:$e.node_ops.rmdir,readdir:$e.node_ops.readdir,symlink:$e.node_ops.symlink},stream:{llseek:$e.stream_ops.llseek}},file:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr},stream:{llseek:$e.stream_ops.llseek,read:$e.stream_ops.read,write:$e.stream_ops.write,allocate:$e.stream_ops.allocate,mmap:$e.stream_ops.mmap,msync:$e.stream_ops.msync}},link:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr,readlink:$e.node_ops.readlink},stream:{}},chrdev:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr},stream:Xe.chrdev_stream_ops}});var r=Xe.createNode(e,t,i,s);return Xe.isDir(r.mode)?(r.node_ops=$e.ops_table.dir.node,r.stream_ops=$e.ops_table.dir.stream,r.contents={}):Xe.isFile(r.mode)?(r.node_ops=$e.ops_table.file.node,r.stream_ops=$e.ops_table.file.stream,r.usedBytes=0,r.contents=null):Xe.isLink(r.mode)?(r.node_ops=$e.ops_table.link.node,r.stream_ops=$e.ops_table.link.stream):Xe.isChrdev(r.mode)&&(r.node_ops=$e.ops_table.chrdev.node,r.stream_ops=$e.ops_table.chrdev.stream),r.timestamp=Date.now(),e&&(e.contents[t]=r),r},getFileDataAsRegularArray:function(e){if(e.contents&&e.contents.subarray){for(var t=[],i=0;i<e.usedBytes;++i)t.push(e.contents[i]);return t}return e.contents},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){t>>>=0;var i=e.contents?e.contents.length:0;if(!(i>=t)){t=Math.max(t,i*(i<1048576?2:1.125)>>>0),0!=i&&(t=Math.max(t,256));var s=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(s.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(t>>>=0,e.usedBytes!=t){if(0==t)return e.contents=null,void(e.usedBytes=0);if(!e.contents||e.contents.subarray){var i=e.contents;return e.contents=new Uint8Array(t),i&&e.contents.set(i.subarray(0,Math.min(t,e.usedBytes))),void(e.usedBytes=t)}if(e.contents||(e.contents=[]),e.contents.length>t)e.contents.length=t;else for(;e.contents.length<t;)e.contents.push(0);e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=Xe.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Xe.isDir(e.mode)?t.size=4096:Xe.isFile(e.mode)?t.size=e.usedBytes:Xe.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&$e.resizeFileStorage(e,t.size)},lookup:function(e,t){throw Xe.genericErrors[44]},mknod:function(e,t,i,s){return $e.createNode(e,t,i,s)},rename:function(e,t,i){if(Xe.isDir(e.mode)){var s;try{s=Xe.lookupNode(t,i)}catch(e){}if(s)for(var r in s.contents)throw new Xe.ErrnoError(55)}delete e.parent.contents[e.name],e.name=i,t.contents[i]=e,e.parent=t},unlink:function(e,t){delete e.contents[t]},rmdir:function(e,t){var i=Xe.lookupNode(e,t);for(var s in i.contents)throw new Xe.ErrnoError(55);delete e.contents[t]},readdir:function(e){var t=[".",".."];for(var i in e.contents)e.contents.hasOwnProperty(i)&&t.push(i);return t},symlink:function(e,t,i){var s=$e.createNode(e,t,41471,0);return s.link=i,s},readlink:function(e){if(!Xe.isLink(e.mode))throw new Xe.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,i,s,r){var o=e.node.contents;if(r>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-r,s);if(a>8&&o.subarray)t.set(o.subarray(r,r+a),i);else for(var n=0;n<a;n++)t[i+n]=o[r+n];return a},write:function(e,i,s,r,o,a){if(i.buffer===t().buffer&&(a=!1),!r)return 0;var n=e.node;if(n.timestamp=Date.now(),i.subarray&&(!n.contents||n.contents.subarray)){if(a)return n.contents=i.subarray(s,s+r),n.usedBytes=r,r;if(0===n.usedBytes&&0===o)return n.contents=i.slice(s,s+r),n.usedBytes=r,r;if(o+r<=n.usedBytes)return n.contents.set(i.subarray(s,s+r),o),r}if($e.expandFileStorage(n,o+r),n.contents.subarray&&i.subarray)n.contents.set(i.subarray(s,s+r),o);else for(var h=0;h<r;h++)n.contents[o+h]=i[s+h];return n.usedBytes=Math.max(n.usedBytes,o+r),r},llseek:function(e,t,i){var s=t;if(1===i?s+=e.position:2===i&&Xe.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new Xe.ErrnoError(28);return s},allocate:function(e,t,i){$e.expandFileStorage(e.node,t+i),e.node.usedBytes=Math.max(e.node.usedBytes,t+i)},mmap:function(e,i,s,r,o,a){if($(0===i),!Xe.isFile(e.node.mode))throw new Xe.ErrnoError(43);var n,h,l=e.node.contents;if(2&a||l.buffer!==O){if((r>0||r+s<l.length)&&(l=l.subarray?l.subarray(r,r+s):Array.prototype.slice.call(l,r,r+s)),h=!0,!(n=We(s)))throw new Xe.ErrnoError(48);n>>>=0,t().set(l,n)}else h=!1,n=l.byteOffset;return{ptr:n,allocated:h}},msync:function(e,t,i,s,r){if(!Xe.isFile(e.node.mode))throw new Xe.ErrnoError(43);return 2&r||$e.stream_ops.write(e,t,0,s,i,!1),0}}},Xe={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=je.resolve(Xe.cwd(),e)))return{path:"",node:null};var i={follow_mount:!0,recurse_count:0};for(var s in i)void 0===t[s]&&(t[s]=i[s]);if(t.recurse_count>8)throw new Xe.ErrnoError(32);for(var r=He.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),o=Xe.root,a="/",n=0;n<r.length;n++){var h=n===r.length-1;if(h&&t.parent)break;if(o=Xe.lookupNode(o,r[n]),a=He.join2(a,r[n]),Xe.isMountpoint(o)&&(!h||h&&t.follow_mount)&&(o=o.mounted.root),!h||t.follow)for(var l=0;Xe.isLink(o.mode);){var c=Xe.readlink(a);if(a=je.resolve(He.dirname(a),c),o=Xe.lookupPath(a,{recurse_count:t.recurse_count}).node,l++>40)throw new Xe.ErrnoError(32)}}return{path:a,node:o}},getPath:function(e){for(var t;;){if(Xe.isRoot(e)){var i=e.mount.mountpoint;return t?"/"!==i[i.length-1]?i+"/"+t:i+t:i}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var i=0,s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s)|0;return(e+i>>>0)%Xe.nameTable.length},hashAddNode:function(e){var t=Xe.hashName(e.parent.id,e.name);e.name_next=Xe.nameTable[t],Xe.nameTable[t]=e},hashRemoveNode:function(e){var t=Xe.hashName(e.parent.id,e.name);if(Xe.nameTable[t]===e)Xe.nameTable[t]=e.name_next;else for(var i=Xe.nameTable[t];i;){if(i.name_next===e){i.name_next=e.name_next;break}i=i.name_next}},lookupNode:function(e,t){var i=Xe.mayLookup(e);if(i)throw new Xe.ErrnoError(i,e);for(var s=Xe.hashName(e.id,t),r=Xe.nameTable[s];r;r=r.name_next){var o=r.name;if(r.parent.id===e.id&&o===t)return r}return Xe.lookup(e,t)},createNode:function(e,t,i,s){var r=new Xe.FSNode(e,t,i,s);return Xe.hashAddNode(r),r},destroyNode:function(e){Xe.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=Xe.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return Xe.ignorePermissions||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:2},mayLookup:function(e){var t=Xe.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return Xe.lookupNode(e,t),20}catch(e){}return Xe.nodePermissions(e,"wx")},mayDelete:function(e,t,i){var s;try{s=Xe.lookupNode(e,t)}catch(e){return e.errno}var r=Xe.nodePermissions(e,"wx");if(r)return r;if(i){if(!Xe.isDir(s.mode))return 54;if(Xe.isRoot(s)||Xe.getPath(s)===Xe.cwd())return 10}else if(Xe.isDir(s.mode))return 31;return 0},mayOpen:function(e,t){return e?Xe.isLink(e.mode)?32:Xe.isDir(e.mode)&&("r"!==Xe.flagsToPermissionString(t)||512&t)?31:Xe.nodePermissions(e,Xe.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||Xe.MAX_OPEN_FDS;for(var i=e;i<=t;i++)if(!Xe.streams[i])return i;throw new Xe.ErrnoError(33)},getStream:function(e){return Xe.streams[e]},createStream:function(e,t,i){Xe.FSStream||(Xe.FSStream=function(){},Xe.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var s=new Xe.FSStream;for(var r in e)s[r]=e[r];e=s;var o=Xe.nextfd(t,i);return e.fd=o,Xe.streams[o]=e,e},closeStream:function(e){Xe.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=Xe.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new Xe.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){Xe.devices[e]={stream_ops:t}},getDevice:function(e){return Xe.devices[e]},getMounts:function(e){for(var t=[],i=[e];i.length;){var s=i.pop();t.push(s),i.push.apply(i,s.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),Xe.syncFSRequests++,Xe.syncFSRequests>1&&A("warning: "+Xe.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var i=Xe.getMounts(Xe.root.mount),s=0;function r(e){return Xe.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,r(e));++s>=i.length&&r(null)}i.forEach((function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:function(e,t,i){var s,r="/"===i,o=!i;if(r&&Xe.root)throw new Xe.ErrnoError(10);if(!r&&!o){var a=Xe.lookupPath(i,{follow_mount:!1});if(i=a.path,s=a.node,Xe.isMountpoint(s))throw new Xe.ErrnoError(10);if(!Xe.isDir(s.mode))throw new Xe.ErrnoError(54)}var n={type:e,opts:t,mountpoint:i,mounts:[]},h=e.mount(n);return h.mount=n,n.root=h,r?Xe.root=h:s&&(s.mounted=n,s.mount&&s.mount.mounts.push(n)),h},unmount:function(e){var t=Xe.lookupPath(e,{follow_mount:!1});if(!Xe.isMountpoint(t.node))throw new Xe.ErrnoError(28);var i=t.node,s=i.mounted,r=Xe.getMounts(s);Object.keys(Xe.nameTable).forEach((function(e){for(var t=Xe.nameTable[e];t;){var i=t.name_next;-1!==r.indexOf(t.mount)&&Xe.destroyNode(t),t=i}})),i.mounted=null;var o=i.mount.mounts.indexOf(s);i.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,i){var s=Xe.lookupPath(e,{parent:!0}).node,r=He.basename(e);if(!r||"."===r||".."===r)throw new Xe.ErrnoError(28);var o=Xe.mayCreate(s,r);if(o)throw new Xe.ErrnoError(o);if(!s.node_ops.mknod)throw new Xe.ErrnoError(63);return s.node_ops.mknod(s,r,t,i)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,Xe.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,Xe.mknod(e,t,0)},mkdirTree:function(e,t){for(var i=e.split("/"),s="",r=0;r<i.length;++r)if(i[r]){s+="/"+i[r];try{Xe.mkdir(s,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,i){return void 0===i&&(i=t,t=438),t|=8192,Xe.mknod(e,t,i)},symlink:function(e,t){if(!je.resolve(e))throw new Xe.ErrnoError(44);var i=Xe.lookupPath(t,{parent:!0}).node;if(!i)throw new Xe.ErrnoError(44);var s=He.basename(t),r=Xe.mayCreate(i,s);if(r)throw new Xe.ErrnoError(r);if(!i.node_ops.symlink)throw new Xe.ErrnoError(63);return i.node_ops.symlink(i,s,e)},rename:function(e,t){var i,s,r=He.dirname(e),o=He.dirname(t),a=He.basename(e),n=He.basename(t);if(i=Xe.lookupPath(e,{parent:!0}).node,s=Xe.lookupPath(t,{parent:!0}).node,!i||!s)throw new Xe.ErrnoError(44);if(i.mount!==s.mount)throw new Xe.ErrnoError(75);var h,l=Xe.lookupNode(i,a),c=je.relative(e,o);if("."!==c.charAt(0))throw new Xe.ErrnoError(28);if("."!==(c=je.relative(t,r)).charAt(0))throw new Xe.ErrnoError(55);try{h=Xe.lookupNode(s,n)}catch(e){}if(l!==h){var u=Xe.isDir(l.mode),p=Xe.mayDelete(i,a,u);if(p)throw new Xe.ErrnoError(p);if(p=h?Xe.mayDelete(s,n,u):Xe.mayCreate(s,n))throw new Xe.ErrnoError(p);if(!i.node_ops.rename)throw new Xe.ErrnoError(63);if(Xe.isMountpoint(l)||h&&Xe.isMountpoint(h))throw new Xe.ErrnoError(10);if(s!==i&&(p=Xe.nodePermissions(i,"w")))throw new Xe.ErrnoError(p);try{Xe.trackingDelegate.willMovePath&&Xe.trackingDelegate.willMovePath(e,t)}catch(i){A("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}Xe.hashRemoveNode(l);try{i.node_ops.rename(l,s,n)}catch(e){throw e}finally{Xe.hashAddNode(l)}try{Xe.trackingDelegate.onMovePath&&Xe.trackingDelegate.onMovePath(e,t)}catch(i){A("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}}},rmdir:function(e){var t=Xe.lookupPath(e,{parent:!0}).node,i=He.basename(e),s=Xe.lookupNode(t,i),r=Xe.mayDelete(t,i,!0);if(r)throw new Xe.ErrnoError(r);if(!t.node_ops.rmdir)throw new Xe.ErrnoError(63);if(Xe.isMountpoint(s))throw new Xe.ErrnoError(10);try{Xe.trackingDelegate.willDeletePath&&Xe.trackingDelegate.willDeletePath(e)}catch(t){A("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,i),Xe.destroyNode(s);try{Xe.trackingDelegate.onDeletePath&&Xe.trackingDelegate.onDeletePath(e)}catch(t){A("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=Xe.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new Xe.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=Xe.lookupPath(e,{parent:!0}).node,i=He.basename(e),s=Xe.lookupNode(t,i),r=Xe.mayDelete(t,i,!1);if(r)throw new Xe.ErrnoError(r);if(!t.node_ops.unlink)throw new Xe.ErrnoError(63);if(Xe.isMountpoint(s))throw new Xe.ErrnoError(10);try{Xe.trackingDelegate.willDeletePath&&Xe.trackingDelegate.willDeletePath(e)}catch(t){A("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,i),Xe.destroyNode(s);try{Xe.trackingDelegate.onDeletePath&&Xe.trackingDelegate.onDeletePath(e)}catch(t){A("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=Xe.lookupPath(e).node;if(!t)throw new Xe.ErrnoError(44);if(!t.node_ops.readlink)throw new Xe.ErrnoError(28);return je.resolve(Xe.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var i=Xe.lookupPath(e,{follow:!t}).node;if(!i)throw new Xe.ErrnoError(44);if(!i.node_ops.getattr)throw new Xe.ErrnoError(63);return i.node_ops.getattr(i)},lstat:function(e){return Xe.stat(e,!0)},chmod:function(e,t,i){var s;if(!(s="string"==typeof e?Xe.lookupPath(e,{follow:!i}).node:e).node_ops.setattr)throw new Xe.ErrnoError(63);s.node_ops.setattr(s,{mode:4095&t|-4096&s.mode,timestamp:Date.now()})},lchmod:function(e,t){Xe.chmod(e,t,!0)},fchmod:function(e,t){var i=Xe.getStream(e);if(!i)throw new Xe.ErrnoError(8);Xe.chmod(i.node,t)},chown:function(e,t,i,s){var r;if(!(r="string"==typeof e?Xe.lookupPath(e,{follow:!s}).node:e).node_ops.setattr)throw new Xe.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(e,t,i){Xe.chown(e,t,i,!0)},fchown:function(e,t,i){var s=Xe.getStream(e);if(!s)throw new Xe.ErrnoError(8);Xe.chown(s.node,t,i)},truncate:function(e,t){if(t<0)throw new Xe.ErrnoError(28);var i;if(!(i="string"==typeof e?Xe.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new Xe.ErrnoError(63);if(Xe.isDir(i.mode))throw new Xe.ErrnoError(31);if(!Xe.isFile(i.mode))throw new Xe.ErrnoError(28);var s=Xe.nodePermissions(i,"w");if(s)throw new Xe.ErrnoError(s);i.node_ops.setattr(i,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var i=Xe.getStream(e);if(!i)throw new Xe.ErrnoError(8);if(0==(2097155&i.flags))throw new Xe.ErrnoError(28);Xe.truncate(i.node,t)},utime:function(e,t,i){var s=Xe.lookupPath(e,{follow:!0}).node;s.node_ops.setattr(s,{timestamp:Math.max(t,i)})},open:function(e,t,i,s,r){if(""===e)throw new Xe.ErrnoError(44);var o;if(i=void 0===i?438:i,i=64&(t="string"==typeof t?Xe.modeStringToFlags(t):t)?4095&i|32768:0,"object"==typeof e)o=e;else{e=He.normalize(e);try{o=Xe.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var a=!1;if(64&t)if(o){if(128&t)throw new Xe.ErrnoError(20)}else o=Xe.mknod(e,i,0),a=!0;if(!o)throw new Xe.ErrnoError(44);if(Xe.isChrdev(o.mode)&&(t&=-513),65536&t&&!Xe.isDir(o.mode))throw new Xe.ErrnoError(54);if(!a){var n=Xe.mayOpen(o,t);if(n)throw new Xe.ErrnoError(n)}512&t&&Xe.truncate(o,0),t&=-131713;var h=Xe.createStream({node:o,path:Xe.getPath(o),flags:t,seekable:!0,position:0,stream_ops:o.stream_ops,ungotten:[],error:!1},s,r);h.stream_ops.open&&h.stream_ops.open(h),!u.logReadFiles||1&t||(Xe.readFiles||(Xe.readFiles={}),e in Xe.readFiles||(Xe.readFiles[e]=1,A("FS.trackingDelegate error on read file: "+e)));try{if(Xe.trackingDelegate.onOpenFile){var l=0;1!=(2097155&t)&&(l|=Xe.tracking.openFlags.READ),0!=(2097155&t)&&(l|=Xe.tracking.openFlags.WRITE),Xe.trackingDelegate.onOpenFile(e,l)}}catch(t){A("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return h},close:function(e){if(Xe.isClosed(e))throw new Xe.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{Xe.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,i){if(Xe.isClosed(e))throw new Xe.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new Xe.ErrnoError(70);if(0!=i&&1!=i&&2!=i)throw new Xe.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,i),e.ungotten=[],e.position},read:function(e,t,i,s,r){if(i>>>=0,s<0||r<0)throw new Xe.ErrnoError(28);if(Xe.isClosed(e))throw new Xe.ErrnoError(8);if(1==(2097155&e.flags))throw new Xe.ErrnoError(8);if(Xe.isDir(e.node.mode))throw new Xe.ErrnoError(31);if(!e.stream_ops.read)throw new Xe.ErrnoError(28);var o=void 0!==r;if(o){if(!e.seekable)throw new Xe.ErrnoError(70)}else r=e.position;var a=e.stream_ops.read(e,t,i,s,r);return o||(e.position+=a),a},write:function(e,t,i,s,r,o){if(i>>>=0,s<0||r<0)throw new Xe.ErrnoError(28);if(Xe.isClosed(e))throw new Xe.ErrnoError(8);if(0==(2097155&e.flags))throw new Xe.ErrnoError(8);if(Xe.isDir(e.node.mode))throw new Xe.ErrnoError(31);if(!e.stream_ops.write)throw new Xe.ErrnoError(28);e.seekable&&1024&e.flags&&Xe.llseek(e,0,2);var a=void 0!==r;if(a){if(!e.seekable)throw new Xe.ErrnoError(70)}else r=e.position;var n=e.stream_ops.write(e,t,i,s,r,o);a||(e.position+=n);try{e.path&&Xe.trackingDelegate.onWriteToFile&&Xe.trackingDelegate.onWriteToFile(e.path)}catch(t){A("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return n},allocate:function(e,t,i){if(Xe.isClosed(e))throw new Xe.ErrnoError(8);if(t<0||i<=0)throw new Xe.ErrnoError(28);if(0==(2097155&e.flags))throw new Xe.ErrnoError(8);if(!Xe.isFile(e.node.mode)&&!Xe.isDir(e.node.mode))throw new Xe.ErrnoError(43);if(!e.stream_ops.allocate)throw new Xe.ErrnoError(138);e.stream_ops.allocate(e,t,i)},mmap:function(e,t,i,s,r,o){if(t>>>=0,0!=(2&r)&&0==(2&o)&&2!=(2097155&e.flags))throw new Xe.ErrnoError(2);if(1==(2097155&e.flags))throw new Xe.ErrnoError(2);if(!e.stream_ops.mmap)throw new Xe.ErrnoError(43);return e.stream_ops.mmap(e,t,i,s,r,o)},msync:function(e,t,i,s,r){return i>>>=0,e&&e.stream_ops.msync?e.stream_ops.msync(e,t,i,s,r):0},munmap:function(e){return 0},ioctl:function(e,t,i){if(!e.stream_ops.ioctl)throw new Xe.ErrnoError(59);return e.stream_ops.ioctl(e,t,i)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var i,s=Xe.open(e,t.flags),r=Xe.stat(e).size,o=new Uint8Array(r);return Xe.read(s,o,0,r,0),"utf8"===t.encoding?i=X(o,0):"binary"===t.encoding&&(i=o),Xe.close(s),i},writeFile:function(e,t,i){(i=i||{}).flags=i.flags||577;var s=Xe.open(e,i.flags,i.mode);if("string"==typeof t){var r=new Uint8Array(Z(t)+1),o=K(t,r,0,r.length);Xe.write(s,r,0,o,void 0,i.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");Xe.write(s,t,0,t.byteLength,void 0,i.canOwn)}Xe.close(s)},cwd:function(){return Xe.currentPath},chdir:function(e){var t=Xe.lookupPath(e,{follow:!0});if(null===t.node)throw new Xe.ErrnoError(44);if(!Xe.isDir(t.node.mode))throw new Xe.ErrnoError(54);var i=Xe.nodePermissions(t.node,"x");if(i)throw new Xe.ErrnoError(i);Xe.currentPath=t.path},createDefaultDirectories:function(){Xe.mkdir("/tmp"),Xe.mkdir("/home"),Xe.mkdir("/home/web_user")},createDefaultDevices:function(){Xe.mkdir("/dev"),Xe.registerDevice(Xe.makedev(1,3),{read:function(){return 0},write:function(e,t,i,s,r){return s}}),Xe.mkdev("/dev/null",Xe.makedev(1,3)),ze.register(Xe.makedev(5,0),ze.default_tty_ops),ze.register(Xe.makedev(6,0),ze.default_tty1_ops),Xe.mkdev("/dev/tty",Xe.makedev(5,0)),Xe.mkdev("/dev/tty1",Xe.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(g)try{var t=require_crypto();return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){fe("randomDevice")}}();Xe.createDevice("/dev","random",e),Xe.createDevice("/dev","urandom",e),Xe.mkdir("/dev/shm"),Xe.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){Xe.mkdir("/proc"),Xe.mkdir("/proc/self"),Xe.mkdir("/proc/self/fd"),Xe.mount({mount:function(){var e=Xe.createNode("/proc/self","fd",16895,73);return e.node_ops={lookup:function(e,t){var i=+t,s=Xe.getStream(i);if(!s)throw new Xe.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return s.path}}};return r.parent=r,r}},e}},{},"/proc/self/fd")},createStandardStreams:function(){u.stdin?Xe.createDevice("/dev","stdin",u.stdin):Xe.symlink("/dev/tty","/dev/stdin"),u.stdout?Xe.createDevice("/dev","stdout",null,u.stdout):Xe.symlink("/dev/tty","/dev/stdout"),u.stderr?Xe.createDevice("/dev","stderr",null,u.stderr):Xe.symlink("/dev/tty1","/dev/stderr"),Xe.open("/dev/stdin",0),Xe.open("/dev/stdout",1),Xe.open("/dev/stderr",1)},ensureErrnoError:function(){Xe.ErrnoError||(Xe.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},Xe.ErrnoError.prototype=new Error,Xe.ErrnoError.prototype.constructor=Xe.ErrnoError,[44].forEach((function(e){Xe.genericErrors[e]=new Xe.ErrnoError(e),Xe.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){Xe.ensureErrnoError(),Xe.nameTable=new Array(4096),Xe.mount($e,{},"/"),Xe.createDefaultDirectories(),Xe.createDefaultDevices(),Xe.createSpecialDirectories(),Xe.filesystems={MEMFS:$e}},init:function(e,t,i){Xe.init.initialized=!0,Xe.ensureErrnoError(),u.stdin=e||u.stdin,u.stdout=t||u.stdout,u.stderr=i||u.stderr,Xe.createStandardStreams()},quit:function(){Xe.init.initialized=!1;var e=u._fflush;e&&e(0);for(var t=0;t<Xe.streams.length;t++){var i=Xe.streams[t];i&&Xe.close(i)}},getMode:function(e,t){var i=0;return e&&(i|=365),t&&(i|=146),i},findObject:function(e,t){var i=Xe.analyzePath(e,t);return i.exists?i.object:null},analyzePath:function(e,t){try{e=(s=Xe.lookupPath(e,{follow:!t})).path}catch(e){}var i={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var s=Xe.lookupPath(e,{parent:!0});i.parentExists=!0,i.parentPath=s.path,i.parentObject=s.node,i.name=He.basename(e),s=Xe.lookupPath(e,{follow:!t}),i.exists=!0,i.path=s.path,i.object=s.node,i.name=s.node.name,i.isRoot="/"===s.path}catch(e){i.error=e.errno}return i},createPath:function(e,t,i,s){e="string"==typeof e?e:Xe.getPath(e);for(var r=t.split("/").reverse();r.length;){var o=r.pop();if(o){var a=He.join2(e,o);try{Xe.mkdir(a)}catch(e){}e=a}}return a},createFile:function(e,t,i,s,r){var o=He.join2("string"==typeof e?e:Xe.getPath(e),t),a=Xe.getMode(s,r);return Xe.create(o,a)},createDataFile:function(e,t,i,s,r,o){var a=t?He.join2("string"==typeof e?e:Xe.getPath(e),t):e,n=Xe.getMode(s,r),h=Xe.create(a,n);if(i){if("string"==typeof i){for(var l=new Array(i.length),c=0,u=i.length;c<u;++c)l[c]=i.charCodeAt(c);i=l}Xe.chmod(h,146|n);var p=Xe.open(h,577);Xe.write(p,i,0,i.length,0,o),Xe.close(p),Xe.chmod(h,n)}return h},createDevice:function(e,t,i,s){var r=He.join2("string"==typeof e?e:Xe.getPath(e),t),o=Xe.getMode(!!i,!!s);Xe.createDevice.major||(Xe.createDevice.major=64);var a=Xe.makedev(Xe.createDevice.major++,0);return Xe.registerDevice(a,{open:function(e){e.seekable=!1},close:function(e){s&&s.buffer&&s.buffer.length&&s(10)},read:function(e,t,s,r,o){for(var a=0,n=0;n<r;n++){var h;try{h=i()}catch(e){throw new Xe.ErrnoError(29)}if(void 0===h&&0===a)throw new Xe.ErrnoError(6);if(null==h)break;a++,t[s+n]=h}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,i,r,o){for(var a=0;a<r;a++)try{s(t[i+a])}catch(e){throw new Xe.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),a}}),Xe.mkdev(r,o,a)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!I)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=Qi(I(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new Xe.ErrnoError(29)}},createLazyFile:function(e,t,i,s,r){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.getter(i)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",i,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+i+". Status: "+e.status);var t,s=Number(e.getResponseHeader("Content-length")),r=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;r||(a=s);var n=this;n.setDataGetter((function(e){var t=e*a,r=(e+1)*a-1;if(r=Math.min(r,s-1),void 0===n.chunks[e]&&(n.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>s-1)throw new Error("only "+s+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",i,!1),s!==a&&r.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+i+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):Qi(r.responseText||"",!0)}(t,r)),void 0===n.chunks[e])throw new Error("doXHR failed!");return n.chunks[e]})),!o&&s||(a=s=1,s=this.getter(0).length,a=s,M("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=s,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new o;Object.defineProperties(a,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var n={isDevice:!1,contents:a}}else n={isDevice:!1,url:i};var h=Xe.createFile(e,t,n,s,r);n.contents?h.contents=n.contents:n.url&&(h.contents=null,h.url=n.url),Object.defineProperties(h,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(h.stream_ops).forEach((function(e){var t=h.stream_ops[e];l[e]=function(){return Xe.forceLoadFile(h),t.apply(null,arguments)}})),l.read=function(e,t,i,s,r){Xe.forceLoadFile(h);var o=e.node.contents;if(r>=o.length)return 0;var a=Math.min(o.length-r,s);if(o.slice)for(var n=0;n<a;n++)t[i+n]=o[r+n];else for(n=0;n<a;n++)t[i+n]=o.get(r+n);return a},h.stream_ops=l,h},createPreloadedFile:function(e,t,i,s,r,o,a,n,h,l){Browser.init();var c=t?je.resolve(He.join2(e,t)):e;function p(i){function p(i){l&&l(),n||Xe.createDataFile(e,t,i,s,r,h),o&&o(),me()}var d=!1;u.preloadPlugins.forEach((function(e){d||e.canHandle(c)&&(e.handle(i,c,p,(function(){a&&a(),me()})),d=!0)})),d||p(i)}de(),"string"==typeof i?Browser.asyncLoad(i,(function(e){p(e)}),a):p(i)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=Xe.indexedDB();try{var r=s.open(Xe.DB_NAME(),Xe.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=function(){M("creating db"),r.result.createObjectStore(Xe.DB_STORE_NAME)},r.onsuccess=function(){var s=r.result.transaction([Xe.DB_STORE_NAME],"readwrite"),o=s.objectStore(Xe.DB_STORE_NAME),a=0,n=0,h=e.length;function l(){0==n?t():i()}e.forEach((function(e){var t=o.put(Xe.analyzePath(e).object.contents,e);t.onsuccess=function(){++a+n==h&&l()},t.onerror=function(){n++,a+n==h&&l()}})),s.onerror=i},r.onerror=i},loadFilesFromDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=Xe.indexedDB();try{var r=s.open(Xe.DB_NAME(),Xe.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=i,r.onsuccess=function(){var s=r.result;try{var o=s.transaction([Xe.DB_STORE_NAME],"readonly")}catch(e){return void i(e)}var a=o.objectStore(Xe.DB_STORE_NAME),n=0,h=0,l=e.length;function c(){0==h?t():i()}e.forEach((function(e){var t=a.get(e);t.onsuccess=function(){Xe.analyzePath(e).exists&&Xe.unlink(e),Xe.createDataFile(He.dirname(e),He.basename(e),t.result,!0,!0,!0),++n+h==l&&c()},t.onerror=function(){h++,n+h==l&&c()}})),o.onerror=i},r.onerror=i}},Ye={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t){if("/"!==t[0]){var i;if(-100===e)i=Xe.cwd();else{var s=Xe.getStream(e);if(!s)throw new Xe.ErrnoError(8);i=s.path}t=He.join2(i,t)}return t},doStat:function(e,t,i){try{var s=e(t)}catch(e){if(e&&e.node&&He.normalize(t)!==He.normalize(Xe.getPath(e.node)))return-54;throw e}return a()[i>>2]=s.dev,a()[i+4>>2]=0,a()[i+8>>2]=s.ino,a()[i+12>>2]=s.mode,a()[i+16>>2]=s.nlink,a()[i+20>>2]=s.uid,a()[i+24>>2]=s.gid,a()[i+28>>2]=s.rdev,a()[i+32>>2]=0,ve=[s.size>>>0,(Te=s.size,+Math.abs(Te)>=1?Te>0?(0|Math.min(+Math.floor(Te/4294967296),4294967295))>>>0:~~+Math.ceil((Te-+(~~Te>>>0))/4294967296)>>>0:0)],a()[i+40>>2]=ve[0],a()[i+44>>2]=ve[1],a()[i+48>>2]=4096,a()[i+52>>2]=s.blocks,a()[i+56>>2]=s.atime.getTime()/1e3|0,a()[i+60>>2]=0,a()[i+64>>2]=s.mtime.getTime()/1e3|0,a()[i+68>>2]=0,a()[i+72>>2]=s.ctime.getTime()/1e3|0,a()[i+76>>2]=0,ve=[s.ino>>>0,(Te=s.ino,+Math.abs(Te)>=1?Te>0?(0|Math.min(+Math.floor(Te/4294967296),4294967295))>>>0:~~+Math.ceil((Te-+(~~Te>>>0))/4294967296)>>>0:0)],a()[i+80>>2]=ve[0],a()[i+84>>2]=ve[1],0},doMsync:function(e,t,i,r,o){var a=s().slice(e,e+i);Xe.msync(t,a,o,i,r)},doMkdir:function(e,t){return"/"===(e=He.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),Xe.mkdir(e,t,0),0},doMknod:function(e,t,i){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return Xe.mknod(e,t,i),0},doReadlink:function(e,i,s){if(s<=0)return-28;var r=Xe.readlink(e),o=Math.min(s,Z(r)),a=t()[i+o];return q(r,i,s+1),t()[i+o]=a,o},doAccess:function(e,t){if(-8&t)return-28;var i;if(!(i=Xe.lookupPath(e,{follow:!0}).node))return-44;var s="";return 4&t&&(s+="r"),2&t&&(s+="w"),1&t&&(s+="x"),s&&Xe.nodePermissions(i,s)?-2:0},doDup:function(e,t,i){var s=Xe.getStream(i);return s&&Xe.close(s),Xe.open(e,t,0,i,i).fd},doReadv:function(e,i,s,r){for(var o=0,n=0;n<s;n++){var h=a()[i+8*n>>2],l=a()[i+(8*n+4)>>2],c=Xe.read(e,t(),h,l,r);if(c<0)return-1;if(o+=c,c<l)break}return o},doWritev:function(e,i,s,r){for(var o=0,n=0;n<s;n++){var h=a()[i+8*n>>2],l=a()[i+(8*n+4)>>2],c=Xe.write(e,t(),h,l,r);if(c<0)return-1;o+=c}return o},varargs:void 0,get:function(){return Ye.varargs+=4,a()[Ye.varargs-4>>2]},getStr:function(e){return Y(e)},getStreamFromFD:function(e){var t=Xe.getStream(e);if(!t)throw new Xe.ErrnoError(8);return t},get64:function(e,t){return e}};function Ke(e,t,i){if(v)return yi(2,1,e,t,i);Ye.varargs=i;try{var s=Ye.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return s.tty?0:-59;case 21519:if(!s.tty)return-59;var r=Ye.get();return a()[r>>2]=0,0;case 21520:return s.tty?-28:-59;case 21531:return r=Ye.get(),Xe.ioctl(s,t,r);default:fe("bad ioctl syscall "+t)}}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),-e.errno}}function qe(e,t,i){if(v)return yi(3,1,e,t,i);Ye.varargs=i;try{var s=Ye.getStr(e),r=Ye.get();return Xe.open(s,t,r).fd}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),-e.errno}}var Ze={};function Qe(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function Je(e){return this.fromWireType(n()[e>>2])}var et={},tt={},it={};function st(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function rt(e,t){return e=st(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ot(e,t){var i=rt(t,(function(e){this.name=t,this.message=e;var i=new Error(e).stack;void 0!==i&&(this.stack=this.toString()+"\n"+i.replace(/^Error(:[^\n]*)?\n/,""))}));return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},i}var at=void 0;function nt(e){throw new at(e)}function ht(e,t,i){function s(t){var s=i(t);s.length!==e.length&&nt("Mismatched type converter count");for(var r=0;r<e.length;++r)ft(e[r],s[r])}e.forEach((function(e){it[e]=t}));var r=new Array(t.length),o=[],a=0;t.forEach((function(e,t){tt.hasOwnProperty(e)?r[t]=tt[e]:(o.push(e),et.hasOwnProperty(e)||(et[e]=[]),et[e].push((function(){r[t]=tt[e],++a===o.length&&s(r)})))})),0===o.length&&s(r)}var lt={};function ct(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var ut=void 0;function pt(e){for(var t="",i=e;s()[i];)t+=ut[s()[i++]];return t}var dt=void 0;function mt(e){throw new dt(e)}function ft(e,t,i){if(i=i||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var s=t.name;if(e||mt('type "'+s+'" must have a positive integer typeid pointer'),tt.hasOwnProperty(e)){if(i.ignoreDuplicateRegistrations)return;mt("Cannot register type '"+s+"' twice")}if(tt[e]=t,delete it[e],et.hasOwnProperty(e)){var r=et[e];delete et[e],r.forEach((function(e){e()}))}}function gt(e){if(!(this instanceof Ft))return!1;if(!(e instanceof Ft))return!1;for(var t=this.$$.ptrType.registeredClass,i=this.$$.ptr,s=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)i=t.upcast(i),t=t.baseClass;for(;s.baseClass;)r=s.upcast(r),s=s.baseClass;return t===s&&i===r}function _t(e){mt(e.$$.ptrType.registeredClass.name+" instance already deleted")}var yt=!1;function Tt(e){}function vt(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function It(e){return"undefined"==typeof FinalizationGroup?(It=function(e){return e},e):(yt=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var i=t.value;i.ptr?vt(i):console.warn("object already deleted: "+i.ptr)}})),Tt=function(e){yt.unregister(e.$$)},(It=function(e){return yt.register(e,e.$$,e.$$),e})(e))}function Et(){if(this.$$.ptr||_t(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=It(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function Pt(){this.$$.ptr||_t(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&mt("Object already scheduled for deletion"),Tt(this),vt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function bt(){return!this.$$.ptr}var Dt=void 0,wt=[];function Ct(){for(;wt.length;){var e=wt.pop();e.$$.deleteScheduled=!1,e.delete()}}function Rt(){return this.$$.ptr||_t(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&mt("Object already scheduled for deletion"),wt.push(this),1===wt.length&&Dt&&Dt(Ct),this.$$.deleteScheduled=!0,this}function Ft(){}var St={};function xt(e,t,i){if(void 0===e[t].overloadTable){var s=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||mt("Function '"+i+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[s.argCount]=s}}function Mt(e,t,i){u.hasOwnProperty(e)?((void 0===i||void 0!==u[e].overloadTable&&void 0!==u[e].overloadTable[i])&&mt("Cannot register public name '"+e+"' twice"),xt(u,e,e),u.hasOwnProperty(i)&&mt("Cannot register multiple overloads of a function with the same number of arguments ("+i+")!"),u[e].overloadTable[i]=t):(u[e]=t,void 0!==i&&(u[e].numArguments=i))}function At(e,t,i,s,r,o,a,n){this.name=e,this.constructor=t,this.instancePrototype=i,this.rawDestructor=s,this.baseClass=r,this.getActualType=o,this.upcast=a,this.downcast=n,this.pureVirtualFunctions=[]}function Lt(e,t,i){for(;t!==i;)t.upcast||mt("Expected null or instance of "+i.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Ot(e,t){if(null===t)return this.isReference&&mt("null is not a valid "+this.name),0;t.$$||mt('Cannot pass "'+ui(t)+'" as a '+this.name),t.$$.ptr||mt("Cannot pass deleted object as a pointer of type "+this.name);var i=t.$$.ptrType.registeredClass;return Lt(t.$$.ptr,i,this.registeredClass)}function Nt(e,t){var i;if(null===t)return this.isReference&&mt("null is not a valid "+this.name),this.isSmartPointer?(i=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,i),i):0;t.$$||mt('Cannot pass "'+ui(t)+'" as a '+this.name),t.$$.ptr||mt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&mt("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;if(i=Lt(t.$$.ptr,s,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&mt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?i=t.$$.smartPtr:mt("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:i=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)i=t.$$.smartPtr;else{var r=t.clone();i=this.rawShare(i,hi((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,i)}break;default:mt("Unsupporting sharing policy")}return i}function Bt(e,t){if(null===t)return this.isReference&&mt("null is not a valid "+this.name),0;t.$$||mt('Cannot pass "'+ui(t)+'" as a '+this.name),t.$$.ptr||mt("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&mt("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;return Lt(t.$$.ptr,i,this.registeredClass)}function kt(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Gt(e){this.rawDestructor&&this.rawDestructor(e)}function Ut(e){null!==e&&e.delete()}function Vt(e,t,i){if(t===i)return e;if(void 0===i.baseClass)return null;var s=Vt(e,t,i.baseClass);return null===s?null:i.downcast(s)}function Ht(){return Object.keys(Wt).length}function jt(){var e=[];for(var t in Wt)Wt.hasOwnProperty(t)&&e.push(Wt[t]);return e}function zt(e){Dt=e,wt.length&&Dt&&Dt(Ct)}var Wt={};function $t(e,t){return t=function(e,t){for(void 0===t&&mt("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),Wt[t]}function Xt(e,t){return t.ptrType&&t.ptr||nt("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&nt("Both smartPtrType and smartPtr must be specified"),t.count={value:1},It(Object.create(e,{$$:{value:t}}))}function Yt(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var i=$t(this.registeredClass,t);if(void 0!==i){if(0===i.$$.count.value)return i.$$.ptr=t,i.$$.smartPtr=e,i.clone();var s=i.clone();return this.destructor(e),s}function r(){return this.isSmartPointer?Xt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Xt(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,a=this.registeredClass.getActualType(t),n=St[a];if(!n)return r.call(this);o=this.isConst?n.constPointerType:n.pointerType;var h=Vt(t,this.registeredClass,o.registeredClass);return null===h?r.call(this):this.isSmartPointer?Xt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h,smartPtrType:this,smartPtr:e}):Xt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h})}function Kt(e,t,i,s,r,o,a,n,h,l,c){this.name=e,this.registeredClass=t,this.isReference=i,this.isConst=s,this.isSmartPointer=r,this.pointeeType=o,this.sharingPolicy=a,this.rawGetPointee=n,this.rawConstructor=h,this.rawShare=l,this.rawDestructor=c,r||void 0!==t.baseClass?this.toWireType=Nt:s?(this.toWireType=Ot,this.destructorFunction=null):(this.toWireType=Bt,this.destructorFunction=null)}function qt(e,t,i){u.hasOwnProperty(e)||nt("Replacing nonexistant public symbol"),void 0!==u[e].overloadTable&&void 0!==i?u[e].overloadTable[i]=t:(u[e]=t,u[e].argCount=i)}function Zt(e,t){var i=-1!=(e=pt(e)).indexOf("j")?function(e,t){$(e.indexOf("j")>=0,"getDynCaller should only be called with i64 sigs");var i=[];return function(){i.length=arguments.length;for(var s=0;s<arguments.length;s++)i[s]=arguments[s];return De(e,t,i)}}(e,t):oe.get(t);return"function"!=typeof i&&mt("unknown function pointer with signature "+e+": "+t),i}var Qt=void 0;function Jt(e){var t=ss(e),i=pt(t);return is(t),i}function ei(e,t){var i=[],s={};throw t.forEach((function e(t){s[t]||tt[t]||(it[t]?it[t].forEach(e):(i.push(t),s[t]=!0))})),new Qt(e+": "+i.map(Jt).join([", "]))}function ti(e,t){for(var i=[],s=0;s<e;s++)i.push(a()[(t>>2)+s]);return i}function ii(e,t,i,s,r){var o=t.length;o<2&&mt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==i,n=!1,h=1;h<t.length;++h)if(null!==t[h]&&void 0===t[h].destructorFunction){n=!0;break}var l="void"!==t[0].name,c="",u="";for(h=0;h<o-2;++h)c+=(0!==h?", ":"")+"arg"+h,u+=(0!==h?", ":"")+"arg"+h+"Wired";var p="return function "+st(e)+"("+c+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";n&&(p+="var destructors = [];\n");var d=n?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[mt,s,r,Qe,t[0],t[1]];for(a&&(p+="var thisWired = classParam.toWireType("+d+", this);\n"),h=0;h<o-2;++h)p+="var arg"+h+"Wired = argType"+h+".toWireType("+d+", arg"+h+"); // "+t[h+2].name+"\n",m.push("argType"+h),f.push(t[h+2]);if(a&&(u="thisWired"+(u.length>0?", ":"")+u),p+=(l?"var rv = ":"")+"invoker(fn"+(u.length>0?", ":"")+u+");\n",n)p+="runDestructors(destructors);\n";else for(h=a?1:2;h<t.length;++h){var g=1===h?"thisWired":"arg"+(h-2)+"Wired";null!==t[h].destructorFunction&&(p+=g+"_dtor("+g+"); // "+t[h].name+"\n",m.push(g+"_dtor"),f.push(t[h].destructorFunction))}return l&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",m.push(p),function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var i=rt(e.name||"unknownFunctionName",(function(){}));i.prototype=e.prototype;var s=new i,r=e.apply(s,t);return r instanceof Object?r:s}(Function,m).apply(null,f)}var si=[],ri=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function oi(e){e>4&&0==--ri[e].refcount&&(ri[e]=void 0,si.push(e))}function ai(){for(var e=0,t=5;t<ri.length;++t)void 0!==ri[t]&&++e;return e}function ni(){for(var e=5;e<ri.length;++e)if(void 0!==ri[e])return ri[e];return null}function hi(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=si.length?si.pop():ri.length;return ri[t]={refcount:1,value:e},t}}function li(e,i,h){switch(i){case 0:return function(e){var i=h?t():s();return this.fromWireType(i[e>>>0])};case 1:return function(e){var t=h?r():o();return this.fromWireType(t[e>>>1])};case 2:return function(e){var t=h?a():n();return this.fromWireType(t[e>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function ci(e,t){var i=tt[e];return void 0===i&&mt(t+" has unknown type "+Jt(e)),i}function ui(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function pi(e,t){switch(t){case 2:return function(e){return this.fromWireType((S.buffer!=O&&re(S.buffer),H)[e>>2])};case 3:return function(e){return this.fromWireType(h()[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function di(e,i,h){switch(i){case 0:return h?function(e){return t()[e]}:function(e){return s()[e]};case 1:return h?function(e){return r()[e>>1]}:function(e){return o()[e>>1]};case 2:return h?function(e){return a()[e>>2]}:function(e){return n()[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function mi(e){return e||mt("Cannot use deleted val. handle = "+e),ri[e].value}var fi={};function gi(e){var t=fi[e];return void 0===t?pt(e):t}function _i(){return"object"==typeof globalThis?globalThis:Function("return this")()}function yi(e,t){for(var i=arguments.length-2,s=as(),r=hs(8*i),o=r>>3,a=0;a<i;a++)h()[o+a]=arguments[2+a];var n=gs(e,i,r,t);return ns(s),n}var Ti=[],vi=[];function Ii(e){try{return S.grow(e-O.byteLength+65535>>>16),re(S.buffer),1}catch(e){}}var Ei={inEventHandler:0,removeAllEventListeners:function(){for(var e=Ei.eventHandlers.length-1;e>=0;--e)Ei._removeHandler(e);Ei.eventHandlers=[],Ei.deferredCalls=[]},registerRemoveEventListeners:function(){Ei.removeEventListenersRegistered||(Ei.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,i){function s(e,t){if(e.length!=t.length)return!1;for(var i in e)if(e[i]!=t[i])return!1;return!0}for(var r in Ei.deferredCalls){var o=Ei.deferredCalls[r];if(o.targetFunction==e&&s(o.argsList,i))return}Ei.deferredCalls.push({targetFunction:e,precedence:t,argsList:i}),Ei.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<Ei.deferredCalls.length;++t)Ei.deferredCalls[t].targetFunction==e&&(Ei.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return Ei.inEventHandler&&Ei.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(Ei.canPerformEventHandlerRequests())for(var e=0;e<Ei.deferredCalls.length;++e){var t=Ei.deferredCalls[e];Ei.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var i=0;i<Ei.eventHandlers.length;++i)Ei.eventHandlers[i].target!=e||t&&t!=Ei.eventHandlers[i].eventTypeString||Ei._removeHandler(i--)},_removeHandler:function(e){var t=Ei.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),Ei.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++Ei.inEventHandler,Ei.currentEventHandler=e,Ei.runDeferredCalls(),e.handlerFunc(t),Ei.runDeferredCalls(),--Ei.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),Ei.eventHandlers.push(e),Ei.registerRemoveEventListeners();else for(var i=0;i<Ei.eventHandlers.length;++i)Ei.eventHandlers[i].target==e.target&&Ei.eventHandlers[i].eventTypeString==e.eventTypeString&&Ei._removeHandler(i--)},queueEventHandlerOnThread_iiii:function(e,t,i,s,r){var o=as(),n=hs(12);a()[n>>2]=i,a()[n+4>>2]=s,a()[n+8>>2]=r,_s(0,e,637534208,t,s,n),ns(o)},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return Le.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function Pi(e,t,i,s){var r,o,n,h=as(),l=hs(12),c=0;t&&(o=Z(r=t)+1,n=ts(o),q(r,n,o),c=n),a()[l>>2]=c,a()[l+4>>2]=i,a()[l+8>>2]=s,_s(0,e,657457152,0,c,l),ns(h)}var bi=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function Di(e){var t;return e=(t=e)>2?Y(t):t,bi[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function wi(e){return Di(e)}function Ci(e,t,i){var s=wi(e);if(!s)return-4;if(s.canvasSharedPtr&&(a()[s.canvasSharedPtr>>2]=t,a()[s.canvasSharedPtr+4>>2]=i),!s.offscreenCanvas&&s.controlTransferredOffscreen)return s.canvasSharedPtr?(function(e,t,i,s){Pi(e,t=t?Y(t):"",i,s)}(a()[s.canvasSharedPtr+8>>2],e,t,i),1):-4;s.offscreenCanvas&&(s=s.offscreenCanvas);var r=!1;if(s.GLctxObject&&s.GLctxObject.GLctx){var o=s.GLctxObject.GLctx.getParameter(2978);r=0===o[0]&&0===o[1]&&o[2]===s.width&&o[3]===s.height}return s.width=t,s.height=i,r&&s.GLctxObject.GLctx.viewport(0,0,t,i),0}function Ri(e,t,i){return v?yi(4,1,e,t,i):Ci(e,t,i)}var Fi={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},timerQueriesEXT:[],programInfos:{},stringCache:{},unpackAlignment:4,recordError:function(e){Fi.lastError||(Fi.lastError=e)},getNewId:function(e){for(var t=Fi.counter++,i=e.length;i<t;i++)e[i]=null;return t},getSource:function(e,t,i,s){for(var r="",o=0;o<t;++o){var n=s?a()[s+4*o>>2]:-1;r+=Y(a()[i+4*o>>2],n<0?void 0:n)}return r},createContext:function(e,t){var i=e.getContext("webgl",t);return i?Fi.registerContext(i,t):0},registerContext:function(e,t){var i=ts(8);a()[i+4>>2]=Ui();var s={handle:i,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=s),Fi.contexts[i]=s,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&Fi.initExtensions(s),i},makeContextCurrent:function(e){return Fi.currentContext=Fi.contexts[e],u.ctx=Xi=Fi.currentContext&&Fi.currentContext.GLctx,!(e&&!Xi)},getContext:function(e){return Fi.contexts[e]},deleteContext:function(e){Fi.currentContext===Fi.contexts[e]&&(Fi.currentContext=null),"object"==typeof Ei&&Ei.removeAllHandlersOnTarget(Fi.contexts[e].GLctx.canvas),Fi.contexts[e]&&Fi.contexts[e].GLctx.canvas&&(Fi.contexts[e].GLctx.canvas.GLctxObject=void 0),is(Fi.contexts[e].handle),Fi.contexts[e]=null},initExtensions:function(e){if(e||(e=Fi.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t,i=e.GLctx;!function(e){var t=e.getExtension("ANGLE_instanced_arrays");t&&(e.vertexAttribDivisor=function(e,i){t.vertexAttribDivisorANGLE(e,i)},e.drawArraysInstanced=function(e,i,s,r){t.drawArraysInstancedANGLE(e,i,s,r)},e.drawElementsInstanced=function(e,i,s,r,o){t.drawElementsInstancedANGLE(e,i,s,r,o)})}(i),function(e){var t=e.getExtension("OES_vertex_array_object");t&&(e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)})}(i),function(e){var t=e.getExtension("WEBGL_draw_buffers");t&&(e.drawBuffers=function(e,i){t.drawBuffersWEBGL(e,i)})}(i),i.disjointTimerQueryExt=i.getExtension("EXT_disjoint_timer_query"),(t=i).multiDrawWebgl=t.getExtension("WEBGL_multi_draw");var s=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(i.getSupportedExtensions()||[]).forEach((function(e){-1!=s.indexOf(e)&&i.getExtension(e)}))}},populateUniformTable:function(e){for(var t=Fi.programs[e],i=Fi.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},s=i.uniforms,r=Xi.getProgramParameter(t,35718),o=0;o<r;++o){var a=Xi.getActiveUniform(t,o),n=a.name;i.maxUniformLength=Math.max(i.maxUniformLength,n.length+1),"]"==n.slice(-1)&&(n=n.slice(0,n.lastIndexOf("[")));var h=Xi.getUniformLocation(t,n);if(h){var l=Fi.getNewId(Fi.uniforms);s[n]=[a.size,l],Fi.uniforms[l]=h;for(var c=1;c<a.size;++c){var u=n+"["+c+"]";h=Xi.getUniformLocation(t,u),l=Fi.getNewId(Fi.uniforms),Fi.uniforms[l]=h}}}}},Si=["default","low-power","high-performance"],xi={};function Mi(){if(!Mi.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"};for(var t in xi)e[t]=xi[t];var i=[];for(var t in e)i.push(t+"="+e[t]);Mi.strings=i}return Mi.strings}function Ai(e,i){if(v)return yi(5,1,e,i);try{var s=0;return Mi().forEach((function(r,o){var n=i+s;a()[e+4*o>>2]=n,function(e,i,s){for(var r=0;r<e.length;++r)t()[i++>>0]=e.charCodeAt(r);s||(t()[i>>0]=0)}(r,n),s+=r.length+1})),0}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),e.errno}}function Li(e,t){if(v)return yi(6,1,e,t);try{var i=Mi();a()[e>>2]=i.length;var s=0;return i.forEach((function(e){s+=e.length+1})),a()[t>>2]=s,0}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),e.errno}}function Oi(e){if(v)return yi(7,1,e);try{var t=Ye.getStreamFromFD(e);return Xe.close(t),0}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),e.errno}}function Ni(e,t,i,s){if(v)return yi(8,1,e,t,i,s);try{var r=Ye.getStreamFromFD(e),o=Ye.doReadv(r,t,i);return a()[s>>2]=o,0}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),e.errno}}function Bi(e,t,i,s,r){if(v)return yi(9,1,e,t,i,s,r);try{var o=Ye.getStreamFromFD(e),n=4294967296*i+(t>>>0),h=9007199254740992;return n<=-h||n>=h?-61:(Xe.llseek(o,n,s),ve=[o.position>>>0,(Te=o.position,+Math.abs(Te)>=1?Te>0?(0|Math.min(+Math.floor(Te/4294967296),4294967295))>>>0:~~+Math.ceil((Te-+(~~Te>>>0))/4294967296)>>>0:0)],a()[r>>2]=ve[0],a()[r+4>>2]=ve[1],o.getdents&&0===n&&0===s&&(o.getdents=null),0)}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),e.errno}}function ki(e,t,i,s){if(v)return yi(10,1,e,t,i,s);try{var r=Ye.getStreamFromFD(e),o=Ye.doWritev(r,t,i);return a()[s>>2]=o,0}catch(e){return void 0!==Xe&&e instanceof Xe.ErrnoError||fe(e),e.errno}}function Gi(e){if(v)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var t=Le.getNewWorker();if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";Le.runningWorkers.push(t);for(var i=ts(512),s=0;s<128;++s)a()[i+4*s>>2]=0;var r=e.stackBase+e.stackSize,o=Le.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,thread:e.pthread_ptr,threadInfoStruct:e.pthread_ptr},h=o.threadInfoStruct>>2;Atomics.store(n(),h+0,0),Atomics.store(n(),h+1,0),Atomics.store(n(),h+2,0),Atomics.store(n(),h+17,e.detached),Atomics.store(n(),h+26,i),Atomics.store(n(),h+12,0),Atomics.store(n(),h+10,o.threadInfoStruct),Atomics.store(n(),h+11,42),Atomics.store(n(),h+27,e.stackSize),Atomics.store(n(),h+21,e.stackSize),Atomics.store(n(),h+20,r),Atomics.store(n(),h+29,r),Atomics.store(n(),h+30,e.detached),Atomics.store(n(),h+32,e.schedPolicy),Atomics.store(n(),h+33,e.schedPrio);var l=os()+40;Atomics.store(n(),h+44,l),t.pthread=o;var c={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,selfThreadId:e.pthread_ptr,parentThreadId:e.parent_pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};t.runPthread=function(){c.time=performance.now(),t.postMessage(c,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread)}function Ui(){return 0|we}function Vi(e){return e%4==0&&(e%100!=0||e%400==0)}function Hi(e,t){for(var i=0,s=0;s<=t;i+=e[s++]);return i}u._pthread_self=Ui;var ji=[31,29,31,30,31,30,31,31,30,31,30,31],zi=[31,28,31,30,31,30,31,31,30,31,30,31];function Wi(e,t){for(var i=new Date(e.getTime());t>0;){var s=Vi(i.getFullYear()),r=i.getMonth(),o=(s?ji:zi)[r];if(!(t>o-i.getDate()))return i.setDate(i.getDate()+t),i;t-=o-i.getDate()+1,i.setDate(1),r<11?i.setMonth(r+1):(i.setMonth(0),i.setFullYear(i.getFullYear()+1))}return i}function $i(e,i,s,r){var o=a()[r+40>>2],n={tm_sec:a()[r>>2],tm_min:a()[r+4>>2],tm_hour:a()[r+8>>2],tm_mday:a()[r+12>>2],tm_mon:a()[r+16>>2],tm_year:a()[r+20>>2],tm_wday:a()[r+24>>2],tm_yday:a()[r+28>>2],tm_isdst:a()[r+32>>2],tm_gmtoff:a()[r+36>>2],tm_zone:o?Y(o):""},h=Y(s),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var c in l)h=h.replace(new RegExp(c,"g"),l[c]);var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],p=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,i){for(var s="number"==typeof e?e.toString():e||"";s.length<t;)s=i[0]+s;return s}function m(e,t){return d(e,t,"0")}function f(e,t){function i(e){return e<0?-1:e>0?1:0}var s;return 0===(s=i(e.getFullYear()-t.getFullYear()))&&0===(s=i(e.getMonth()-t.getMonth()))&&(s=i(e.getDate()-t.getDate())),s}function g(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function _(e){var t=Wi(new Date(e.tm_year+1900,0,1),e.tm_yday),i=new Date(t.getFullYear(),0,4),s=new Date(t.getFullYear()+1,0,4),r=g(i),o=g(s);return f(r,t)<=0?f(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var y={"%a":function(e){return u[e.tm_wday].substring(0,3)},"%A":function(e){return u[e.tm_wday]},"%b":function(e){return p[e.tm_mon].substring(0,3)},"%B":function(e){return p[e.tm_mon]},"%C":function(e){return m((e.tm_year+1900)/100|0,2)},"%d":function(e){return m(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return _(e).toString().substring(2)},"%G":function(e){return _(e)},"%H":function(e){return m(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),m(t,2)},"%j":function(e){return m(e.tm_mday+Hi(Vi(e.tm_year+1900)?ji:zi,e.tm_mon-1),3)},"%m":function(e){return m(e.tm_mon+1,2)},"%M":function(e){return m(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return m(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),i=0===t.getDay()?t:Wi(t,7-t.getDay()),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(f(i,s)<0){var r=Hi(Vi(s.getFullYear())?ji:zi,s.getMonth()-1)-31,o=31-i.getDate()+r+s.getDate();return m(Math.ceil(o/7),2)}return 0===f(i,t)?"01":"00"},"%V":function(e){var t,i=new Date(e.tm_year+1900,0,4),s=new Date(e.tm_year+1901,0,4),r=g(i),o=g(s),a=Wi(new Date(e.tm_year+1900,0,1),e.tm_yday);return f(a,r)<0?"53":f(o,a)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),m(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),i=1===t.getDay()?t:Wi(t,0===t.getDay()?1:7-t.getDay()+1),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(f(i,s)<0){var r=Hi(Vi(s.getFullYear())?ji:zi,s.getMonth()-1)-31,o=31-i.getDate()+r+s.getDate();return m(Math.ceil(o/7),2)}return 0===f(i,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,i=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(i?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var c in y)h.indexOf(c)>=0&&(h=h.replace(new RegExp(c,"g"),y[c](n)));var T,v,I=Qi(h,!1);return I.length>i?0:(T=I,v=e,t().set(T,v),I.length-1)}v||Le.initMainThreadBlock();var Xi,Yi=function(e,t,i,s){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=Xe.nextInode++,this.name=t,this.mode=i,this.node_ops={},this.stream_ops={},this.rdev=s},Ki=365,qi=146;Object.defineProperties(Yi.prototype,{read:{get:function(){return(this.mode&Ki)===Ki},set:function(e){e?this.mode|=Ki:this.mode&=-366}},write:{get:function(){return(this.mode&qi)===qi},set:function(e){e?this.mode|=qi:this.mode&=-147}},isFolder:{get:function(){return Xe.isDir(this.mode)}},isDevice:{get:function(){return Xe.isChrdev(this.mode)}}}),Xe.FSNode=Yi,Xe.staticInit(),u.FS_createPath=Xe.createPath,u.FS_createDataFile=Xe.createDataFile,u.FS_createPreloadedFile=Xe.createPreloadedFile,u.FS_createLazyFile=Xe.createLazyFile,u.FS_createDevice=Xe.createDevice,u.FS_unlink=Xe.unlink,at=u.InternalError=ot(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);ut=e}(),dt=u.BindingError=ot(Error,"BindingError"),Ft.prototype.isAliasOf=gt,Ft.prototype.clone=Et,Ft.prototype.delete=Pt,Ft.prototype.isDeleted=bt,Ft.prototype.deleteLater=Rt,Kt.prototype.getPointee=kt,Kt.prototype.destructor=Gt,Kt.prototype.argPackAdvance=8,Kt.prototype.readValueFromPointer=Je,Kt.prototype.deleteObject=Ut,Kt.prototype.fromWireType=Yt,u.getInheritedInstanceCount=Ht,u.getLiveInheritedInstances=jt,u.flushPendingDeletes=Ct,u.setDelayFunction=zt,Qt=u.UnboundTypeError=ot(Error,"UnboundTypeError"),u.count_emval_handles=ai,u.get_first_emval=ni;var Zi=[null,function(e,t){if(v)return yi(1,1,e,t)},Ke,qe,Ri,Ai,Li,Oi,Ni,Bi,ki];function Qi(e,t,i){var s=i>0?i:Z(e)+1,r=new Array(s),o=K(e,r,0,r.length);return t&&(r.length=o),r}v||he.push({func:function(){es()}});var Ji={p:function(e,t,i,s){fe("Assertion failed: "+Y(e)+", at: "+[t?Y(t):"unknown filename",i,s?Y(s):"unknown function"])},H:function(e){return ts(e+Ue)+Ue},G:function(e,t,i){throw new Ve(e).init(t,i),e},ha:Ke,ia:qe,na:function(e){var t=Ze[e];delete Ze[e];var i=t.elements,s=i.length,r=i.map((function(e){return e.getterReturnType})).concat(i.map((function(e){return e.setterArgumentType}))),o=t.rawConstructor,a=t.rawDestructor;ht([e],r,(function(e){return i.forEach((function(t,i){var r=e[i],o=t.getter,a=t.getterContext,n=e[i+s],h=t.setter,l=t.setterContext;t.read=function(e){return r.fromWireType(o(a,e))},t.write=function(e,t){var i=[];h(l,e,n.toWireType(i,t)),Qe(i)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(s),r=0;r<s;++r)t[r]=i[r].read(e);return a(e),t},toWireType:function(e,r){if(s!==r.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+s+", actual="+r.length);for(var n=o(),h=0;h<s;++h)i[h].write(n,r[h]);return null!==e&&e.push(a,n),n},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:a}]}))},w:function(e){var t=lt[e];delete lt[e];var i=t.rawConstructor,s=t.rawDestructor,r=t.fields;ht([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var o={};return r.forEach((function(t,i){var s=t.fieldName,a=e[i],n=t.getter,h=t.getterContext,l=e[i+r.length],c=t.setter,u=t.setterContext;o[s]={read:function(e){return a.fromWireType(n(h,e))},write:function(e,t){var i=[];c(u,e,l.toWireType(i,t)),Qe(i)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var i in o)t[i]=o[i].read(e);return s(e),t},toWireType:function(e,t){for(var r in o)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var a=i();for(r in o)o[r].write(a,t[r]);return null!==e&&e.push(s,a),a},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:s}]}))},ka:function(e,i,s,o,n){var h=ct(s);ft(e,{name:i=pt(i),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?o:n},argPackAdvance:8,readValueFromPointer:function(e){var o;if(1===s)o=t();else if(2===s)o=r();else{if(4!==s)throw new TypeError("Unknown boolean type size: "+i);o=a()}return this.fromWireType(o[e>>>h])},destructorFunction:null})},z:function(e,t,i,s,r,o,a,n,h,l,c,u,p){c=pt(c),o=Zt(r,o),n&&(n=Zt(a,n)),l&&(l=Zt(h,l)),p=Zt(u,p);var d=st(c);Mt(d,(function(){ei("Cannot construct "+c+" due to unbound types",[s])})),ht([e,t,i],s?[s]:[],(function(t){var i,r;t=t[0],r=s?(i=t.registeredClass).instancePrototype:Ft.prototype;var a=rt(d,(function(){if(Object.getPrototypeOf(this)!==h)throw new dt("Use 'new' to construct "+c);if(void 0===u.constructor_body)throw new dt(c+" has no accessible constructor");var e=u.constructor_body[arguments.length];if(void 0===e)throw new dt("Tried to invoke ctor of "+c+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(u.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),h=Object.create(r,{constructor:{value:a}});a.prototype=h;var u=new At(c,a,h,p,i,o,n,l),m=new Kt(c,u,!0,!1,!1),f=new Kt(c+"*",u,!1,!1,!1),g=new Kt(c+" const*",u,!1,!0,!1);return St[e]={pointerType:f,constPointerType:g},qt(d,a),[m,f,g]}))},y:function(e,t,i,s,r,o){$(t>0);var a=ti(t,i);r=Zt(s,r);var n=[o],h=[];ht([],[e],(function(e){var i="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new dt("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){ei("Cannot construct "+e.name+" due to unbound types",a)},ht([],a,(function(s){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&mt(i+" called with "+arguments.length+" arguments, expected "+(t-1)),h.length=0,n.length=t;for(var e=1;e<t;++e)n[e]=s[e].toWireType(h,arguments[e-1]);var o=r.apply(null,n);return Qe(h),s[0].fromWireType(o)},[]})),[]}))},e:function(e,t,i,s,r,o,a,n){var h=ti(i,s);t=pt(t),o=Zt(r,o),ht([],[e],(function(e){var s=(e=e[0]).name+"."+t;function r(){ei("Cannot call "+s+" due to unbound types",h)}n&&e.registeredClass.pureVirtualFunctions.push(t);var l=e.registeredClass.instancePrototype,c=l[t];return void 0===c||void 0===c.overloadTable&&c.className!==e.name&&c.argCount===i-2?(r.argCount=i-2,r.className=e.name,l[t]=r):(xt(l,t,s),l[t].overloadTable[i-2]=r),ht([],h,(function(r){var n=ii(s,r,e,o,a);return void 0===l[t].overloadTable?(n.argCount=i-2,l[t]=n):l[t].overloadTable[i-2]=n,[]})),[]}))},ja:function(e,t){ft(e,{name:t=pt(t),fromWireType:function(e){var t=ri[e].value;return oi(e),t},toWireType:function(e,t){return hi(t)},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:null})},ma:function(e,t,i,s){var r=ct(i);function o(){}t=pt(t),o.values={},ft(e,{name:t,constructor:o,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:li(t,r,s),destructorFunction:null}),Mt(t,o)},E:function(e,t,i){var s=ci(e,"enum");t=pt(t);var r=s.constructor,o=Object.create(s.constructor.prototype,{value:{value:i},constructor:{value:rt(s.name+"_"+t,(function(){}))}});r.values[i]=o,r[t]=o},N:function(e,t,i){var s=ct(i);ft(e,{name:t=pt(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+ui(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:pi(t,s),destructorFunction:null})},i:function(e,t,i,s,r,o){var a=ti(t,i);e=pt(e),r=Zt(s,r),Mt(e,(function(){ei("Cannot call "+e+" due to unbound types",a)}),t-1),ht([],a,(function(i){var s=[i[0],null].concat(i.slice(1));return qt(e,ii(e,s,null,r,o),t-1),[]}))},u:function(e,t,i,s,r){t=pt(t),-1===r&&(r=4294967295);var o=ct(i),a=function(e){return e};if(0===s){var n=32-8*i;a=function(e){return e<<n>>>n}}var h=-1!=t.indexOf("unsigned");ft(e,{name:t,fromWireType:a,toWireType:function(e,i){if("number"!=typeof i&&"boolean"!=typeof i)throw new TypeError('Cannot convert "'+ui(i)+'" to '+this.name);if(i<s||i>r)throw new TypeError('Passing a number "'+ui(i)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+s+", "+r+"]!");return h?i>>>0:0|i},argPackAdvance:8,readValueFromPointer:di(t,o,0!==s),destructorFunction:null})},q:function(e,t,i){var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){e>>=2;var t=n(),i=t[e>>>0],r=t[e+1>>>0];return new s(O,r,i)}ft(e,{name:i=pt(i),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},O:function(e,t){var i="std::string"===(t=pt(t));ft(e,{name:t,fromWireType:function(e){var t,r=n()[e>>2];if(i)for(var o=e+4,a=0;a<=r;++a){var h=e+4+a;if(a==r||0==s()[h]){var l=Y(o,h-o);void 0===t?t=l:(t+=String.fromCharCode(0),t+=l),o=h+1}}else{var c=new Array(r);for(a=0;a<r;++a)c[a]=String.fromCharCode(s()[e+4+a]);t=c.join("")}return is(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||mt("Cannot pass non-string to std::string");var o=(i&&r?function(){return Z(t)}:function(){return t.length})(),a=ts(4+o+1);if(a>>>=0,n()[a>>2]=o,i&&r)q(t,a+4,o+1);else if(r)for(var h=0;h<o;++h){var l=t.charCodeAt(h);l>255&&(is(a),mt("String has UTF-16 code units that do not fit in 8 bits")),s()[a+4+h]=l}else for(h=0;h<o;++h)s()[a+4+h]=t[h];return null!==e&&e.push(is,a),a},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:function(e){is(e)}})},F:function(e,t,i){var s,r,a,h,l;i=pt(i),2===t?(s=Q,r=J,h=ee,a=function(){return o()},l=1):4===t&&(s=te,r=ie,h=se,a=function(){return n()},l=2),ft(e,{name:i,fromWireType:function(e){for(var i,r=n()[e>>2],o=a(),h=e+4,c=0;c<=r;++c){var u=e+4+c*t;if(c==r||0==o[u>>>l]){var p=s(h,u-h);void 0===i?i=p:(i+=String.fromCharCode(0),i+=p),h=u+t}}return is(e),i},toWireType:function(e,s){"string"!=typeof s&&mt("Cannot pass non-string to C++ string type "+i);var o=h(s),a=ts(4+o+t);return a>>>=0,n()[a>>2]=o>>l,r(s,a+4,o+t),null!==e&&e.push(is,a),a},argPackAdvance:8,readValueFromPointer:Je,destructorFunction:function(e){is(e)}})},oa:function(e,t,i,s,r,o){Ze[e]={name:pt(t),rawConstructor:Zt(i,s),rawDestructor:Zt(r,o),elements:[]}},l:function(e,t,i,s,r,o,a,n,h){Ze[e].elements.push({getterReturnType:t,getter:Zt(i,s),getterContext:r,setterArgumentType:o,setter:Zt(a,n),setterContext:h})},x:function(e,t,i,s,r,o){lt[e]={name:pt(t),rawConstructor:Zt(i,s),rawDestructor:Zt(r,o),fields:[]}},h:function(e,t,i,s,r,o,a,n,h,l){lt[e].fields.push({fieldName:pt(t),getterReturnType:i,getter:Zt(s,r),getterContext:o,setterArgumentType:a,setter:Zt(n,h),setterContext:l})},la:function(e,t){ft(e,{isVoid:!0,name:t=pt(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},$:function(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(v)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var i=Le.pthreads[e],s=i&&i.worker;if(!s)return;s.postMessage({cmd:"processThreadQueue"})}return 1},s:function(e,t,i){e=mi(e),t=ci(t,"emval::as");var s=[],r=hi(s);return a()[i>>2]=r,t.toWireType(s,e)},P:function(e,t,i,s){e=mi(e);for(var r=function(e,t){for(var i=new Array(e),s=0;s<e;++s)i[s]=ci(a()[(t>>2)+s],"parameter "+s);return i}(t,i),o=new Array(t),n=0;n<t;++n){var h=r[n];o[n]=h.readValueFromPointer(s),s+=h.argPackAdvance}return hi(e.apply(void 0,o))},b:oi,Z:function(e){return 0===e?hi(_i()):(e=gi(e),hi(_i()[e]))},t:function(e,t){return hi((e=mi(e))[t=mi(t)])},o:function(e){e>4&&(ri[e].refcount+=1)},ba:function(e,t){return(e=mi(e))instanceof(t=mi(t))},Q:function(e){return"number"==typeof(e=mi(e))},I:function(){return hi([])},j:function(e){return hi(gi(e))},A:function(){return hi({})},r:function(e){Qe(ri[e].value),oi(e)},m:function(e,t,i){e=mi(e),t=mi(t),i=mi(i),e[t]=i},g:function(e,t){return hi((e=ci(e,"_emval_take_value")).readValueFromPointer(t))},K:function(){fe()},fa:function(e,t){var i;if(0===e)i=Date.now();else{if(1!==e&&4!==e)return function(e){a()[rs()>>2]=e}(28),-1;i=Ae()}return a()[t>>2]=i/1e3|0,a()[t+4>>2]=i%1e3*1e3*1e3|0,0},B:function(e,t,i){var r=function(e,t){var i;for(vi.length=0,t>>=2;i=s()[e++];){var r=i<105;r&&1&t&&t++,vi.push(r?h()[t++>>1]:a()[t]),++t}return vi}(t,i);return Pe[e].apply(null,r)},aa:function(){g||f||L("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},J:function(e,t){},k:function(e,i,s){if(e<=0||e>t().length||!0&e)return-28;if(m){if(Atomics.load(a(),e>>2)!=i)return-6;var r=performance.now(),o=r+s;for(Atomics.exchange(a(),Le.mainThreadFutex>>2,e);;){if((r=performance.now())>o)return Atomics.exchange(a(),Le.mainThreadFutex>>2,0),-73;if(0==Atomics.exchange(a(),Le.mainThreadFutex>>2,0))break;if(ps(),Atomics.load(a(),e>>2)!=i)return-6;Atomics.exchange(a(),Le.mainThreadFutex>>2,e)}return 0}var n=Atomics.wait(a(),e>>2,i,s);if("timed-out"===n)return-73;if("not-equal"===n)return-6;if("ok"===n)return 0;throw"Atomics.wait returned an unexpected value "+n},n:Me,d:Ae,D:function(){return 0|Re},C:function(){return 0|Ce},U:function(e,t,i){s().copyWithin(e,t,t+i)},W:function(e,t,i){Ti.length=t;for(var s=i>>3,r=0;r<t;r++)Ti[r]=h()[s+r];return(e<0?Pe[-e-1]:Zi[e]).apply(null,Ti)},v:function(e){e>>>=0;var t=s().length;if(e<=t)return!1;var i=4294967296;if(e>i)return!1;for(var r,o,a=1;a<=4;a*=2){var n=t*(1+.2/a);if(n=Math.min(n,e+100663296),Ii(Math.min(i,((r=Math.max(16777216,e,n))%(o=65536)>0&&(r+=o-r%o),r))))return!0}return!1},X:function(e,t,i){return wi(e)?Ci(e,t,i):Ri(e,t,i)},f:function(e){},Y:function(e,t){return function(e,t){var i=t>>2,s=a()[i+6],r={alpha:!!a()[i+0],depth:!!a()[i+1],stencil:!!a()[i+2],antialias:!!a()[i+3],premultipliedAlpha:!!a()[i+4],preserveDrawingBuffer:!!a()[i+5],powerPreference:Si[s],failIfMajorPerformanceCaveat:!!a()[i+7],majorVersion:a()[i+8],minorVersion:a()[i+9],enableExtensionsByDefault:a()[i+10],explicitSwapControl:a()[i+11],proxyContextToMainThread:a()[i+12],renderViaOffscreenBackBuffer:a()[i+13]},o=wi(e);return o?r.explicitSwapControl?0:Fi.createContext(o,r):0}(e,t)},da:Ai,ea:Li,M:Oi,ga:Ni,R:Bi,L:ki,T:function(){Le.initRuntime()},a:S||u.wasmMemory,V:function(e,t){Le.threadExitHandlers.push((function(){oe.get(e)(t)}))},_:function(e,t,i,s){if("undefined"==typeof SharedArrayBuffer)return A("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return A("pthread_create called with a null thread pointer!"),28;var r=[];if(v&&0===r.length)return fs(687865856,e,t,i,s);var o=0,h=0,l=0,c=0,u=0;if(t)if(o=a()[t>>2],o+=81920,h=a()[t+8>>2],l=0!==a()[t+12>>2],0===a()[t+16>>2]){var p=a()[t+20>>2],d=a()[t+24>>2];!function(e,t,i){if(!t&&!i)return xe;if(!e)return A("pthread_getschedparam called with a null thread pointer!"),Se;if(a()[e+12>>2]!==e)return A("pthread_getschedparam attempted on thread "+e+", which does not point to a valid thread, or does not exist anymore!"),Se;var s=Atomics.load(n(),e+108+20>>2),r=Atomics.load(n(),e+108+24>>2);t&&(a()[t>>2]=s),i&&(a()[i>>2]=r)}(Le.currentProxiedOperationCallerThread?Le.currentProxiedOperationCallerThread:Ui(),t+20,t+24),c=a()[t+20>>2],u=a()[t+24>>2],a()[t+20>>2]=p,a()[t+24>>2]=d}else c=a()[t+20>>2],u=a()[t+24>>2];else o=2097152;var m=0==h;m?h=cs(16,o):$((h-=o)>0);for(var f=ts(232),g=0;g<58;++g)n()[(f>>2)+g]=0;a()[e>>2]=f,a()[f+12>>2]=f;var _=f+156;a()[_>>2]=_;var y={stackBase:h,stackSize:o,allocatedOwnStack:m,schedPolicy:c,schedPrio:u,detached:l,startRoutine:i,pthread_ptr:f,parent_pthread_ptr:Ui(),arg:s,transferList:r};return v?(y.cmd="spawnThread",postMessage(y,r)):Gi(y),0},c:Ui,S:function(e){},ca:function(e,t,i,s){return $i(e,t,i,s)}};!function(){var e={a:Ji};function t(e,t){var i=e.exports;if(u.asm=i,oe=u.asm.pa,x=t,!v){var s=Le.unusedWorkers.length;Le.unusedWorkers.forEach((function(e){Le.loadWasmModuleToWorker(e,(function(){--s||me()}))}))}}function i(e){t(e.instance,e.module)}function s(t){return(R||!m&&!f||"function"!=typeof fetch||ye(Ie)?Promise.resolve().then(Ee):fetch(Ie,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Ie+"'";return e.arrayBuffer()})).catch((function(){return Ee()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){A("failed to asynchronously prepare wasm: "+e),fe(e)}))}if(v||de(),u.instantiateWasm)try{return u.instantiateWasm(e,t)}catch(e){return A("Module.instantiateWasm callback failed with error: "+e),!1}(R||"function"!=typeof WebAssembly.instantiateStreaming||_e(Ie)||ye(Ie)||"function"!=typeof fetch?s(i):fetch(Ie,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return A("wasm streaming compile failed: "+e),A("falling back to ArrayBuffer instantiation"),s(i)}))}))).catch(c)}();var es=u.___wasm_call_ctors=function(){return(es=u.___wasm_call_ctors=u.asm.qa).apply(null,arguments)};u._main=function(){return(u._main=u.asm.ra).apply(null,arguments)};var ts=u._malloc=function(){return(ts=u._malloc=u.asm.sa).apply(null,arguments)},is=u._free=function(){return(is=u._free=u.asm.ta).apply(null,arguments)},ss=u.___getTypeName=function(){return(ss=u.___getTypeName=u.asm.ua).apply(null,arguments)};u.___embind_register_native_and_builtin_types=function(){return(u.___embind_register_native_and_builtin_types=u.asm.va).apply(null,arguments)};var rs=u.___errno_location=function(){return(rs=u.___errno_location=u.asm.wa).apply(null,arguments)},os=u._emscripten_get_global_libc=function(){return(os=u._emscripten_get_global_libc=u.asm.xa).apply(null,arguments)};u.___em_js__initPthreadsJS=function(){return(u.___em_js__initPthreadsJS=u.asm.ya).apply(null,arguments)};var as=u.stackSave=function(){return(as=u.stackSave=u.asm.za).apply(null,arguments)},ns=u.stackRestore=function(){return(ns=u.stackRestore=u.asm.Aa).apply(null,arguments)},hs=u.stackAlloc=function(){return(hs=u.stackAlloc=u.asm.Ba).apply(null,arguments)},ls=u._emscripten_stack_set_limits=function(){return(ls=u._emscripten_stack_set_limits=u.asm.Ca).apply(null,arguments)},cs=u._memalign=function(){return(cs=u._memalign=u.asm.Da).apply(null,arguments)};u._emscripten_main_browser_thread_id=function(){return(u._emscripten_main_browser_thread_id=u.asm.Ea).apply(null,arguments)};var us=u.___pthread_tsd_run_dtors=function(){return(us=u.___pthread_tsd_run_dtors=u.asm.Fa).apply(null,arguments)},ps=u._emscripten_main_thread_process_queued_calls=function(){return(ps=u._emscripten_main_thread_process_queued_calls=u.asm.Ga).apply(null,arguments)};u._emscripten_current_thread_process_queued_calls=function(){return(u._emscripten_current_thread_process_queued_calls=u.asm.Ha).apply(null,arguments)};var ds=u._emscripten_register_main_browser_thread_id=function(){return(ds=u._emscripten_register_main_browser_thread_id=u.asm.Ia).apply(null,arguments)},ms=u._do_emscripten_dispatch_to_thread=function(){return(ms=u._do_emscripten_dispatch_to_thread=u.asm.Ja).apply(null,arguments)};u._emscripten_async_run_in_main_thread=function(){return(u._emscripten_async_run_in_main_thread=u.asm.Ka).apply(null,arguments)},u._emscripten_sync_run_in_main_thread=function(){return(u._emscripten_sync_run_in_main_thread=u.asm.La).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_0=function(){return(u._emscripten_sync_run_in_main_thread_0=u.asm.Ma).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_1=function(){return(u._emscripten_sync_run_in_main_thread_1=u.asm.Na).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_2=function(){return(u._emscripten_sync_run_in_main_thread_2=u.asm.Oa).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_xprintf_varargs=function(){return(u._emscripten_sync_run_in_main_thread_xprintf_varargs=u.asm.Pa).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_3=function(){return(u._emscripten_sync_run_in_main_thread_3=u.asm.Qa).apply(null,arguments)};var fs=u._emscripten_sync_run_in_main_thread_4=function(){return(fs=u._emscripten_sync_run_in_main_thread_4=u.asm.Ra).apply(null,arguments)};u._emscripten_sync_run_in_main_thread_5=function(){return(u._emscripten_sync_run_in_main_thread_5=u.asm.Sa).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_6=function(){return(u._emscripten_sync_run_in_main_thread_6=u.asm.Ta).apply(null,arguments)},u._emscripten_sync_run_in_main_thread_7=function(){return(u._emscripten_sync_run_in_main_thread_7=u.asm.Ua).apply(null,arguments)};var gs=u._emscripten_run_in_main_runtime_thread_js=function(){return(gs=u._emscripten_run_in_main_runtime_thread_js=u.asm.Va).apply(null,arguments)},_s=u.__emscripten_call_on_thread=function(){return(_s=u.__emscripten_call_on_thread=u.asm.Wa).apply(null,arguments)};u._emscripten_tls_init=function(){return(u._emscripten_tls_init=u.asm.Xa).apply(null,arguments)},u.dynCall_jiji=function(){return(u.dynCall_jiji=u.asm.Ya).apply(null,arguments)},u.dynCall_viijii=function(){return(u.dynCall_viijii=u.asm.Za).apply(null,arguments)},u.dynCall_iiiiiijj=function(){return(u.dynCall_iiiiiijj=u.asm._a).apply(null,arguments)},u.dynCall_iiiiij=function(){return(u.dynCall_iiiiij=u.asm.$a).apply(null,arguments)},u.dynCall_iiiiijj=function(){return(u.dynCall_iiiiijj=u.asm.ab).apply(null,arguments)};var ys,Ts=u._main_thread_futex=51928;function vs(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Is(e){var t,i=u._main;try{t=i(0,0),!0&&F&&0===t||(F||(Le.terminateAllThreads(),u.onExit&&u.onExit(t),W=!0),T(t,new vs(t)))}catch(e){if(e instanceof vs)return;if("unwind"==e)return void(F=!0);var s=e;e&&"object"==typeof e&&e.stack&&(s=[e,e.stack]),A("exception thrown: "+s),T(1,e)}}function Es(e){function t(){ys||(ys=!0,u.calledRun=!0,W||(u.noFSInit||Xe.init.initialized||Xe.init(),be(he),v||(Xe.ignorePermissions=!1,be(le)),l(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),Ps&&Is(),function(){if(!v){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;)e=u.postRun.shift(),ce.unshift(e);var e;be(ce)}}()))}ue>0||(function(){if(!v){if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)e=u.preRun.shift(),ne.unshift(e);var e;be(ne)}}(),ue>0||(u.setStatus?(u.setStatus("Running..."),setTimeout((function(){setTimeout((function(){u.setStatus("")}),1),t()}),1)):t()))}if(u.addRunDependency=de,u.removeRunDependency=me,u.FS_createPath=Xe.createPath,u.FS_createDataFile=Xe.createDataFile,u.FS_createPreloadedFile=Xe.createPreloadedFile,u.FS_createLazyFile=Xe.createLazyFile,u.FS_createDevice=Xe.createDevice,u.FS_unlink=Xe.unlink,u.FS=Xe,u.PThread=Le,u.PThread=Le,u._pthread_self=Ui,u.wasmMemory=S,u.ExitStatus=vs,pe=function e(){ys||Es(),ys||(pe=e)},u.run=Es,u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);u.preInit.length>0;)u.preInit.pop()();var Ps=!0;return u.noInitialRun&&(Ps=!1),v||(F=!0),v?Le.initWorker():Es(),e.ready});"object"==typeof e&&"object"==typeof t?t.exports=s:"function"==typeof define&&define.amd?define([],(function(){return s})):"object"==typeof e&&(e.WebIFCWasm=s)}}),require_web_ifc=__commonJS({"dist/web-ifc.js"(e,t){var i,s=(i="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(i=i||__filename),function(e){var t,s,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,i){t=e,s=i}));var o,a={};for(o in r)r.hasOwnProperty(o)&&(a[o]=r[o]);var n,h,l,c,u="./this.program",p=function(e,t){throw t};n="object"==typeof window,h="function"==typeof importScripts,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,c=!n&&!l&&!h;var d,m,f,g,_="";l?(_=h?__require("path").dirname(_)+"/":__dirname+"/",d=function(e,t){return f||(f=__require("fs")),g||(g=__require("path")),e=g.normalize(e),f.readFileSync(e,t?null:"utf8")},m=function(e){var t=d(e,!0);return t.buffer||(t=new Uint8Array(t)),b(t.buffer),t},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof _i))throw e})),process.on("unhandledRejection",re),p=function(e){process.exit(e)},r.inspect=function(){return"[Emscripten Module object]"}):c?("undefined"!=typeof read&&(d=function(e){return read(e)}),m=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(b("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(p=function(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(n||h)&&(h?_=self.location.href:"undefined"!=typeof document&&document.currentScript&&(_=document.currentScript.src),i&&(_=i),_=0!==_.indexOf("blob:")?_.substr(0,_.lastIndexOf("/")+1):"",d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(m=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}));var y,T,v,I=r.print||console.log.bind(console),E=r.printErr||console.warn.bind(console);for(o in a)a.hasOwnProperty(o)&&(r[o]=a[o]);a=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(p=r.quit),r.wasmBinary&&(y=r.wasmBinary),r.noExitRuntime&&(T=r.noExitRuntime),"object"!=typeof WebAssembly&&re("no native wasm support detected");var P=!1;function b(e,t){e||re("Assertion failed: "+t)}var D="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,i){for(var s=(t>>>=0)+i,r=t;e[r>>>0]&&!(r>=s);)++r;if(r-t>16&&e.subarray&&D)return D.decode(e.subarray(t>>>0,r>>>0));for(var o="";t<r;){var a=e[t++>>>0];if(128&a){var n=63&e[t++>>>0];if(192!=(224&a)){var h=63&e[t++>>>0];if((a=224==(240&a)?(15&a)<<12|n<<6|h:(7&a)<<18|n<<12|h<<6|63&e[t++>>>0])<65536)o+=String.fromCharCode(a);else{var l=a-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&a)<<6|n)}else o+=String.fromCharCode(a)}return o}function C(e,t){return(e>>>=0)?w(A,e,t):""}function R(e,t,i,s){if(!(s>0))return 0;for(var r=i>>>=0,o=i+s-1,a=0;a<e.length;++a){var n=e.charCodeAt(a);if(n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++a)),n<=127){if(i>=o)break;t[i++>>>0]=n}else if(n<=2047){if(i+1>=o)break;t[i++>>>0]=192|n>>6,t[i++>>>0]=128|63&n}else if(n<=65535){if(i+2>=o)break;t[i++>>>0]=224|n>>12,t[i++>>>0]=128|n>>6&63,t[i++>>>0]=128|63&n}else{if(i+3>=o)break;t[i++>>>0]=240|n>>18,t[i++>>>0]=128|n>>12&63,t[i++>>>0]=128|n>>6&63,t[i++>>>0]=128|63&n}}return t[i>>>0]=0,i-r}function F(e,t,i){return R(e,A,t,i)}function S(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127?++t:t+=s<=2047?2:s<=65535?3:4}return t}var x,M,A,L,O,N,B,k,G,U="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function V(e,t){for(var i=e,s=i>>1,r=s+t/2;!(s>=r)&&O[s>>>0];)++s;if((i=s<<1)-e>32&&U)return U.decode(A.subarray(e>>>0,i>>>0));for(var o="",a=0;!(a>=t/2);++a){var n=L[e+2*a>>>1];if(0==n)break;o+=String.fromCharCode(n)}return o}function H(e,t,i){if(void 0===i&&(i=2147483647),i<2)return 0;for(var s=t,r=(i-=2)<2*e.length?i/2:e.length,o=0;o<r;++o){var a=e.charCodeAt(o);L[t>>>1]=a,t+=2}return L[t>>>1]=0,t-s}function j(e){return 2*e.length}function z(e,t){for(var i=0,s="";!(i>=t/4);){var r=N[e+4*i>>>2];if(0==r)break;if(++i,r>=65536){var o=r-65536;s+=String.fromCharCode(55296|o>>10,56320|1023&o)}else s+=String.fromCharCode(r)}return s}function W(e,t,i){if(void 0===i&&(i=2147483647),i<4)return 0;for(var s=t>>>=0,r=s+i-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),N[t>>>2]=a,(t+=4)+4>r)break}return N[t>>>2]=0,t-s}function $(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&++i,t+=4}return t}function X(e){x=e,r.HEAP8=M=new Int8Array(e),r.HEAP16=L=new Int16Array(e),r.HEAP32=N=new Int32Array(e),r.HEAPU8=A=new Uint8Array(e),r.HEAPU16=O=new Uint16Array(e),r.HEAPU32=B=new Uint32Array(e),r.HEAPF32=k=new Float32Array(e),r.HEAPF64=G=new Float64Array(e)}var Y,K=r.INITIAL_MEMORY||16777216;(v=r.wasmMemory?r.wasmMemory:new WebAssembly.Memory({initial:K/65536,maximum:65536}))&&(x=v.buffer),K=x.byteLength,X(x);var q=[],Z=[],Q=[],J=[],ee=0,te=null;function ie(e){ee++,r.monitorRunDependencies&&r.monitorRunDependencies(ee)}function se(e){if(ee--,r.monitorRunDependencies&&r.monitorRunDependencies(ee),0==ee&&te){var t=te;te=null,t()}}function re(e){r.onAbort&&r.onAbort(e),E(e+=""),P=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw s(t),t}function oe(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function ae(e){return oe(e,"data:application/octet-stream;base64,")}function ne(e){return oe(e,"file://")}r.preloadedImages={},r.preloadedAudios={};var he,le,ce,ue="web-ifc.wasm";function pe(){try{if(y)return new Uint8Array(y);if(m)return m(ue);throw"both async and sync fetching of the wasm failed"}catch(e){re(e)}}function de(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?Y.get(i)():Y.get(i)(t.arg):i(void 0===t.arg?null:t.arg)}else t(r)}}function me(e,t,i){return-1!=e.indexOf("j")?function(e,t,i){return i&&i.length?r["dynCall_"+e].apply(null,[t].concat(i)):r["dynCall_"+e].call(null,t)}(e,t,i):Y.get(t).apply(null,i)}ae(ue)||(he=ue,ue=r.locateFile?r.locateFile(he,_):_+he);var fe=0,ge=4,_e=8,ye=12,Te=13,ve=16;function Ie(e){this.excPtr=e,this.ptr=e-ve,this.set_type=function(e){N[this.ptr+_e>>>2]=e},this.get_type=function(){return N[this.ptr+_e>>>2]},this.set_destructor=function(e){N[this.ptr+fe>>>2]=e},this.get_destructor=function(){return N[this.ptr+fe>>>2]},this.set_refcount=function(e){N[this.ptr+ge>>>2]=e},this.set_caught=function(e){e=e?1:0,M[this.ptr+ye>>>0]=e},this.get_caught=function(){return 0!=M[this.ptr+ye>>>0]},this.set_rethrown=function(e){e=e?1:0,M[this.ptr+Te>>>0]=e},this.get_rethrown=function(){return 0!=M[this.ptr+Te>>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=N[this.ptr+ge>>>2];N[this.ptr+ge>>>2]=e+1},this.release_ref=function(){var e=N[this.ptr+ge>>>2];return N[this.ptr+ge>>>2]=e-1,1===e}}var Ee={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var i=0,s=e.length-1;s>=0;s--){var r=e[s];"."===r?e.splice(s,1):".."===r?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(t)for(;i;i--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),i="/"===e.substr(-1);return e=Ee.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),e||t||(e="."),e&&i&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=Ee.splitPath(e),i=t[0],s=t[1];return i||s?(s&&(s=s.substr(0,s.length-1)),i+s):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=Ee.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return Ee.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return Ee.normalize(e.join("/"))},join2:function(e,t){return Ee.normalize(e+"/"+t)}},Pe={resolve:function(){for(var e="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var s=i>=0?arguments[i]:Ce.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";e=s+"/"+e,t="/"===s.charAt(0)}return e=Ee.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=Pe.resolve(e).substr(1),t=Pe.resolve(t).substr(1);for(var s=i(e.split("/")),r=i(t.split("/")),o=Math.min(s.length,r.length),a=o,n=0;n<o;n++)if(s[n]!==r[n]){a=n;break}var h=[];for(n=a;n<s.length;n++)h.push("..");return(h=h.concat(r.slice(a))).join("/")}},be={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){be.ttys[e]={input:[],output:[],ops:t},Ce.registerDevice(e,be.stream_ops)},stream_ops:{open:function(e){var t=be.ttys[e.node.rdev];if(!t)throw new Ce.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.get_char)throw new Ce.ErrnoError(60);for(var o=0,a=0;a<s;a++){var n;try{n=e.tty.ops.get_char(e.tty)}catch(e){throw new Ce.ErrnoError(29)}if(void 0===n&&0===o)throw new Ce.ErrnoError(6);if(null==n)break;o++,t[i+a]=n}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.put_char)throw new Ce.ErrnoError(60);try{for(var o=0;o<s;o++)e.tty.ops.put_char(e.tty,t[i+o])}catch(e){throw new Ce.ErrnoError(29)}return s&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(l){var i=Buffer.alloc?Buffer.alloc(256):new Buffer(256),s=0;try{s=f.readSync(process.stdin.fd,i,0,256,null)}catch(e){if(-1==e.toString().indexOf("EOF"))throw e;s=0}t=s>0?i.slice(0,s).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=li(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(I(w(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(I(w(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(E(w(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(E(w(e.output,0)),e.output=[])}}};function De(e){for(var t=function(e,t){return t||(t=16),Math.ceil(e/t)*t}(e,16384),i=pi(t);e<t;)M[i+e++>>>0]=0;return i}var we={ops_table:null,mount:function(e){return we.createNode(null,"/",16895,0)},createNode:function(e,t,i,s){if(Ce.isBlkdev(i)||Ce.isFIFO(i))throw new Ce.ErrnoError(63);we.ops_table||(we.ops_table={dir:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr,lookup:we.node_ops.lookup,mknod:we.node_ops.mknod,rename:we.node_ops.rename,unlink:we.node_ops.unlink,rmdir:we.node_ops.rmdir,readdir:we.node_ops.readdir,symlink:we.node_ops.symlink},stream:{llseek:we.stream_ops.llseek}},file:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr},stream:{llseek:we.stream_ops.llseek,read:we.stream_ops.read,write:we.stream_ops.write,allocate:we.stream_ops.allocate,mmap:we.stream_ops.mmap,msync:we.stream_ops.msync}},link:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr,readlink:we.node_ops.readlink},stream:{}},chrdev:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr},stream:Ce.chrdev_stream_ops}});var r=Ce.createNode(e,t,i,s);return Ce.isDir(r.mode)?(r.node_ops=we.ops_table.dir.node,r.stream_ops=we.ops_table.dir.stream,r.contents={}):Ce.isFile(r.mode)?(r.node_ops=we.ops_table.file.node,r.stream_ops=we.ops_table.file.stream,r.usedBytes=0,r.contents=null):Ce.isLink(r.mode)?(r.node_ops=we.ops_table.link.node,r.stream_ops=we.ops_table.link.stream):Ce.isChrdev(r.mode)&&(r.node_ops=we.ops_table.chrdev.node,r.stream_ops=we.ops_table.chrdev.stream),r.timestamp=Date.now(),e&&(e.contents[t]=r),r},getFileDataAsRegularArray:function(e){if(e.contents&&e.contents.subarray){for(var t=[],i=0;i<e.usedBytes;++i)t.push(e.contents[i]);return t}return e.contents},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){t>>>=0;var i=e.contents?e.contents.length:0;if(!(i>=t)){t=Math.max(t,i*(i<1048576?2:1.125)>>>0),0!=i&&(t=Math.max(t,256));var s=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(s.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(t>>>=0,e.usedBytes!=t){if(0==t)return e.contents=null,void(e.usedBytes=0);if(!e.contents||e.contents.subarray){var i=e.contents;return e.contents=new Uint8Array(t),i&&e.contents.set(i.subarray(0,Math.min(t,e.usedBytes))),void(e.usedBytes=t)}if(e.contents||(e.contents=[]),e.contents.length>t)e.contents.length=t;else for(;e.contents.length<t;)e.contents.push(0);e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=Ce.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Ce.isDir(e.mode)?t.size=4096:Ce.isFile(e.mode)?t.size=e.usedBytes:Ce.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&we.resizeFileStorage(e,t.size)},lookup:function(e,t){throw Ce.genericErrors[44]},mknod:function(e,t,i,s){return we.createNode(e,t,i,s)},rename:function(e,t,i){if(Ce.isDir(e.mode)){var s;try{s=Ce.lookupNode(t,i)}catch(e){}if(s)for(var r in s.contents)throw new Ce.ErrnoError(55)}delete e.parent.contents[e.name],e.name=i,t.contents[i]=e,e.parent=t},unlink:function(e,t){delete e.contents[t]},rmdir:function(e,t){var i=Ce.lookupNode(e,t);for(var s in i.contents)throw new Ce.ErrnoError(55);delete e.contents[t]},readdir:function(e){var t=[".",".."];for(var i in e.contents)e.contents.hasOwnProperty(i)&&t.push(i);return t},symlink:function(e,t,i){var s=we.createNode(e,t,41471,0);return s.link=i,s},readlink:function(e){if(!Ce.isLink(e.mode))throw new Ce.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,i,s,r){var o=e.node.contents;if(r>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-r,s);if(a>8&&o.subarray)t.set(o.subarray(r,r+a),i);else for(var n=0;n<a;n++)t[i+n]=o[r+n];return a},write:function(e,t,i,s,r,o){if(t.buffer===M.buffer&&(o=!1),!s)return 0;var a=e.node;if(a.timestamp=Date.now(),t.subarray&&(!a.contents||a.contents.subarray)){if(o)return a.contents=t.subarray(i,i+s),a.usedBytes=s,s;if(0===a.usedBytes&&0===r)return a.contents=t.slice(i,i+s),a.usedBytes=s,s;if(r+s<=a.usedBytes)return a.contents.set(t.subarray(i,i+s),r),s}if(we.expandFileStorage(a,r+s),a.contents.subarray&&t.subarray)a.contents.set(t.subarray(i,i+s),r);else for(var n=0;n<s;n++)a.contents[r+n]=t[i+n];return a.usedBytes=Math.max(a.usedBytes,r+s),s},llseek:function(e,t,i){var s=t;if(1===i?s+=e.position:2===i&&Ce.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new Ce.ErrnoError(28);return s},allocate:function(e,t,i){we.expandFileStorage(e.node,t+i),e.node.usedBytes=Math.max(e.node.usedBytes,t+i)},mmap:function(e,t,i,s,r,o){if(b(0===t),!Ce.isFile(e.node.mode))throw new Ce.ErrnoError(43);var a,n,h=e.node.contents;if(2&o||h.buffer!==x){if((s>0||s+i<h.length)&&(h=h.subarray?h.subarray(s,s+i):Array.prototype.slice.call(h,s,s+i)),n=!0,!(a=De(i)))throw new Ce.ErrnoError(48);a>>>=0,M.set(h,a>>>0)}else n=!1,a=h.byteOffset;return{ptr:a,allocated:n}},msync:function(e,t,i,s,r){if(!Ce.isFile(e.node.mode))throw new Ce.ErrnoError(43);return 2&r||we.stream_ops.write(e,t,0,s,i,!1),0}}},Ce={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=Pe.resolve(Ce.cwd(),e)))return{path:"",node:null};var i={follow_mount:!0,recurse_count:0};for(var s in i)void 0===t[s]&&(t[s]=i[s]);if(t.recurse_count>8)throw new Ce.ErrnoError(32);for(var r=Ee.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),o=Ce.root,a="/",n=0;n<r.length;n++){var h=n===r.length-1;if(h&&t.parent)break;if(o=Ce.lookupNode(o,r[n]),a=Ee.join2(a,r[n]),Ce.isMountpoint(o)&&(!h||h&&t.follow_mount)&&(o=o.mounted.root),!h||t.follow)for(var l=0;Ce.isLink(o.mode);){var c=Ce.readlink(a);if(a=Pe.resolve(Ee.dirname(a),c),o=Ce.lookupPath(a,{recurse_count:t.recurse_count}).node,l++>40)throw new Ce.ErrnoError(32)}}return{path:a,node:o}},getPath:function(e){for(var t;;){if(Ce.isRoot(e)){var i=e.mount.mountpoint;return t?"/"!==i[i.length-1]?i+"/"+t:i+t:i}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var i=0,s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s)|0;return(e+i>>>0)%Ce.nameTable.length},hashAddNode:function(e){var t=Ce.hashName(e.parent.id,e.name);e.name_next=Ce.nameTable[t],Ce.nameTable[t]=e},hashRemoveNode:function(e){var t=Ce.hashName(e.parent.id,e.name);if(Ce.nameTable[t]===e)Ce.nameTable[t]=e.name_next;else for(var i=Ce.nameTable[t];i;){if(i.name_next===e){i.name_next=e.name_next;break}i=i.name_next}},lookupNode:function(e,t){var i=Ce.mayLookup(e);if(i)throw new Ce.ErrnoError(i,e);for(var s=Ce.hashName(e.id,t),r=Ce.nameTable[s];r;r=r.name_next){var o=r.name;if(r.parent.id===e.id&&o===t)return r}return Ce.lookup(e,t)},createNode:function(e,t,i,s){var r=new Ce.FSNode(e,t,i,s);return Ce.hashAddNode(r),r},destroyNode:function(e){Ce.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=Ce.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return Ce.ignorePermissions||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:2},mayLookup:function(e){var t=Ce.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return Ce.lookupNode(e,t),20}catch(e){}return Ce.nodePermissions(e,"wx")},mayDelete:function(e,t,i){var s;try{s=Ce.lookupNode(e,t)}catch(e){return e.errno}var r=Ce.nodePermissions(e,"wx");if(r)return r;if(i){if(!Ce.isDir(s.mode))return 54;if(Ce.isRoot(s)||Ce.getPath(s)===Ce.cwd())return 10}else if(Ce.isDir(s.mode))return 31;return 0},mayOpen:function(e,t){return e?Ce.isLink(e.mode)?32:Ce.isDir(e.mode)&&("r"!==Ce.flagsToPermissionString(t)||512&t)?31:Ce.nodePermissions(e,Ce.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||Ce.MAX_OPEN_FDS;for(var i=e;i<=t;i++)if(!Ce.streams[i])return i;throw new Ce.ErrnoError(33)},getStream:function(e){return Ce.streams[e]},createStream:function(e,t,i){Ce.FSStream||(Ce.FSStream=function(){},Ce.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var s=new Ce.FSStream;for(var r in e)s[r]=e[r];e=s;var o=Ce.nextfd(t,i);return e.fd=o,Ce.streams[o]=e,e},closeStream:function(e){Ce.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=Ce.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new Ce.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){Ce.devices[e]={stream_ops:t}},getDevice:function(e){return Ce.devices[e]},getMounts:function(e){for(var t=[],i=[e];i.length;){var s=i.pop();t.push(s),i.push.apply(i,s.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),Ce.syncFSRequests++,Ce.syncFSRequests>1&&E("warning: "+Ce.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var i=Ce.getMounts(Ce.root.mount),s=0;function r(e){return Ce.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,r(e));++s>=i.length&&r(null)}i.forEach((function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:function(e,t,i){var s,r="/"===i,o=!i;if(r&&Ce.root)throw new Ce.ErrnoError(10);if(!r&&!o){var a=Ce.lookupPath(i,{follow_mount:!1});if(i=a.path,s=a.node,Ce.isMountpoint(s))throw new Ce.ErrnoError(10);if(!Ce.isDir(s.mode))throw new Ce.ErrnoError(54)}var n={type:e,opts:t,mountpoint:i,mounts:[]},h=e.mount(n);return h.mount=n,n.root=h,r?Ce.root=h:s&&(s.mounted=n,s.mount&&s.mount.mounts.push(n)),h},unmount:function(e){var t=Ce.lookupPath(e,{follow_mount:!1});if(!Ce.isMountpoint(t.node))throw new Ce.ErrnoError(28);var i=t.node,s=i.mounted,r=Ce.getMounts(s);Object.keys(Ce.nameTable).forEach((function(e){for(var t=Ce.nameTable[e];t;){var i=t.name_next;-1!==r.indexOf(t.mount)&&Ce.destroyNode(t),t=i}})),i.mounted=null;var o=i.mount.mounts.indexOf(s);i.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,i){var s=Ce.lookupPath(e,{parent:!0}).node,r=Ee.basename(e);if(!r||"."===r||".."===r)throw new Ce.ErrnoError(28);var o=Ce.mayCreate(s,r);if(o)throw new Ce.ErrnoError(o);if(!s.node_ops.mknod)throw new Ce.ErrnoError(63);return s.node_ops.mknod(s,r,t,i)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,Ce.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,Ce.mknod(e,t,0)},mkdirTree:function(e,t){for(var i=e.split("/"),s="",r=0;r<i.length;++r)if(i[r]){s+="/"+i[r];try{Ce.mkdir(s,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,i){return void 0===i&&(i=t,t=438),t|=8192,Ce.mknod(e,t,i)},symlink:function(e,t){if(!Pe.resolve(e))throw new Ce.ErrnoError(44);var i=Ce.lookupPath(t,{parent:!0}).node;if(!i)throw new Ce.ErrnoError(44);var s=Ee.basename(t),r=Ce.mayCreate(i,s);if(r)throw new Ce.ErrnoError(r);if(!i.node_ops.symlink)throw new Ce.ErrnoError(63);return i.node_ops.symlink(i,s,e)},rename:function(e,t){var i,s,r=Ee.dirname(e),o=Ee.dirname(t),a=Ee.basename(e),n=Ee.basename(t);if(i=Ce.lookupPath(e,{parent:!0}).node,s=Ce.lookupPath(t,{parent:!0}).node,!i||!s)throw new Ce.ErrnoError(44);if(i.mount!==s.mount)throw new Ce.ErrnoError(75);var h,l=Ce.lookupNode(i,a),c=Pe.relative(e,o);if("."!==c.charAt(0))throw new Ce.ErrnoError(28);if("."!==(c=Pe.relative(t,r)).charAt(0))throw new Ce.ErrnoError(55);try{h=Ce.lookupNode(s,n)}catch(e){}if(l!==h){var u=Ce.isDir(l.mode),p=Ce.mayDelete(i,a,u);if(p)throw new Ce.ErrnoError(p);if(p=h?Ce.mayDelete(s,n,u):Ce.mayCreate(s,n))throw new Ce.ErrnoError(p);if(!i.node_ops.rename)throw new Ce.ErrnoError(63);if(Ce.isMountpoint(l)||h&&Ce.isMountpoint(h))throw new Ce.ErrnoError(10);if(s!==i&&(p=Ce.nodePermissions(i,"w")))throw new Ce.ErrnoError(p);try{Ce.trackingDelegate.willMovePath&&Ce.trackingDelegate.willMovePath(e,t)}catch(i){E("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}Ce.hashRemoveNode(l);try{i.node_ops.rename(l,s,n)}catch(e){throw e}finally{Ce.hashAddNode(l)}try{Ce.trackingDelegate.onMovePath&&Ce.trackingDelegate.onMovePath(e,t)}catch(i){E("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}}},rmdir:function(e){var t=Ce.lookupPath(e,{parent:!0}).node,i=Ee.basename(e),s=Ce.lookupNode(t,i),r=Ce.mayDelete(t,i,!0);if(r)throw new Ce.ErrnoError(r);if(!t.node_ops.rmdir)throw new Ce.ErrnoError(63);if(Ce.isMountpoint(s))throw new Ce.ErrnoError(10);try{Ce.trackingDelegate.willDeletePath&&Ce.trackingDelegate.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,i),Ce.destroyNode(s);try{Ce.trackingDelegate.onDeletePath&&Ce.trackingDelegate.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=Ce.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new Ce.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=Ce.lookupPath(e,{parent:!0}).node,i=Ee.basename(e),s=Ce.lookupNode(t,i),r=Ce.mayDelete(t,i,!1);if(r)throw new Ce.ErrnoError(r);if(!t.node_ops.unlink)throw new Ce.ErrnoError(63);if(Ce.isMountpoint(s))throw new Ce.ErrnoError(10);try{Ce.trackingDelegate.willDeletePath&&Ce.trackingDelegate.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,i),Ce.destroyNode(s);try{Ce.trackingDelegate.onDeletePath&&Ce.trackingDelegate.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=Ce.lookupPath(e).node;if(!t)throw new Ce.ErrnoError(44);if(!t.node_ops.readlink)throw new Ce.ErrnoError(28);return Pe.resolve(Ce.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var i=Ce.lookupPath(e,{follow:!t}).node;if(!i)throw new Ce.ErrnoError(44);if(!i.node_ops.getattr)throw new Ce.ErrnoError(63);return i.node_ops.getattr(i)},lstat:function(e){return Ce.stat(e,!0)},chmod:function(e,t,i){var s;if(!(s="string"==typeof e?Ce.lookupPath(e,{follow:!i}).node:e).node_ops.setattr)throw new Ce.ErrnoError(63);s.node_ops.setattr(s,{mode:4095&t|-4096&s.mode,timestamp:Date.now()})},lchmod:function(e,t){Ce.chmod(e,t,!0)},fchmod:function(e,t){var i=Ce.getStream(e);if(!i)throw new Ce.ErrnoError(8);Ce.chmod(i.node,t)},chown:function(e,t,i,s){var r;if(!(r="string"==typeof e?Ce.lookupPath(e,{follow:!s}).node:e).node_ops.setattr)throw new Ce.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(e,t,i){Ce.chown(e,t,i,!0)},fchown:function(e,t,i){var s=Ce.getStream(e);if(!s)throw new Ce.ErrnoError(8);Ce.chown(s.node,t,i)},truncate:function(e,t){if(t<0)throw new Ce.ErrnoError(28);var i;if(!(i="string"==typeof e?Ce.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new Ce.ErrnoError(63);if(Ce.isDir(i.mode))throw new Ce.ErrnoError(31);if(!Ce.isFile(i.mode))throw new Ce.ErrnoError(28);var s=Ce.nodePermissions(i,"w");if(s)throw new Ce.ErrnoError(s);i.node_ops.setattr(i,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var i=Ce.getStream(e);if(!i)throw new Ce.ErrnoError(8);if(0==(2097155&i.flags))throw new Ce.ErrnoError(28);Ce.truncate(i.node,t)},utime:function(e,t,i){var s=Ce.lookupPath(e,{follow:!0}).node;s.node_ops.setattr(s,{timestamp:Math.max(t,i)})},open:function(e,t,i,s,o){if(""===e)throw new Ce.ErrnoError(44);var a;if(i=void 0===i?438:i,i=64&(t="string"==typeof t?Ce.modeStringToFlags(t):t)?4095&i|32768:0,"object"==typeof e)a=e;else{e=Ee.normalize(e);try{a=Ce.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var n=!1;if(64&t)if(a){if(128&t)throw new Ce.ErrnoError(20)}else a=Ce.mknod(e,i,0),n=!0;if(!a)throw new Ce.ErrnoError(44);if(Ce.isChrdev(a.mode)&&(t&=-513),65536&t&&!Ce.isDir(a.mode))throw new Ce.ErrnoError(54);if(!n){var h=Ce.mayOpen(a,t);if(h)throw new Ce.ErrnoError(h)}512&t&&Ce.truncate(a,0),t&=-131713;var l=Ce.createStream({node:a,path:Ce.getPath(a),flags:t,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1},s,o);l.stream_ops.open&&l.stream_ops.open(l),!r.logReadFiles||1&t||(Ce.readFiles||(Ce.readFiles={}),e in Ce.readFiles||(Ce.readFiles[e]=1,E("FS.trackingDelegate error on read file: "+e)));try{if(Ce.trackingDelegate.onOpenFile){var c=0;1!=(2097155&t)&&(c|=Ce.tracking.openFlags.READ),0!=(2097155&t)&&(c|=Ce.tracking.openFlags.WRITE),Ce.trackingDelegate.onOpenFile(e,c)}}catch(t){E("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return l},close:function(e){if(Ce.isClosed(e))throw new Ce.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{Ce.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,i){if(Ce.isClosed(e))throw new Ce.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new Ce.ErrnoError(70);if(0!=i&&1!=i&&2!=i)throw new Ce.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,i),e.ungotten=[],e.position},read:function(e,t,i,s,r){if(i>>>=0,s<0||r<0)throw new Ce.ErrnoError(28);if(Ce.isClosed(e))throw new Ce.ErrnoError(8);if(1==(2097155&e.flags))throw new Ce.ErrnoError(8);if(Ce.isDir(e.node.mode))throw new Ce.ErrnoError(31);if(!e.stream_ops.read)throw new Ce.ErrnoError(28);var o=void 0!==r;if(o){if(!e.seekable)throw new Ce.ErrnoError(70)}else r=e.position;var a=e.stream_ops.read(e,t,i,s,r);return o||(e.position+=a),a},write:function(e,t,i,s,r,o){if(i>>>=0,s<0||r<0)throw new Ce.ErrnoError(28);if(Ce.isClosed(e))throw new Ce.ErrnoError(8);if(0==(2097155&e.flags))throw new Ce.ErrnoError(8);if(Ce.isDir(e.node.mode))throw new Ce.ErrnoError(31);if(!e.stream_ops.write)throw new Ce.ErrnoError(28);e.seekable&&1024&e.flags&&Ce.llseek(e,0,2);var a=void 0!==r;if(a){if(!e.seekable)throw new Ce.ErrnoError(70)}else r=e.position;var n=e.stream_ops.write(e,t,i,s,r,o);a||(e.position+=n);try{e.path&&Ce.trackingDelegate.onWriteToFile&&Ce.trackingDelegate.onWriteToFile(e.path)}catch(t){E("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return n},allocate:function(e,t,i){if(Ce.isClosed(e))throw new Ce.ErrnoError(8);if(t<0||i<=0)throw new Ce.ErrnoError(28);if(0==(2097155&e.flags))throw new Ce.ErrnoError(8);if(!Ce.isFile(e.node.mode)&&!Ce.isDir(e.node.mode))throw new Ce.ErrnoError(43);if(!e.stream_ops.allocate)throw new Ce.ErrnoError(138);e.stream_ops.allocate(e,t,i)},mmap:function(e,t,i,s,r,o){if(t>>>=0,0!=(2&r)&&0==(2&o)&&2!=(2097155&e.flags))throw new Ce.ErrnoError(2);if(1==(2097155&e.flags))throw new Ce.ErrnoError(2);if(!e.stream_ops.mmap)throw new Ce.ErrnoError(43);return e.stream_ops.mmap(e,t,i,s,r,o)},msync:function(e,t,i,s,r){return i>>>=0,e&&e.stream_ops.msync?e.stream_ops.msync(e,t,i,s,r):0},munmap:function(e){return 0},ioctl:function(e,t,i){if(!e.stream_ops.ioctl)throw new Ce.ErrnoError(59);return e.stream_ops.ioctl(e,t,i)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var i,s=Ce.open(e,t.flags),r=Ce.stat(e).size,o=new Uint8Array(r);return Ce.read(s,o,0,r,0),"utf8"===t.encoding?i=w(o,0):"binary"===t.encoding&&(i=o),Ce.close(s),i},writeFile:function(e,t,i){(i=i||{}).flags=i.flags||577;var s=Ce.open(e,i.flags,i.mode);if("string"==typeof t){var r=new Uint8Array(S(t)+1),o=R(t,r,0,r.length);Ce.write(s,r,0,o,void 0,i.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");Ce.write(s,t,0,t.byteLength,void 0,i.canOwn)}Ce.close(s)},cwd:function(){return Ce.currentPath},chdir:function(e){var t=Ce.lookupPath(e,{follow:!0});if(null===t.node)throw new Ce.ErrnoError(44);if(!Ce.isDir(t.node.mode))throw new Ce.ErrnoError(54);var i=Ce.nodePermissions(t.node,"x");if(i)throw new Ce.ErrnoError(i);Ce.currentPath=t.path},createDefaultDirectories:function(){Ce.mkdir("/tmp"),Ce.mkdir("/home"),Ce.mkdir("/home/web_user")},createDefaultDevices:function(){Ce.mkdir("/dev"),Ce.registerDevice(Ce.makedev(1,3),{read:function(){return 0},write:function(e,t,i,s,r){return s}}),Ce.mkdev("/dev/null",Ce.makedev(1,3)),be.register(Ce.makedev(5,0),be.default_tty_ops),be.register(Ce.makedev(6,0),be.default_tty1_ops),Ce.mkdev("/dev/tty",Ce.makedev(5,0)),Ce.mkdev("/dev/tty1",Ce.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(l)try{var t=require_crypto();return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){re("randomDevice")}}();Ce.createDevice("/dev","random",e),Ce.createDevice("/dev","urandom",e),Ce.mkdir("/dev/shm"),Ce.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){Ce.mkdir("/proc"),Ce.mkdir("/proc/self"),Ce.mkdir("/proc/self/fd"),Ce.mount({mount:function(){var e=Ce.createNode("/proc/self","fd",16895,73);return e.node_ops={lookup:function(e,t){var i=+t,s=Ce.getStream(i);if(!s)throw new Ce.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return s.path}}};return r.parent=r,r}},e}},{},"/proc/self/fd")},createStandardStreams:function(){r.stdin?Ce.createDevice("/dev","stdin",r.stdin):Ce.symlink("/dev/tty","/dev/stdin"),r.stdout?Ce.createDevice("/dev","stdout",null,r.stdout):Ce.symlink("/dev/tty","/dev/stdout"),r.stderr?Ce.createDevice("/dev","stderr",null,r.stderr):Ce.symlink("/dev/tty1","/dev/stderr"),Ce.open("/dev/stdin",0),Ce.open("/dev/stdout",1),Ce.open("/dev/stderr",1)},ensureErrnoError:function(){Ce.ErrnoError||(Ce.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},Ce.ErrnoError.prototype=new Error,Ce.ErrnoError.prototype.constructor=Ce.ErrnoError,[44].forEach((function(e){Ce.genericErrors[e]=new Ce.ErrnoError(e),Ce.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){Ce.ensureErrnoError(),Ce.nameTable=new Array(4096),Ce.mount(we,{},"/"),Ce.createDefaultDirectories(),Ce.createDefaultDevices(),Ce.createSpecialDirectories(),Ce.filesystems={MEMFS:we}},init:function(e,t,i){Ce.init.initialized=!0,Ce.ensureErrnoError(),r.stdin=e||r.stdin,r.stdout=t||r.stdout,r.stderr=i||r.stderr,Ce.createStandardStreams()},quit:function(){Ce.init.initialized=!1;var e=r._fflush;e&&e(0);for(var t=0;t<Ce.streams.length;t++){var i=Ce.streams[t];i&&Ce.close(i)}},getMode:function(e,t){var i=0;return e&&(i|=365),t&&(i|=146),i},findObject:function(e,t){var i=Ce.analyzePath(e,t);return i.exists?i.object:null},analyzePath:function(e,t){try{e=(s=Ce.lookupPath(e,{follow:!t})).path}catch(e){}var i={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var s=Ce.lookupPath(e,{parent:!0});i.parentExists=!0,i.parentPath=s.path,i.parentObject=s.node,i.name=Ee.basename(e),s=Ce.lookupPath(e,{follow:!t}),i.exists=!0,i.path=s.path,i.object=s.node,i.name=s.node.name,i.isRoot="/"===s.path}catch(e){i.error=e.errno}return i},createPath:function(e,t,i,s){e="string"==typeof e?e:Ce.getPath(e);for(var r=t.split("/").reverse();r.length;){var o=r.pop();if(o){var a=Ee.join2(e,o);try{Ce.mkdir(a)}catch(e){}e=a}}return a},createFile:function(e,t,i,s,r){var o=Ee.join2("string"==typeof e?e:Ce.getPath(e),t),a=Ce.getMode(s,r);return Ce.create(o,a)},createDataFile:function(e,t,i,s,r,o){var a=t?Ee.join2("string"==typeof e?e:Ce.getPath(e),t):e,n=Ce.getMode(s,r),h=Ce.create(a,n);if(i){if("string"==typeof i){for(var l=new Array(i.length),c=0,u=i.length;c<u;++c)l[c]=i.charCodeAt(c);i=l}Ce.chmod(h,146|n);var p=Ce.open(h,577);Ce.write(p,i,0,i.length,0,o),Ce.close(p),Ce.chmod(h,n)}return h},createDevice:function(e,t,i,s){var r=Ee.join2("string"==typeof e?e:Ce.getPath(e),t),o=Ce.getMode(!!i,!!s);Ce.createDevice.major||(Ce.createDevice.major=64);var a=Ce.makedev(Ce.createDevice.major++,0);return Ce.registerDevice(a,{open:function(e){e.seekable=!1},close:function(e){s&&s.buffer&&s.buffer.length&&s(10)},read:function(e,t,s,r,o){for(var a=0,n=0;n<r;n++){var h;try{h=i()}catch(e){throw new Ce.ErrnoError(29)}if(void 0===h&&0===a)throw new Ce.ErrnoError(6);if(null==h)break;a++,t[s+n]=h}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,i,r,o){for(var a=0;a<r;a++)try{s(t[i+a])}catch(e){throw new Ce.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),a}}),Ce.mkdev(r,o,a)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!d)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=li(d(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new Ce.ErrnoError(29)}},createLazyFile:function(e,t,i,s,r){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.getter(i)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",i,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+i+". Status: "+e.status);var t,s=Number(e.getResponseHeader("Content-length")),r=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;r||(a=s);var n=this;n.setDataGetter((function(e){var t=e*a,r=(e+1)*a-1;if(r=Math.min(r,s-1),void 0===n.chunks[e]&&(n.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>s-1)throw new Error("only "+s+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",i,!1),s!==a&&r.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+i+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):li(r.responseText||"",!0)}(t,r)),void 0===n.chunks[e])throw new Error("doXHR failed!");return n.chunks[e]})),!o&&s||(a=s=1,s=this.getter(0).length,a=s,I("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=s,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new o;Object.defineProperties(a,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var n={isDevice:!1,contents:a}}else n={isDevice:!1,url:i};var l=Ce.createFile(e,t,n,s,r);n.contents?l.contents=n.contents:n.url&&(l.contents=null,l.url=n.url),Object.defineProperties(l,{usedBytes:{get:function(){return this.contents.length}}});var c={};return Object.keys(l.stream_ops).forEach((function(e){var t=l.stream_ops[e];c[e]=function(){return Ce.forceLoadFile(l),t.apply(null,arguments)}})),c.read=function(e,t,i,s,r){Ce.forceLoadFile(l);var o=e.node.contents;if(r>=o.length)return 0;var a=Math.min(o.length-r,s);if(o.slice)for(var n=0;n<a;n++)t[i+n]=o[r+n];else for(n=0;n<a;n++)t[i+n]=o.get(r+n);return a},l.stream_ops=c,l},createPreloadedFile:function(e,t,i,s,o,a,n,h,l,c){Browser.init();var u=t?Pe.resolve(Ee.join2(e,t)):e;function p(i){function p(i){c&&c(),h||Ce.createDataFile(e,t,i,s,o,l),a&&a(),se()}var d=!1;r.preloadPlugins.forEach((function(e){d||e.canHandle(u)&&(e.handle(i,u,p,(function(){n&&n(),se()})),d=!0)})),d||p(i)}ie(),"string"==typeof i?Browser.asyncLoad(i,(function(e){p(e)}),n):p(i)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=Ce.indexedDB();try{var r=s.open(Ce.DB_NAME(),Ce.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=function(){I("creating db"),r.result.createObjectStore(Ce.DB_STORE_NAME)},r.onsuccess=function(){var s=r.result.transaction([Ce.DB_STORE_NAME],"readwrite"),o=s.objectStore(Ce.DB_STORE_NAME),a=0,n=0,h=e.length;function l(){0==n?t():i()}e.forEach((function(e){var t=o.put(Ce.analyzePath(e).object.contents,e);t.onsuccess=function(){++a+n==h&&l()},t.onerror=function(){n++,a+n==h&&l()}})),s.onerror=i},r.onerror=i},loadFilesFromDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=Ce.indexedDB();try{var r=s.open(Ce.DB_NAME(),Ce.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=i,r.onsuccess=function(){var s=r.result;try{var o=s.transaction([Ce.DB_STORE_NAME],"readonly")}catch(e){return void i(e)}var a=o.objectStore(Ce.DB_STORE_NAME),n=0,h=0,l=e.length;function c(){0==h?t():i()}e.forEach((function(e){var t=a.get(e);t.onsuccess=function(){Ce.analyzePath(e).exists&&Ce.unlink(e),Ce.createDataFile(Ee.dirname(e),Ee.basename(e),t.result,!0,!0,!0),++n+h==l&&c()},t.onerror=function(){h++,n+h==l&&c()}})),o.onerror=i},r.onerror=i}},Re={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t){if("/"!==t[0]){var i;if(-100===e)i=Ce.cwd();else{var s=Ce.getStream(e);if(!s)throw new Ce.ErrnoError(8);i=s.path}t=Ee.join2(i,t)}return t},doStat:function(e,t,i){try{var s=e(t)}catch(e){if(e&&e.node&&Ee.normalize(t)!==Ee.normalize(Ce.getPath(e.node)))return-54;throw e}return N[i>>>2]=s.dev,N[i+4>>>2]=0,N[i+8>>>2]=s.ino,N[i+12>>>2]=s.mode,N[i+16>>>2]=s.nlink,N[i+20>>>2]=s.uid,N[i+24>>>2]=s.gid,N[i+28>>>2]=s.rdev,N[i+32>>>2]=0,ce=[s.size>>>0,(le=s.size,+Math.abs(le)>=1?le>0?(0|Math.min(+Math.floor(le/4294967296),4294967295))>>>0:~~+Math.ceil((le-+(~~le>>>0))/4294967296)>>>0:0)],N[i+40>>>2]=ce[0],N[i+44>>>2]=ce[1],N[i+48>>>2]=4096,N[i+52>>>2]=s.blocks,N[i+56>>>2]=s.atime.getTime()/1e3|0,N[i+60>>>2]=0,N[i+64>>>2]=s.mtime.getTime()/1e3|0,N[i+68>>>2]=0,N[i+72>>>2]=s.ctime.getTime()/1e3|0,N[i+76>>>2]=0,ce=[s.ino>>>0,(le=s.ino,+Math.abs(le)>=1?le>0?(0|Math.min(+Math.floor(le/4294967296),4294967295))>>>0:~~+Math.ceil((le-+(~~le>>>0))/4294967296)>>>0:0)],N[i+80>>>2]=ce[0],N[i+84>>>2]=ce[1],0},doMsync:function(e,t,i,s,r){var o=A.slice(e,e+i);Ce.msync(t,o,r,i,s)},doMkdir:function(e,t){return"/"===(e=Ee.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),Ce.mkdir(e,t,0),0},doMknod:function(e,t,i){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return Ce.mknod(e,t,i),0},doReadlink:function(e,t,i){if(i<=0)return-28;var s=Ce.readlink(e),r=Math.min(i,S(s)),o=M[t+r>>>0];return F(s,t,i+1),M[t+r>>>0]=o,r},doAccess:function(e,t){if(-8&t)return-28;var i;if(!(i=Ce.lookupPath(e,{follow:!0}).node))return-44;var s="";return 4&t&&(s+="r"),2&t&&(s+="w"),1&t&&(s+="x"),s&&Ce.nodePermissions(i,s)?-2:0},doDup:function(e,t,i){var s=Ce.getStream(i);return s&&Ce.close(s),Ce.open(e,t,0,i,i).fd},doReadv:function(e,t,i,s){for(var r=0,o=0;o<i;o++){var a=N[t+8*o>>>2],n=N[t+(8*o+4)>>>2],h=Ce.read(e,M,a,n,s);if(h<0)return-1;if(r+=h,h<n)break}return r},doWritev:function(e,t,i,s){for(var r=0,o=0;o<i;o++){var a=N[t+8*o>>>2],n=N[t+(8*o+4)>>>2],h=Ce.write(e,M,a,n,s);if(h<0)return-1;r+=h}return r},varargs:void 0,get:function(){return Re.varargs+=4,N[Re.varargs-4>>>2]},getStr:function(e){return C(e)},getStreamFromFD:function(e){var t=Ce.getStream(e);if(!t)throw new Ce.ErrnoError(8);return t},get64:function(e,t){return e}},Fe={};function Se(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function xe(e){return this.fromWireType(B[e>>>2])}var Me={},Ae={},Le={};function Oe(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function Ne(e,t){return e=Oe(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function Be(e,t){var i=Ne(t,(function(e){this.name=t,this.message=e;var i=new Error(e).stack;void 0!==i&&(this.stack=this.toString()+"\n"+i.replace(/^Error(:[^\n]*)?\n/,""))}));return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},i}var ke=void 0;function Ge(e){throw new ke(e)}function Ue(e,t,i){function s(t){var s=i(t);s.length!==e.length&&Ge("Mismatched type converter count");for(var r=0;r<e.length;++r)Xe(e[r],s[r])}e.forEach((function(e){Le[e]=t}));var r=new Array(t.length),o=[],a=0;t.forEach((function(e,t){Ae.hasOwnProperty(e)?r[t]=Ae[e]:(o.push(e),Me.hasOwnProperty(e)||(Me[e]=[]),Me[e].push((function(){r[t]=Ae[e],++a===o.length&&s(r)})))})),0===o.length&&s(r)}var Ve={};function He(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var je=void 0;function ze(e){for(var t="",i=e;A[i>>>0];)t+=je[A[i++>>>0]];return t}var We=void 0;function $e(e){throw new We(e)}function Xe(e,t,i){if(i=i||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var s=t.name;if(e||$e('type "'+s+'" must have a positive integer typeid pointer'),Ae.hasOwnProperty(e)){if(i.ignoreDuplicateRegistrations)return;$e("Cannot register type '"+s+"' twice")}if(Ae[e]=t,delete Le[e],Me.hasOwnProperty(e)){var r=Me[e];delete Me[e],r.forEach((function(e){e()}))}}function Ye(e){if(!(this instanceof nt))return!1;if(!(e instanceof nt))return!1;for(var t=this.$$.ptrType.registeredClass,i=this.$$.ptr,s=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)i=t.upcast(i),t=t.baseClass;for(;s.baseClass;)r=s.upcast(r),s=s.baseClass;return t===s&&i===r}function Ke(e){$e(e.$$.ptrType.registeredClass.name+" instance already deleted")}var qe=!1;function Ze(e){}function Qe(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function Je(e){return"undefined"==typeof FinalizationGroup?(Je=function(e){return e},e):(qe=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var i=t.value;i.ptr?Qe(i):console.warn("object already deleted: "+i.ptr)}})),Ze=function(e){qe.unregister(e.$$)},(Je=function(e){return qe.register(e,e.$$,e.$$),e})(e))}function et(){if(this.$$.ptr||Ke(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=Je(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function tt(){this.$$.ptr||Ke(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&$e("Object already scheduled for deletion"),Ze(this),Qe(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function it(){return!this.$$.ptr}var st=void 0,rt=[];function ot(){for(;rt.length;){var e=rt.pop();e.$$.deleteScheduled=!1,e.delete()}}function at(){return this.$$.ptr||Ke(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&$e("Object already scheduled for deletion"),rt.push(this),1===rt.length&&st&&st(ot),this.$$.deleteScheduled=!0,this}function nt(){}var ht={};function lt(e,t,i){if(void 0===e[t].overloadTable){var s=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||$e("Function '"+i+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[s.argCount]=s}}function ct(e,t,i){r.hasOwnProperty(e)?((void 0===i||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[i])&&$e("Cannot register public name '"+e+"' twice"),lt(r,e,e),r.hasOwnProperty(i)&&$e("Cannot register multiple overloads of a function with the same number of arguments ("+i+")!"),r[e].overloadTable[i]=t):(r[e]=t,void 0!==i&&(r[e].numArguments=i))}function ut(e,t,i,s,r,o,a,n){this.name=e,this.constructor=t,this.instancePrototype=i,this.rawDestructor=s,this.baseClass=r,this.getActualType=o,this.upcast=a,this.downcast=n,this.pureVirtualFunctions=[]}function pt(e,t,i){for(;t!==i;)t.upcast||$e("Expected null or instance of "+i.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function dt(e,t){if(null===t)return this.isReference&&$e("null is not a valid "+this.name),0;t.$$||$e('Cannot pass "'+jt(t)+'" as a '+this.name),t.$$.ptr||$e("Cannot pass deleted object as a pointer of type "+this.name);var i=t.$$.ptrType.registeredClass;return pt(t.$$.ptr,i,this.registeredClass)}function mt(e,t){var i;if(null===t)return this.isReference&&$e("null is not a valid "+this.name),this.isSmartPointer?(i=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,i),i):0;t.$$||$e('Cannot pass "'+jt(t)+'" as a '+this.name),t.$$.ptr||$e("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&$e("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;if(i=pt(t.$$.ptr,s,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&$e("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?i=t.$$.smartPtr:$e("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:i=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)i=t.$$.smartPtr;else{var r=t.clone();i=this.rawShare(i,Ut((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,i)}break;default:$e("Unsupporting sharing policy")}return i}function ft(e,t){if(null===t)return this.isReference&&$e("null is not a valid "+this.name),0;t.$$||$e('Cannot pass "'+jt(t)+'" as a '+this.name),t.$$.ptr||$e("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&$e("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;return pt(t.$$.ptr,i,this.registeredClass)}function gt(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function _t(e){this.rawDestructor&&this.rawDestructor(e)}function yt(e){null!==e&&e.delete()}function Tt(e,t,i){if(t===i)return e;if(void 0===i.baseClass)return null;var s=Tt(e,t,i.baseClass);return null===s?null:i.downcast(s)}function vt(){return Object.keys(Pt).length}function It(){var e=[];for(var t in Pt)Pt.hasOwnProperty(t)&&e.push(Pt[t]);return e}function Et(e){st=e,rt.length&&st&&st(ot)}var Pt={};function bt(e,t){return t=function(e,t){for(void 0===t&&$e("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),Pt[t]}function Dt(e,t){return t.ptrType&&t.ptr||Ge("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&Ge("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Je(Object.create(e,{$$:{value:t}}))}function wt(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var i=bt(this.registeredClass,t);if(void 0!==i){if(0===i.$$.count.value)return i.$$.ptr=t,i.$$.smartPtr=e,i.clone();var s=i.clone();return this.destructor(e),s}function r(){return this.isSmartPointer?Dt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Dt(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,a=this.registeredClass.getActualType(t),n=ht[a];if(!n)return r.call(this);o=this.isConst?n.constPointerType:n.pointerType;var h=Tt(t,this.registeredClass,o.registeredClass);return null===h?r.call(this):this.isSmartPointer?Dt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h,smartPtrType:this,smartPtr:e}):Dt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h})}function Ct(e,t,i,s,r,o,a,n,h,l,c){this.name=e,this.registeredClass=t,this.isReference=i,this.isConst=s,this.isSmartPointer=r,this.pointeeType=o,this.sharingPolicy=a,this.rawGetPointee=n,this.rawConstructor=h,this.rawShare=l,this.rawDestructor=c,r||void 0!==t.baseClass?this.toWireType=mt:s?(this.toWireType=dt,this.destructorFunction=null):(this.toWireType=ft,this.destructorFunction=null)}function Rt(e,t,i){r.hasOwnProperty(e)||Ge("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==i?r[e].overloadTable[i]=t:(r[e]=t,r[e].argCount=i)}function Ft(e,t){var i=-1!=(e=ze(e)).indexOf("j")?function(e,t){b(e.indexOf("j")>=0,"getDynCaller should only be called with i64 sigs");var i=[];return function(){i.length=arguments.length;for(var s=0;s<arguments.length;s++)i[s]=arguments[s];return me(e,t,i)}}(e,t):Y.get(t);return"function"!=typeof i&&$e("unknown function pointer with signature "+e+": "+t),i}var St=void 0;function xt(e){var t=mi(e),i=ze(t);return di(t),i}function Mt(e,t){var i=[],s={};throw t.forEach((function e(t){s[t]||Ae[t]||(Le[t]?Le[t].forEach(e):(i.push(t),s[t]=!0))})),new St(e+": "+i.map(xt).join([", "]))}function At(e,t){for(var i=[],s=0;s<e;s++)i.push(N[(t>>2)+s>>>0]);return i}function Lt(e,t,i,s,r){var o=t.length;o<2&&$e("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==i,n=!1,h=1;h<t.length;++h)if(null!==t[h]&&void 0===t[h].destructorFunction){n=!0;break}var l="void"!==t[0].name,c="",u="";for(h=0;h<o-2;++h)c+=(0!==h?", ":"")+"arg"+h,u+=(0!==h?", ":"")+"arg"+h+"Wired";var p="return function "+Oe(e)+"("+c+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";n&&(p+="var destructors = [];\n");var d=n?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[$e,s,r,Se,t[0],t[1]];for(a&&(p+="var thisWired = classParam.toWireType("+d+", this);\n"),h=0;h<o-2;++h)p+="var arg"+h+"Wired = argType"+h+".toWireType("+d+", arg"+h+"); // "+t[h+2].name+"\n",m.push("argType"+h),f.push(t[h+2]);if(a&&(u="thisWired"+(u.length>0?", ":"")+u),p+=(l?"var rv = ":"")+"invoker(fn"+(u.length>0?", ":"")+u+");\n",n)p+="runDestructors(destructors);\n";else for(h=a?1:2;h<t.length;++h){var g=1===h?"thisWired":"arg"+(h-2)+"Wired";null!==t[h].destructorFunction&&(p+=g+"_dtor("+g+"); // "+t[h].name+"\n",m.push(g+"_dtor"),f.push(t[h].destructorFunction))}return l&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",m.push(p),function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var i=Ne(e.name||"unknownFunctionName",(function(){}));i.prototype=e.prototype;var s=new i,r=e.apply(s,t);return r instanceof Object?r:s}(Function,m).apply(null,f)}var Ot=[],Nt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Bt(e){e>4&&0==--Nt[e].refcount&&(Nt[e]=void 0,Ot.push(e))}function kt(){for(var e=0,t=5;t<Nt.length;++t)void 0!==Nt[t]&&++e;return e}function Gt(){for(var e=5;e<Nt.length;++e)if(void 0!==Nt[e])return Nt[e];return null}function Ut(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Ot.length?Ot.pop():Nt.length;return Nt[t]={refcount:1,value:e},t}}function Vt(e,t,i){switch(t){case 0:return function(e){var t=i?M:A;return this.fromWireType(t[e>>>0])};case 1:return function(e){var t=i?L:O;return this.fromWireType(t[e>>>1])};case 2:return function(e){var t=i?N:B;return this.fromWireType(t[e>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Ht(e,t){var i=Ae[e];return void 0===i&&$e(t+" has unknown type "+xt(e)),i}function jt(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function zt(e,t){switch(t){case 2:return function(e){return this.fromWireType(k[e>>>2])};case 3:return function(e){return this.fromWireType(G[e>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Wt(e,t,i){switch(t){case 0:return i?function(e){return M[e>>>0]}:function(e){return A[e>>>0]};case 1:return i?function(e){return L[e>>>1]}:function(e){return O[e>>>1]};case 2:return i?function(e){return N[e>>>2]}:function(e){return B[e>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function $t(e){return e||$e("Cannot use deleted val. handle = "+e),Nt[e].value}var Xt,Yt={};function Kt(e){var t=Yt[e];return void 0===t?ze(e):t}function qt(){return"object"==typeof globalThis?globalThis:Function("return this")()}function Zt(e){try{return v.grow(e-x.byteLength+65535>>>16),X(v.buffer),1}catch(e){}}Xt=l?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Qt={};function Jt(){if(!Jt.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(var t in Qt)e[t]=Qt[t];var i=[];for(var t in e)i.push(t+"="+e[t]);Jt.strings=i}return Jt.strings}function ei(e){return e%4==0&&(e%100!=0||e%400==0)}function ti(e,t){for(var i=0,s=0;s<=t;i+=e[s++]);return i}var ii=[31,29,31,30,31,30,31,31,30,31,30,31],si=[31,28,31,30,31,30,31,31,30,31,30,31];function ri(e,t){for(var i=new Date(e.getTime());t>0;){var s=ei(i.getFullYear()),r=i.getMonth(),o=(s?ii:si)[r];if(!(t>o-i.getDate()))return i.setDate(i.getDate()+t),i;t-=o-i.getDate()+1,i.setDate(1),r<11?i.setMonth(r+1):(i.setMonth(0),i.setFullYear(i.getFullYear()+1))}return i}function oi(e,t,i,s){var r=N[s+40>>>2],o={tm_sec:N[s>>>2],tm_min:N[s+4>>>2],tm_hour:N[s+8>>>2],tm_mday:N[s+12>>>2],tm_mon:N[s+16>>>2],tm_year:N[s+20>>>2],tm_wday:N[s+24>>>2],tm_yday:N[s+28>>>2],tm_isdst:N[s+32>>>2],tm_gmtoff:N[s+36>>>2],tm_zone:r?C(r):""},a=C(i),n={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var h in n)a=a.replace(new RegExp(h,"g"),n[h]);var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","December"];function u(e,t,i){for(var s="number"==typeof e?e.toString():e||"";s.length<t;)s=i[0]+s;return s}function p(e,t){return u(e,t,"0")}function d(e,t){function i(e){return e<0?-1:e>0?1:0}var s;return 0===(s=i(e.getFullYear()-t.getFullYear()))&&0===(s=i(e.getMonth()-t.getMonth()))&&(s=i(e.getDate()-t.getDate())),s}function m(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function f(e){var t=ri(new Date(e.tm_year+1900,0,1),e.tm_yday),i=new Date(t.getFullYear(),0,4),s=new Date(t.getFullYear()+1,0,4),r=m(i),o=m(s);return d(r,t)<=0?d(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return l[e.tm_wday].substring(0,3)},"%A":function(e){return l[e.tm_wday]},"%b":function(e){return c[e.tm_mon].substring(0,3)},"%B":function(e){return c[e.tm_mon]},"%C":function(e){return p((e.tm_year+1900)/100|0,2)},"%d":function(e){return p(e.tm_mday,2)},"%e":function(e){return u(e.tm_mday,2," ")},"%g":function(e){return f(e).toString().substring(2)},"%G":function(e){return f(e)},"%H":function(e){return p(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),p(t,2)},"%j":function(e){return p(e.tm_mday+ti(ei(e.tm_year+1900)?ii:si,e.tm_mon-1),3)},"%m":function(e){return p(e.tm_mon+1,2)},"%M":function(e){return p(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return p(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),i=0===t.getDay()?t:ri(t,7-t.getDay()),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(i,s)<0){var r=ti(ei(s.getFullYear())?ii:si,s.getMonth()-1)-31,o=31-i.getDate()+r+s.getDate();return p(Math.ceil(o/7),2)}return 0===d(i,t)?"01":"00"},"%V":function(e){var t,i=new Date(e.tm_year+1900,0,4),s=new Date(e.tm_year+1901,0,4),r=m(i),o=m(s),a=ri(new Date(e.tm_year+1900,0,1),e.tm_yday);return d(a,r)<0?"53":d(o,a)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),p(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),i=1===t.getDay()?t:ri(t,0===t.getDay()?1:7-t.getDay()+1),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(i,s)<0){var r=ti(ei(s.getFullYear())?ii:si,s.getMonth()-1)-31,o=31-i.getDate()+r+s.getDate();return p(Math.ceil(o/7),2)}return 0===d(i,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,i=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(i?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var h in g)a.indexOf(h)>=0&&(a=a.replace(new RegExp(h,"g"),g[h](o)));var _,y,T=li(a,!1);return T.length>t?0:(_=T,y=e,M.set(_,y>>>0),T.length-1)}var ai=function(e,t,i,s){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=Ce.nextInode++,this.name=t,this.mode=i,this.node_ops={},this.stream_ops={},this.rdev=s},ni=365,hi=146;function li(e,t,i){var s=i>0?i:S(e)+1,r=new Array(s),o=R(e,r,0,r.length);return t&&(r.length=o),r}Object.defineProperties(ai.prototype,{read:{get:function(){return(this.mode&ni)===ni},set:function(e){e?this.mode|=ni:this.mode&=-366}},write:{get:function(){return(this.mode&hi)===hi},set:function(e){e?this.mode|=hi:this.mode&=-147}},isFolder:{get:function(){return Ce.isDir(this.mode)}},isDevice:{get:function(){return Ce.isChrdev(this.mode)}}}),Ce.FSNode=ai,Ce.staticInit(),r.FS_createPath=Ce.createPath,r.FS_createDataFile=Ce.createDataFile,r.FS_createPreloadedFile=Ce.createPreloadedFile,r.FS_createLazyFile=Ce.createLazyFile,r.FS_createDevice=Ce.createDevice,r.FS_unlink=Ce.unlink,ke=r.InternalError=Be(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);je=e}(),We=r.BindingError=Be(Error,"BindingError"),nt.prototype.isAliasOf=Ye,nt.prototype.clone=et,nt.prototype.delete=tt,nt.prototype.isDeleted=it,nt.prototype.deleteLater=at,Ct.prototype.getPointee=gt,Ct.prototype.destructor=_t,Ct.prototype.argPackAdvance=8,Ct.prototype.readValueFromPointer=xe,Ct.prototype.deleteObject=yt,Ct.prototype.fromWireType=wt,r.getInheritedInstanceCount=vt,r.getLiveInheritedInstances=It,r.flushPendingDeletes=ot,r.setDelayFunction=Et,St=r.UnboundTypeError=Be(Error,"UnboundTypeError"),r.count_emval_handles=kt,r.get_first_emval=Gt,Z.push({func:function(){ui()}});var ci={z:function(e,t,i,s){re("Assertion failed: "+C(e)+", at: "+[t?C(t):"unknown filename",i,s?C(s):"unknown function"])},y:function(e){return pi(e+ve)+ve},x:function(e,t,i){throw new Ie(e).init(t,i),e},V:function(e,t,i){Re.varargs=i;try{var s=Re.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return s.tty?0:-59;case 21519:if(!s.tty)return-59;var r=Re.get();return N[r>>>2]=0,0;case 21520:return s.tty?-28:-59;case 21531:return r=Re.get(),Ce.ioctl(s,t,r);default:re("bad ioctl syscall "+t)}}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),-e.errno}},W:function(e,t,i){Re.varargs=i;try{var s=Re.getStr(e),r=Re.get();return Ce.open(s,t,r).fd}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),-e.errno}},$:function(e){var t=Fe[e];delete Fe[e];var i=t.elements,s=i.length,r=i.map((function(e){return e.getterReturnType})).concat(i.map((function(e){return e.setterArgumentType}))),o=t.rawConstructor,a=t.rawDestructor;Ue([e],r,(function(e){return i.forEach((function(t,i){var r=e[i],o=t.getter,a=t.getterContext,n=e[i+s],h=t.setter,l=t.setterContext;t.read=function(e){return r.fromWireType(o(a,e))},t.write=function(e,t){var i=[];h(l,e,n.toWireType(i,t)),Se(i)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(s),r=0;r<s;++r)t[r]=i[r].read(e);return a(e),t},toWireType:function(e,r){if(s!==r.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+s+", actual="+r.length);for(var n=o(),h=0;h<s;++h)i[h].write(n,r[h]);return null!==e&&e.push(a,n),n},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:a}]}))},q:function(e){var t=Ve[e];delete Ve[e];var i=t.rawConstructor,s=t.rawDestructor,r=t.fields;Ue([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var o={};return r.forEach((function(t,i){var s=t.fieldName,a=e[i],n=t.getter,h=t.getterContext,l=e[i+r.length],c=t.setter,u=t.setterContext;o[s]={read:function(e){return a.fromWireType(n(h,e))},write:function(e,t){var i=[];c(u,e,l.toWireType(i,t)),Se(i)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var i in o)t[i]=o[i].read(e);return s(e),t},toWireType:function(e,t){for(var r in o)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var a=i();for(r in o)o[r].write(a,t[r]);return null!==e&&e.push(s,a),a},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:s}]}))},Y:function(e,t,i,s,r){var o=He(i);Xe(e,{name:t=ze(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?s:r},argPackAdvance:8,readValueFromPointer:function(e){var s;if(1===i)s=M;else if(2===i)s=L;else{if(4!==i)throw new TypeError("Unknown boolean type size: "+t);s=N}return this.fromWireType(s[e>>>o])},destructorFunction:null})},t:function(e,t,i,s,r,o,a,n,h,l,c,u,p){c=ze(c),o=Ft(r,o),n&&(n=Ft(a,n)),l&&(l=Ft(h,l)),p=Ft(u,p);var d=Oe(c);ct(d,(function(){Mt("Cannot construct "+c+" due to unbound types",[s])})),Ue([e,t,i],s?[s]:[],(function(t){var i,r;t=t[0],r=s?(i=t.registeredClass).instancePrototype:nt.prototype;var a=Ne(d,(function(){if(Object.getPrototypeOf(this)!==h)throw new We("Use 'new' to construct "+c);if(void 0===u.constructor_body)throw new We(c+" has no accessible constructor");var e=u.constructor_body[arguments.length];if(void 0===e)throw new We("Tried to invoke ctor of "+c+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(u.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),h=Object.create(r,{constructor:{value:a}});a.prototype=h;var u=new ut(c,a,h,p,i,o,n,l),m=new Ct(c,u,!0,!1,!1),f=new Ct(c+"*",u,!1,!1,!1),g=new Ct(c+" const*",u,!1,!0,!1);return ht[e]={pointerType:f,constPointerType:g},Rt(d,a),[m,f,g]}))},s:function(e,t,i,s,r,o){b(t>0);var a=At(t,i);r=Ft(s,r);var n=[o],h=[];Ue([],[e],(function(e){var i="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new We("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){Mt("Cannot construct "+e.name+" due to unbound types",a)},Ue([],a,(function(s){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&$e(i+" called with "+arguments.length+" arguments, expected "+(t-1)),h.length=0,n.length=t;for(var e=1;e<t;++e)n[e]=s[e].toWireType(h,arguments[e-1]);var o=r.apply(null,n);return Se(h),s[0].fromWireType(o)},[]})),[]}))},c:function(e,t,i,s,r,o,a,n){var h=At(i,s);t=ze(t),o=Ft(r,o),Ue([],[e],(function(e){var s=(e=e[0]).name+"."+t;function r(){Mt("Cannot call "+s+" due to unbound types",h)}n&&e.registeredClass.pureVirtualFunctions.push(t);var l=e.registeredClass.instancePrototype,c=l[t];return void 0===c||void 0===c.overloadTable&&c.className!==e.name&&c.argCount===i-2?(r.argCount=i-2,r.className=e.name,l[t]=r):(lt(l,t,s),l[t].overloadTable[i-2]=r),Ue([],h,(function(r){var n=Lt(s,r,e,o,a);return void 0===l[t].overloadTable?(n.argCount=i-2,l[t]=n):l[t].overloadTable[i-2]=n,[]})),[]}))},X:function(e,t){Xe(e,{name:t=ze(t),fromWireType:function(e){var t=Nt[e].value;return Bt(e),t},toWireType:function(e,t){return Ut(t)},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:null})},_:function(e,t,i,s){var r=He(i);function o(){}t=ze(t),o.values={},Xe(e,{name:t,constructor:o,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Vt(t,r,s),destructorFunction:null}),ct(t,o)},v:function(e,t,i){var s=Ht(e,"enum");t=ze(t);var r=s.constructor,o=Object.create(s.constructor.prototype,{value:{value:i},constructor:{value:Ne(s.name+"_"+t,(function(){}))}});r.values[i]=o,r[t]=o},F:function(e,t,i){var s=He(i);Xe(e,{name:t=ze(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+jt(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:zt(t,s),destructorFunction:null})},f:function(e,t,i,s,r,o){var a=At(t,i);e=ze(e),r=Ft(s,r),ct(e,(function(){Mt("Cannot call "+e+" due to unbound types",a)}),t-1),Ue([],a,(function(i){var s=[i[0],null].concat(i.slice(1));return Rt(e,Lt(e,s,null,r,o),t-1),[]}))},o:function(e,t,i,s,r){t=ze(t),-1===r&&(r=4294967295);var o=He(i),a=function(e){return e};if(0===s){var n=32-8*i;a=function(e){return e<<n>>>n}}var h=-1!=t.indexOf("unsigned");Xe(e,{name:t,fromWireType:a,toWireType:function(e,i){if("number"!=typeof i&&"boolean"!=typeof i)throw new TypeError('Cannot convert "'+jt(i)+'" to '+this.name);if(i<s||i>r)throw new TypeError('Passing a number "'+jt(i)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+s+", "+r+"]!");return h?i>>>0:0|i},argPackAdvance:8,readValueFromPointer:Wt(t,o,0!==s),destructorFunction:null})},k:function(e,t,i){var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){var t=B,i=t[(e>>=2)>>>0],r=t[e+1>>>0];return new s(x,r,i)}Xe(e,{name:i=ze(i),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},G:function(e,t){var i="std::string"===(t=ze(t));Xe(e,{name:t,fromWireType:function(e){var t,s=B[e>>>2];if(i)for(var r=e+4,o=0;o<=s;++o){var a=e+4+o;if(o==s||0==A[a>>>0]){var n=C(r,a-r);void 0===t?t=n:(t+=String.fromCharCode(0),t+=n),r=a+1}}else{var h=new Array(s);for(o=0;o<s;++o)h[o]=String.fromCharCode(A[e+4+o>>>0]);t=h.join("")}return di(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var s="string"==typeof t;s||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||$e("Cannot pass non-string to std::string");var r=(i&&s?function(){return S(t)}:function(){return t.length})(),o=pi(4+r+1);if(B[(o>>>=0)>>>2]=r,i&&s)F(t,o+4,r+1);else if(s)for(var a=0;a<r;++a){var n=t.charCodeAt(a);n>255&&(di(o),$e("String has UTF-16 code units that do not fit in 8 bits")),A[o+4+a>>>0]=n}else for(a=0;a<r;++a)A[o+4+a>>>0]=t[a];return null!==e&&e.push(di,o),o},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:function(e){di(e)}})},w:function(e,t,i){var s,r,o,a,n;i=ze(i),2===t?(s=V,r=H,a=j,o=function(){return O},n=1):4===t&&(s=z,r=W,a=$,o=function(){return B},n=2),Xe(e,{name:i,fromWireType:function(e){for(var i,r=B[e>>>2],a=o(),h=e+4,l=0;l<=r;++l){var c=e+4+l*t;if(l==r||0==a[c>>>n]){var u=s(h,c-h);void 0===i?i=u:(i+=String.fromCharCode(0),i+=u),h=c+t}}return di(e),i},toWireType:function(e,s){"string"!=typeof s&&$e("Cannot pass non-string to C++ string type "+i);var o=a(s),h=pi(4+o+t);return B[(h>>>=0)>>>2]=o>>n,r(s,h+4,o+t),null!==e&&e.push(di,h),h},argPackAdvance:8,readValueFromPointer:xe,destructorFunction:function(e){di(e)}})},aa:function(e,t,i,s,r,o){Fe[e]={name:ze(t),rawConstructor:Ft(i,s),rawDestructor:Ft(r,o),elements:[]}},h:function(e,t,i,s,r,o,a,n,h){Fe[e].elements.push({getterReturnType:t,getter:Ft(i,s),getterContext:r,setterArgumentType:o,setter:Ft(a,n),setterContext:h})},r:function(e,t,i,s,r,o){Ve[e]={name:ze(t),rawConstructor:Ft(i,s),rawDestructor:Ft(r,o),fields:[]}},e:function(e,t,i,s,r,o,a,n,h,l){Ve[e].fields.push({fieldName:ze(t),getterReturnType:i,getter:Ft(s,r),getterContext:o,setterArgumentType:a,setter:Ft(n,h),setterContext:l})},Z:function(e,t){Xe(e,{isVoid:!0,name:t=ze(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},m:function(e,t,i){e=$t(e),t=Ht(t,"emval::as");var s=[],r=Ut(s);return N[i>>>2]=r,t.toWireType(s,e)},H:function(e,t,i,s){e=$t(e);for(var r=function(e,t){for(var i=new Array(e),s=0;s<e;++s)i[s]=Ht(N[(t>>2)+s>>>0],"parameter "+s);return i}(t,i),o=new Array(t),a=0;a<t;++a){var n=r[a];o[a]=n.readValueFromPointer(s),s+=n.argPackAdvance}return Ut(e.apply(void 0,o))},b:Bt,J:function(e){return 0===e?Ut(qt()):(e=Kt(e),Ut(qt()[e]))},n:function(e,t){return Ut((e=$t(e))[t=$t(t)])},j:function(e){e>4&&(Nt[e].refcount+=1)},N:function(e,t){return(e=$t(e))instanceof(t=$t(t))},I:function(e){return"number"==typeof(e=$t(e))},A:function(){return Ut([])},g:function(e){return Ut(Kt(e))},u:function(){return Ut({})},l:function(e){Se(Nt[e].value),Bt(e)},i:function(e,t,i){e=$t(e),t=$t(t),i=$t(i),e[t]=i},d:function(e,t){return Ut((e=Ht(e,"_emval_take_value")).readValueFromPointer(t))},C:function(){re()},T:function(e,t){var i;if(0===e)i=Date.now();else{if(1!==e&&4!==e)return function(e){N[gi()>>>2]=e}(28),-1;i=Xt()}return N[t>>>2]=i/1e3|0,N[t+4>>>2]=i%1e3*1e3*1e3|0,0},M:function(e,t,i){A.copyWithin(e>>>0,t>>>0,t+i>>>0)},p:function(e){e>>>=0;var t=A.length,i=4294967296;if(e>i)return!1;for(var s,r,o=1;o<=4;o*=2){var a=t*(1+.2/o);if(a=Math.min(a,e+100663296),Zt(Math.min(i,((s=Math.max(16777216,e,a))%(r=65536)>0&&(s+=r-s%r),s))))return!0}return!1},R:function(e,t){try{var i=0;return Jt().forEach((function(s,r){var o=t+i;N[e+4*r>>>2]=o,function(e,t,i){for(var s=0;s<e.length;++s)M[t++>>>0]=e.charCodeAt(s);i||(M[t>>>0]=0)}(s,o),i+=s.length+1})),0}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),e.errno}},S:function(e,t){try{var i=Jt();N[e>>>2]=i.length;var s=0;return i.forEach((function(e){s+=e.length+1})),N[t>>>2]=s,0}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),e.errno}},E:function(e){try{var t=Re.getStreamFromFD(e);return Ce.close(t),0}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),e.errno}},U:function(e,t,i,s){try{var r=Re.getStreamFromFD(e),o=Re.doReadv(r,t,i);return N[s>>>2]=o,0}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),e.errno}},K:function(e,t,i,s,r){try{var o=Re.getStreamFromFD(e),a=4294967296*i+(t>>>0),n=9007199254740992;return a<=-n||a>=n?-61:(Ce.llseek(o,a,s),ce=[o.position>>>0,(le=o.position,+Math.abs(le)>=1?le>0?(0|Math.min(+Math.floor(le/4294967296),4294967295))>>>0:~~+Math.ceil((le-+(~~le>>>0))/4294967296)>>>0:0)],N[r>>>2]=ce[0],N[r+4>>>2]=ce[1],o.getdents&&0===a&&0===s&&(o.getdents=null),0)}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),e.errno}},D:function(e,t,i,s){try{var r=Re.getStreamFromFD(e),o=Re.doWritev(r,t,i);return N[s>>>2]=o,0}catch(e){return void 0!==Ce&&e instanceof Ce.ErrnoError||re(e),e.errno}},a:v,B:function(){},P:function(){},O:function(){},L:function(e){},Q:function(e,t,i,s){return oi(e,t,i,s)}};!function(){var e={a:ci};function t(e,t){var i=e.exports;r.asm=i,Y=r.asm.ba,se()}function i(e){t(e.instance)}function o(t){return(y||!n&&!h||"function"!=typeof fetch||ne(ue)?Promise.resolve().then(pe):fetch(ue,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ue+"'";return e.arrayBuffer()})).catch((function(){return pe()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){E("failed to asynchronously prepare wasm: "+e),re(e)}))}if(ie(),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return E("Module.instantiateWasm callback failed with error: "+e),!1}(y||"function"!=typeof WebAssembly.instantiateStreaming||ae(ue)||ne(ue)||"function"!=typeof fetch?o(i):fetch(ue,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return E("wasm streaming compile failed: "+e),E("falling back to ArrayBuffer instantiation"),o(i)}))}))).catch(s)}();var ui=r.___wasm_call_ctors=function(){return(ui=r.___wasm_call_ctors=r.asm.ca).apply(null,arguments)};r._main=function(){return(r._main=r.asm.da).apply(null,arguments)};var pi=r._malloc=function(){return(pi=r._malloc=r.asm.ea).apply(null,arguments)},di=r._free=function(){return(di=r._free=r.asm.fa).apply(null,arguments)},mi=r.___getTypeName=function(){return(mi=r.___getTypeName=r.asm.ga).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ha).apply(null,arguments)};var fi,gi=r.___errno_location=function(){return(gi=r.___errno_location=r.asm.ia).apply(null,arguments)};function _i(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function yi(e){var t,i=r._main;try{t=i(0,0),!0&&T&&0===t||(T||(r.onExit&&r.onExit(t),P=!0),p(t,new _i(t)))}catch(e){if(e instanceof _i)return;if("unwind"==e)return void(T=!0);var s=e;e&&"object"==typeof e&&e.stack&&(s=[e,e.stack]),E("exception thrown: "+s),p(1,e)}}function Ti(e){function i(){fi||(fi=!0,r.calledRun=!0,P||(r.noFSInit||Ce.init.initialized||Ce.init(),de(Z),Ce.ignorePermissions=!1,de(Q),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),vi&&yi(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),J.unshift(e);var e;de(J)}()))}ee>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),q.unshift(e);var e;de(q)}(),ee>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),i()}),1)):i()))}if(r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.ja).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.ka).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.la).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.ma).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.na).apply(null,arguments)},r.addRunDependency=ie,r.removeRunDependency=se,r.FS_createPath=Ce.createPath,r.FS_createDataFile=Ce.createDataFile,r.FS_createPreloadedFile=Ce.createPreloadedFile,r.FS_createLazyFile=Ce.createLazyFile,r.FS_createDevice=Ce.createDevice,r.FS_unlink=Ce.unlink,r.FS=Ce,te=function e(){fi||Ti(),fi||(te=e)},r.run=Ti,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var vi=!0;return r.noInitialRun&&(vi=!1),T=!0,Ti(),e.ready});"object"==typeof e&&"object"==typeof t?t.exports=s:"function"==typeof define&&define.amd?define([],(function(){return s})):"object"==typeof e&&(e.WebIFCWasm=s)}}),IFCACTIONREQUEST=3821786052,IFCACTOR=2296667514,IFCACTORROLE=3630933823,IFCACTUATOR=4288193352,IFCACTUATORTYPE=2874132201,IFCADDRESS=618182010,IFCADVANCEDBREP=1635779807,IFCADVANCEDBREPWITHVOIDS=2603310189,IFCADVANCEDFACE=3406155212,IFCAIRTERMINAL=1634111441,IFCAIRTERMINALBOX=177149247,IFCAIRTERMINALBOXTYPE=1411407467,IFCAIRTERMINALTYPE=3352864051,IFCAIRTOAIRHEATRECOVERY=2056796094,IFCAIRTOAIRHEATRECOVERYTYPE=1871374353,IFCALARM=3087945054,IFCALARMTYPE=3001207471,IFCALIGNMENT=325726236,IFCALIGNMENT2DHORIZONTAL=749761778,IFCALIGNMENT2DHORIZONTALSEGMENT=3199563722,IFCALIGNMENT2DSEGMENT=2483840362,IFCALIGNMENT2DVERSEGCIRCULARARC=3379348081,IFCALIGNMENT2DVERSEGLINE=3239324667,IFCALIGNMENT2DVERSEGPARABOLICARC=4263986512,IFCALIGNMENT2DVERTICAL=53199957,IFCALIGNMENT2DVERTICALSEGMENT=2029264950,IFCALIGNMENTCURVE=3512275521,IFCANNOTATION=1674181508,IFCANNOTATIONFILLAREA=669184980,IFCAPPLICATION=639542469,IFCAPPLIEDVALUE=411424972,IFCAPPROVAL=130549933,IFCAPPROVALRELATIONSHIP=3869604511,IFCARBITRARYCLOSEDPROFILEDEF=3798115385,IFCARBITRARYOPENPROFILEDEF=1310608509,IFCARBITRARYPROFILEDEFWITHVOIDS=2705031697,IFCASSET=3460190687,IFCASYMMETRICISHAPEPROFILEDEF=3207858831,IFCAUDIOVISUALAPPLIANCE=277319702,IFCAUDIOVISUALAPPLIANCETYPE=1532957894,IFCAXIS1PLACEMENT=4261334040,IFCAXIS2PLACEMENT2D=3125803723,IFCAXIS2PLACEMENT3D=2740243338,IFCBSPLINECURVE=1967976161,IFCBSPLINECURVEWITHKNOTS=2461110595,IFCBSPLINESURFACE=2887950389,IFCBSPLINESURFACEWITHKNOTS=167062518,IFCBEAM=753842376,IFCBEAMSTANDARDCASE=2906023776,IFCBEAMTYPE=819618141,IFCBEARING=4196446775,IFCBEARINGTYPE=3649138523,IFCBLOBTEXTURE=616511568,IFCBLOCK=1334484129,IFCBOILER=32344328,IFCBOILERTYPE=231477066,IFCBOOLEANCLIPPINGRESULT=3649129432,IFCBOOLEANRESULT=2736907675,IFCBOUNDARYCONDITION=4037036970,IFCBOUNDARYCURVE=1136057603,IFCBOUNDARYEDGECONDITION=1560379544,IFCBOUNDARYFACECONDITION=3367102660,IFCBOUNDARYNODECONDITION=1387855156,IFCBOUNDARYNODECONDITIONWARPING=2069777674,IFCBOUNDEDCURVE=1260505505,IFCBOUNDEDSURFACE=4182860854,IFCBOUNDINGBOX=2581212453,IFCBOXEDHALFSPACE=2713105998,IFCBRIDGE=644574406,IFCBRIDGEPART=963979645,IFCBUILDING=4031249490,IFCBUILDINGELEMENT=3299480353,IFCBUILDINGELEMENTPART=2979338954,IFCBUILDINGELEMENTPARTTYPE=39481116,IFCBUILDINGELEMENTPROXY=1095909175,IFCBUILDINGELEMENTPROXYTYPE=1909888760,IFCBUILDINGELEMENTTYPE=1950629157,IFCBUILDINGSTOREY=3124254112,IFCBUILDINGSYSTEM=1177604601,IFCBURNER=2938176219,IFCBURNERTYPE=2188180465,IFCCSHAPEPROFILEDEF=2898889636,IFCCABLECARRIERFITTING=635142910,IFCCABLECARRIERFITTINGTYPE=395041908,IFCCABLECARRIERSEGMENT=3758799889,IFCCABLECARRIERSEGMENTTYPE=3293546465,IFCCABLEFITTING=1051757585,IFCCABLEFITTINGTYPE=2674252688,IFCCABLESEGMENT=4217484030,IFCCABLESEGMENTTYPE=1285652485,IFCCAISSONFOUNDATION=3999819293,IFCCAISSONFOUNDATIONTYPE=3203706013,IFCCARTESIANPOINT=1123145078,IFCCARTESIANPOINTLIST=574549367,IFCCARTESIANPOINTLIST2D=1675464909,IFCCARTESIANPOINTLIST3D=2059837836,IFCCARTESIANTRANSFORMATIONOPERATOR=59481748,IFCCARTESIANTRANSFORMATIONOPERATOR2D=3749851601,IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM=3486308946,IFCCARTESIANTRANSFORMATIONOPERATOR3D=3331915920,IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM=1416205885,IFCCENTERLINEPROFILEDEF=3150382593,IFCCHILLER=3902619387,IFCCHILLERTYPE=2951183804,IFCCHIMNEY=3296154744,IFCCHIMNEYTYPE=2197970202,IFCCIRCLE=2611217952,IFCCIRCLEHOLLOWPROFILEDEF=2937912522,IFCCIRCLEPROFILEDEF=1383045692,IFCCIRCULARARCSEGMENT2D=1062206242,IFCCIVILELEMENT=1677625105,IFCCIVILELEMENTTYPE=3893394355,IFCCLASSIFICATION=747523909,IFCCLASSIFICATIONREFERENCE=647927063,IFCCLOSEDSHELL=2205249479,IFCCOIL=639361253,IFCCOILTYPE=2301859152,IFCCOLOURRGB=776857604,IFCCOLOURRGBLIST=3285139300,IFCCOLOURSPECIFICATION=3264961684,IFCCOLUMN=843113511,IFCCOLUMNSTANDARDCASE=905975707,IFCCOLUMNTYPE=300633059,IFCCOMMUNICATIONSAPPLIANCE=3221913625,IFCCOMMUNICATIONSAPPLIANCETYPE=400855858,IFCCOMPLEXPROPERTY=2542286263,IFCCOMPLEXPROPERTYTEMPLATE=3875453745,IFCCOMPOSITECURVE=3732776249,IFCCOMPOSITECURVEONSURFACE=15328376,IFCCOMPOSITECURVESEGMENT=2485617015,IFCCOMPOSITEPROFILEDEF=1485152156,IFCCOMPRESSOR=3571504051,IFCCOMPRESSORTYPE=3850581409,IFCCONDENSER=2272882330,IFCCONDENSERTYPE=2816379211,IFCCONIC=2510884976,IFCCONNECTEDFACESET=370225590,IFCCONNECTIONCURVEGEOMETRY=1981873012,IFCCONNECTIONGEOMETRY=2859738748,IFCCONNECTIONPOINTECCENTRICITY=45288368,IFCCONNECTIONPOINTGEOMETRY=2614616156,IFCCONNECTIONSURFACEGEOMETRY=2732653382,IFCCONNECTIONVOLUMEGEOMETRY=775493141,IFCCONSTRAINT=1959218052,IFCCONSTRUCTIONEQUIPMENTRESOURCE=3898045240,IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE=2185764099,IFCCONSTRUCTIONMATERIALRESOURCE=1060000209,IFCCONSTRUCTIONMATERIALRESOURCETYPE=4105962743,IFCCONSTRUCTIONPRODUCTRESOURCE=488727124,IFCCONSTRUCTIONPRODUCTRESOURCETYPE=1525564444,IFCCONSTRUCTIONRESOURCE=2559216714,IFCCONSTRUCTIONRESOURCETYPE=2574617495,IFCCONTEXT=3419103109,IFCCONTEXTDEPENDENTUNIT=3050246964,IFCCONTROL=3293443760,IFCCONTROLLER=25142252,IFCCONTROLLERTYPE=578613899,IFCCONVERSIONBASEDUNIT=2889183280,IFCCONVERSIONBASEDUNITWITHOFFSET=2713554722,IFCCOOLEDBEAM=4136498852,IFCCOOLEDBEAMTYPE=335055490,IFCCOOLINGTOWER=3640358203,IFCCOOLINGTOWERTYPE=2954562838,IFCCOORDINATEOPERATION=1785450214,IFCCOORDINATEREFERENCESYSTEM=1466758467,IFCCOSTITEM=3895139033,IFCCOSTSCHEDULE=1419761937,IFCCOSTVALUE=602808272,IFCCOVERING=1973544240,IFCCOVERINGTYPE=1916426348,IFCCREWRESOURCE=3295246426,IFCCREWRESOURCETYPE=1815067380,IFCCSGPRIMITIVE3D=2506170314,IFCCSGSOLID=2147822146,IFCCURRENCYRELATIONSHIP=539742890,IFCCURTAINWALL=3495092785,IFCCURTAINWALLTYPE=1457835157,IFCCURVE=2601014836,IFCCURVEBOUNDEDPLANE=2827736869,IFCCURVEBOUNDEDSURFACE=2629017746,IFCCURVESEGMENT2D=1186437898,IFCCURVESTYLE=3800577675,IFCCURVESTYLEFONT=1105321065,IFCCURVESTYLEFONTANDSCALING=2367409068,IFCCURVESTYLEFONTPATTERN=3510044353,IFCCYLINDRICALSURFACE=1213902940,IFCDAMPER=4074379575,IFCDAMPERTYPE=3961806047,IFCDEEPFOUNDATION=3426335179,IFCDEEPFOUNDATIONTYPE=1306400036,IFCDERIVEDPROFILEDEF=3632507154,IFCDERIVEDUNIT=1765591967,IFCDERIVEDUNITELEMENT=1045800335,IFCDIMENSIONALEXPONENTS=2949456006,IFCDIRECTION=32440307,IFCDISCRETEACCESSORY=1335981549,IFCDISCRETEACCESSORYTYPE=2635815018,IFCDISTANCEEXPRESSION=1945343521,IFCDISTRIBUTIONCHAMBERELEMENT=1052013943,IFCDISTRIBUTIONCHAMBERELEMENTTYPE=1599208980,IFCDISTRIBUTIONCIRCUIT=562808652,IFCDISTRIBUTIONCONTROLELEMENT=1062813311,IFCDISTRIBUTIONCONTROLELEMENTTYPE=2063403501,IFCDISTRIBUTIONELEMENT=1945004755,IFCDISTRIBUTIONELEMENTTYPE=3256556792,IFCDISTRIBUTIONFLOWELEMENT=3040386961,IFCDISTRIBUTIONFLOWELEMENTTYPE=3849074793,IFCDISTRIBUTIONPORT=3041715199,IFCDISTRIBUTIONSYSTEM=3205830791,IFCDOCUMENTINFORMATION=1154170062,IFCDOCUMENTINFORMATIONRELATIONSHIP=770865208,IFCDOCUMENTREFERENCE=3732053477,IFCDOOR=395920057,IFCDOORLININGPROPERTIES=2963535650,IFCDOORPANELPROPERTIES=1714330368,IFCDOORSTANDARDCASE=3242481149,IFCDOORSTYLE=526551008,IFCDOORTYPE=2323601079,IFCDRAUGHTINGPREDEFINEDCOLOUR=445594917,IFCDRAUGHTINGPREDEFINEDCURVEFONT=4006246654,IFCDUCTFITTING=342316401,IFCDUCTFITTINGTYPE=869906466,IFCDUCTSEGMENT=3518393246,IFCDUCTSEGMENTTYPE=3760055223,IFCDUCTSILENCER=1360408905,IFCDUCTSILENCERTYPE=2030761528,IFCEDGE=3900360178,IFCEDGECURVE=476780140,IFCEDGELOOP=1472233963,IFCELECTRICAPPLIANCE=1904799276,IFCELECTRICAPPLIANCETYPE=663422040,IFCELECTRICDISTRIBUTIONBOARD=862014818,IFCELECTRICDISTRIBUTIONBOARDTYPE=2417008758,IFCELECTRICFLOWSTORAGEDEVICE=3310460725,IFCELECTRICFLOWSTORAGEDEVICETYPE=3277789161,IFCELECTRICGENERATOR=264262732,IFCELECTRICGENERATORTYPE=1534661035,IFCELECTRICMOTOR=402227799,IFCELECTRICMOTORTYPE=1217240411,IFCELECTRICTIMECONTROL=1003880860,IFCELECTRICTIMECONTROLTYPE=712377611,IFCELEMENT=1758889154,IFCELEMENTASSEMBLY=4123344466,IFCELEMENTASSEMBLYTYPE=2397081782,IFCELEMENTCOMPONENT=1623761950,IFCELEMENTCOMPONENTTYPE=2590856083,IFCELEMENTQUANTITY=1883228015,IFCELEMENTTYPE=339256511,IFCELEMENTARYSURFACE=2777663545,IFCELLIPSE=1704287377,IFCELLIPSEPROFILEDEF=2835456948,IFCENERGYCONVERSIONDEVICE=1658829314,IFCENERGYCONVERSIONDEVICETYPE=2107101300,IFCENGINE=2814081492,IFCENGINETYPE=132023988,IFCEVAPORATIVECOOLER=3747195512,IFCEVAPORATIVECOOLERTYPE=3174744832,IFCEVAPORATOR=484807127,IFCEVAPORATORTYPE=3390157468,IFCEVENT=4148101412,IFCEVENTTIME=211053100,IFCEVENTTYPE=4024345920,IFCEXTENDEDPROPERTIES=297599258,IFCEXTERNALINFORMATION=4294318154,IFCEXTERNALREFERENCE=3200245327,IFCEXTERNALREFERENCERELATIONSHIP=1437805879,IFCEXTERNALSPATIALELEMENT=1209101575,IFCEXTERNALSPATIALSTRUCTUREELEMENT=2853485674,IFCEXTERNALLYDEFINEDHATCHSTYLE=2242383968,IFCEXTERNALLYDEFINEDSURFACESTYLE=1040185647,IFCEXTERNALLYDEFINEDTEXTFONT=3548104201,IFCEXTRUDEDAREASOLID=477187591,IFCEXTRUDEDAREASOLIDTAPERED=2804161546,IFCFACE=2556980723,IFCFACEBASEDSURFACEMODEL=2047409740,IFCFACEBOUND=1809719519,IFCFACEOUTERBOUND=803316827,IFCFACESURFACE=3008276851,IFCFACETEDBREP=807026263,IFCFACETEDBREPWITHVOIDS=3737207727,IFCFACILITY=24185140,IFCFACILITYPART=1310830890,IFCFAILURECONNECTIONCONDITION=4219587988,IFCFAN=3415622556,IFCFANTYPE=346874300,IFCFASTENER=647756555,IFCFASTENERTYPE=2489546625,IFCFEATUREELEMENT=2827207264,IFCFEATUREELEMENTADDITION=2143335405,IFCFEATUREELEMENTSUBTRACTION=1287392070,IFCFILLAREASTYLE=738692330,IFCFILLAREASTYLEHATCHING=374418227,IFCFILLAREASTYLETILES=315944413,IFCFILTER=819412036,IFCFILTERTYPE=1810631287,IFCFIRESUPPRESSIONTERMINAL=1426591983,IFCFIRESUPPRESSIONTERMINALTYPE=4222183408,IFCFIXEDREFERENCESWEPTAREASOLID=2652556860,IFCFLOWCONTROLLER=2058353004,IFCFLOWCONTROLLERTYPE=3907093117,IFCFLOWFITTING=4278956645,IFCFLOWFITTINGTYPE=3198132628,IFCFLOWINSTRUMENT=182646315,IFCFLOWINSTRUMENTTYPE=4037862832,IFCFLOWMETER=2188021234,IFCFLOWMETERTYPE=3815607619,IFCFLOWMOVINGDEVICE=3132237377,IFCFLOWMOVINGDEVICETYPE=1482959167,IFCFLOWSEGMENT=987401354,IFCFLOWSEGMENTTYPE=1834744321,IFCFLOWSTORAGEDEVICE=707683696,IFCFLOWSTORAGEDEVICETYPE=1339347760,IFCFLOWTERMINAL=2223149337,IFCFLOWTERMINALTYPE=2297155007,IFCFLOWTREATMENTDEVICE=3508470533,IFCFLOWTREATMENTDEVICETYPE=3009222698,IFCFOOTING=900683007,IFCFOOTINGTYPE=1893162501,IFCFURNISHINGELEMENT=263784265,IFCFURNISHINGELEMENTTYPE=4238390223,IFCFURNITURE=1509553395,IFCFURNITURETYPE=1268542332,IFCGEOGRAPHICELEMENT=3493046030,IFCGEOGRAPHICELEMENTTYPE=4095422895,IFCGEOMETRICCURVESET=987898635,IFCGEOMETRICREPRESENTATIONCONTEXT=3448662350,IFCGEOMETRICREPRESENTATIONITEM=2453401579,IFCGEOMETRICREPRESENTATIONSUBCONTEXT=4142052618,IFCGEOMETRICSET=3590301190,IFCGRID=3009204131,IFCGRIDAXIS=852622518,IFCGRIDPLACEMENT=178086475,IFCGROUP=2706460486,IFCHALFSPACESOLID=812098782,IFCHEATEXCHANGER=3319311131,IFCHEATEXCHANGERTYPE=1251058090,IFCHUMIDIFIER=2068733104,IFCHUMIDIFIERTYPE=1806887404,IFCISHAPEPROFILEDEF=1484403080,IFCIMAGETEXTURE=3905492369,IFCINDEXEDCOLOURMAP=3570813810,IFCINDEXEDPOLYCURVE=2571569899,IFCINDEXEDPOLYGONALFACE=178912537,IFCINDEXEDPOLYGONALFACEWITHVOIDS=2294589976,IFCINDEXEDTEXTUREMAP=1437953363,IFCINDEXEDTRIANGLETEXTUREMAP=2133299955,IFCINTERCEPTOR=4175244083,IFCINTERCEPTORTYPE=3946677679,IFCINTERSECTIONCURVE=3113134337,IFCINVENTORY=2391368822,IFCIRREGULARTIMESERIES=3741457305,IFCIRREGULARTIMESERIESVALUE=3020489413,IFCJUNCTIONBOX=2176052936,IFCJUNCTIONBOXTYPE=4288270099,IFCLSHAPEPROFILEDEF=572779678,IFCLABORRESOURCE=3827777499,IFCLABORRESOURCETYPE=428585644,IFCLAGTIME=1585845231,IFCLAMP=76236018,IFCLAMPTYPE=1051575348,IFCLIBRARYINFORMATION=2655187982,IFCLIBRARYREFERENCE=3452421091,IFCLIGHTDISTRIBUTIONDATA=4162380809,IFCLIGHTFIXTURE=629592764,IFCLIGHTFIXTURETYPE=1161773419,IFCLIGHTINTENSITYDISTRIBUTION=1566485204,IFCLIGHTSOURCE=1402838566,IFCLIGHTSOURCEAMBIENT=125510826,IFCLIGHTSOURCEDIRECTIONAL=2604431987,IFCLIGHTSOURCEGONIOMETRIC=4266656042,IFCLIGHTSOURCEPOSITIONAL=1520743889,IFCLIGHTSOURCESPOT=3422422726,IFCLINE=1281925730,IFCLINESEGMENT2D=3092502836,IFCLINEARPLACEMENT=388784114,IFCLINEARPOSITIONINGELEMENT=1154579445,IFCLOCALPLACEMENT=2624227202,IFCLOOP=1008929658,IFCMANIFOLDSOLIDBREP=1425443689,IFCMAPCONVERSION=3057273783,IFCMAPPEDITEM=2347385850,IFCMATERIAL=1838606355,IFCMATERIALCLASSIFICATIONRELATIONSHIP=1847130766,IFCMATERIALCONSTITUENT=3708119e3,IFCMATERIALCONSTITUENTSET=2852063980,IFCMATERIALDEFINITION=760658860,IFCMATERIALDEFINITIONREPRESENTATION=2022407955,IFCMATERIALLAYER=248100487,IFCMATERIALLAYERSET=3303938423,IFCMATERIALLAYERSETUSAGE=1303795690,IFCMATERIALLAYERWITHOFFSETS=1847252529,IFCMATERIALLIST=2199411900,IFCMATERIALPROFILE=2235152071,IFCMATERIALPROFILESET=164193824,IFCMATERIALPROFILESETUSAGE=3079605661,IFCMATERIALPROFILESETUSAGETAPERING=3404854881,IFCMATERIALPROFILEWITHOFFSETS=552965576,IFCMATERIALPROPERTIES=3265635763,IFCMATERIALRELATIONSHIP=853536259,IFCMATERIALUSAGEDEFINITION=1507914824,IFCMEASUREWITHUNIT=2597039031,IFCMECHANICALFASTENER=377706215,IFCMECHANICALFASTENERTYPE=2108223431,IFCMEDICALDEVICE=1437502449,IFCMEDICALDEVICETYPE=1114901282,IFCMEMBER=1073191201,IFCMEMBERSTANDARDCASE=1911478936,IFCMEMBERTYPE=3181161470,IFCMETRIC=3368373690,IFCMIRROREDPROFILEDEF=2998442950,IFCMONETARYUNIT=2706619895,IFCMOTORCONNECTION=2474470126,IFCMOTORCONNECTIONTYPE=977012517,IFCNAMEDUNIT=1918398963,IFCOBJECT=3888040117,IFCOBJECTDEFINITION=219451334,IFCOBJECTPLACEMENT=3701648758,IFCOBJECTIVE=2251480897,IFCOCCUPANT=4143007308,IFCOFFSETCURVE=590820931,IFCOFFSETCURVE2D=3388369263,IFCOFFSETCURVE3D=3505215534,IFCOFFSETCURVEBYDISTANCES=2485787929,IFCOPENSHELL=2665983363,IFCOPENINGELEMENT=3588315303,IFCOPENINGSTANDARDCASE=3079942009,IFCORGANIZATION=4251960020,IFCORGANIZATIONRELATIONSHIP=1411181986,IFCORIENTATIONEXPRESSION=643959842,IFCORIENTEDEDGE=1029017970,IFCOUTERBOUNDARYCURVE=144952367,IFCOUTLET=3694346114,IFCOUTLETTYPE=2837617999,IFCOWNERHISTORY=1207048766,IFCPARAMETERIZEDPROFILEDEF=2529465313,IFCPATH=2519244187,IFCPCURVE=1682466193,IFCPERFORMANCEHISTORY=2382730787,IFCPERMEABLECOVERINGPROPERTIES=3566463478,IFCPERMIT=3327091369,IFCPERSON=2077209135,IFCPERSONANDORGANIZATION=101040310,IFCPHYSICALCOMPLEXQUANTITY=3021840470,IFCPHYSICALQUANTITY=2483315170,IFCPHYSICALSIMPLEQUANTITY=2226359599,IFCPILE=1687234759,IFCPILETYPE=1158309216,IFCPIPEFITTING=310824031,IFCPIPEFITTINGTYPE=804291784,IFCPIPESEGMENT=3612865200,IFCPIPESEGMENTTYPE=4231323485,IFCPIXELTEXTURE=597895409,IFCPLACEMENT=2004835150,IFCPLANARBOX=603570806,IFCPLANAREXTENT=1663979128,IFCPLANE=220341763,IFCPLATE=3171933400,IFCPLATESTANDARDCASE=1156407060,IFCPLATETYPE=4017108033,IFCPOINT=2067069095,IFCPOINTONCURVE=4022376103,IFCPOINTONSURFACE=1423911732,IFCPOLYLOOP=2924175390,IFCPOLYGONALBOUNDEDHALFSPACE=2775532180,IFCPOLYGONALFACESET=2839578677,IFCPOLYLINE=3724593414,IFCPORT=3740093272,IFCPOSITIONINGELEMENT=1946335990,IFCPOSTALADDRESS=3355820592,IFCPREDEFINEDCOLOUR=759155922,IFCPREDEFINEDCURVEFONT=2559016684,IFCPREDEFINEDITEM=3727388367,IFCPREDEFINEDPROPERTIES=3778827333,IFCPREDEFINEDPROPERTYSET=3967405729,IFCPREDEFINEDTEXTFONT=1775413392,IFCPRESENTATIONITEM=677532197,IFCPRESENTATIONLAYERASSIGNMENT=2022622350,IFCPRESENTATIONLAYERWITHSTYLE=1304840413,IFCPRESENTATIONSTYLE=3119450353,IFCPRESENTATIONSTYLEASSIGNMENT=2417041796,IFCPROCEDURE=2744685151,IFCPROCEDURETYPE=569719735,IFCPROCESS=2945172077,IFCPRODUCT=4208778838,IFCPRODUCTDEFINITIONSHAPE=673634403,IFCPRODUCTREPRESENTATION=2095639259,IFCPROFILEDEF=3958567839,IFCPROFILEPROPERTIES=2802850158,IFCPROJECT=103090709,IFCPROJECTLIBRARY=653396225,IFCPROJECTORDER=2904328755,IFCPROJECTEDCRS=3843373140,IFCPROJECTIONELEMENT=3651124850,IFCPROPERTY=2598011224,IFCPROPERTYABSTRACTION=986844984,IFCPROPERTYBOUNDEDVALUE=871118103,IFCPROPERTYDEFINITION=1680319473,IFCPROPERTYDEPENDENCYRELATIONSHIP=148025276,IFCPROPERTYENUMERATEDVALUE=4166981789,IFCPROPERTYENUMERATION=3710013099,IFCPROPERTYLISTVALUE=2752243245,IFCPROPERTYREFERENCEVALUE=941946838,IFCPROPERTYSET=1451395588,IFCPROPERTYSETDEFINITION=3357820518,IFCPROPERTYSETTEMPLATE=492091185,IFCPROPERTYSINGLEVALUE=3650150729,IFCPROPERTYTABLEVALUE=110355661,IFCPROPERTYTEMPLATE=3521284610,IFCPROPERTYTEMPLATEDEFINITION=1482703590,IFCPROTECTIVEDEVICE=738039164,IFCPROTECTIVEDEVICETRIPPINGUNIT=2295281155,IFCPROTECTIVEDEVICETRIPPINGUNITTYPE=655969474,IFCPROTECTIVEDEVICETYPE=1842657554,IFCPROXY=3219374653,IFCPUMP=90941305,IFCPUMPTYPE=2250791053,IFCQUANTITYAREA=2044713172,IFCQUANTITYCOUNT=2093928680,IFCQUANTITYLENGTH=931644368,IFCQUANTITYSET=2090586900,IFCQUANTITYTIME=3252649465,IFCQUANTITYVOLUME=2405470396,IFCQUANTITYWEIGHT=825690147,IFCRAILING=2262370178,IFCRAILINGTYPE=2893384427,IFCRAMP=3024970846,IFCRAMPFLIGHT=3283111854,IFCRAMPFLIGHTTYPE=2324767716,IFCRAMPTYPE=1469900589,IFCRATIONALBSPLINECURVEWITHKNOTS=1232101972,IFCRATIONALBSPLINESURFACEWITHKNOTS=683857671,IFCRECTANGLEHOLLOWPROFILEDEF=2770003689,IFCRECTANGLEPROFILEDEF=3615266464,IFCRECTANGULARPYRAMID=2798486643,IFCRECTANGULARTRIMMEDSURFACE=3454111270,IFCRECURRENCEPATTERN=3915482550,IFCREFERENCE=2433181523,IFCREFERENT=4021432810,IFCREGULARTIMESERIES=3413951693,IFCREINFORCEMENTBARPROPERTIES=1580146022,IFCREINFORCEMENTDEFINITIONPROPERTIES=3765753017,IFCREINFORCINGBAR=979691226,IFCREINFORCINGBARTYPE=2572171363,IFCREINFORCINGELEMENT=3027567501,IFCREINFORCINGELEMENTTYPE=964333572,IFCREINFORCINGMESH=2320036040,IFCREINFORCINGMESHTYPE=2310774935,IFCRELAGGREGATES=160246688,IFCRELASSIGNS=3939117080,IFCRELASSIGNSTOACTOR=1683148259,IFCRELASSIGNSTOCONTROL=2495723537,IFCRELASSIGNSTOGROUP=1307041759,IFCRELASSIGNSTOGROUPBYFACTOR=1027710054,IFCRELASSIGNSTOPROCESS=4278684876,IFCRELASSIGNSTOPRODUCT=2857406711,IFCRELASSIGNSTORESOURCE=205026976,IFCRELASSOCIATES=1865459582,IFCRELASSOCIATESAPPROVAL=4095574036,IFCRELASSOCIATESCLASSIFICATION=919958153,IFCRELASSOCIATESCONSTRAINT=2728634034,IFCRELASSOCIATESDOCUMENT=982818633,IFCRELASSOCIATESLIBRARY=3840914261,IFCRELASSOCIATESMATERIAL=2655215786,IFCRELCONNECTS=826625072,IFCRELCONNECTSELEMENTS=1204542856,IFCRELCONNECTSPATHELEMENTS=3945020480,IFCRELCONNECTSPORTTOELEMENT=4201705270,IFCRELCONNECTSPORTS=3190031847,IFCRELCONNECTSSTRUCTURALACTIVITY=2127690289,IFCRELCONNECTSSTRUCTURALMEMBER=1638771189,IFCRELCONNECTSWITHECCENTRICITY=504942748,IFCRELCONNECTSWITHREALIZINGELEMENTS=3678494232,IFCRELCONTAINEDINSPATIALSTRUCTURE=3242617779,IFCRELCOVERSBLDGELEMENTS=886880790,IFCRELCOVERSSPACES=2802773753,IFCRELDECLARES=2565941209,IFCRELDECOMPOSES=2551354335,IFCRELDEFINES=693640335,IFCRELDEFINESBYOBJECT=1462361463,IFCRELDEFINESBYPROPERTIES=4186316022,IFCRELDEFINESBYTEMPLATE=307848117,IFCRELDEFINESBYTYPE=781010003,IFCRELFILLSELEMENT=3940055652,IFCRELFLOWCONTROLELEMENTS=279856033,IFCRELINTERFERESELEMENTS=427948657,IFCRELNESTS=3268803585,IFCRELPOSITIONS=1441486842,IFCRELPROJECTSELEMENT=750771296,IFCRELREFERENCEDINSPATIALSTRUCTURE=1245217292,IFCRELSEQUENCE=4122056220,IFCRELSERVICESBUILDINGS=366585022,IFCRELSPACEBOUNDARY=3451746338,IFCRELSPACEBOUNDARY1STLEVEL=3523091289,IFCRELSPACEBOUNDARY2NDLEVEL=1521410863,IFCRELVOIDSELEMENT=1401173127,IFCRELATIONSHIP=478536968,IFCREPARAMETRISEDCOMPOSITECURVESEGMENT=816062949,IFCREPRESENTATION=1076942058,IFCREPRESENTATIONCONTEXT=3377609919,IFCREPRESENTATIONITEM=3008791417,IFCREPRESENTATIONMAP=1660063152,IFCRESOURCE=2914609552,IFCRESOURCEAPPROVALRELATIONSHIP=2943643501,IFCRESOURCECONSTRAINTRELATIONSHIP=1608871552,IFCRESOURCELEVELRELATIONSHIP=2439245199,IFCRESOURCETIME=1042787934,IFCREVOLVEDAREASOLID=1856042241,IFCREVOLVEDAREASOLIDTAPERED=3243963512,IFCRIGHTCIRCULARCONE=4158566097,IFCRIGHTCIRCULARCYLINDER=3626867408,IFCROOF=2016517767,IFCROOFTYPE=2781568857,IFCROOT=2341007311,IFCROUNDEDRECTANGLEPROFILEDEF=2778083089,IFCSIUNIT=448429030,IFCSANITARYTERMINAL=3053780830,IFCSANITARYTERMINALTYPE=1768891740,IFCSCHEDULINGTIME=1054537805,IFCSEAMCURVE=2157484638,IFCSECTIONPROPERTIES=2042790032,IFCSECTIONREINFORCEMENTPROPERTIES=4165799628,IFCSECTIONEDSOLID=1862484736,IFCSECTIONEDSOLIDHORIZONTAL=1290935644,IFCSECTIONEDSPINE=1509187699,IFCSENSOR=4086658281,IFCSENSORTYPE=1783015770,IFCSHADINGDEVICE=1329646415,IFCSHADINGDEVICETYPE=4074543187,IFCSHAPEASPECT=867548509,IFCSHAPEMODEL=3982875396,IFCSHAPEREPRESENTATION=4240577450,IFCSHELLBASEDSURFACEMODEL=4124623270,IFCSIMPLEPROPERTY=3692461612,IFCSIMPLEPROPERTYTEMPLATE=3663146110,IFCSITE=4097777520,IFCSLAB=1529196076,IFCSLABELEMENTEDCASE=3127900445,IFCSLABSTANDARDCASE=3027962421,IFCSLABTYPE=2533589738,IFCSLIPPAGECONNECTIONCONDITION=2609359061,IFCSOLARDEVICE=3420628829,IFCSOLARDEVICETYPE=1072016465,IFCSOLIDMODEL=723233188,IFCSPACE=3856911033,IFCSPACEHEATER=1999602285,IFCSPACEHEATERTYPE=1305183839,IFCSPACETYPE=3812236995,IFCSPATIALELEMENT=1412071761,IFCSPATIALELEMENTTYPE=710998568,IFCSPATIALSTRUCTUREELEMENT=2706606064,IFCSPATIALSTRUCTUREELEMENTTYPE=3893378262,IFCSPATIALZONE=463610769,IFCSPATIALZONETYPE=2481509218,IFCSPHERE=451544542,IFCSPHERICALSURFACE=4015995234,IFCSTACKTERMINAL=1404847402,IFCSTACKTERMINALTYPE=3112655638,IFCSTAIR=331165859,IFCSTAIRFLIGHT=4252922144,IFCSTAIRFLIGHTTYPE=1039846685,IFCSTAIRTYPE=338393293,IFCSTRUCTURALACTION=682877961,IFCSTRUCTURALACTIVITY=3544373492,IFCSTRUCTURALANALYSISMODEL=2515109513,IFCSTRUCTURALCONNECTION=1179482911,IFCSTRUCTURALCONNECTIONCONDITION=2273995522,IFCSTRUCTURALCURVEACTION=1004757350,IFCSTRUCTURALCURVECONNECTION=4243806635,IFCSTRUCTURALCURVEMEMBER=214636428,IFCSTRUCTURALCURVEMEMBERVARYING=2445595289,IFCSTRUCTURALCURVEREACTION=2757150158,IFCSTRUCTURALITEM=3136571912,IFCSTRUCTURALLINEARACTION=1807405624,IFCSTRUCTURALLOAD=2162789131,IFCSTRUCTURALLOADCASE=385403989,IFCSTRUCTURALLOADCONFIGURATION=3478079324,IFCSTRUCTURALLOADGROUP=1252848954,IFCSTRUCTURALLOADLINEARFORCE=1595516126,IFCSTRUCTURALLOADORRESULT=609421318,IFCSTRUCTURALLOADPLANARFORCE=2668620305,IFCSTRUCTURALLOADSINGLEDISPLACEMENT=2473145415,IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION=1973038258,IFCSTRUCTURALLOADSINGLEFORCE=1597423693,IFCSTRUCTURALLOADSINGLEFORCEWARPING=1190533807,IFCSTRUCTURALLOADSTATIC=2525727697,IFCSTRUCTURALLOADTEMPERATURE=3408363356,IFCSTRUCTURALMEMBER=530289379,IFCSTRUCTURALPLANARACTION=1621171031,IFCSTRUCTURALPOINTACTION=2082059205,IFCSTRUCTURALPOINTCONNECTION=734778138,IFCSTRUCTURALPOINTREACTION=1235345126,IFCSTRUCTURALREACTION=3689010777,IFCSTRUCTURALRESULTGROUP=2986769608,IFCSTRUCTURALSURFACEACTION=3657597509,IFCSTRUCTURALSURFACECONNECTION=1975003073,IFCSTRUCTURALSURFACEMEMBER=3979015343,IFCSTRUCTURALSURFACEMEMBERVARYING=2218152070,IFCSTRUCTURALSURFACEREACTION=603775116,IFCSTYLEMODEL=2830218821,IFCSTYLEDITEM=3958052878,IFCSTYLEDREPRESENTATION=3049322572,IFCSUBCONTRACTRESOURCE=148013059,IFCSUBCONTRACTRESOURCETYPE=4095615324,IFCSUBEDGE=2233826070,IFCSURFACE=2513912981,IFCSURFACECURVE=699246055,IFCSURFACECURVESWEPTAREASOLID=2028607225,IFCSURFACEFEATURE=3101698114,IFCSURFACEOFLINEAREXTRUSION=2809605785,IFCSURFACEOFREVOLUTION=4124788165,IFCSURFACEREINFORCEMENTAREA=2934153892,IFCSURFACESTYLE=1300840506,IFCSURFACESTYLELIGHTING=3303107099,IFCSURFACESTYLEREFRACTION=1607154358,IFCSURFACESTYLERENDERING=1878645084,IFCSURFACESTYLESHADING=846575682,IFCSURFACESTYLEWITHTEXTURES=1351298697,IFCSURFACETEXTURE=626085974,IFCSWEPTAREASOLID=2247615214,IFCSWEPTDISKSOLID=1260650574,IFCSWEPTDISKSOLIDPOLYGONAL=1096409881,IFCSWEPTSURFACE=230924584,IFCSWITCHINGDEVICE=1162798199,IFCSWITCHINGDEVICETYPE=2315554128,IFCSYSTEM=2254336722,IFCSYSTEMFURNITUREELEMENT=413509423,IFCSYSTEMFURNITUREELEMENTTYPE=1580310250,IFCTSHAPEPROFILEDEF=3071757647,IFCTABLE=985171141,IFCTABLECOLUMN=2043862942,IFCTABLEROW=531007025,IFCTANK=812556717,IFCTANKTYPE=5716631,IFCTASK=3473067441,IFCTASKTIME=1549132990,IFCTASKTIMERECURRING=2771591690,IFCTASKTYPE=3206491090,IFCTELECOMADDRESS=912023232,IFCTENDON=3824725483,IFCTENDONANCHOR=2347447852,IFCTENDONANCHORTYPE=3081323446,IFCTENDONCONDUIT=3663046924,IFCTENDONCONDUITTYPE=2281632017,IFCTENDONTYPE=2415094496,IFCTESSELLATEDFACESET=2387106220,IFCTESSELLATEDITEM=901063453,IFCTEXTLITERAL=4282788508,IFCTEXTLITERALWITHEXTENT=3124975700,IFCTEXTSTYLE=1447204868,IFCTEXTSTYLEFONTMODEL=1983826977,IFCTEXTSTYLEFORDEFINEDFONT=2636378356,IFCTEXTSTYLETEXTMODEL=1640371178,IFCTEXTURECOORDINATE=280115917,IFCTEXTURECOORDINATEGENERATOR=1742049831,IFCTEXTUREMAP=2552916305,IFCTEXTUREVERTEX=1210645708,IFCTEXTUREVERTEXLIST=3611470254,IFCTIMEPERIOD=1199560280,IFCTIMESERIES=3101149627,IFCTIMESERIESVALUE=581633288,IFCTOPOLOGICALREPRESENTATIONITEM=1377556343,IFCTOPOLOGYREPRESENTATION=1735638870,IFCTOROIDALSURFACE=1935646853,IFCTRANSFORMER=3825984169,IFCTRANSFORMERTYPE=1692211062,IFCTRANSITIONCURVESEGMENT2D=2595432518,IFCTRANSPORTELEMENT=1620046519,IFCTRANSPORTELEMENTTYPE=2097647324,IFCTRAPEZIUMPROFILEDEF=2715220739,IFCTRIANGULATEDFACESET=2916149573,IFCTRIANGULATEDIRREGULARNETWORK=1229763772,IFCTRIMMEDCURVE=3593883385,IFCTUBEBUNDLE=3026737570,IFCTUBEBUNDLETYPE=1600972822,IFCTYPEOBJECT=1628702193,IFCTYPEPROCESS=3736923433,IFCTYPEPRODUCT=2347495698,IFCTYPERESOURCE=3698973494,IFCUSHAPEPROFILEDEF=427810014,IFCUNITASSIGNMENT=180925521,IFCUNITARYCONTROLELEMENT=630975310,IFCUNITARYCONTROLELEMENTTYPE=3179687236,IFCUNITARYEQUIPMENT=4292641817,IFCUNITARYEQUIPMENTTYPE=1911125066,IFCVALVE=4207607924,IFCVALVETYPE=728799441,IFCVECTOR=1417489154,IFCVERTEX=2799835756,IFCVERTEXLOOP=2759199220,IFCVERTEXPOINT=1907098498,IFCVIBRATIONDAMPER=1530820697,IFCVIBRATIONDAMPERTYPE=3956297820,IFCVIBRATIONISOLATOR=2391383451,IFCVIBRATIONISOLATORTYPE=3313531582,IFCVIRTUALELEMENT=2769231204,IFCVIRTUALGRIDINTERSECTION=891718957,IFCVOIDINGFEATURE=926996030,IFCWALL=2391406946,IFCWALLELEMENTEDCASE=4156078855,IFCWALLSTANDARDCASE=3512223829,IFCWALLTYPE=1898987631,IFCWASTETERMINAL=4237592921,IFCWASTETERMINALTYPE=1133259667,IFCWINDOW=3304561284,IFCWINDOWLININGPROPERTIES=336235671,IFCWINDOWPANELPROPERTIES=512836454,IFCWINDOWSTANDARDCASE=486154966,IFCWINDOWSTYLE=1299126871,IFCWINDOWTYPE=4009809668,IFCWORKCALENDAR=4088093105,IFCWORKCONTROL=1028945134,IFCWORKPLAN=4218914973,IFCWORKSCHEDULE=3342526732,IFCWORKTIME=1236880293,IFCZSHAPEPROFILEDEF=2543172580,IFCZONE=1033361043,IfcElements=[IFCACTUATOR,IFCAIRTERMINAL,IFCAIRTERMINALBOX,IFCAIRTOAIRHEATRECOVERY,IFCALARM,IFCALIGNMENT,IFCANNOTATION,IFCAUDIOVISUALAPPLIANCE,IFCBEAM,IFCBEAMSTANDARDCASE,IFCBEARING,IFCBOILER,IFCBRIDGE,IFCBRIDGEPART,IFCBUILDING,IFCBUILDINGELEMENT,IFCBUILDINGELEMENTPART,IFCBUILDINGELEMENTPROXY,IFCBUILDINGSTOREY,IFCBURNER,IFCCABLECARRIERFITTING,IFCCABLECARRIERSEGMENT,IFCCABLEFITTING,IFCCABLESEGMENT,IFCCAISSONFOUNDATION,IFCCHILLER,IFCCHIMNEY,IFCCIVILELEMENT,IFCCOIL,IFCCOLUMN,IFCCOLUMNSTANDARDCASE,IFCCOMMUNICATIONSAPPLIANCE,IFCCOMPRESSOR,IFCCONDENSER,IFCCONTROLLER,IFCCOOLEDBEAM,IFCCOOLINGTOWER,IFCCOVERING,IFCCURTAINWALL,IFCDAMPER,IFCDEEPFOUNDATION,IFCDISCRETEACCESSORY,IFCDISTRIBUTIONCHAMBERELEMENT,IFCDISTRIBUTIONCONTROLELEMENT,IFCDISTRIBUTIONELEMENT,IFCDISTRIBUTIONFLOWELEMENT,IFCDISTRIBUTIONPORT,IFCDOOR,IFCDOORSTANDARDCASE,IFCDUCTFITTING,IFCDUCTSEGMENT,IFCDUCTSILENCER,IFCELECTRICAPPLIANCE,IFCELECTRICDISTRIBUTIONBOARD,IFCELECTRICFLOWSTORAGEDEVICE,IFCELECTRICGENERATOR,IFCELECTRICMOTOR,IFCELECTRICTIMECONTROL,IFCELEMENT,IFCELEMENTASSEMBLY,IFCELEMENTCOMPONENT,IFCENERGYCONVERSIONDEVICE,IFCENGINE,IFCEVAPORATIVECOOLER,IFCEVAPORATOR,IFCEXTERNALSPATIALELEMENT,IFCEXTERNALSPATIALSTRUCTUREELEMENT,IFCFACILITY,IFCFACILITYPART,IFCFAN,IFCFASTENER,IFCFEATUREELEMENT,IFCFEATUREELEMENTADDITION,IFCFEATUREELEMENTSUBTRACTION,IFCFILTER,IFCFIRESUPPRESSIONTERMINAL,IFCFLOWCONTROLLER,IFCFLOWFITTING,IFCFLOWINSTRUMENT,IFCFLOWMETER,IFCFLOWMOVINGDEVICE,IFCFLOWSEGMENT,IFCFLOWSTORAGEDEVICE,IFCFLOWTERMINAL,IFCFLOWTREATMENTDEVICE,IFCFOOTING,IFCFURNISHINGELEMENT,IFCFURNITURE,IFCGEOGRAPHICELEMENT,IFCGRID,IFCHEATEXCHANGER,IFCHUMIDIFIER,IFCINTERCEPTOR,IFCJUNCTIONBOX,IFCLAMP,IFCLIGHTFIXTURE,IFCLINEARPOSITIONINGELEMENT,IFCMECHANICALFASTENER,IFCMEDICALDEVICE,IFCMEMBER,IFCMEMBERSTANDARDCASE,IFCMOTORCONNECTION,IFCOPENINGELEMENT,IFCOPENINGSTANDARDCASE,IFCOUTLET,IFCPILE,IFCPIPEFITTING,IFCPIPESEGMENT,IFCPLATE,IFCPLATESTANDARDCASE,IFCPORT,IFCPOSITIONINGELEMENT,IFCPROJECTIONELEMENT,IFCPROTECTIVEDEVICE,IFCPROTECTIVEDEVICETRIPPINGUNIT,IFCPROXY,IFCPUMP,IFCRAILING,IFCRAMP,IFCRAMPFLIGHT,IFCREFERENT,IFCREINFORCINGBAR,IFCREINFORCINGELEMENT,IFCREINFORCINGMESH,IFCROOF,IFCSANITARYTERMINAL,IFCSENSOR,IFCSHADINGDEVICE,IFCSITE,IFCSLAB,IFCSLABELEMENTEDCASE,IFCSLABSTANDARDCASE,IFCSOLARDEVICE,IFCSPACE,IFCSPACEHEATER,IFCSPATIALELEMENT,IFCSPATIALSTRUCTUREELEMENT,IFCSPATIALZONE,IFCSTACKTERMINAL,IFCSTAIR,IFCSTAIRFLIGHT,IFCSTRUCTURALACTION,IFCSTRUCTURALACTIVITY,IFCSTRUCTURALCONNECTION,IFCSTRUCTURALCURVEACTION,IFCSTRUCTURALCURVECONNECTION,IFCSTRUCTURALCURVEMEMBER,IFCSTRUCTURALCURVEMEMBERVARYING,IFCSTRUCTURALCURVEREACTION,IFCSTRUCTURALITEM,IFCSTRUCTURALLINEARACTION,IFCSTRUCTURALMEMBER,IFCSTRUCTURALPLANARACTION,IFCSTRUCTURALPOINTACTION,IFCSTRUCTURALPOINTCONNECTION,IFCSTRUCTURALPOINTREACTION,IFCSTRUCTURALREACTION,IFCSTRUCTURALSURFACEACTION,IFCSTRUCTURALSURFACECONNECTION,IFCSTRUCTURALSURFACEMEMBER,IFCSTRUCTURALSURFACEMEMBERVARYING,IFCSTRUCTURALSURFACEREACTION,IFCSURFACEFEATURE,IFCSWITCHINGDEVICE,IFCSYSTEMFURNITUREELEMENT,IFCTANK,IFCTENDON,IFCTENDONANCHOR,IFCTENDONCONDUIT,IFCTRANSFORMER,IFCTRANSPORTELEMENT,IFCTUBEBUNDLE,IFCUNITARYCONTROLELEMENT,IFCUNITARYEQUIPMENT,IFCVALVE,IFCVIBRATIONDAMPER,IFCVIBRATIONISOLATOR,IFCVIRTUALELEMENT,IFCVOIDINGFEATURE,IFCWALL,IFCWALLELEMENTEDCASE,IFCWALLSTANDARDCASE,IFCWASTETERMINAL,IFCWINDOW,IFCWINDOWSTANDARDCASE],FromRawLineData={};FromRawLineData[IFCACTIONREQUEST]=e=>IfcActionRequest.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCACTOR]=e=>IfcActor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCACTORROLE]=e=>IfcActorRole.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCACTUATOR]=e=>IfcActuator.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCACTUATORTYPE]=e=>IfcActuatorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCADDRESS]=e=>IfcAddress.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCADVANCEDBREP]=e=>IfcAdvancedBrep.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCADVANCEDBREPWITHVOIDS]=e=>IfcAdvancedBrepWithVoids.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCADVANCEDFACE]=e=>IfcAdvancedFace.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAIRTERMINAL]=e=>IfcAirTerminal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAIRTERMINALBOX]=e=>IfcAirTerminalBox.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAIRTERMINALBOXTYPE]=e=>IfcAirTerminalBoxType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAIRTERMINALTYPE]=e=>IfcAirTerminalType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAIRTOAIRHEATRECOVERY]=e=>IfcAirToAirHeatRecovery.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAIRTOAIRHEATRECOVERYTYPE]=e=>IfcAirToAirHeatRecoveryType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALARM]=e=>IfcAlarm.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALARMTYPE]=e=>IfcAlarmType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT]=e=>IfcAlignment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DHORIZONTAL]=e=>IfcAlignment2DHorizontal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DHORIZONTALSEGMENT]=e=>IfcAlignment2DHorizontalSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DSEGMENT]=e=>IfcAlignment2DSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DVERSEGCIRCULARARC]=e=>IfcAlignment2DVerSegCircularArc.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DVERSEGLINE]=e=>IfcAlignment2DVerSegLine.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DVERSEGPARABOLICARC]=e=>IfcAlignment2DVerSegParabolicArc.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DVERTICAL]=e=>IfcAlignment2DVertical.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENT2DVERTICALSEGMENT]=e=>IfcAlignment2DVerticalSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCALIGNMENTCURVE]=e=>IfcAlignmentCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCANNOTATION]=e=>IfcAnnotation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCANNOTATIONFILLAREA]=e=>IfcAnnotationFillArea.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAPPLICATION]=e=>IfcApplication.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAPPLIEDVALUE]=e=>IfcAppliedValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAPPROVAL]=e=>IfcApproval.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAPPROVALRELATIONSHIP]=e=>IfcApprovalRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCARBITRARYCLOSEDPROFILEDEF]=e=>IfcArbitraryClosedProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCARBITRARYOPENPROFILEDEF]=e=>IfcArbitraryOpenProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCARBITRARYPROFILEDEFWITHVOIDS]=e=>IfcArbitraryProfileDefWithVoids.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCASSET]=e=>IfcAsset.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCASYMMETRICISHAPEPROFILEDEF]=e=>IfcAsymmetricIShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAUDIOVISUALAPPLIANCE]=e=>IfcAudioVisualAppliance.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAUDIOVISUALAPPLIANCETYPE]=e=>IfcAudioVisualApplianceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAXIS1PLACEMENT]=e=>IfcAxis1Placement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAXIS2PLACEMENT2D]=e=>IfcAxis2Placement2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCAXIS2PLACEMENT3D]=e=>IfcAxis2Placement3D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBSPLINECURVE]=e=>IfcBSplineCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBSPLINECURVEWITHKNOTS]=e=>IfcBSplineCurveWithKnots.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBSPLINESURFACE]=e=>IfcBSplineSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBSPLINESURFACEWITHKNOTS]=e=>IfcBSplineSurfaceWithKnots.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBEAM]=e=>IfcBeam.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBEAMSTANDARDCASE]=e=>IfcBeamStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBEAMTYPE]=e=>IfcBeamType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBEARING]=e=>IfcBearing.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBEARINGTYPE]=e=>IfcBearingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBLOBTEXTURE]=e=>IfcBlobTexture.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBLOCK]=e=>IfcBlock.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOILER]=e=>IfcBoiler.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOILERTYPE]=e=>IfcBoilerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOOLEANCLIPPINGRESULT]=e=>IfcBooleanClippingResult.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOOLEANRESULT]=e=>IfcBooleanResult.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDARYCONDITION]=e=>IfcBoundaryCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDARYCURVE]=e=>IfcBoundaryCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDARYEDGECONDITION]=e=>IfcBoundaryEdgeCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDARYFACECONDITION]=e=>IfcBoundaryFaceCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDARYNODECONDITION]=e=>IfcBoundaryNodeCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDARYNODECONDITIONWARPING]=e=>IfcBoundaryNodeConditionWarping.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDEDCURVE]=e=>IfcBoundedCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDEDSURFACE]=e=>IfcBoundedSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOUNDINGBOX]=e=>IfcBoundingBox.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBOXEDHALFSPACE]=e=>IfcBoxedHalfSpace.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBRIDGE]=e=>IfcBridge.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBRIDGEPART]=e=>IfcBridgePart.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDING]=e=>IfcBuilding.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGELEMENT]=e=>IfcBuildingElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGELEMENTPART]=e=>IfcBuildingElementPart.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGELEMENTPARTTYPE]=e=>IfcBuildingElementPartType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGELEMENTPROXY]=e=>IfcBuildingElementProxy.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGELEMENTPROXYTYPE]=e=>IfcBuildingElementProxyType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGELEMENTTYPE]=e=>IfcBuildingElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGSTOREY]=e=>IfcBuildingStorey.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBUILDINGSYSTEM]=e=>IfcBuildingSystem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBURNER]=e=>IfcBurner.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCBURNERTYPE]=e=>IfcBurnerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCSHAPEPROFILEDEF]=e=>IfcCShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLECARRIERFITTING]=e=>IfcCableCarrierFitting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLECARRIERFITTINGTYPE]=e=>IfcCableCarrierFittingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLECARRIERSEGMENT]=e=>IfcCableCarrierSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLECARRIERSEGMENTTYPE]=e=>IfcCableCarrierSegmentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLEFITTING]=e=>IfcCableFitting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLEFITTINGTYPE]=e=>IfcCableFittingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLESEGMENT]=e=>IfcCableSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCABLESEGMENTTYPE]=e=>IfcCableSegmentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCAISSONFOUNDATION]=e=>IfcCaissonFoundation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCAISSONFOUNDATIONTYPE]=e=>IfcCaissonFoundationType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANPOINT]=e=>IfcCartesianPoint.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANPOINTLIST]=e=>IfcCartesianPointList.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANPOINTLIST2D]=e=>IfcCartesianPointList2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANPOINTLIST3D]=e=>IfcCartesianPointList3D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANTRANSFORMATIONOPERATOR]=e=>IfcCartesianTransformationOperator.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANTRANSFORMATIONOPERATOR2D]=e=>IfcCartesianTransformationOperator2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM]=e=>IfcCartesianTransformationOperator2DnonUniform.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANTRANSFORMATIONOPERATOR3D]=e=>IfcCartesianTransformationOperator3D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM]=e=>IfcCartesianTransformationOperator3DnonUniform.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCENTERLINEPROFILEDEF]=e=>IfcCenterLineProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCHILLER]=e=>IfcChiller.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCHILLERTYPE]=e=>IfcChillerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCHIMNEY]=e=>IfcChimney.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCHIMNEYTYPE]=e=>IfcChimneyType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCIRCLE]=e=>IfcCircle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCIRCLEHOLLOWPROFILEDEF]=e=>IfcCircleHollowProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCIRCLEPROFILEDEF]=e=>IfcCircleProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCIRCULARARCSEGMENT2D]=e=>IfcCircularArcSegment2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCIVILELEMENT]=e=>IfcCivilElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCIVILELEMENTTYPE]=e=>IfcCivilElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCLASSIFICATION]=e=>IfcClassification.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCLASSIFICATIONREFERENCE]=e=>IfcClassificationReference.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCLOSEDSHELL]=e=>IfcClosedShell.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOIL]=e=>IfcCoil.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOILTYPE]=e=>IfcCoilType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOLOURRGB]=e=>IfcColourRgb.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOLOURRGBLIST]=e=>IfcColourRgbList.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOLOURSPECIFICATION]=e=>IfcColourSpecification.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOLUMN]=e=>IfcColumn.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOLUMNSTANDARDCASE]=e=>IfcColumnStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOLUMNTYPE]=e=>IfcColumnType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMMUNICATIONSAPPLIANCE]=e=>IfcCommunicationsAppliance.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMMUNICATIONSAPPLIANCETYPE]=e=>IfcCommunicationsApplianceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPLEXPROPERTY]=e=>IfcComplexProperty.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPLEXPROPERTYTEMPLATE]=e=>IfcComplexPropertyTemplate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPOSITECURVE]=e=>IfcCompositeCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPOSITECURVEONSURFACE]=e=>IfcCompositeCurveOnSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPOSITECURVESEGMENT]=e=>IfcCompositeCurveSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPOSITEPROFILEDEF]=e=>IfcCompositeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPRESSOR]=e=>IfcCompressor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOMPRESSORTYPE]=e=>IfcCompressorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONDENSER]=e=>IfcCondenser.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONDENSERTYPE]=e=>IfcCondenserType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONIC]=e=>IfcConic.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTEDFACESET]=e=>IfcConnectedFaceSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTIONCURVEGEOMETRY]=e=>IfcConnectionCurveGeometry.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTIONGEOMETRY]=e=>IfcConnectionGeometry.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTIONPOINTECCENTRICITY]=e=>IfcConnectionPointEccentricity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTIONPOINTGEOMETRY]=e=>IfcConnectionPointGeometry.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTIONSURFACEGEOMETRY]=e=>IfcConnectionSurfaceGeometry.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONNECTIONVOLUMEGEOMETRY]=e=>IfcConnectionVolumeGeometry.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRAINT]=e=>IfcConstraint.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONEQUIPMENTRESOURCE]=e=>IfcConstructionEquipmentResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE]=e=>IfcConstructionEquipmentResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONMATERIALRESOURCE]=e=>IfcConstructionMaterialResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONMATERIALRESOURCETYPE]=e=>IfcConstructionMaterialResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONPRODUCTRESOURCE]=e=>IfcConstructionProductResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONPRODUCTRESOURCETYPE]=e=>IfcConstructionProductResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONRESOURCE]=e=>IfcConstructionResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONSTRUCTIONRESOURCETYPE]=e=>IfcConstructionResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONTEXT]=e=>IfcContext.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONTEXTDEPENDENTUNIT]=e=>IfcContextDependentUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONTROL]=e=>IfcControl.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONTROLLER]=e=>IfcController.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONTROLLERTYPE]=e=>IfcControllerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONVERSIONBASEDUNIT]=e=>IfcConversionBasedUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCONVERSIONBASEDUNITWITHOFFSET]=e=>IfcConversionBasedUnitWithOffset.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOOLEDBEAM]=e=>IfcCooledBeam.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOOLEDBEAMTYPE]=e=>IfcCooledBeamType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOOLINGTOWER]=e=>IfcCoolingTower.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOOLINGTOWERTYPE]=e=>IfcCoolingTowerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOORDINATEOPERATION]=e=>IfcCoordinateOperation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOORDINATEREFERENCESYSTEM]=e=>IfcCoordinateReferenceSystem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOSTITEM]=e=>IfcCostItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOSTSCHEDULE]=e=>IfcCostSchedule.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOSTVALUE]=e=>IfcCostValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOVERING]=e=>IfcCovering.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCOVERINGTYPE]=e=>IfcCoveringType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCREWRESOURCE]=e=>IfcCrewResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCREWRESOURCETYPE]=e=>IfcCrewResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCSGPRIMITIVE3D]=e=>IfcCsgPrimitive3D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCSGSOLID]=e=>IfcCsgSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURRENCYRELATIONSHIP]=e=>IfcCurrencyRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURTAINWALL]=e=>IfcCurtainWall.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURTAINWALLTYPE]=e=>IfcCurtainWallType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVE]=e=>IfcCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVEBOUNDEDPLANE]=e=>IfcCurveBoundedPlane.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVEBOUNDEDSURFACE]=e=>IfcCurveBoundedSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVESEGMENT2D]=e=>IfcCurveSegment2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVESTYLE]=e=>IfcCurveStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVESTYLEFONT]=e=>IfcCurveStyleFont.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVESTYLEFONTANDSCALING]=e=>IfcCurveStyleFontAndScaling.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCURVESTYLEFONTPATTERN]=e=>IfcCurveStyleFontPattern.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCCYLINDRICALSURFACE]=e=>IfcCylindricalSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDAMPER]=e=>IfcDamper.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDAMPERTYPE]=e=>IfcDamperType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDEEPFOUNDATION]=e=>IfcDeepFoundation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDEEPFOUNDATIONTYPE]=e=>IfcDeepFoundationType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDERIVEDPROFILEDEF]=e=>IfcDerivedProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDERIVEDUNIT]=e=>IfcDerivedUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDERIVEDUNITELEMENT]=e=>IfcDerivedUnitElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDIMENSIONALEXPONENTS]=e=>IfcDimensionalExponents.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDIRECTION]=e=>IfcDirection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISCRETEACCESSORY]=e=>IfcDiscreteAccessory.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISCRETEACCESSORYTYPE]=e=>IfcDiscreteAccessoryType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTANCEEXPRESSION]=e=>IfcDistanceExpression.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONCHAMBERELEMENT]=e=>IfcDistributionChamberElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONCHAMBERELEMENTTYPE]=e=>IfcDistributionChamberElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONCIRCUIT]=e=>IfcDistributionCircuit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONCONTROLELEMENT]=e=>IfcDistributionControlElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONCONTROLELEMENTTYPE]=e=>IfcDistributionControlElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONELEMENT]=e=>IfcDistributionElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONELEMENTTYPE]=e=>IfcDistributionElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONFLOWELEMENT]=e=>IfcDistributionFlowElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONFLOWELEMENTTYPE]=e=>IfcDistributionFlowElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONPORT]=e=>IfcDistributionPort.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDISTRIBUTIONSYSTEM]=e=>IfcDistributionSystem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOCUMENTINFORMATION]=e=>IfcDocumentInformation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOCUMENTINFORMATIONRELATIONSHIP]=e=>IfcDocumentInformationRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOCUMENTREFERENCE]=e=>IfcDocumentReference.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOOR]=e=>IfcDoor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOORLININGPROPERTIES]=e=>IfcDoorLiningProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOORPANELPROPERTIES]=e=>IfcDoorPanelProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOORSTANDARDCASE]=e=>IfcDoorStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOORSTYLE]=e=>IfcDoorStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDOORTYPE]=e=>IfcDoorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDRAUGHTINGPREDEFINEDCOLOUR]=e=>IfcDraughtingPreDefinedColour.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDRAUGHTINGPREDEFINEDCURVEFONT]=e=>IfcDraughtingPreDefinedCurveFont.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDUCTFITTING]=e=>IfcDuctFitting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDUCTFITTINGTYPE]=e=>IfcDuctFittingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDUCTSEGMENT]=e=>IfcDuctSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDUCTSEGMENTTYPE]=e=>IfcDuctSegmentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDUCTSILENCER]=e=>IfcDuctSilencer.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCDUCTSILENCERTYPE]=e=>IfcDuctSilencerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEDGE]=e=>IfcEdge.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEDGECURVE]=e=>IfcEdgeCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEDGELOOP]=e=>IfcEdgeLoop.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICAPPLIANCE]=e=>IfcElectricAppliance.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICAPPLIANCETYPE]=e=>IfcElectricApplianceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICDISTRIBUTIONBOARD]=e=>IfcElectricDistributionBoard.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICDISTRIBUTIONBOARDTYPE]=e=>IfcElectricDistributionBoardType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICFLOWSTORAGEDEVICE]=e=>IfcElectricFlowStorageDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICFLOWSTORAGEDEVICETYPE]=e=>IfcElectricFlowStorageDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICGENERATOR]=e=>IfcElectricGenerator.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICGENERATORTYPE]=e=>IfcElectricGeneratorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICMOTOR]=e=>IfcElectricMotor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICMOTORTYPE]=e=>IfcElectricMotorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICTIMECONTROL]=e=>IfcElectricTimeControl.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELECTRICTIMECONTROLTYPE]=e=>IfcElectricTimeControlType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENT]=e=>IfcElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTASSEMBLY]=e=>IfcElementAssembly.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTASSEMBLYTYPE]=e=>IfcElementAssemblyType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTCOMPONENT]=e=>IfcElementComponent.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTCOMPONENTTYPE]=e=>IfcElementComponentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTQUANTITY]=e=>IfcElementQuantity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTTYPE]=e=>IfcElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELEMENTARYSURFACE]=e=>IfcElementarySurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELLIPSE]=e=>IfcEllipse.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCELLIPSEPROFILEDEF]=e=>IfcEllipseProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCENERGYCONVERSIONDEVICE]=e=>IfcEnergyConversionDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCENERGYCONVERSIONDEVICETYPE]=e=>IfcEnergyConversionDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCENGINE]=e=>IfcEngine.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCENGINETYPE]=e=>IfcEngineType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVAPORATIVECOOLER]=e=>IfcEvaporativeCooler.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVAPORATIVECOOLERTYPE]=e=>IfcEvaporativeCoolerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVAPORATOR]=e=>IfcEvaporator.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVAPORATORTYPE]=e=>IfcEvaporatorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVENT]=e=>IfcEvent.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVENTTIME]=e=>IfcEventTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEVENTTYPE]=e=>IfcEventType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTENDEDPROPERTIES]=e=>IfcExtendedProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALINFORMATION]=e=>IfcExternalInformation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALREFERENCE]=e=>IfcExternalReference.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALREFERENCERELATIONSHIP]=e=>IfcExternalReferenceRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALSPATIALELEMENT]=e=>IfcExternalSpatialElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALSPATIALSTRUCTUREELEMENT]=e=>IfcExternalSpatialStructureElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALLYDEFINEDHATCHSTYLE]=e=>IfcExternallyDefinedHatchStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALLYDEFINEDSURFACESTYLE]=e=>IfcExternallyDefinedSurfaceStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTERNALLYDEFINEDTEXTFONT]=e=>IfcExternallyDefinedTextFont.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTRUDEDAREASOLID]=e=>IfcExtrudedAreaSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCEXTRUDEDAREASOLIDTAPERED]=e=>IfcExtrudedAreaSolidTapered.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACE]=e=>IfcFace.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACEBASEDSURFACEMODEL]=e=>IfcFaceBasedSurfaceModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACEBOUND]=e=>IfcFaceBound.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACEOUTERBOUND]=e=>IfcFaceOuterBound.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACESURFACE]=e=>IfcFaceSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACETEDBREP]=e=>IfcFacetedBrep.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACETEDBREPWITHVOIDS]=e=>IfcFacetedBrepWithVoids.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACILITY]=e=>IfcFacility.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFACILITYPART]=e=>IfcFacilityPart.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFAILURECONNECTIONCONDITION]=e=>IfcFailureConnectionCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFAN]=e=>IfcFan.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFANTYPE]=e=>IfcFanType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFASTENER]=e=>IfcFastener.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFASTENERTYPE]=e=>IfcFastenerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFEATUREELEMENT]=e=>IfcFeatureElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFEATUREELEMENTADDITION]=e=>IfcFeatureElementAddition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFEATUREELEMENTSUBTRACTION]=e=>IfcFeatureElementSubtraction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFILLAREASTYLE]=e=>IfcFillAreaStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFILLAREASTYLEHATCHING]=e=>IfcFillAreaStyleHatching.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFILLAREASTYLETILES]=e=>IfcFillAreaStyleTiles.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFILTER]=e=>IfcFilter.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFILTERTYPE]=e=>IfcFilterType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFIRESUPPRESSIONTERMINAL]=e=>IfcFireSuppressionTerminal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFIRESUPPRESSIONTERMINALTYPE]=e=>IfcFireSuppressionTerminalType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFIXEDREFERENCESWEPTAREASOLID]=e=>IfcFixedReferenceSweptAreaSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWCONTROLLER]=e=>IfcFlowController.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWCONTROLLERTYPE]=e=>IfcFlowControllerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWFITTING]=e=>IfcFlowFitting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWFITTINGTYPE]=e=>IfcFlowFittingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWINSTRUMENT]=e=>IfcFlowInstrument.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWINSTRUMENTTYPE]=e=>IfcFlowInstrumentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWMETER]=e=>IfcFlowMeter.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWMETERTYPE]=e=>IfcFlowMeterType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWMOVINGDEVICE]=e=>IfcFlowMovingDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWMOVINGDEVICETYPE]=e=>IfcFlowMovingDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWSEGMENT]=e=>IfcFlowSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWSEGMENTTYPE]=e=>IfcFlowSegmentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWSTORAGEDEVICE]=e=>IfcFlowStorageDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWSTORAGEDEVICETYPE]=e=>IfcFlowStorageDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWTERMINAL]=e=>IfcFlowTerminal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWTERMINALTYPE]=e=>IfcFlowTerminalType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWTREATMENTDEVICE]=e=>IfcFlowTreatmentDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFLOWTREATMENTDEVICETYPE]=e=>IfcFlowTreatmentDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFOOTING]=e=>IfcFooting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFOOTINGTYPE]=e=>IfcFootingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFURNISHINGELEMENT]=e=>IfcFurnishingElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFURNISHINGELEMENTTYPE]=e=>IfcFurnishingElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFURNITURE]=e=>IfcFurniture.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCFURNITURETYPE]=e=>IfcFurnitureType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOGRAPHICELEMENT]=e=>IfcGeographicElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOGRAPHICELEMENTTYPE]=e=>IfcGeographicElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOMETRICCURVESET]=e=>IfcGeometricCurveSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOMETRICREPRESENTATIONCONTEXT]=e=>IfcGeometricRepresentationContext.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOMETRICREPRESENTATIONITEM]=e=>IfcGeometricRepresentationItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOMETRICREPRESENTATIONSUBCONTEXT]=e=>IfcGeometricRepresentationSubContext.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGEOMETRICSET]=e=>IfcGeometricSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGRID]=e=>IfcGrid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGRIDAXIS]=e=>IfcGridAxis.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGRIDPLACEMENT]=e=>IfcGridPlacement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCGROUP]=e=>IfcGroup.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCHALFSPACESOLID]=e=>IfcHalfSpaceSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCHEATEXCHANGER]=e=>IfcHeatExchanger.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCHEATEXCHANGERTYPE]=e=>IfcHeatExchangerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCHUMIDIFIER]=e=>IfcHumidifier.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCHUMIDIFIERTYPE]=e=>IfcHumidifierType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCISHAPEPROFILEDEF]=e=>IfcIShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCIMAGETEXTURE]=e=>IfcImageTexture.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINDEXEDCOLOURMAP]=e=>IfcIndexedColourMap.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINDEXEDPOLYCURVE]=e=>IfcIndexedPolyCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINDEXEDPOLYGONALFACE]=e=>IfcIndexedPolygonalFace.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINDEXEDPOLYGONALFACEWITHVOIDS]=e=>IfcIndexedPolygonalFaceWithVoids.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINDEXEDTEXTUREMAP]=e=>IfcIndexedTextureMap.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINDEXEDTRIANGLETEXTUREMAP]=e=>IfcIndexedTriangleTextureMap.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINTERCEPTOR]=e=>IfcInterceptor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINTERCEPTORTYPE]=e=>IfcInterceptorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINTERSECTIONCURVE]=e=>IfcIntersectionCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCINVENTORY]=e=>IfcInventory.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCIRREGULARTIMESERIES]=e=>IfcIrregularTimeSeries.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCIRREGULARTIMESERIESVALUE]=e=>IfcIrregularTimeSeriesValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCJUNCTIONBOX]=e=>IfcJunctionBox.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCJUNCTIONBOXTYPE]=e=>IfcJunctionBoxType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLSHAPEPROFILEDEF]=e=>IfcLShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLABORRESOURCE]=e=>IfcLaborResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLABORRESOURCETYPE]=e=>IfcLaborResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLAGTIME]=e=>IfcLagTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLAMP]=e=>IfcLamp.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLAMPTYPE]=e=>IfcLampType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIBRARYINFORMATION]=e=>IfcLibraryInformation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIBRARYREFERENCE]=e=>IfcLibraryReference.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTDISTRIBUTIONDATA]=e=>IfcLightDistributionData.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTFIXTURE]=e=>IfcLightFixture.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTFIXTURETYPE]=e=>IfcLightFixtureType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTINTENSITYDISTRIBUTION]=e=>IfcLightIntensityDistribution.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTSOURCE]=e=>IfcLightSource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTSOURCEAMBIENT]=e=>IfcLightSourceAmbient.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTSOURCEDIRECTIONAL]=e=>IfcLightSourceDirectional.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTSOURCEGONIOMETRIC]=e=>IfcLightSourceGoniometric.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTSOURCEPOSITIONAL]=e=>IfcLightSourcePositional.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLIGHTSOURCESPOT]=e=>IfcLightSourceSpot.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLINE]=e=>IfcLine.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLINESEGMENT2D]=e=>IfcLineSegment2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLINEARPLACEMENT]=e=>IfcLinearPlacement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLINEARPOSITIONINGELEMENT]=e=>IfcLinearPositioningElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLOCALPLACEMENT]=e=>IfcLocalPlacement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCLOOP]=e=>IfcLoop.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMANIFOLDSOLIDBREP]=e=>IfcManifoldSolidBrep.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMAPCONVERSION]=e=>IfcMapConversion.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMAPPEDITEM]=e=>IfcMappedItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIAL]=e=>IfcMaterial.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALCLASSIFICATIONRELATIONSHIP]=e=>IfcMaterialClassificationRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALCONSTITUENT]=e=>IfcMaterialConstituent.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALCONSTITUENTSET]=e=>IfcMaterialConstituentSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALDEFINITION]=e=>IfcMaterialDefinition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALDEFINITIONREPRESENTATION]=e=>IfcMaterialDefinitionRepresentation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALLAYER]=e=>IfcMaterialLayer.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALLAYERSET]=e=>IfcMaterialLayerSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALLAYERSETUSAGE]=e=>IfcMaterialLayerSetUsage.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALLAYERWITHOFFSETS]=e=>IfcMaterialLayerWithOffsets.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALLIST]=e=>IfcMaterialList.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALPROFILE]=e=>IfcMaterialProfile.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALPROFILESET]=e=>IfcMaterialProfileSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALPROFILESETUSAGE]=e=>IfcMaterialProfileSetUsage.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALPROFILESETUSAGETAPERING]=e=>IfcMaterialProfileSetUsageTapering.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALPROFILEWITHOFFSETS]=e=>IfcMaterialProfileWithOffsets.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALPROPERTIES]=e=>IfcMaterialProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALRELATIONSHIP]=e=>IfcMaterialRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMATERIALUSAGEDEFINITION]=e=>IfcMaterialUsageDefinition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMEASUREWITHUNIT]=e=>IfcMeasureWithUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMECHANICALFASTENER]=e=>IfcMechanicalFastener.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMECHANICALFASTENERTYPE]=e=>IfcMechanicalFastenerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMEDICALDEVICE]=e=>IfcMedicalDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMEDICALDEVICETYPE]=e=>IfcMedicalDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMEMBER]=e=>IfcMember.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMEMBERSTANDARDCASE]=e=>IfcMemberStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMEMBERTYPE]=e=>IfcMemberType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMETRIC]=e=>IfcMetric.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMIRROREDPROFILEDEF]=e=>IfcMirroredProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMONETARYUNIT]=e=>IfcMonetaryUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMOTORCONNECTION]=e=>IfcMotorConnection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCMOTORCONNECTIONTYPE]=e=>IfcMotorConnectionType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCNAMEDUNIT]=e=>IfcNamedUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOBJECT]=e=>IfcObject.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOBJECTDEFINITION]=e=>IfcObjectDefinition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOBJECTPLACEMENT]=e=>IfcObjectPlacement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOBJECTIVE]=e=>IfcObjective.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOCCUPANT]=e=>IfcOccupant.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOFFSETCURVE]=e=>IfcOffsetCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOFFSETCURVE2D]=e=>IfcOffsetCurve2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOFFSETCURVE3D]=e=>IfcOffsetCurve3D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOFFSETCURVEBYDISTANCES]=e=>IfcOffsetCurveByDistances.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOPENSHELL]=e=>IfcOpenShell.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOPENINGELEMENT]=e=>IfcOpeningElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOPENINGSTANDARDCASE]=e=>IfcOpeningStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCORGANIZATION]=e=>IfcOrganization.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCORGANIZATIONRELATIONSHIP]=e=>IfcOrganizationRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCORIENTATIONEXPRESSION]=e=>IfcOrientationExpression.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCORIENTEDEDGE]=e=>IfcOrientedEdge.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOUTERBOUNDARYCURVE]=e=>IfcOuterBoundaryCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOUTLET]=e=>IfcOutlet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOUTLETTYPE]=e=>IfcOutletType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCOWNERHISTORY]=e=>IfcOwnerHistory.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPARAMETERIZEDPROFILEDEF]=e=>IfcParameterizedProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPATH]=e=>IfcPath.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPCURVE]=e=>IfcPcurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPERFORMANCEHISTORY]=e=>IfcPerformanceHistory.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPERMEABLECOVERINGPROPERTIES]=e=>IfcPermeableCoveringProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPERMIT]=e=>IfcPermit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPERSON]=e=>IfcPerson.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPERSONANDORGANIZATION]=e=>IfcPersonAndOrganization.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPHYSICALCOMPLEXQUANTITY]=e=>IfcPhysicalComplexQuantity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPHYSICALQUANTITY]=e=>IfcPhysicalQuantity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPHYSICALSIMPLEQUANTITY]=e=>IfcPhysicalSimpleQuantity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPILE]=e=>IfcPile.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPILETYPE]=e=>IfcPileType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPIPEFITTING]=e=>IfcPipeFitting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPIPEFITTINGTYPE]=e=>IfcPipeFittingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPIPESEGMENT]=e=>IfcPipeSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPIPESEGMENTTYPE]=e=>IfcPipeSegmentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPIXELTEXTURE]=e=>IfcPixelTexture.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLACEMENT]=e=>IfcPlacement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLANARBOX]=e=>IfcPlanarBox.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLANAREXTENT]=e=>IfcPlanarExtent.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLANE]=e=>IfcPlane.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLATE]=e=>IfcPlate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLATESTANDARDCASE]=e=>IfcPlateStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPLATETYPE]=e=>IfcPlateType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOINT]=e=>IfcPoint.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOINTONCURVE]=e=>IfcPointOnCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOINTONSURFACE]=e=>IfcPointOnSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOLYLOOP]=e=>IfcPolyLoop.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOLYGONALBOUNDEDHALFSPACE]=e=>IfcPolygonalBoundedHalfSpace.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOLYGONALFACESET]=e=>IfcPolygonalFaceSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOLYLINE]=e=>IfcPolyline.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPORT]=e=>IfcPort.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOSITIONINGELEMENT]=e=>IfcPositioningElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPOSTALADDRESS]=e=>IfcPostalAddress.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPREDEFINEDCOLOUR]=e=>IfcPreDefinedColour.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPREDEFINEDCURVEFONT]=e=>IfcPreDefinedCurveFont.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPREDEFINEDITEM]=e=>IfcPreDefinedItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPREDEFINEDPROPERTIES]=e=>IfcPreDefinedProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPREDEFINEDPROPERTYSET]=e=>IfcPreDefinedPropertySet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPREDEFINEDTEXTFONT]=e=>IfcPreDefinedTextFont.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRESENTATIONITEM]=e=>IfcPresentationItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRESENTATIONLAYERASSIGNMENT]=e=>IfcPresentationLayerAssignment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRESENTATIONLAYERWITHSTYLE]=e=>IfcPresentationLayerWithStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRESENTATIONSTYLE]=e=>IfcPresentationStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRESENTATIONSTYLEASSIGNMENT]=e=>IfcPresentationStyleAssignment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROCEDURE]=e=>IfcProcedure.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROCEDURETYPE]=e=>IfcProcedureType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROCESS]=e=>IfcProcess.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRODUCT]=e=>IfcProduct.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRODUCTDEFINITIONSHAPE]=e=>IfcProductDefinitionShape.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPRODUCTREPRESENTATION]=e=>IfcProductRepresentation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROFILEDEF]=e=>IfcProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROFILEPROPERTIES]=e=>IfcProfileProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROJECT]=e=>IfcProject.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROJECTLIBRARY]=e=>IfcProjectLibrary.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROJECTORDER]=e=>IfcProjectOrder.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROJECTEDCRS]=e=>IfcProjectedCRS.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROJECTIONELEMENT]=e=>IfcProjectionElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTY]=e=>IfcProperty.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYABSTRACTION]=e=>IfcPropertyAbstraction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYBOUNDEDVALUE]=e=>IfcPropertyBoundedValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYDEFINITION]=e=>IfcPropertyDefinition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYDEPENDENCYRELATIONSHIP]=e=>IfcPropertyDependencyRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYENUMERATEDVALUE]=e=>IfcPropertyEnumeratedValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYENUMERATION]=e=>IfcPropertyEnumeration.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYLISTVALUE]=e=>IfcPropertyListValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYREFERENCEVALUE]=e=>IfcPropertyReferenceValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYSET]=e=>IfcPropertySet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYSETDEFINITION]=e=>IfcPropertySetDefinition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYSETTEMPLATE]=e=>IfcPropertySetTemplate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYSINGLEVALUE]=e=>IfcPropertySingleValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYTABLEVALUE]=e=>IfcPropertyTableValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYTEMPLATE]=e=>IfcPropertyTemplate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROPERTYTEMPLATEDEFINITION]=e=>IfcPropertyTemplateDefinition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROTECTIVEDEVICE]=e=>IfcProtectiveDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROTECTIVEDEVICETRIPPINGUNIT]=e=>IfcProtectiveDeviceTrippingUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROTECTIVEDEVICETRIPPINGUNITTYPE]=e=>IfcProtectiveDeviceTrippingUnitType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROTECTIVEDEVICETYPE]=e=>IfcProtectiveDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPROXY]=e=>IfcProxy.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPUMP]=e=>IfcPump.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCPUMPTYPE]=e=>IfcPumpType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYAREA]=e=>IfcQuantityArea.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYCOUNT]=e=>IfcQuantityCount.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYLENGTH]=e=>IfcQuantityLength.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYSET]=e=>IfcQuantitySet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYTIME]=e=>IfcQuantityTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYVOLUME]=e=>IfcQuantityVolume.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCQUANTITYWEIGHT]=e=>IfcQuantityWeight.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRAILING]=e=>IfcRailing.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRAILINGTYPE]=e=>IfcRailingType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRAMP]=e=>IfcRamp.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRAMPFLIGHT]=e=>IfcRampFlight.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRAMPFLIGHTTYPE]=e=>IfcRampFlightType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRAMPTYPE]=e=>IfcRampType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRATIONALBSPLINECURVEWITHKNOTS]=e=>IfcRationalBSplineCurveWithKnots.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRATIONALBSPLINESURFACEWITHKNOTS]=e=>IfcRationalBSplineSurfaceWithKnots.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRECTANGLEHOLLOWPROFILEDEF]=e=>IfcRectangleHollowProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRECTANGLEPROFILEDEF]=e=>IfcRectangleProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRECTANGULARPYRAMID]=e=>IfcRectangularPyramid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRECTANGULARTRIMMEDSURFACE]=e=>IfcRectangularTrimmedSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRECURRENCEPATTERN]=e=>IfcRecurrencePattern.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREFERENCE]=e=>IfcReference.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREFERENT]=e=>IfcReferent.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREGULARTIMESERIES]=e=>IfcRegularTimeSeries.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCEMENTBARPROPERTIES]=e=>IfcReinforcementBarProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCEMENTDEFINITIONPROPERTIES]=e=>IfcReinforcementDefinitionProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCINGBAR]=e=>IfcReinforcingBar.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCINGBARTYPE]=e=>IfcReinforcingBarType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCINGELEMENT]=e=>IfcReinforcingElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCINGELEMENTTYPE]=e=>IfcReinforcingElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCINGMESH]=e=>IfcReinforcingMesh.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREINFORCINGMESHTYPE]=e=>IfcReinforcingMeshType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELAGGREGATES]=e=>IfcRelAggregates.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNS]=e=>IfcRelAssigns.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTOACTOR]=e=>IfcRelAssignsToActor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTOCONTROL]=e=>IfcRelAssignsToControl.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTOGROUP]=e=>IfcRelAssignsToGroup.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTOGROUPBYFACTOR]=e=>IfcRelAssignsToGroupByFactor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTOPROCESS]=e=>IfcRelAssignsToProcess.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTOPRODUCT]=e=>IfcRelAssignsToProduct.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSIGNSTORESOURCE]=e=>IfcRelAssignsToResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATES]=e=>IfcRelAssociates.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATESAPPROVAL]=e=>IfcRelAssociatesApproval.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATESCLASSIFICATION]=e=>IfcRelAssociatesClassification.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATESCONSTRAINT]=e=>IfcRelAssociatesConstraint.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATESDOCUMENT]=e=>IfcRelAssociatesDocument.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATESLIBRARY]=e=>IfcRelAssociatesLibrary.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELASSOCIATESMATERIAL]=e=>IfcRelAssociatesMaterial.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTS]=e=>IfcRelConnects.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSELEMENTS]=e=>IfcRelConnectsElements.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSPATHELEMENTS]=e=>IfcRelConnectsPathElements.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSPORTTOELEMENT]=e=>IfcRelConnectsPortToElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSPORTS]=e=>IfcRelConnectsPorts.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSSTRUCTURALACTIVITY]=e=>IfcRelConnectsStructuralActivity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSSTRUCTURALMEMBER]=e=>IfcRelConnectsStructuralMember.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSWITHECCENTRICITY]=e=>IfcRelConnectsWithEccentricity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONNECTSWITHREALIZINGELEMENTS]=e=>IfcRelConnectsWithRealizingElements.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCONTAINEDINSPATIALSTRUCTURE]=e=>IfcRelContainedInSpatialStructure.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCOVERSBLDGELEMENTS]=e=>IfcRelCoversBldgElements.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELCOVERSSPACES]=e=>IfcRelCoversSpaces.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDECLARES]=e=>IfcRelDeclares.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDECOMPOSES]=e=>IfcRelDecomposes.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDEFINES]=e=>IfcRelDefines.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDEFINESBYOBJECT]=e=>IfcRelDefinesByObject.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDEFINESBYPROPERTIES]=e=>IfcRelDefinesByProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDEFINESBYTEMPLATE]=e=>IfcRelDefinesByTemplate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELDEFINESBYTYPE]=e=>IfcRelDefinesByType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELFILLSELEMENT]=e=>IfcRelFillsElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELFLOWCONTROLELEMENTS]=e=>IfcRelFlowControlElements.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELINTERFERESELEMENTS]=e=>IfcRelInterferesElements.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELNESTS]=e=>IfcRelNests.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELPOSITIONS]=e=>IfcRelPositions.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELPROJECTSELEMENT]=e=>IfcRelProjectsElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELREFERENCEDINSPATIALSTRUCTURE]=e=>IfcRelReferencedInSpatialStructure.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELSEQUENCE]=e=>IfcRelSequence.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELSERVICESBUILDINGS]=e=>IfcRelServicesBuildings.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELSPACEBOUNDARY]=e=>IfcRelSpaceBoundary.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELSPACEBOUNDARY1STLEVEL]=e=>IfcRelSpaceBoundary1stLevel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELSPACEBOUNDARY2NDLEVEL]=e=>IfcRelSpaceBoundary2ndLevel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELVOIDSELEMENT]=e=>IfcRelVoidsElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRELATIONSHIP]=e=>IfcRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREPARAMETRISEDCOMPOSITECURVESEGMENT]=e=>IfcReparametrisedCompositeCurveSegment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREPRESENTATION]=e=>IfcRepresentation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREPRESENTATIONCONTEXT]=e=>IfcRepresentationContext.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREPRESENTATIONITEM]=e=>IfcRepresentationItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREPRESENTATIONMAP]=e=>IfcRepresentationMap.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRESOURCE]=e=>IfcResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRESOURCEAPPROVALRELATIONSHIP]=e=>IfcResourceApprovalRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRESOURCECONSTRAINTRELATIONSHIP]=e=>IfcResourceConstraintRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRESOURCELEVELRELATIONSHIP]=e=>IfcResourceLevelRelationship.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRESOURCETIME]=e=>IfcResourceTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREVOLVEDAREASOLID]=e=>IfcRevolvedAreaSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCREVOLVEDAREASOLIDTAPERED]=e=>IfcRevolvedAreaSolidTapered.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRIGHTCIRCULARCONE]=e=>IfcRightCircularCone.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCRIGHTCIRCULARCYLINDER]=e=>IfcRightCircularCylinder.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCROOF]=e=>IfcRoof.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCROOFTYPE]=e=>IfcRoofType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCROOT]=e=>IfcRoot.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCROUNDEDRECTANGLEPROFILEDEF]=e=>IfcRoundedRectangleProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSIUNIT]=e=>IfcSIUnit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSANITARYTERMINAL]=e=>IfcSanitaryTerminal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSANITARYTERMINALTYPE]=e=>IfcSanitaryTerminalType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSCHEDULINGTIME]=e=>IfcSchedulingTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSEAMCURVE]=e=>IfcSeamCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSECTIONPROPERTIES]=e=>IfcSectionProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSECTIONREINFORCEMENTPROPERTIES]=e=>IfcSectionReinforcementProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSECTIONEDSOLID]=e=>IfcSectionedSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSECTIONEDSOLIDHORIZONTAL]=e=>IfcSectionedSolidHorizontal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSECTIONEDSPINE]=e=>IfcSectionedSpine.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSENSOR]=e=>IfcSensor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSENSORTYPE]=e=>IfcSensorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSHADINGDEVICE]=e=>IfcShadingDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSHADINGDEVICETYPE]=e=>IfcShadingDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSHAPEASPECT]=e=>IfcShapeAspect.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSHAPEMODEL]=e=>IfcShapeModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSHAPEREPRESENTATION]=e=>IfcShapeRepresentation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSHELLBASEDSURFACEMODEL]=e=>IfcShellBasedSurfaceModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSIMPLEPROPERTY]=e=>IfcSimpleProperty.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSIMPLEPROPERTYTEMPLATE]=e=>IfcSimplePropertyTemplate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSITE]=e=>IfcSite.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSLAB]=e=>IfcSlab.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSLABELEMENTEDCASE]=e=>IfcSlabElementedCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSLABSTANDARDCASE]=e=>IfcSlabStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSLABTYPE]=e=>IfcSlabType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSLIPPAGECONNECTIONCONDITION]=e=>IfcSlippageConnectionCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSOLARDEVICE]=e=>IfcSolarDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSOLARDEVICETYPE]=e=>IfcSolarDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSOLIDMODEL]=e=>IfcSolidModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPACE]=e=>IfcSpace.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPACEHEATER]=e=>IfcSpaceHeater.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPACEHEATERTYPE]=e=>IfcSpaceHeaterType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPACETYPE]=e=>IfcSpaceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPATIALELEMENT]=e=>IfcSpatialElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPATIALELEMENTTYPE]=e=>IfcSpatialElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPATIALSTRUCTUREELEMENT]=e=>IfcSpatialStructureElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPATIALSTRUCTUREELEMENTTYPE]=e=>IfcSpatialStructureElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPATIALZONE]=e=>IfcSpatialZone.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPATIALZONETYPE]=e=>IfcSpatialZoneType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPHERE]=e=>IfcSphere.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSPHERICALSURFACE]=e=>IfcSphericalSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTACKTERMINAL]=e=>IfcStackTerminal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTACKTERMINALTYPE]=e=>IfcStackTerminalType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTAIR]=e=>IfcStair.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTAIRFLIGHT]=e=>IfcStairFlight.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTAIRFLIGHTTYPE]=e=>IfcStairFlightType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTAIRTYPE]=e=>IfcStairType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALACTION]=e=>IfcStructuralAction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALACTIVITY]=e=>IfcStructuralActivity.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALANALYSISMODEL]=e=>IfcStructuralAnalysisModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCONNECTION]=e=>IfcStructuralConnection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCONNECTIONCONDITION]=e=>IfcStructuralConnectionCondition.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCURVEACTION]=e=>IfcStructuralCurveAction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCURVECONNECTION]=e=>IfcStructuralCurveConnection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCURVEMEMBER]=e=>IfcStructuralCurveMember.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCURVEMEMBERVARYING]=e=>IfcStructuralCurveMemberVarying.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALCURVEREACTION]=e=>IfcStructuralCurveReaction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALITEM]=e=>IfcStructuralItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLINEARACTION]=e=>IfcStructuralLinearAction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOAD]=e=>IfcStructuralLoad.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADCASE]=e=>IfcStructuralLoadCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADCONFIGURATION]=e=>IfcStructuralLoadConfiguration.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADGROUP]=e=>IfcStructuralLoadGroup.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADLINEARFORCE]=e=>IfcStructuralLoadLinearForce.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADORRESULT]=e=>IfcStructuralLoadOrResult.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADPLANARFORCE]=e=>IfcStructuralLoadPlanarForce.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADSINGLEDISPLACEMENT]=e=>IfcStructuralLoadSingleDisplacement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION]=e=>IfcStructuralLoadSingleDisplacementDistortion.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADSINGLEFORCE]=e=>IfcStructuralLoadSingleForce.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADSINGLEFORCEWARPING]=e=>IfcStructuralLoadSingleForceWarping.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADSTATIC]=e=>IfcStructuralLoadStatic.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALLOADTEMPERATURE]=e=>IfcStructuralLoadTemperature.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALMEMBER]=e=>IfcStructuralMember.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALPLANARACTION]=e=>IfcStructuralPlanarAction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALPOINTACTION]=e=>IfcStructuralPointAction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALPOINTCONNECTION]=e=>IfcStructuralPointConnection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALPOINTREACTION]=e=>IfcStructuralPointReaction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALREACTION]=e=>IfcStructuralReaction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALRESULTGROUP]=e=>IfcStructuralResultGroup.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALSURFACEACTION]=e=>IfcStructuralSurfaceAction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALSURFACECONNECTION]=e=>IfcStructuralSurfaceConnection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALSURFACEMEMBER]=e=>IfcStructuralSurfaceMember.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALSURFACEMEMBERVARYING]=e=>IfcStructuralSurfaceMemberVarying.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTRUCTURALSURFACEREACTION]=e=>IfcStructuralSurfaceReaction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTYLEMODEL]=e=>IfcStyleModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTYLEDITEM]=e=>IfcStyledItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSTYLEDREPRESENTATION]=e=>IfcStyledRepresentation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSUBCONTRACTRESOURCE]=e=>IfcSubContractResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSUBCONTRACTRESOURCETYPE]=e=>IfcSubContractResourceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSUBEDGE]=e=>IfcSubedge.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACE]=e=>IfcSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACECURVE]=e=>IfcSurfaceCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACECURVESWEPTAREASOLID]=e=>IfcSurfaceCurveSweptAreaSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACEFEATURE]=e=>IfcSurfaceFeature.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACEOFLINEAREXTRUSION]=e=>IfcSurfaceOfLinearExtrusion.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACEOFREVOLUTION]=e=>IfcSurfaceOfRevolution.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACEREINFORCEMENTAREA]=e=>IfcSurfaceReinforcementArea.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACESTYLE]=e=>IfcSurfaceStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACESTYLELIGHTING]=e=>IfcSurfaceStyleLighting.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACESTYLEREFRACTION]=e=>IfcSurfaceStyleRefraction.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACESTYLERENDERING]=e=>IfcSurfaceStyleRendering.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACESTYLESHADING]=e=>IfcSurfaceStyleShading.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACESTYLEWITHTEXTURES]=e=>IfcSurfaceStyleWithTextures.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSURFACETEXTURE]=e=>IfcSurfaceTexture.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSWEPTAREASOLID]=e=>IfcSweptAreaSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSWEPTDISKSOLID]=e=>IfcSweptDiskSolid.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSWEPTDISKSOLIDPOLYGONAL]=e=>IfcSweptDiskSolidPolygonal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSWEPTSURFACE]=e=>IfcSweptSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSWITCHINGDEVICE]=e=>IfcSwitchingDevice.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSWITCHINGDEVICETYPE]=e=>IfcSwitchingDeviceType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSYSTEM]=e=>IfcSystem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSYSTEMFURNITUREELEMENT]=e=>IfcSystemFurnitureElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCSYSTEMFURNITUREELEMENTTYPE]=e=>IfcSystemFurnitureElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTSHAPEPROFILEDEF]=e=>IfcTShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTABLE]=e=>IfcTable.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTABLECOLUMN]=e=>IfcTableColumn.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTABLEROW]=e=>IfcTableRow.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTANK]=e=>IfcTank.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTANKTYPE]=e=>IfcTankType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTASK]=e=>IfcTask.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTASKTIME]=e=>IfcTaskTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTASKTIMERECURRING]=e=>IfcTaskTimeRecurring.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTASKTYPE]=e=>IfcTaskType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTELECOMADDRESS]=e=>IfcTelecomAddress.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTENDON]=e=>IfcTendon.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTENDONANCHOR]=e=>IfcTendonAnchor.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTENDONANCHORTYPE]=e=>IfcTendonAnchorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTENDONCONDUIT]=e=>IfcTendonConduit.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTENDONCONDUITTYPE]=e=>IfcTendonConduitType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTENDONTYPE]=e=>IfcTendonType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTESSELLATEDFACESET]=e=>IfcTessellatedFaceSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTESSELLATEDITEM]=e=>IfcTessellatedItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTLITERAL]=e=>IfcTextLiteral.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTLITERALWITHEXTENT]=e=>IfcTextLiteralWithExtent.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTSTYLE]=e=>IfcTextStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTSTYLEFONTMODEL]=e=>IfcTextStyleFontModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTSTYLEFORDEFINEDFONT]=e=>IfcTextStyleForDefinedFont.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTSTYLETEXTMODEL]=e=>IfcTextStyleTextModel.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTURECOORDINATE]=e=>IfcTextureCoordinate.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTURECOORDINATEGENERATOR]=e=>IfcTextureCoordinateGenerator.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTUREMAP]=e=>IfcTextureMap.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTUREVERTEX]=e=>IfcTextureVertex.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTEXTUREVERTEXLIST]=e=>IfcTextureVertexList.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTIMEPERIOD]=e=>IfcTimePeriod.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTIMESERIES]=e=>IfcTimeSeries.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTIMESERIESVALUE]=e=>IfcTimeSeriesValue.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTOPOLOGICALREPRESENTATIONITEM]=e=>IfcTopologicalRepresentationItem.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTOPOLOGYREPRESENTATION]=e=>IfcTopologyRepresentation.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTOROIDALSURFACE]=e=>IfcToroidalSurface.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRANSFORMER]=e=>IfcTransformer.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRANSFORMERTYPE]=e=>IfcTransformerType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRANSITIONCURVESEGMENT2D]=e=>IfcTransitionCurveSegment2D.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRANSPORTELEMENT]=e=>IfcTransportElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRANSPORTELEMENTTYPE]=e=>IfcTransportElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRAPEZIUMPROFILEDEF]=e=>IfcTrapeziumProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRIANGULATEDFACESET]=e=>IfcTriangulatedFaceSet.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRIANGULATEDIRREGULARNETWORK]=e=>IfcTriangulatedIrregularNetwork.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTRIMMEDCURVE]=e=>IfcTrimmedCurve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTUBEBUNDLE]=e=>IfcTubeBundle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTUBEBUNDLETYPE]=e=>IfcTubeBundleType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTYPEOBJECT]=e=>IfcTypeObject.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTYPEPROCESS]=e=>IfcTypeProcess.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTYPEPRODUCT]=e=>IfcTypeProduct.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCTYPERESOURCE]=e=>IfcTypeResource.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCUSHAPEPROFILEDEF]=e=>IfcUShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCUNITASSIGNMENT]=e=>IfcUnitAssignment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCUNITARYCONTROLELEMENT]=e=>IfcUnitaryControlElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCUNITARYCONTROLELEMENTTYPE]=e=>IfcUnitaryControlElementType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCUNITARYEQUIPMENT]=e=>IfcUnitaryEquipment.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCUNITARYEQUIPMENTTYPE]=e=>IfcUnitaryEquipmentType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVALVE]=e=>IfcValve.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVALVETYPE]=e=>IfcValveType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVECTOR]=e=>IfcVector.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVERTEX]=e=>IfcVertex.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVERTEXLOOP]=e=>IfcVertexLoop.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVERTEXPOINT]=e=>IfcVertexPoint.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVIBRATIONDAMPER]=e=>IfcVibrationDamper.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVIBRATIONDAMPERTYPE]=e=>IfcVibrationDamperType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVIBRATIONISOLATOR]=e=>IfcVibrationIsolator.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVIBRATIONISOLATORTYPE]=e=>IfcVibrationIsolatorType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVIRTUALELEMENT]=e=>IfcVirtualElement.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVIRTUALGRIDINTERSECTION]=e=>IfcVirtualGridIntersection.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCVOIDINGFEATURE]=e=>IfcVoidingFeature.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWALL]=e=>IfcWall.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWALLELEMENTEDCASE]=e=>IfcWallElementedCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWALLSTANDARDCASE]=e=>IfcWallStandardCase.FromTape(e.ID,e.type,e.arguments);FromRawLineData[IFCWALLTYPE]=e=>IfcWallType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWASTETERMINAL]=e=>IfcWasteTerminal.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWASTETERMINALTYPE]=e=>IfcWasteTerminalType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWINDOW]=e=>IfcWindow.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWINDOWLININGPROPERTIES]=e=>IfcWindowLiningProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWINDOWPANELPROPERTIES]=e=>IfcWindowPanelProperties.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWINDOWSTANDARDCASE]=e=>IfcWindowStandardCase.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWINDOWSTYLE]=e=>IfcWindowStyle.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWINDOWTYPE]=e=>IfcWindowType.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWORKCALENDAR]=e=>IfcWorkCalendar.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWORKCONTROL]=e=>IfcWorkControl.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWORKPLAN]=e=>IfcWorkPlan.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWORKSCHEDULE]=e=>IfcWorkSchedule.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCWORKTIME]=e=>IfcWorkTime.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCZSHAPEPROFILEDEF]=e=>IfcZShapeProfileDef.FromTape(e.ID,e.type,e.arguments),FromRawLineData[IFCZONE]=e=>IfcZone.FromTape(e.ID,e.type,e.arguments);var WebIFCWasm,IfcActionRequest=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.PredefinedType=h,this.Status=l,this.LongDescription=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcActionRequest(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}},IfcActor=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.TheActor=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcActor(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheActor),e}},IfcActorRole=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Role=i,this.UserDefinedRole=s,this.Description=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcActorRole(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Role),e.push(this.UserDefinedRole),e.push(this.Description),e}},IfcActuator=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcActuator(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcActuatorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcActuatorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcAddress=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Purpose=i,this.Description=s,this.UserDefinedPurpose=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcAddress(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e}},IfcAdvancedBrep=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Outer=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcAdvancedBrep(e,t,r)}ToTape(){let e=[];return e.push(this.Outer),e}},IfcAdvancedBrepWithVoids=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Outer=i,this.Voids=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcAdvancedBrepWithVoids(e,t,r,o)}ToTape(){let e=[];return e.push(this.Outer),e.push(this.Voids),e}},IfcAdvancedFace=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Bounds=i,this.FaceSurface=s,this.SameSense=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcAdvancedFace(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Bounds),e.push(this.FaceSurface),e.push(this.SameSense),e}},IfcAirTerminal=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAirTerminal(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcAirTerminalBox=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAirTerminalBox(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcAirTerminalBoxType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcAirTerminalBoxType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcAirTerminalType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcAirTerminalType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcAirToAirHeatRecovery=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAirToAirHeatRecovery(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcAirToAirHeatRecoveryType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcAirToAirHeatRecoveryType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcAlarm=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAlarm(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcAlarmType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcAlarmType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcAlignment=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Axis=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAlignment(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Axis),e.push(this.PredefinedType),e}},IfcAlignment2DHorizontal=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.StartDistAlong=i,this.Segments=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcAlignment2DHorizontal(e,t,r,o)}ToTape(){let e=[];return e.push(this.StartDistAlong),e.push(this.Segments),e}},IfcAlignment2DHorizontalSegment=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.TangentialContinuity=i,this.StartTag=s,this.EndTag=r,this.CurveGeometry=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcAlignment2DHorizontalSegment(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.CurveGeometry),e}},IfcAlignment2DSegment=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.TangentialContinuity=i,this.StartTag=s,this.EndTag=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcAlignment2DSegment(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e}},IfcAlignment2DVerSegCircularArc=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.TangentialContinuity=i,this.StartTag=s,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=n,this.StartGradient=h,this.Radius=l,this.IsConvex=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAlignment2DVerSegCircularArc(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e.push(this.Radius),e.push(this.IsConvex),e}},IfcAlignment2DVerSegLine=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.TangentialContinuity=i,this.StartTag=s,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=n,this.StartGradient=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcAlignment2DVerSegLine(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e}},IfcAlignment2DVerSegParabolicArc=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.TangentialContinuity=i,this.StartTag=s,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=n,this.StartGradient=h,this.ParabolaConstant=l,this.IsConvex=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAlignment2DVerSegParabolicArc(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e.push(this.ParabolaConstant),e.push(this.IsConvex),e}},IfcAlignment2DVertical=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Segments=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcAlignment2DVertical(e,t,r)}ToTape(){let e=[];return e.push(this.Segments),e}},IfcAlignment2DVerticalSegment=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.TangentialContinuity=i,this.StartTag=s,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=n,this.StartGradient=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcAlignment2DVerticalSegment(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e}},IfcAlignmentCurve=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Horizontal=i,this.Vertical=s,this.Tag=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcAlignmentCurve(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Horizontal),e.push(this.Vertical),e.push(this.Tag),e}},IfcAnnotation=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcAnnotation(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},IfcAnnotationFillArea=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.OuterBoundary=i,this.InnerBoundaries=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcAnnotationFillArea(e,t,r,o)}ToTape(){let e=[];return e.push(this.OuterBoundary),e.push(this.InnerBoundaries),e}},IfcApplication=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ApplicationDeveloper=i,this.Version=s,this.ApplicationFullName=r,this.ApplicationIdentifier=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcApplication(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ApplicationDeveloper),e.push(this.Version),e.push(this.ApplicationFullName),e.push(this.ApplicationIdentifier),e}},IfcAppliedValue=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.AppliedValue=r,this.UnitBasis=o,this.ApplicableDate=a,this.FixedUntilDate=n,this.Category=h,this.Condition=l,this.ArithmeticOperator=c,this.Components=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcAppliedValue(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AppliedValue),e.push(this.UnitBasis),e.push(this.ApplicableDate),e.push(this.FixedUntilDate),e.push(this.Category),e.push(this.Condition),e.push(this.ArithmeticOperator),e.push(this.Components),e}},IfcApproval=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.Identifier=i,this.Name=s,this.Description=r,this.TimeOfApproval=o,this.Status=a,this.Level=n,this.Qualifier=h,this.RequestingApproval=l,this.GivingApproval=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcApproval(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.Identifier),e.push(this.Name),e.push(this.Description),e.push(this.TimeOfApproval),e.push(this.Status),e.push(this.Level),e.push(this.Qualifier),e.push(this.RequestingApproval),e.push(this.GivingApproval),e}},IfcApprovalRelationship=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingApproval=r,this.RelatedApprovals=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcApprovalRelationship(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingApproval),e.push(this.RelatedApprovals),e}},IfcArbitraryClosedProfileDef=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.OuterCurve=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcArbitraryClosedProfileDef(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.OuterCurve),e}},IfcArbitraryOpenProfileDef=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Curve=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcArbitraryOpenProfileDef(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Curve),e}},IfcArbitraryProfileDefWithVoids=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.OuterCurve=r,this.InnerCurves=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcArbitraryProfileDefWithVoids(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.OuterCurve),e.push(this.InnerCurves),e}},IfcAsset=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.OriginalValue=h,this.CurrentValue=l,this.TotalReplacementCost=c,this.Owner=u,this.User=p,this.ResponsiblePerson=d,this.IncorporationDate=m,this.DepreciatedValue=f}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++];return new IfcAsset(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.OriginalValue),e.push(this.CurrentValue),e.push(this.TotalReplacementCost),e.push(this.Owner),e.push(this.User),e.push(this.ResponsiblePerson),e.push(this.IncorporationDate),e.push(this.DepreciatedValue),e}},IfcAsymmetricIShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.BottomFlangeWidth=o,this.OverallDepth=a,this.WebThickness=n,this.BottomFlangeThickness=h,this.BottomFlangeFilletRadius=l,this.TopFlangeWidth=c,this.TopFlangeThickness=u,this.TopFlangeFilletRadius=p,this.BottomFlangeEdgeRadius=d,this.BottomFlangeSlope=m,this.TopFlangeEdgeRadius=f,this.TopFlangeSlope=g}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++];return new IfcAsymmetricIShapeProfileDef(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.BottomFlangeWidth),e.push(this.OverallDepth),e.push(this.WebThickness),e.push(this.BottomFlangeThickness),e.push(this.BottomFlangeFilletRadius),e.push(this.TopFlangeWidth),e.push(this.TopFlangeThickness),e.push(this.TopFlangeFilletRadius),e.push(this.BottomFlangeEdgeRadius),e.push(this.BottomFlangeSlope),e.push(this.TopFlangeEdgeRadius),e.push(this.TopFlangeSlope),e}},IfcAudioVisualAppliance=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcAudioVisualAppliance(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcAudioVisualApplianceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcAudioVisualApplianceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcAxis1Placement=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Location=i,this.Axis=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcAxis1Placement(e,t,r,o)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Axis),e}},IfcAxis2Placement2D=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Location=i,this.RefDirection=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcAxis2Placement2D(e,t,r,o)}ToTape(){let e=[];return e.push(this.Location),e.push(this.RefDirection),e}},IfcAxis2Placement3D=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Location=i,this.Axis=s,this.RefDirection=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcAxis2Placement3D(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Axis),e.push(this.RefDirection),e}},IfcBSplineCurve=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Degree=i,this.ControlPointsList=s,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcBSplineCurve(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e}},IfcBSplineCurveWithKnots=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Degree=i,this.ControlPointsList=s,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=a,this.KnotMultiplicities=n,this.Knots=h,this.KnotSpec=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcBSplineCurveWithKnots(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e.push(this.KnotMultiplicities),e.push(this.Knots),e.push(this.KnotSpec),e}},IfcBSplineSurface=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.UDegree=i,this.VDegree=s,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=a,this.VClosed=n,this.SelfIntersect=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcBSplineSurface(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e}},IfcBSplineSurfaceWithKnots=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.UDegree=i,this.VDegree=s,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=a,this.VClosed=n,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=c,this.UKnots=u,this.VKnots=p,this.KnotSpec=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcBSplineSurfaceWithKnots(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e.push(this.UMultiplicities),e.push(this.VMultiplicities),e.push(this.UKnots),e.push(this.VKnots),e.push(this.KnotSpec),e}},IfcBeam=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBeam(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBeamStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBeamStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBeamType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBeamType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcBearing=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBearing(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBearingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBearingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcBlobTexture=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.RepeatS=i,this.RepeatT=s,this.Mode=r,this.TextureTransform=o,this.Parameter=a,this.RasterFormat=n,this.RasterCode=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcBlobTexture(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.RasterFormat),e.push(this.RasterCode),e}},IfcBlock=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Position=i,this.XLength=s,this.YLength=r,this.ZLength=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcBlock(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Position),e.push(this.XLength),e.push(this.YLength),e.push(this.ZLength),e}},IfcBoiler=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBoiler(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBoilerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBoilerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcBooleanClippingResult=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Operator=i,this.FirstOperand=s,this.SecondOperand=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcBooleanClippingResult(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Operator),e.push(this.FirstOperand),e.push(this.SecondOperand),e}},IfcBooleanResult=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Operator=i,this.FirstOperand=s,this.SecondOperand=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcBooleanResult(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Operator),e.push(this.FirstOperand),e.push(this.SecondOperand),e}},IfcBoundaryCondition=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcBoundaryCondition(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcBoundaryCurve=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Segments=i,this.SelfIntersect=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcBoundaryCurve(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},IfcBoundaryEdgeCondition=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.TranslationalStiffnessByLengthX=s,this.TranslationalStiffnessByLengthY=r,this.TranslationalStiffnessByLengthZ=o,this.RotationalStiffnessByLengthX=a,this.RotationalStiffnessByLengthY=n,this.RotationalStiffnessByLengthZ=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcBoundaryEdgeCondition(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessByLengthX),e.push(this.TranslationalStiffnessByLengthY),e.push(this.TranslationalStiffnessByLengthZ),e.push(this.RotationalStiffnessByLengthX),e.push(this.RotationalStiffnessByLengthY),e.push(this.RotationalStiffnessByLengthZ),e}},IfcBoundaryFaceCondition=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.TranslationalStiffnessByAreaX=s,this.TranslationalStiffnessByAreaY=r,this.TranslationalStiffnessByAreaZ=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcBoundaryFaceCondition(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessByAreaX),e.push(this.TranslationalStiffnessByAreaY),e.push(this.TranslationalStiffnessByAreaZ),e}},IfcBoundaryNodeCondition=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.TranslationalStiffnessX=s,this.TranslationalStiffnessY=r,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=a,this.RotationalStiffnessY=n,this.RotationalStiffnessZ=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcBoundaryNodeCondition(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessX),e.push(this.TranslationalStiffnessY),e.push(this.TranslationalStiffnessZ),e.push(this.RotationalStiffnessX),e.push(this.RotationalStiffnessY),e.push(this.RotationalStiffnessZ),e}},IfcBoundaryNodeConditionWarping=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Name=i,this.TranslationalStiffnessX=s,this.TranslationalStiffnessY=r,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=a,this.RotationalStiffnessY=n,this.RotationalStiffnessZ=h,this.WarpingStiffness=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcBoundaryNodeConditionWarping(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessX),e.push(this.TranslationalStiffnessY),e.push(this.TranslationalStiffnessZ),e.push(this.RotationalStiffnessX),e.push(this.RotationalStiffnessY),e.push(this.RotationalStiffnessZ),e.push(this.WarpingStiffness),e}},IfcBoundedCurve=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcBoundedCurve(e,t)}ToTape(){return[]}},IfcBoundedSurface=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcBoundedSurface(e,t)}ToTape(){return[]}},IfcBoundingBox=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Corner=i,this.XDim=s,this.YDim=r,this.ZDim=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcBoundingBox(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Corner),e.push(this.XDim),e.push(this.YDim),e.push(this.ZDim),e}},IfcBoxedHalfSpace=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.BaseSurface=i,this.AgreementFlag=s,this.Enclosure=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcBoxedHalfSpace(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e.push(this.Enclosure),e}},IfcBridge=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBridge(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e}},IfcBridgePart=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBridgePart(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e}},IfcBuilding=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c,this.ElevationOfRefHeight=u,this.ElevationOfTerrain=p,this.BuildingAddress=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcBuilding(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.ElevationOfRefHeight),e.push(this.ElevationOfTerrain),e.push(this.BuildingAddress),e}},IfcBuildingElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcBuildingElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcBuildingElementPart=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBuildingElementPart(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBuildingElementPartType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBuildingElementPartType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcBuildingElementProxy=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBuildingElementProxy(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBuildingElementProxyType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBuildingElementProxyType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcBuildingElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBuildingElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcBuildingStorey=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c,this.Elevation=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBuildingStorey(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.Elevation),e}},IfcBuildingSystem=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.PredefinedType=n,this.LongName=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcBuildingSystem(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.LongName),e}},IfcBurner=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcBurner(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcBurnerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcBurnerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Depth=o,this.Width=a,this.WallThickness=n,this.Girth=h,this.InternalFilletRadius=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcCShapeProfileDef(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.Width),e.push(this.WallThickness),e.push(this.Girth),e.push(this.InternalFilletRadius),e}},IfcCableCarrierFitting=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCableCarrierFitting(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCableCarrierFittingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCableCarrierFittingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCableCarrierSegment=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCableCarrierSegment(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCableCarrierSegmentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCableCarrierSegmentType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCableFitting=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCableFitting(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCableFittingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCableFittingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCableSegment=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCableSegment(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCableSegmentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCableSegmentType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCaissonFoundation=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCaissonFoundation(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCaissonFoundationType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCaissonFoundationType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCartesianPoint=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Coordinates=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcCartesianPoint(e,t,r)}ToTape(){let e=[];return e.push(this.Coordinates),e}},IfcCartesianPointList=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcCartesianPointList(e,t)}ToTape(){return[]}},IfcCartesianPointList2D=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.CoordList=i,this.TagList=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCartesianPointList2D(e,t,r,o)}ToTape(){let e=[];return e.push(this.CoordList),e.push(this.TagList),e}},IfcCartesianPointList3D=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.CoordList=i,this.TagList=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCartesianPointList3D(e,t,r,o)}ToTape(){let e=[];return e.push(this.CoordList),e.push(this.TagList),e}},IfcCartesianTransformationOperator=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Axis1=i,this.Axis2=s,this.LocalOrigin=r,this.Scale=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcCartesianTransformationOperator(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e}},IfcCartesianTransformationOperator2D=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Axis1=i,this.Axis2=s,this.LocalOrigin=r,this.Scale=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcCartesianTransformationOperator2D(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e}},IfcCartesianTransformationOperator2DnonUniform=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Axis1=i,this.Axis2=s,this.LocalOrigin=r,this.Scale=o,this.Scale2=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcCartesianTransformationOperator2DnonUniform(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Scale2),e}},IfcCartesianTransformationOperator3D=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Axis1=i,this.Axis2=s,this.LocalOrigin=r,this.Scale=o,this.Axis3=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcCartesianTransformationOperator3D(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Axis3),e}},IfcCartesianTransformationOperator3DnonUniform=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Axis1=i,this.Axis2=s,this.LocalOrigin=r,this.Scale=o,this.Axis3=a,this.Scale2=n,this.Scale3=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcCartesianTransformationOperator3DnonUniform(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Axis3),e.push(this.Scale2),e.push(this.Scale3),e}},IfcCenterLineProfileDef=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Curve=r,this.Thickness=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcCenterLineProfileDef(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Curve),e.push(this.Thickness),e}},IfcChiller=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcChiller(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcChillerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcChillerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcChimney=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcChimney(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcChimneyType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcChimneyType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCircle=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Position=i,this.Radius=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCircle(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},IfcCircleHollowProfileDef=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Radius=o,this.WallThickness=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcCircleHollowProfileDef(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Radius),e.push(this.WallThickness),e}},IfcCircleProfileDef=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Radius=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcCircleProfileDef(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Radius),e}},IfcCircularArcSegment2D=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.StartPoint=i,this.StartDirection=s,this.SegmentLength=r,this.Radius=o,this.IsCCW=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcCircularArcSegment2D(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e.push(this.Radius),e.push(this.IsCCW),e}},IfcCivilElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcCivilElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcCivilElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCivilElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcClassification=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Source=i,this.Edition=s,this.EditionDate=r,this.Name=o,this.Description=a,this.Location=n,this.ReferenceTokens=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcClassification(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Source),e.push(this.Edition),e.push(this.EditionDate),e.push(this.Name),e.push(this.Description),e.push(this.Location),e.push(this.ReferenceTokens),e}},IfcClassificationReference=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r,this.ReferencedSource=o,this.Description=a,this.Sort=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcClassificationReference(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.ReferencedSource),e.push(this.Description),e.push(this.Sort),e}},IfcClosedShell=class{constructor(e,t,i){this.expressID=e,this.type=t,this.CfsFaces=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcClosedShell(e,t,r)}ToTape(){let e=[];return e.push(this.CfsFaces),e}},IfcCoil=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCoil(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCoilType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCoilType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcColourRgb=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Red=s,this.Green=r,this.Blue=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcColourRgb(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Red),e.push(this.Green),e.push(this.Blue),e}},IfcColourRgbList=class{constructor(e,t,i){this.expressID=e,this.type=t,this.ColourList=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcColourRgbList(e,t,r)}ToTape(){let e=[];return e.push(this.ColourList),e}},IfcColourSpecification=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcColourSpecification(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcColumn=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcColumn(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcColumnStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcColumnStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcColumnType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcColumnType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCommunicationsAppliance=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCommunicationsAppliance(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCommunicationsApplianceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCommunicationsApplianceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcComplexProperty=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.UsageName=r,this.HasProperties=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcComplexProperty(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.HasProperties),e}},IfcComplexPropertyTemplate=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.UsageName=a,this.TemplateType=n,this.HasPropertyTemplates=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcComplexPropertyTemplate(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.TemplateType),e.push(this.HasPropertyTemplates),e}},IfcCompositeCurve=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Segments=i,this.SelfIntersect=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCompositeCurve(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},IfcCompositeCurveOnSurface=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Segments=i,this.SelfIntersect=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCompositeCurveOnSurface(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},IfcCompositeCurveSegment=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Transition=i,this.SameSense=s,this.ParentCurve=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcCompositeCurveSegment(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Transition),e.push(this.SameSense),e.push(this.ParentCurve),e}},IfcCompositeProfileDef=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Profiles=r,this.Label=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcCompositeProfileDef(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Profiles),e.push(this.Label),e}},IfcCompressor=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCompressor(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCompressorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCompressorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCondenser=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCondenser(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCondenserType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCondenserType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcConic=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Position=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcConic(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},IfcConnectedFaceSet=class{constructor(e,t,i){this.expressID=e,this.type=t,this.CfsFaces=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcConnectedFaceSet(e,t,r)}ToTape(){let e=[];return e.push(this.CfsFaces),e}},IfcConnectionCurveGeometry=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.CurveOnRelatingElement=i,this.CurveOnRelatedElement=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcConnectionCurveGeometry(e,t,r,o)}ToTape(){let e=[];return e.push(this.CurveOnRelatingElement),e.push(this.CurveOnRelatedElement),e}},IfcConnectionGeometry=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcConnectionGeometry(e,t)}ToTape(){return[]}},IfcConnectionPointEccentricity=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.PointOnRelatingElement=i,this.PointOnRelatedElement=s,this.EccentricityInX=r,this.EccentricityInY=o,this.EccentricityInZ=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcConnectionPointEccentricity(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.PointOnRelatingElement),e.push(this.PointOnRelatedElement),e.push(this.EccentricityInX),e.push(this.EccentricityInY),e.push(this.EccentricityInZ),e}},IfcConnectionPointGeometry=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.PointOnRelatingElement=i,this.PointOnRelatedElement=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcConnectionPointGeometry(e,t,r,o)}ToTape(){let e=[];return e.push(this.PointOnRelatingElement),e.push(this.PointOnRelatedElement),e}},IfcConnectionSurfaceGeometry=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.SurfaceOnRelatingElement=i,this.SurfaceOnRelatedElement=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcConnectionSurfaceGeometry(e,t,r,o)}ToTape(){let e=[];return e.push(this.SurfaceOnRelatingElement),e.push(this.SurfaceOnRelatedElement),e}},IfcConnectionVolumeGeometry=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.VolumeOnRelatingElement=i,this.VolumeOnRelatedElement=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcConnectionVolumeGeometry(e,t,r,o)}ToTape(){let e=[];return e.push(this.VolumeOnRelatingElement),e.push(this.VolumeOnRelatedElement),e}},IfcConstraint=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=a,this.CreationTime=n,this.UserDefinedGrade=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcConstraint(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e}},IfcConstructionEquipmentResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcConstructionEquipmentResource(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcConstructionEquipmentResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcConstructionEquipmentResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcConstructionMaterialResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcConstructionMaterialResource(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcConstructionMaterialResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcConstructionMaterialResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcConstructionProductResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcConstructionProductResource(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcConstructionProductResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcConstructionProductResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcConstructionResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcConstructionResource(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e}},IfcConstructionResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcConstructionResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e}},IfcContext=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.LongName=n,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcContext(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}},IfcContextDependentUnit=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Dimensions=i,this.UnitType=s,this.Name=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcContextDependentUnit(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e}},IfcControl=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcControl(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e}},IfcController=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcController(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcControllerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcControllerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcConversionBasedUnit=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Dimensions=i,this.UnitType=s,this.Name=r,this.ConversionFactor=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcConversionBasedUnit(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e.push(this.ConversionFactor),e}},IfcConversionBasedUnitWithOffset=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Dimensions=i,this.UnitType=s,this.Name=r,this.ConversionFactor=o,this.ConversionOffset=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcConversionBasedUnitWithOffset(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e.push(this.ConversionFactor),e.push(this.ConversionOffset),e}},IfcCooledBeam=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCooledBeam(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCooledBeamType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCooledBeamType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCoolingTower=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCoolingTower(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCoolingTowerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCoolingTowerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCoordinateOperation=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.SourceCRS=i,this.TargetCRS=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCoordinateOperation(e,t,r,o)}ToTape(){let e=[];return e.push(this.SourceCRS),e.push(this.TargetCRS),e}},IfcCoordinateReferenceSystem=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.GeodeticDatum=r,this.VerticalDatum=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcCoordinateReferenceSystem(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.GeodeticDatum),e.push(this.VerticalDatum),e}},IfcCostItem=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.PredefinedType=h,this.CostValues=l,this.CostQuantities=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCostItem(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.CostValues),e.push(this.CostQuantities),e}},IfcCostSchedule=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.PredefinedType=h,this.Status=l,this.SubmittedOn=c,this.UpdateDate=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCostSchedule(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.SubmittedOn),e.push(this.UpdateDate),e}},IfcCostValue=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.AppliedValue=r,this.UnitBasis=o,this.ApplicableDate=a,this.FixedUntilDate=n,this.Category=h,this.Condition=l,this.ArithmeticOperator=c,this.Components=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCostValue(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AppliedValue),e.push(this.UnitBasis),e.push(this.ApplicableDate),e.push(this.FixedUntilDate),e.push(this.Category),e.push(this.Condition),e.push(this.ArithmeticOperator),e.push(this.Components),e}},IfcCovering=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCovering(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCoveringType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCoveringType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCrewResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcCrewResource(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcCrewResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcCrewResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcCsgPrimitive3D=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Position=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcCsgPrimitive3D(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},IfcCsgSolid=class{constructor(e,t,i){this.expressID=e,this.type=t,this.TreeRootExpression=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcCsgSolid(e,t,r)}ToTape(){let e=[];return e.push(this.TreeRootExpression),e}},IfcCurrencyRelationship=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingMonetaryUnit=r,this.RelatedMonetaryUnit=o,this.ExchangeRate=a,this.RateDateTime=n,this.RateSource=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcCurrencyRelationship(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingMonetaryUnit),e.push(this.RelatedMonetaryUnit),e.push(this.ExchangeRate),e.push(this.RateDateTime),e.push(this.RateSource),e}},IfcCurtainWall=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcCurtainWall(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcCurtainWallType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcCurtainWallType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcCurve=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcCurve(e,t)}ToTape(){return[]}},IfcCurveBoundedPlane=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.BasisSurface=i,this.OuterBoundary=s,this.InnerBoundaries=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcCurveBoundedPlane(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.OuterBoundary),e.push(this.InnerBoundaries),e}},IfcCurveBoundedSurface=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.BasisSurface=i,this.Boundaries=s,this.ImplicitOuter=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcCurveBoundedSurface(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.Boundaries),e.push(this.ImplicitOuter),e}},IfcCurveSegment2D=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.StartPoint=i,this.StartDirection=s,this.SegmentLength=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcCurveSegment2D(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e}},IfcCurveStyle=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.CurveFont=s,this.CurveWidth=r,this.CurveColour=o,this.ModelOrDraughting=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcCurveStyle(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.CurveFont),e.push(this.CurveWidth),e.push(this.CurveColour),e.push(this.ModelOrDraughting),e}},IfcCurveStyleFont=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Name=i,this.PatternList=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCurveStyleFont(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.PatternList),e}},IfcCurveStyleFontAndScaling=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.CurveFont=s,this.CurveFontScaling=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcCurveStyleFontAndScaling(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.CurveFont),e.push(this.CurveFontScaling),e}},IfcCurveStyleFontPattern=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.VisibleSegmentLength=i,this.InvisibleSegmentLength=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCurveStyleFontPattern(e,t,r,o)}ToTape(){let e=[];return e.push(this.VisibleSegmentLength),e.push(this.InvisibleSegmentLength),e}},IfcCylindricalSurface=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Position=i,this.Radius=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcCylindricalSurface(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},IfcDamper=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDamper(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcDamperType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDamperType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcDeepFoundation=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcDeepFoundation(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcDeepFoundationType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDeepFoundationType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcDerivedProfileDef=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.ParentProfile=r,this.Operator=o,this.Label=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcDerivedProfileDef(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.ParentProfile),e.push(this.Operator),e.push(this.Label),e}},IfcDerivedUnit=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Elements=i,this.UnitType=s,this.UserDefinedType=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcDerivedUnit(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Elements),e.push(this.UnitType),e.push(this.UserDefinedType),e}},IfcDerivedUnitElement=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Unit=i,this.Exponent=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcDerivedUnitElement(e,t,r,o)}ToTape(){let e=[];return e.push(this.Unit),e.push(this.Exponent),e}},IfcDimensionalExponents=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.LengthExponent=i,this.MassExponent=s,this.TimeExponent=r,this.ElectricCurrentExponent=o,this.ThermodynamicTemperatureExponent=a,this.AmountOfSubstanceExponent=n,this.LuminousIntensityExponent=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcDimensionalExponents(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.LengthExponent),e.push(this.MassExponent),e.push(this.TimeExponent),e.push(this.ElectricCurrentExponent),e.push(this.ThermodynamicTemperatureExponent),e.push(this.AmountOfSubstanceExponent),e.push(this.LuminousIntensityExponent),e}},IfcDirection=class{constructor(e,t,i){this.expressID=e,this.type=t,this.DirectionRatios=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcDirection(e,t,r)}ToTape(){let e=[];return e.push(this.DirectionRatios),e}},IfcDiscreteAccessory=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDiscreteAccessory(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcDiscreteAccessoryType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDiscreteAccessoryType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcDistanceExpression=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.DistanceAlong=i,this.OffsetLateral=s,this.OffsetVertical=r,this.OffsetLongitudinal=o,this.AlongHorizontal=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcDistanceExpression(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.DistanceAlong),e.push(this.OffsetLateral),e.push(this.OffsetVertical),e.push(this.OffsetLongitudinal),e.push(this.AlongHorizontal),e}},IfcDistributionChamberElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDistributionChamberElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcDistributionChamberElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDistributionChamberElementType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcDistributionCircuit=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.LongName=n,this.PredefinedType=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcDistributionCircuit(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.PredefinedType),e}},IfcDistributionControlElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcDistributionControlElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcDistributionControlElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDistributionControlElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcDistributionElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcDistributionElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcDistributionElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDistributionElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcDistributionFlowElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcDistributionFlowElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcDistributionFlowElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDistributionFlowElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcDistributionPort=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.FlowDirection=l,this.PredefinedType=c,this.SystemType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDistributionPort(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.FlowDirection),e.push(this.PredefinedType),e.push(this.SystemType),e}},IfcDistributionSystem=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.LongName=n,this.PredefinedType=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcDistributionSystem(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.PredefinedType),e}},IfcDocumentInformation=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y){this.expressID=e,this.type=t,this.Identification=i,this.Name=s,this.Description=r,this.Location=o,this.Purpose=a,this.IntendedUse=n,this.Scope=h,this.Revision=l,this.DocumentOwner=c,this.Editors=u,this.CreationTime=p,this.LastRevisionTime=d,this.ElectronicFormat=m,this.ValidFrom=f,this.ValidUntil=g,this.Confidentiality=_,this.Status=y}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++];return new IfcDocumentInformation(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v)}ToTape(){let e=[];return e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Location),e.push(this.Purpose),e.push(this.IntendedUse),e.push(this.Scope),e.push(this.Revision),e.push(this.DocumentOwner),e.push(this.Editors),e.push(this.CreationTime),e.push(this.LastRevisionTime),e.push(this.ElectronicFormat),e.push(this.ValidFrom),e.push(this.ValidUntil),e.push(this.Confidentiality),e.push(this.Status),e}},IfcDocumentInformationRelationship=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingDocument=r,this.RelatedDocuments=o,this.RelationshipType=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcDocumentInformationRelationship(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingDocument),e.push(this.RelatedDocuments),e.push(this.RelationshipType),e}},IfcDocumentReference=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r,this.Description=o,this.ReferencedDocument=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcDocumentReference(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.ReferencedDocument),e}},IfcDoor=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=u,this.PredefinedType=p,this.OperationType=d,this.UserDefinedOperationType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcDoor(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.UserDefinedOperationType),e}},IfcDoorLiningProperties=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.LiningDepth=a,this.LiningThickness=n,this.ThresholdDepth=h,this.ThresholdThickness=l,this.TransomThickness=c,this.TransomOffset=u,this.LiningOffset=p,this.ThresholdOffset=d,this.CasingThickness=m,this.CasingDepth=f,this.ShapeAspectStyle=g,this.LiningToPanelOffsetX=_,this.LiningToPanelOffsetY=y}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++];return new IfcDoorLiningProperties(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.LiningDepth),e.push(this.LiningThickness),e.push(this.ThresholdDepth),e.push(this.ThresholdThickness),e.push(this.TransomThickness),e.push(this.TransomOffset),e.push(this.LiningOffset),e.push(this.ThresholdOffset),e.push(this.CasingThickness),e.push(this.CasingDepth),e.push(this.ShapeAspectStyle),e.push(this.LiningToPanelOffsetX),e.push(this.LiningToPanelOffsetY),e}},IfcDoorPanelProperties=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.PanelDepth=a,this.PanelOperation=n,this.PanelWidth=h,this.PanelPosition=l,this.ShapeAspectStyle=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDoorPanelProperties(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.PanelDepth),e.push(this.PanelOperation),e.push(this.PanelWidth),e.push(this.PanelPosition),e.push(this.ShapeAspectStyle),e}},IfcDoorStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=u,this.PredefinedType=p,this.OperationType=d,this.UserDefinedOperationType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcDoorStandardCase(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.UserDefinedOperationType),e}},IfcDoorStyle=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.OperationType=c,this.ConstructionType=u,this.ParameterTakesPrecedence=p,this.Sizeable=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcDoorStyle(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.OperationType),e.push(this.ConstructionType),e.push(this.ParameterTakesPrecedence),e.push(this.Sizeable),e}},IfcDoorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.OperationType=p,this.ParameterTakesPrecedence=d,this.UserDefinedOperationType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcDoorType(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.ParameterTakesPrecedence),e.push(this.UserDefinedOperationType),e}},IfcDraughtingPreDefinedColour=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcDraughtingPreDefinedColour(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcDraughtingPreDefinedCurveFont=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcDraughtingPreDefinedCurveFont(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcDuctFitting=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDuctFitting(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcDuctFittingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDuctFittingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcDuctSegment=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDuctSegment(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcDuctSegmentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDuctSegmentType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcDuctSilencer=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcDuctSilencer(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcDuctSilencerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcDuctSilencerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcEdge=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.EdgeStart=i,this.EdgeEnd=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcEdge(e,t,r,o)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e}},IfcEdgeCurve=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.EdgeStart=i,this.EdgeEnd=s,this.EdgeGeometry=r,this.SameSense=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcEdgeCurve(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.EdgeGeometry),e.push(this.SameSense),e}},IfcEdgeLoop=class{constructor(e,t,i){this.expressID=e,this.type=t,this.EdgeList=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcEdgeLoop(e,t,r)}ToTape(){let e=[];return e.push(this.EdgeList),e}},IfcElectricAppliance=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElectricAppliance(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcElectricApplianceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElectricApplianceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElectricDistributionBoard=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElectricDistributionBoard(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcElectricDistributionBoardType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElectricDistributionBoardType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElectricFlowStorageDevice=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElectricFlowStorageDevice(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcElectricFlowStorageDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElectricFlowStorageDeviceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElectricGenerator=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElectricGenerator(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcElectricGeneratorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElectricGeneratorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElectricMotor=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElectricMotor(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcElectricMotorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElectricMotorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElectricTimeControl=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElectricTimeControl(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcElectricTimeControlType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElectricTimeControlType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcElementAssembly=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.AssemblyPlace=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElementAssembly(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.AssemblyPlace),e.push(this.PredefinedType),e}},IfcElementAssemblyType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcElementAssemblyType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcElementComponent=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcElementComponent(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcElementComponentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElementComponentType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcElementQuantity=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.MethodOfMeasurement=a,this.Quantities=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcElementQuantity(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.MethodOfMeasurement),e.push(this.Quantities),e}},IfcElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcElementarySurface=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Position=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcElementarySurface(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},IfcEllipse=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Position=i,this.SemiAxis1=s,this.SemiAxis2=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcEllipse(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Position),e.push(this.SemiAxis1),e.push(this.SemiAxis2),e}},IfcEllipseProfileDef=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.SemiAxis1=o,this.SemiAxis2=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcEllipseProfileDef(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.SemiAxis1),e.push(this.SemiAxis2),e}},IfcEnergyConversionDevice=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcEnergyConversionDevice(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcEnergyConversionDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcEnergyConversionDeviceType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcEngine=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcEngine(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcEngineType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcEngineType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcEvaporativeCooler=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcEvaporativeCooler(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcEvaporativeCoolerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcEvaporativeCoolerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcEvaporator=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcEvaporator(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcEvaporatorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcEvaporatorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcEvent=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.PredefinedType=l,this.EventTriggerType=c,this.UserDefinedEventTriggerType=u,this.EventOccurenceTime=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcEvent(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.PredefinedType),e.push(this.EventTriggerType),e.push(this.UserDefinedEventTriggerType),e.push(this.EventOccurenceTime),e}},IfcEventTime=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r,this.ActualDate=o,this.EarlyDate=a,this.LateDate=n,this.ScheduleDate=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcEventTime(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.ActualDate),e.push(this.EarlyDate),e.push(this.LateDate),e.push(this.ScheduleDate),e}},IfcEventType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ProcessType=c,this.PredefinedType=u,this.EventTriggerType=p,this.UserDefinedEventTriggerType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcEventType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e.push(this.EventTriggerType),e.push(this.UserDefinedEventTriggerType),e}},IfcExtendedProperties=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Properties=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcExtendedProperties(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e}},IfcExternalInformation=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcExternalInformation(e,t)}ToTape(){return[]}},IfcExternalReference=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcExternalReference(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},IfcExternalReferenceRelationship=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingReference=r,this.RelatedResourceObjects=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcExternalReferenceRelationship(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingReference),e.push(this.RelatedResourceObjects),e}},IfcExternalSpatialElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcExternalSpatialElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.PredefinedType),e}},IfcExternalSpatialStructureElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcExternalSpatialStructureElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e}},IfcExternallyDefinedHatchStyle=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcExternallyDefinedHatchStyle(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},IfcExternallyDefinedSurfaceStyle=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcExternallyDefinedSurfaceStyle(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},IfcExternallyDefinedTextFont=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcExternallyDefinedTextFont(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},IfcExtrudedAreaSolid=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s,this.ExtrudedDirection=r,this.Depth=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcExtrudedAreaSolid(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e}},IfcExtrudedAreaSolidTapered=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s,this.ExtrudedDirection=r,this.Depth=o,this.EndSweptArea=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcExtrudedAreaSolidTapered(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e.push(this.EndSweptArea),e}},IfcFace=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Bounds=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcFace(e,t,r)}ToTape(){let e=[];return e.push(this.Bounds),e}},IfcFaceBasedSurfaceModel=class{constructor(e,t,i){this.expressID=e,this.type=t,this.FbsmFaces=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcFaceBasedSurfaceModel(e,t,r)}ToTape(){let e=[];return e.push(this.FbsmFaces),e}},IfcFaceBound=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Bound=i,this.Orientation=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcFaceBound(e,t,r,o)}ToTape(){let e=[];return e.push(this.Bound),e.push(this.Orientation),e}},IfcFaceOuterBound=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Bound=i,this.Orientation=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcFaceOuterBound(e,t,r,o)}ToTape(){let e=[];return e.push(this.Bound),e.push(this.Orientation),e}},IfcFaceSurface=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Bounds=i,this.FaceSurface=s,this.SameSense=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcFaceSurface(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Bounds),e.push(this.FaceSurface),e.push(this.SameSense),e}},IfcFacetedBrep=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Outer=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcFacetedBrep(e,t,r)}ToTape(){let e=[];return e.push(this.Outer),e}},IfcFacetedBrepWithVoids=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Outer=i,this.Voids=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcFacetedBrepWithVoids(e,t,r,o)}ToTape(){let e=[];return e.push(this.Outer),e.push(this.Voids),e}},IfcFacility=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFacility(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}},IfcFacilityPart=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFacilityPart(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}},IfcFailureConnectionCondition=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.TensionFailureX=s,this.TensionFailureY=r,this.TensionFailureZ=o,this.CompressionFailureX=a,this.CompressionFailureY=n,this.CompressionFailureZ=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcFailureConnectionCondition(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TensionFailureX),e.push(this.TensionFailureY),e.push(this.TensionFailureZ),e.push(this.CompressionFailureX),e.push(this.CompressionFailureY),e.push(this.CompressionFailureZ),e}},IfcFan=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFan(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFanType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFanType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFastener=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFastener(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFastenerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFastenerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFeatureElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFeatureElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFeatureElementAddition=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFeatureElementAddition(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFeatureElementSubtraction=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFeatureElementSubtraction(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFillAreaStyle=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.FillStyles=s,this.ModelorDraughting=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcFillAreaStyle(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.FillStyles),e.push(this.ModelorDraughting),e}},IfcFillAreaStyleHatching=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.HatchLineAppearance=i,this.StartOfNextHatchLine=s,this.PointOfReferenceHatchLine=r,this.PatternStart=o,this.HatchLineAngle=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcFillAreaStyleHatching(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.HatchLineAppearance),e.push(this.StartOfNextHatchLine),e.push(this.PointOfReferenceHatchLine),e.push(this.PatternStart),e.push(this.HatchLineAngle),e}},IfcFillAreaStyleTiles=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.TilingPattern=i,this.Tiles=s,this.TilingScale=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcFillAreaStyleTiles(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.TilingPattern),e.push(this.Tiles),e.push(this.TilingScale),e}},IfcFilter=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFilter(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFilterType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFilterType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFireSuppressionTerminal=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFireSuppressionTerminal(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFireSuppressionTerminalType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFireSuppressionTerminalType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFixedReferenceSweptAreaSolid=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s,this.Directrix=r,this.StartParam=o,this.EndParam=a,this.FixedReference=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcFixedReferenceSweptAreaSolid(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Directrix),e.push(this.StartParam),e.push(this.EndParam),e.push(this.FixedReference),e}},IfcFlowController=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowController(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowControllerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowControllerType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFlowFitting=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowFitting(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowFittingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowFittingType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFlowInstrument=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowInstrument(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFlowInstrumentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFlowInstrumentType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFlowMeter=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowMeter(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFlowMeterType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFlowMeterType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFlowMovingDevice=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowMovingDevice(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowMovingDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowMovingDeviceType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFlowSegment=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowSegment(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowSegmentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowSegmentType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFlowStorageDevice=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowStorageDevice(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowStorageDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowStorageDeviceType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFlowTerminal=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowTerminal(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowTerminalType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowTerminalType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFlowTreatmentDevice=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFlowTreatmentDevice(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFlowTreatmentDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFlowTreatmentDeviceType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFooting=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFooting(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFootingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcFootingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcFurnishingElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcFurnishingElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcFurnishingElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFurnishingElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcFurniture=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcFurniture(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcFurnitureType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.AssemblyPlace=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcFurnitureType(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.AssemblyPlace),e.push(this.PredefinedType),e}},IfcGeographicElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcGeographicElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcGeographicElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcGeographicElementType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcGeometricCurveSet=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Elements=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcGeometricCurveSet(e,t,r)}ToTape(){let e=[];return e.push(this.Elements),e}},IfcGeometricRepresentationContext=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.ContextIdentifier=i,this.ContextType=s,this.CoordinateSpaceDimension=r,this.Precision=o,this.WorldCoordinateSystem=a,this.TrueNorth=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcGeometricRepresentationContext(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e.push(this.CoordinateSpaceDimension),e.push(this.Precision),e.push(this.WorldCoordinateSystem),e.push(this.TrueNorth),e}},IfcGeometricRepresentationItem=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcGeometricRepresentationItem(e,t)}ToTape(){return[]}},IfcGeometricRepresentationSubContext=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.ContextIdentifier=i,this.ContextType=s,this.CoordinateSpaceDimension=r,this.Precision=o,this.WorldCoordinateSystem=a,this.TrueNorth=n,this.ParentContext=h,this.TargetScale=l,this.TargetView=c,this.UserDefinedTargetView=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcGeometricRepresentationSubContext(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e.push(this.CoordinateSpaceDimension),e.push(this.Precision),e.push(this.WorldCoordinateSystem),e.push(this.TrueNorth),e.push(this.ParentContext),e.push(this.TargetScale),e.push(this.TargetView),e.push(this.UserDefinedTargetView),e}},IfcGeometricSet=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Elements=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcGeometricSet(e,t,r)}ToTape(){let e=[];return e.push(this.Elements),e}},IfcGrid=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.UAxes=l,this.VAxes=c,this.WAxes=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcGrid(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.UAxes),e.push(this.VAxes),e.push(this.WAxes),e.push(this.PredefinedType),e}},IfcGridAxis=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.AxisTag=i,this.AxisCurve=s,this.SameSense=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcGridAxis(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.AxisTag),e.push(this.AxisCurve),e.push(this.SameSense),e}},IfcGridPlacement=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.PlacementRelTo=i,this.PlacementLocation=s,this.PlacementRefDirection=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcGridPlacement(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e.push(this.PlacementLocation),e.push(this.PlacementRefDirection),e}},IfcGroup=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcGroup(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}},IfcHalfSpaceSolid=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.BaseSurface=i,this.AgreementFlag=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcHalfSpaceSolid(e,t,r,o)}ToTape(){let e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e}},IfcHeatExchanger=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcHeatExchanger(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcHeatExchangerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcHeatExchangerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcHumidifier=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcHumidifier(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcHumidifierType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcHumidifierType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcIShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.OverallWidth=o,this.OverallDepth=a,this.WebThickness=n,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=c,this.FlangeSlope=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcIShapeProfileDef(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.OverallWidth),e.push(this.OverallDepth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.FlangeEdgeRadius),e.push(this.FlangeSlope),e}},IfcImageTexture=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.RepeatS=i,this.RepeatT=s,this.Mode=r,this.TextureTransform=o,this.Parameter=a,this.URLReference=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcImageTexture(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.URLReference),e}},IfcIndexedColourMap=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.MappedTo=i,this.Opacity=s,this.Colours=r,this.ColourIndex=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcIndexedColourMap(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.MappedTo),e.push(this.Opacity),e.push(this.Colours),e.push(this.ColourIndex),e}},IfcIndexedPolyCurve=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Points=i,this.Segments=s,this.SelfIntersect=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcIndexedPolyCurve(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Points),e.push(this.Segments),e.push(this.SelfIntersect),e}},IfcIndexedPolygonalFace=class{constructor(e,t,i){this.expressID=e,this.type=t,this.CoordIndex=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcIndexedPolygonalFace(e,t,r)}ToTape(){let e=[];return e.push(this.CoordIndex),e}},IfcIndexedPolygonalFaceWithVoids=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.CoordIndex=i,this.InnerCoordIndices=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcIndexedPolygonalFaceWithVoids(e,t,r,o)}ToTape(){let e=[];return e.push(this.CoordIndex),e.push(this.InnerCoordIndices),e}},IfcIndexedTextureMap=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Maps=i,this.MappedTo=s,this.TexCoords=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcIndexedTextureMap(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.MappedTo),e.push(this.TexCoords),e}},IfcIndexedTriangleTextureMap=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Maps=i,this.MappedTo=s,this.TexCoords=r,this.TexCoordIndex=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcIndexedTriangleTextureMap(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.MappedTo),e.push(this.TexCoords),e.push(this.TexCoordIndex),e}},IfcInterceptor=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcInterceptor(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcInterceptorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcInterceptorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcIntersectionCurve=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Curve3D=i,this.AssociatedGeometry=s,this.MasterRepresentation=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcIntersectionCurve(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}},IfcInventory=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.PredefinedType=n,this.Jurisdiction=h,this.ResponsiblePersons=l,this.LastUpdateDate=c,this.CurrentValue=u,this.OriginalValue=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcInventory(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.Jurisdiction),e.push(this.ResponsiblePersons),e.push(this.LastUpdateDate),e.push(this.CurrentValue),e.push(this.OriginalValue),e}},IfcIrregularTimeSeries=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=a,this.DataOrigin=n,this.UserDefinedDataOrigin=h,this.Unit=l,this.Values=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcIrregularTimeSeries(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e.push(this.Values),e}},IfcIrregularTimeSeriesValue=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.TimeStamp=i,this.ListValues=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcIrregularTimeSeriesValue(e,t,r,o)}ToTape(){let e=[];return e.push(this.TimeStamp),e.push(this.ListValues),e}},IfcJunctionBox=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcJunctionBox(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcJunctionBoxType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcJunctionBoxType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcLShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Depth=o,this.Width=a,this.Thickness=n,this.FilletRadius=h,this.EdgeRadius=l,this.LegSlope=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcLShapeProfileDef(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.Width),e.push(this.Thickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e.push(this.LegSlope),e}},IfcLaborResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcLaborResource(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcLaborResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcLaborResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcLagTime=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r,this.LagValue=o,this.DurationType=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcLagTime(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.LagValue),e.push(this.DurationType),e}},IfcLamp=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcLamp(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcLampType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcLampType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcLibraryInformation=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Name=i,this.Version=s,this.Publisher=r,this.VersionDate=o,this.Location=a,this.Description=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcLibraryInformation(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Version),e.push(this.Publisher),e.push(this.VersionDate),e.push(this.Location),e.push(this.Description),e}},IfcLibraryReference=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Location=i,this.Identification=s,this.Name=r,this.Description=o,this.Language=a,this.ReferencedLibrary=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcLibraryReference(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Language),e.push(this.ReferencedLibrary),e}},IfcLightDistributionData=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.MainPlaneAngle=i,this.SecondaryPlaneAngle=s,this.LuminousIntensity=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcLightDistributionData(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.MainPlaneAngle),e.push(this.SecondaryPlaneAngle),e.push(this.LuminousIntensity),e}},IfcLightFixture=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcLightFixture(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcLightFixtureType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcLightFixtureType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcLightIntensityDistribution=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.LightDistributionCurve=i,this.DistributionData=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcLightIntensityDistribution(e,t,r,o)}ToTape(){let e=[];return e.push(this.LightDistributionCurve),e.push(this.DistributionData),e}},IfcLightSource=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.LightColour=s,this.AmbientIntensity=r,this.Intensity=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcLightSource(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e}},IfcLightSourceAmbient=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.LightColour=s,this.AmbientIntensity=r,this.Intensity=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcLightSourceAmbient(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e}},IfcLightSourceDirectional=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.LightColour=s,this.AmbientIntensity=r,this.Intensity=o,this.Orientation=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcLightSourceDirectional(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Orientation),e}},IfcLightSourceGoniometric=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.Name=i,this.LightColour=s,this.AmbientIntensity=r,this.Intensity=o,this.Position=a,this.ColourAppearance=n,this.ColourTemperature=h,this.LuminousFlux=l,this.LightEmissionSource=c,this.LightDistributionDataSource=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcLightSourceGoniometric(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.ColourAppearance),e.push(this.ColourTemperature),e.push(this.LuminousFlux),e.push(this.LightEmissionSource),e.push(this.LightDistributionDataSource),e}},IfcLightSourcePositional=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.Name=i,this.LightColour=s,this.AmbientIntensity=r,this.Intensity=o,this.Position=a,this.Radius=n,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcLightSourcePositional(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.Radius),e.push(this.ConstantAttenuation),e.push(this.DistanceAttenuation),e.push(this.QuadricAttenuation),e}},IfcLightSourceSpot=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.Name=i,this.LightColour=s,this.AmbientIntensity=r,this.Intensity=o,this.Position=a,this.Radius=n,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=c,this.Orientation=u,this.ConcentrationExponent=p,this.SpreadAngle=d,this.BeamWidthAngle=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcLightSourceSpot(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.Radius),e.push(this.ConstantAttenuation),e.push(this.DistanceAttenuation),e.push(this.QuadricAttenuation),e.push(this.Orientation),e.push(this.ConcentrationExponent),e.push(this.SpreadAngle),e.push(this.BeamWidthAngle),e}},IfcLine=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Pnt=i,this.Dir=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcLine(e,t,r,o)}ToTape(){let e=[];return e.push(this.Pnt),e.push(this.Dir),e}},IfcLineSegment2D=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.StartPoint=i,this.StartDirection=s,this.SegmentLength=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcLineSegment2D(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e}},IfcLinearPlacement=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.PlacementRelTo=i,this.PlacementMeasuredAlong=s,this.Distance=r,this.Orientation=o,this.CartesianPosition=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcLinearPlacement(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e.push(this.PlacementMeasuredAlong),e.push(this.Distance),e.push(this.Orientation),e.push(this.CartesianPosition),e}},IfcLinearPositioningElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Axis=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcLinearPositioningElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Axis),e}},IfcLocalPlacement=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.PlacementRelTo=i,this.RelativePlacement=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcLocalPlacement(e,t,r,o)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e.push(this.RelativePlacement),e}},IfcLoop=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcLoop(e,t)}ToTape(){return[]}},IfcManifoldSolidBrep=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Outer=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcManifoldSolidBrep(e,t,r)}ToTape(){let e=[];return e.push(this.Outer),e}},IfcMapConversion=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.SourceCRS=i,this.TargetCRS=s,this.Eastings=r,this.Northings=o,this.OrthogonalHeight=a,this.XAxisAbscissa=n,this.XAxisOrdinate=h,this.Scale=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcMapConversion(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.SourceCRS),e.push(this.TargetCRS),e.push(this.Eastings),e.push(this.Northings),e.push(this.OrthogonalHeight),e.push(this.XAxisAbscissa),e.push(this.XAxisOrdinate),e.push(this.Scale),e}},IfcMappedItem=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.MappingSource=i,this.MappingTarget=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcMappedItem(e,t,r,o)}ToTape(){let e=[];return e.push(this.MappingSource),e.push(this.MappingTarget),e}},IfcMaterial=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Category=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcMaterial(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Category),e}},IfcMaterialClassificationRelationship=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.MaterialClassifications=i,this.ClassifiedMaterial=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcMaterialClassificationRelationship(e,t,r,o)}ToTape(){let e=[];return e.push(this.MaterialClassifications),e.push(this.ClassifiedMaterial),e}},IfcMaterialConstituent=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Material=r,this.Fraction=o,this.Category=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcMaterialConstituent(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Fraction),e.push(this.Category),e}},IfcMaterialConstituentSet=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.MaterialConstituents=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcMaterialConstituentSet(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.MaterialConstituents),e}},IfcMaterialDefinition=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcMaterialDefinition(e,t)}ToTape(){return[]}},IfcMaterialDefinitionRepresentation=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Representations=r,this.RepresentedMaterial=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcMaterialDefinitionRepresentation(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e.push(this.RepresentedMaterial),e}},IfcMaterialLayer=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Material=i,this.LayerThickness=s,this.IsVentilated=r,this.Name=o,this.Description=a,this.Category=n,this.Priority=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcMaterialLayer(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Material),e.push(this.LayerThickness),e.push(this.IsVentilated),e.push(this.Name),e.push(this.Description),e.push(this.Category),e.push(this.Priority),e}},IfcMaterialLayerSet=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.MaterialLayers=i,this.LayerSetName=s,this.Description=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcMaterialLayerSet(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.MaterialLayers),e.push(this.LayerSetName),e.push(this.Description),e}},IfcMaterialLayerSetUsage=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ForLayerSet=i,this.LayerSetDirection=s,this.DirectionSense=r,this.OffsetFromReferenceLine=o,this.ReferenceExtent=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcMaterialLayerSetUsage(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ForLayerSet),e.push(this.LayerSetDirection),e.push(this.DirectionSense),e.push(this.OffsetFromReferenceLine),e.push(this.ReferenceExtent),e}},IfcMaterialLayerWithOffsets=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.Material=i,this.LayerThickness=s,this.IsVentilated=r,this.Name=o,this.Description=a,this.Category=n,this.Priority=h,this.OffsetDirection=l,this.OffsetValues=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcMaterialLayerWithOffsets(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.Material),e.push(this.LayerThickness),e.push(this.IsVentilated),e.push(this.Name),e.push(this.Description),e.push(this.Category),e.push(this.Priority),e.push(this.OffsetDirection),e.push(this.OffsetValues),e}},IfcMaterialList=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Materials=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcMaterialList(e,t,r)}ToTape(){let e=[];return e.push(this.Materials),e}},IfcMaterialProfile=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Material=r,this.Profile=o,this.Priority=a,this.Category=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcMaterialProfile(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Profile),e.push(this.Priority),e.push(this.Category),e}},IfcMaterialProfileSet=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.MaterialProfiles=r,this.CompositeProfile=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcMaterialProfileSet(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.MaterialProfiles),e.push(this.CompositeProfile),e}},IfcMaterialProfileSetUsage=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.ForProfileSet=i,this.CardinalPoint=s,this.ReferenceExtent=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcMaterialProfileSetUsage(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.ForProfileSet),e.push(this.CardinalPoint),e.push(this.ReferenceExtent),e}},IfcMaterialProfileSetUsageTapering=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ForProfileSet=i,this.CardinalPoint=s,this.ReferenceExtent=r,this.ForProfileEndSet=o,this.CardinalEndPoint=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcMaterialProfileSetUsageTapering(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ForProfileSet),e.push(this.CardinalPoint),e.push(this.ReferenceExtent),e.push(this.ForProfileEndSet),e.push(this.CardinalEndPoint),e}},IfcMaterialProfileWithOffsets=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Material=r,this.Profile=o,this.Priority=a,this.Category=n,this.OffsetValues=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcMaterialProfileWithOffsets(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Profile),e.push(this.Priority),e.push(this.Category),e.push(this.OffsetValues),e}},IfcMaterialProperties=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Properties=r,this.Material=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcMaterialProperties(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e.push(this.Material),e}},IfcMaterialRelationship=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingMaterial=r,this.RelatedMaterials=o,this.Expression=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcMaterialRelationship(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingMaterial),e.push(this.RelatedMaterials),e.push(this.Expression),e}},IfcMaterialUsageDefinition=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcMaterialUsageDefinition(e,t)}ToTape(){return[]}},IfcMeasureWithUnit=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.ValueComponent=i,this.UnitComponent=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcMeasureWithUnit(e,t,r,o)}ToTape(){let e=[];return e.push(this.ValueComponent),e.push(this.UnitComponent),e}},IfcMechanicalFastener=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.NominalDiameter=c,this.NominalLength=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcMechanicalFastener(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.NominalDiameter),e.push(this.NominalLength),e.push(this.PredefinedType),e}},IfcMechanicalFastenerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.NominalDiameter=p,this.NominalLength=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcMechanicalFastenerType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.NominalLength),e}},IfcMedicalDevice=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcMedicalDevice(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcMedicalDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcMedicalDeviceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcMember=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcMember(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcMemberStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcMemberStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcMemberType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcMemberType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcMetric=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=a,this.CreationTime=n,this.UserDefinedGrade=h,this.Benchmark=l,this.ValueSource=c,this.DataValue=u,this.ReferencePath=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcMetric(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e.push(this.Benchmark),e.push(this.ValueSource),e.push(this.DataValue),e.push(this.ReferencePath),e}},IfcMirroredProfileDef=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.ParentProfile=r,this.Operator=o,this.Label=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcMirroredProfileDef(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.ParentProfile),e.push(this.Operator),e.push(this.Label),e}},IfcMonetaryUnit=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Currency=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcMonetaryUnit(e,t,r)}ToTape(){let e=[];return e.push(this.Currency),e}},IfcMotorConnection=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcMotorConnection(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcMotorConnectionType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcMotorConnectionType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcNamedUnit=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Dimensions=i,this.UnitType=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcNamedUnit(e,t,r,o)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e}},IfcObject=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcObject(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}},IfcObjectDefinition=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcObjectDefinition(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcObjectPlacement=class{constructor(e,t,i){this.expressID=e,this.type=t,this.PlacementRelTo=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcObjectPlacement(e,t,r)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e}},IfcObjective=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=a,this.CreationTime=n,this.UserDefinedGrade=h,this.BenchmarkValues=l,this.LogicalAggregator=c,this.ObjectiveQualifier=u,this.UserDefinedQualifier=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcObjective(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e.push(this.BenchmarkValues),e.push(this.LogicalAggregator),e.push(this.ObjectiveQualifier),e.push(this.UserDefinedQualifier),e}},IfcOccupant=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.TheActor=n,this.PredefinedType=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcOccupant(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheActor),e.push(this.PredefinedType),e}},IfcOffsetCurve=class{constructor(e,t,i){this.expressID=e,this.type=t,this.BasisCurve=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcOffsetCurve(e,t,r)}ToTape(){let e=[];return e.push(this.BasisCurve),e}},IfcOffsetCurve2D=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.BasisCurve=i,this.Distance=s,this.SelfIntersect=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcOffsetCurve2D(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.Distance),e.push(this.SelfIntersect),e}},IfcOffsetCurve3D=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.BasisCurve=i,this.Distance=s,this.SelfIntersect=r,this.RefDirection=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcOffsetCurve3D(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.Distance),e.push(this.SelfIntersect),e.push(this.RefDirection),e}},IfcOffsetCurveByDistances=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.BasisCurve=i,this.OffsetValues=s,this.Tag=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcOffsetCurveByDistances(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.OffsetValues),e.push(this.Tag),e}},IfcOpenShell=class{constructor(e,t,i){this.expressID=e,this.type=t,this.CfsFaces=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcOpenShell(e,t,r)}ToTape(){let e=[];return e.push(this.CfsFaces),e}},IfcOpeningElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcOpeningElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcOpeningStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcOpeningStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcOrganization=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Identification=i,this.Name=s,this.Description=r,this.Roles=o,this.Addresses=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcOrganization(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Roles),e.push(this.Addresses),e}},IfcOrganizationRelationship=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingOrganization=r,this.RelatedOrganizations=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcOrganizationRelationship(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingOrganization),e.push(this.RelatedOrganizations),e}},IfcOrientationExpression=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.LateralAxisDirection=i,this.VerticalAxisDirection=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcOrientationExpression(e,t,r,o)}ToTape(){let e=[];return e.push(this.LateralAxisDirection),e.push(this.VerticalAxisDirection),e}},IfcOrientedEdge=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.EdgeStart=i,this.EdgeEnd=s,this.EdgeElement=r,this.Orientation=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcOrientedEdge(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.EdgeElement),e.push(this.Orientation),e}},IfcOuterBoundaryCurve=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Segments=i,this.SelfIntersect=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcOuterBoundaryCurve(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},IfcOutlet=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcOutlet(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcOutletType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcOutletType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcOwnerHistory=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.OwningUser=i,this.OwningApplication=s,this.State=r,this.ChangeAction=o,this.LastModifiedDate=a,this.LastModifyingUser=n,this.LastModifyingApplication=h,this.CreationDate=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcOwnerHistory(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.OwningUser),e.push(this.OwningApplication),e.push(this.State),e.push(this.ChangeAction),e.push(this.LastModifiedDate),e.push(this.LastModifyingUser),e.push(this.LastModifyingApplication),e.push(this.CreationDate),e}},IfcParameterizedProfileDef=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcParameterizedProfileDef(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e}},IfcPath=class{constructor(e,t,i){this.expressID=e,this.type=t,this.EdgeList=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPath(e,t,r)}ToTape(){let e=[];return e.push(this.EdgeList),e}},IfcPcurve=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.BasisSurface=i,this.ReferenceCurve=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcPcurve(e,t,r,o)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.ReferenceCurve),e}},IfcPerformanceHistory=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LifeCyclePhase=h,this.PredefinedType=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcPerformanceHistory(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LifeCyclePhase),e.push(this.PredefinedType),e}},IfcPermeableCoveringProperties=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.OperationType=a,this.PanelPosition=n,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPermeableCoveringProperties(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.OperationType),e.push(this.PanelPosition),e.push(this.FrameDepth),e.push(this.FrameThickness),e.push(this.ShapeAspectStyle),e}},IfcPermit=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.PredefinedType=h,this.Status=l,this.LongDescription=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPermit(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}},IfcPerson=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Identification=i,this.FamilyName=s,this.GivenName=r,this.MiddleNames=o,this.PrefixTitles=a,this.SuffixTitles=n,this.Roles=h,this.Addresses=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcPerson(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Identification),e.push(this.FamilyName),e.push(this.GivenName),e.push(this.MiddleNames),e.push(this.PrefixTitles),e.push(this.SuffixTitles),e.push(this.Roles),e.push(this.Addresses),e}},IfcPersonAndOrganization=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.ThePerson=i,this.TheOrganization=s,this.Roles=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcPersonAndOrganization(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.ThePerson),e.push(this.TheOrganization),e.push(this.Roles),e}},IfcPhysicalComplexQuantity=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.HasQuantities=r,this.Discrimination=o,this.Quality=a,this.Usage=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcPhysicalComplexQuantity(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.HasQuantities),e.push(this.Discrimination),e.push(this.Quality),e.push(this.Usage),e}},IfcPhysicalQuantity=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Name=i,this.Description=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcPhysicalQuantity(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},IfcPhysicalSimpleQuantity=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcPhysicalSimpleQuantity(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e}},IfcPile=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c,this.ConstructionType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPile(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e.push(this.ConstructionType),e}},IfcPileType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPileType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcPipeFitting=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPipeFitting(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcPipeFittingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPipeFittingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcPipeSegment=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPipeSegment(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcPipeSegmentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPipeSegmentType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcPixelTexture=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.RepeatS=i,this.RepeatT=s,this.Mode=r,this.TextureTransform=o,this.Parameter=a,this.Width=n,this.Height=h,this.ColourComponents=l,this.Pixel=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPixelTexture(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.Width),e.push(this.Height),e.push(this.ColourComponents),e.push(this.Pixel),e}},IfcPlacement=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Location=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPlacement(e,t,r)}ToTape(){let e=[];return e.push(this.Location),e}},IfcPlanarBox=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.SizeInX=i,this.SizeInY=s,this.Placement=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcPlanarBox(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.SizeInX),e.push(this.SizeInY),e.push(this.Placement),e}},IfcPlanarExtent=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.SizeInX=i,this.SizeInY=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcPlanarExtent(e,t,r,o)}ToTape(){let e=[];return e.push(this.SizeInX),e.push(this.SizeInY),e}},IfcPlane=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Position=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPlane(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},IfcPlate=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPlate(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcPlateStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPlateStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcPlateType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPlateType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcPoint=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcPoint(e,t)}ToTape(){return[]}},IfcPointOnCurve=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.BasisCurve=i,this.PointParameter=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcPointOnCurve(e,t,r,o)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.PointParameter),e}},IfcPointOnSurface=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.BasisSurface=i,this.PointParameterU=s,this.PointParameterV=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcPointOnSurface(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.PointParameterU),e.push(this.PointParameterV),e}},IfcPolyLoop=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Polygon=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPolyLoop(e,t,r)}ToTape(){let e=[];return e.push(this.Polygon),e}},IfcPolygonalBoundedHalfSpace=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.BaseSurface=i,this.AgreementFlag=s,this.Position=r,this.PolygonalBoundary=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPolygonalBoundedHalfSpace(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e.push(this.Position),e.push(this.PolygonalBoundary),e}},IfcPolygonalFaceSet=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Coordinates=i,this.Closed=s,this.Faces=r,this.PnIndex=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPolygonalFaceSet(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Coordinates),e.push(this.Closed),e.push(this.Faces),e.push(this.PnIndex),e}},IfcPolyline=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Points=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPolyline(e,t,r)}ToTape(){let e=[];return e.push(this.Points),e}},IfcPort=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcPort(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},IfcPositioningElement=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcPositioningElement(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},IfcPostalAddress=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.Purpose=i,this.Description=s,this.UserDefinedPurpose=r,this.InternalLocation=o,this.AddressLines=a,this.PostalBox=n,this.Town=h,this.Region=l,this.PostalCode=c,this.Country=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPostalAddress(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e.push(this.InternalLocation),e.push(this.AddressLines),e.push(this.PostalBox),e.push(this.Town),e.push(this.Region),e.push(this.PostalCode),e.push(this.Country),e}},IfcPreDefinedColour=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPreDefinedColour(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcPreDefinedCurveFont=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPreDefinedCurveFont(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcPreDefinedItem=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPreDefinedItem(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcPreDefinedProperties=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcPreDefinedProperties(e,t)}ToTape(){return[]}},IfcPreDefinedPropertySet=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPreDefinedPropertySet(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcPreDefinedTextFont=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPreDefinedTextFont(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcPresentationItem=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcPresentationItem(e,t)}ToTape(){return[]}},IfcPresentationLayerAssignment=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.AssignedItems=r,this.Identifier=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPresentationLayerAssignment(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AssignedItems),e.push(this.Identifier),e}},IfcPresentationLayerWithStyle=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.AssignedItems=r,this.Identifier=o,this.LayerOn=a,this.LayerFrozen=n,this.LayerBlocked=h,this.LayerStyles=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcPresentationLayerWithStyle(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AssignedItems),e.push(this.Identifier),e.push(this.LayerOn),e.push(this.LayerFrozen),e.push(this.LayerBlocked),e.push(this.LayerStyles),e}},IfcPresentationStyle=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPresentationStyle(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcPresentationStyleAssignment=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Styles=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcPresentationStyleAssignment(e,t,r)}ToTape(){let e=[];return e.push(this.Styles),e}},IfcProcedure=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.PredefinedType=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcProcedure(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.PredefinedType),e}},IfcProcedureType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ProcessType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcProcedureType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e}},IfcProcess=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcProcess(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e}},IfcProduct=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcProduct(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},IfcProductDefinitionShape=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Representations=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcProductDefinitionShape(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e}},IfcProductRepresentation=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Representations=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcProductRepresentation(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e}},IfcProfileDef=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcProfileDef(e,t,r,o)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e}},IfcProfileProperties=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Properties=r,this.ProfileDefinition=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcProfileProperties(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e.push(this.ProfileDefinition),e}},IfcProject=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.LongName=n,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProject(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}},IfcProjectLibrary=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.LongName=n,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProjectLibrary(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}},IfcProjectOrder=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.PredefinedType=h,this.Status=l,this.LongDescription=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProjectOrder(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}},IfcProjectedCRS=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.GeodeticDatum=r,this.VerticalDatum=o,this.MapProjection=a,this.MapZone=n,this.MapUnit=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcProjectedCRS(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.GeodeticDatum),e.push(this.VerticalDatum),e.push(this.MapProjection),e.push(this.MapZone),e.push(this.MapUnit),e}},IfcProjectionElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProjectionElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcProperty=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Name=i,this.Description=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcProperty(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},IfcPropertyAbstraction=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcPropertyAbstraction(e,t)}ToTape(){return[]}},IfcPropertyBoundedValue=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.UpperBoundValue=r,this.LowerBoundValue=o,this.Unit=a,this.SetPointValue=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcPropertyBoundedValue(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UpperBoundValue),e.push(this.LowerBoundValue),e.push(this.Unit),e.push(this.SetPointValue),e}},IfcPropertyDefinition=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertyDefinition(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcPropertyDependencyRelationship=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.DependingProperty=r,this.DependantProperty=o,this.Expression=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcPropertyDependencyRelationship(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.DependingProperty),e.push(this.DependantProperty),e.push(this.Expression),e}},IfcPropertyEnumeratedValue=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.EnumerationValues=r,this.EnumerationReference=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertyEnumeratedValue(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.EnumerationValues),e.push(this.EnumerationReference),e}},IfcPropertyEnumeration=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.EnumerationValues=s,this.Unit=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcPropertyEnumeration(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.EnumerationValues),e.push(this.Unit),e}},IfcPropertyListValue=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.ListValues=r,this.Unit=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertyListValue(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ListValues),e.push(this.Unit),e}},IfcPropertyReferenceValue=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.UsageName=r,this.PropertyReference=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertyReferenceValue(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.PropertyReference),e}},IfcPropertySet=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.HasProperties=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcPropertySet(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.HasProperties),e}},IfcPropertySetDefinition=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertySetDefinition(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcPropertySetTemplate=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.TemplateType=a,this.ApplicableEntity=n,this.HasPropertyTemplates=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcPropertySetTemplate(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.TemplateType),e.push(this.ApplicableEntity),e.push(this.HasPropertyTemplates),e}},IfcPropertySingleValue=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.NominalValue=r,this.Unit=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertySingleValue(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.NominalValue),e.push(this.Unit),e}},IfcPropertyTableValue=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.DefiningValues=r,this.DefinedValues=o,this.Expression=a,this.DefiningUnit=n,this.DefinedUnit=h,this.CurveInterpolation=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcPropertyTableValue(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.DefiningValues),e.push(this.DefinedValues),e.push(this.Expression),e.push(this.DefiningUnit),e.push(this.DefinedUnit),e.push(this.CurveInterpolation),e}},IfcPropertyTemplate=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertyTemplate(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcPropertyTemplateDefinition=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcPropertyTemplateDefinition(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcProtectiveDevice=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProtectiveDevice(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcProtectiveDeviceTrippingUnit=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProtectiveDeviceTrippingUnit(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcProtectiveDeviceTrippingUnitType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcProtectiveDeviceTrippingUnitType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcProtectiveDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcProtectiveDeviceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcProxy=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.ProxyType=l,this.Tag=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcProxy(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.ProxyType),e.push(this.Tag),e}},IfcPump=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcPump(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcPumpType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcPumpType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcQuantityArea=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r,this.AreaValue=o,this.Formula=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcQuantityArea(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.AreaValue),e.push(this.Formula),e}},IfcQuantityCount=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r,this.CountValue=o,this.Formula=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcQuantityCount(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.CountValue),e.push(this.Formula),e}},IfcQuantityLength=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r,this.LengthValue=o,this.Formula=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcQuantityLength(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.LengthValue),e.push(this.Formula),e}},IfcQuantitySet=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcQuantitySet(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcQuantityTime=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r,this.TimeValue=o,this.Formula=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcQuantityTime(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.TimeValue),e.push(this.Formula),e}},IfcQuantityVolume=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r,this.VolumeValue=o,this.Formula=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcQuantityVolume(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.VolumeValue),e.push(this.Formula),e}},IfcQuantityWeight=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.Unit=r,this.WeightValue=o,this.Formula=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcQuantityWeight(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.WeightValue),e.push(this.Formula),e}},IfcRailing=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRailing(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcRailingType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRailingType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcRamp=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRamp(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcRampFlight=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRampFlight(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcRampFlightType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRampFlightType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcRampType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRampType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcRationalBSplineCurveWithKnots=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.Degree=i,this.ControlPointsList=s,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=a,this.KnotMultiplicities=n,this.Knots=h,this.KnotSpec=l,this.WeightsData=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRationalBSplineCurveWithKnots(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e.push(this.KnotMultiplicities),e.push(this.Knots),e.push(this.KnotSpec),e.push(this.WeightsData),e}},IfcRationalBSplineSurfaceWithKnots=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.UDegree=i,this.VDegree=s,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=a,this.VClosed=n,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=c,this.UKnots=u,this.VKnots=p,this.KnotSpec=d,this.WeightsData=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcRationalBSplineSurfaceWithKnots(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e.push(this.UMultiplicities),e.push(this.VMultiplicities),e.push(this.UKnots),e.push(this.VKnots),e.push(this.KnotSpec),e.push(this.WeightsData),e}},IfcRectangleHollowProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.XDim=o,this.YDim=a,this.WallThickness=n,this.InnerFilletRadius=h,this.OuterFilletRadius=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcRectangleHollowProfileDef(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e.push(this.WallThickness),e.push(this.InnerFilletRadius),e.push(this.OuterFilletRadius),e}},IfcRectangleProfileDef=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.XDim=o,this.YDim=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcRectangleProfileDef(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e}},IfcRectangularPyramid=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Position=i,this.XLength=s,this.YLength=r,this.Height=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRectangularPyramid(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Position),e.push(this.XLength),e.push(this.YLength),e.push(this.Height),e}},IfcRectangularTrimmedSurface=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.BasisSurface=i,this.U1=s,this.V1=r,this.U2=o,this.V2=a,this.Usense=n,this.Vsense=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRectangularTrimmedSurface(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.U1),e.push(this.V1),e.push(this.U2),e.push(this.V2),e.push(this.Usense),e.push(this.Vsense),e}},IfcRecurrencePattern=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.RecurrenceType=i,this.DayComponent=s,this.WeekdayComponent=r,this.MonthComponent=o,this.Position=a,this.Interval=n,this.Occurrences=h,this.TimePeriods=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcRecurrencePattern(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.RecurrenceType),e.push(this.DayComponent),e.push(this.WeekdayComponent),e.push(this.MonthComponent),e.push(this.Position),e.push(this.Interval),e.push(this.Occurrences),e.push(this.TimePeriods),e}},IfcReference=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.TypeIdentifier=i,this.AttributeIdentifier=s,this.InstanceName=r,this.ListPositions=o,this.InnerReference=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcReference(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.TypeIdentifier),e.push(this.AttributeIdentifier),e.push(this.InstanceName),e.push(this.ListPositions),e.push(this.InnerReference),e}},IfcReferent=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.PredefinedType=l,this.RestartDistance=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcReferent(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.RestartDistance),e}},IfcRegularTimeSeries=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=a,this.DataOrigin=n,this.UserDefinedDataOrigin=h,this.Unit=l,this.TimeStep=c,this.Values=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRegularTimeSeries(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e.push(this.TimeStep),e.push(this.Values),e}},IfcReinforcementBarProperties=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.TotalCrossSectionArea=i,this.SteelGrade=s,this.BarSurface=r,this.EffectiveDepth=o,this.NominalBarDiameter=a,this.BarCount=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcReinforcementBarProperties(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.TotalCrossSectionArea),e.push(this.SteelGrade),e.push(this.BarSurface),e.push(this.EffectiveDepth),e.push(this.NominalBarDiameter),e.push(this.BarCount),e}},IfcReinforcementDefinitionProperties=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.DefinitionType=a,this.ReinforcementSectionDefinitions=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcReinforcementDefinitionProperties(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.DefinitionType),e.push(this.ReinforcementSectionDefinitions),e}},IfcReinforcingBar=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.NominalDiameter=u,this.CrossSectionArea=p,this.BarLength=d,this.PredefinedType=m,this.BarSurface=f}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++];return new IfcReinforcingBar(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.BarLength),e.push(this.PredefinedType),e.push(this.BarSurface),e}},IfcReinforcingBarType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.NominalDiameter=p,this.CrossSectionArea=d,this.BarLength=m,this.BarSurface=f,this.BendingShapeCode=g,this.BendingParameters=_}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++];return new IfcReinforcingBarType(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.BarLength),e.push(this.BarSurface),e.push(this.BendingShapeCode),e.push(this.BendingParameters),e}},IfcReinforcingElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.SteelGrade=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcReinforcingElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e}},IfcReinforcingElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcReinforcingElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcReinforcingMesh=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.MeshLength=u,this.MeshWidth=p,this.LongitudinalBarNominalDiameter=d,this.TransverseBarNominalDiameter=m,this.LongitudinalBarCrossSectionArea=f,this.TransverseBarCrossSectionArea=g,this.LongitudinalBarSpacing=_,this.TransverseBarSpacing=y,this.PredefinedType=T}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++],I=i[s++];return new IfcReinforcingMesh(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.MeshLength),e.push(this.MeshWidth),e.push(this.LongitudinalBarNominalDiameter),e.push(this.TransverseBarNominalDiameter),e.push(this.LongitudinalBarCrossSectionArea),e.push(this.TransverseBarCrossSectionArea),e.push(this.LongitudinalBarSpacing),e.push(this.TransverseBarSpacing),e.push(this.PredefinedType),e}},IfcReinforcingMeshType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.MeshLength=p,this.MeshWidth=d,this.LongitudinalBarNominalDiameter=m,this.TransverseBarNominalDiameter=f,this.LongitudinalBarCrossSectionArea=g,this.TransverseBarCrossSectionArea=_,this.LongitudinalBarSpacing=y,this.TransverseBarSpacing=T,this.BendingShapeCode=v,this.BendingParameters=I}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++],I=i[s++],E=i[s++],P=i[s++];return new IfcReinforcingMeshType(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I,E,P)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.MeshLength),e.push(this.MeshWidth),e.push(this.LongitudinalBarNominalDiameter),e.push(this.TransverseBarNominalDiameter),e.push(this.LongitudinalBarCrossSectionArea),e.push(this.TransverseBarCrossSectionArea),e.push(this.LongitudinalBarSpacing),e.push(this.TransverseBarSpacing),e.push(this.BendingShapeCode),e.push(this.BendingParameters),e}},IfcRelAggregates=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingObject=a,this.RelatedObjects=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAggregates(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingObject),e.push(this.RelatedObjects),e}},IfcRelAssigns=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAssigns(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e}},IfcRelAssignsToActor=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingActor=h,this.ActingRole=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcRelAssignsToActor(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingActor),e.push(this.ActingRole),e}},IfcRelAssignsToControl=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingControl=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelAssignsToControl(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingControl),e}},IfcRelAssignsToGroup=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingGroup=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelAssignsToGroup(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingGroup),e}},IfcRelAssignsToGroupByFactor=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingGroup=h,this.Factor=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcRelAssignsToGroupByFactor(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingGroup),e.push(this.Factor),e}},IfcRelAssignsToProcess=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingProcess=h,this.QuantityInProcess=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcRelAssignsToProcess(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingProcess),e.push(this.QuantityInProcess),e}},IfcRelAssignsToProduct=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingProduct=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelAssignsToProduct(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingProduct),e}},IfcRelAssignsToResource=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=n,this.RelatingResource=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelAssignsToResource(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingResource),e}},IfcRelAssociates=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcRelAssociates(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e}},IfcRelAssociatesApproval=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingApproval=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAssociatesApproval(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingApproval),e}},IfcRelAssociatesClassification=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingClassification=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAssociatesClassification(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingClassification),e}},IfcRelAssociatesConstraint=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.Intent=n,this.RelatingConstraint=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelAssociatesConstraint(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.Intent),e.push(this.RelatingConstraint),e}},IfcRelAssociatesDocument=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingDocument=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAssociatesDocument(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingDocument),e}},IfcRelAssociatesLibrary=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingLibrary=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAssociatesLibrary(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingLibrary),e}},IfcRelAssociatesMaterial=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingMaterial=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelAssociatesMaterial(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingMaterial),e}},IfcRelConnects=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRelConnects(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcRelConnectsElements=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ConnectionGeometry=a,this.RelatingElement=n,this.RelatedElement=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelConnectsElements(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e}},IfcRelConnectsPathElements=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ConnectionGeometry=a,this.RelatingElement=n,this.RelatedElement=h,this.RelatingPriorities=l,this.RelatedPriorities=c,this.RelatedConnectionType=u,this.RelatingConnectionType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcRelConnectsPathElements(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.RelatingPriorities),e.push(this.RelatedPriorities),e.push(this.RelatedConnectionType),e.push(this.RelatingConnectionType),e}},IfcRelConnectsPortToElement=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingPort=a,this.RelatedElement=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelConnectsPortToElement(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPort),e.push(this.RelatedElement),e}},IfcRelConnectsPorts=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingPort=a,this.RelatedPort=n,this.RealizingElement=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcRelConnectsPorts(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPort),e.push(this.RelatedPort),e.push(this.RealizingElement),e}},IfcRelConnectsStructuralActivity=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingElement=a,this.RelatedStructuralActivity=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelConnectsStructuralActivity(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedStructuralActivity),e}},IfcRelConnectsStructuralMember=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingStructuralMember=a,this.RelatedStructuralConnection=n,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=c,this.ConditionCoordinateSystem=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRelConnectsStructuralMember(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingStructuralMember),e.push(this.RelatedStructuralConnection),e.push(this.AppliedCondition),e.push(this.AdditionalConditions),e.push(this.SupportedLength),e.push(this.ConditionCoordinateSystem),e}},IfcRelConnectsWithEccentricity=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingStructuralMember=a,this.RelatedStructuralConnection=n,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=c,this.ConditionCoordinateSystem=u,this.ConnectionConstraint=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcRelConnectsWithEccentricity(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingStructuralMember),e.push(this.RelatedStructuralConnection),e.push(this.AppliedCondition),e.push(this.AdditionalConditions),e.push(this.SupportedLength),e.push(this.ConditionCoordinateSystem),e.push(this.ConnectionConstraint),e}},IfcRelConnectsWithRealizingElements=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ConnectionGeometry=a,this.RelatingElement=n,this.RelatedElement=h,this.RealizingElements=l,this.ConnectionType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRelConnectsWithRealizingElements(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.RealizingElements),e.push(this.ConnectionType),e}},IfcRelContainedInSpatialStructure=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedElements=a,this.RelatingStructure=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelContainedInSpatialStructure(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedElements),e.push(this.RelatingStructure),e}},IfcRelCoversBldgElements=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingBuildingElement=a,this.RelatedCoverings=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelCoversBldgElements(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingBuildingElement),e.push(this.RelatedCoverings),e}},IfcRelCoversSpaces=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingSpace=a,this.RelatedCoverings=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelCoversSpaces(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedCoverings),e}},IfcRelDeclares=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingContext=a,this.RelatedDefinitions=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelDeclares(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingContext),e.push(this.RelatedDefinitions),e}},IfcRelDecomposes=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRelDecomposes(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcRelDefines=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRelDefines(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcRelDefinesByObject=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingObject=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelDefinesByObject(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingObject),e}},IfcRelDefinesByProperties=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingPropertyDefinition=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelDefinesByProperties(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingPropertyDefinition),e}},IfcRelDefinesByTemplate=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedPropertySets=a,this.RelatingTemplate=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelDefinesByTemplate(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedPropertySets),e.push(this.RelatingTemplate),e}},IfcRelDefinesByType=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedObjects=a,this.RelatingType=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelDefinesByType(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingType),e}},IfcRelFillsElement=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingOpeningElement=a,this.RelatedBuildingElement=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelFillsElement(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingOpeningElement),e.push(this.RelatedBuildingElement),e}},IfcRelFlowControlElements=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedControlElements=a,this.RelatingFlowElement=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelFlowControlElements(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedControlElements),e.push(this.RelatingFlowElement),e}},IfcRelInterferesElements=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingElement=a,this.RelatedElement=n,this.InterferenceGeometry=h,this.InterferenceType=l,this.ImpliedOrder=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRelInterferesElements(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.InterferenceGeometry),e.push(this.InterferenceType),e.push(this.ImpliedOrder),e}},IfcRelNests=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingObject=a,this.RelatedObjects=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelNests(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingObject),e.push(this.RelatedObjects),e}},IfcRelPositions=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingPositioningElement=a,this.RelatedProducts=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelPositions(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPositioningElement),e.push(this.RelatedProducts),e}},IfcRelProjectsElement=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingElement=a,this.RelatedFeatureElement=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelProjectsElement(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedFeatureElement),e}},IfcRelReferencedInSpatialStructure=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatedElements=a,this.RelatingStructure=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelReferencedInSpatialStructure(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedElements),e.push(this.RelatingStructure),e}},IfcRelSequence=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingProcess=a,this.RelatedProcess=n,this.TimeLag=h,this.SequenceType=l,this.UserDefinedSequenceType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRelSequence(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingProcess),e.push(this.RelatedProcess),e.push(this.TimeLag),e.push(this.SequenceType),e.push(this.UserDefinedSequenceType),e}},IfcRelServicesBuildings=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingSystem=a,this.RelatedBuildings=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelServicesBuildings(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSystem),e.push(this.RelatedBuildings),e}},IfcRelSpaceBoundary=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingSpace=a,this.RelatedBuildingElement=n,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRelSpaceBoundary(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e}},IfcRelSpaceBoundary1stLevel=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingSpace=a,this.RelatedBuildingElement=n,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=c,this.ParentBoundary=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRelSpaceBoundary1stLevel(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e.push(this.ParentBoundary),e}},IfcRelSpaceBoundary2ndLevel=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingSpace=a,this.RelatedBuildingElement=n,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=c,this.ParentBoundary=u,this.CorrespondingBoundary=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcRelSpaceBoundary2ndLevel(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e.push(this.ParentBoundary),e.push(this.CorrespondingBoundary),e}},IfcRelVoidsElement=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.RelatingBuildingElement=a,this.RelatedOpeningElement=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRelVoidsElement(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingBuildingElement),e.push(this.RelatedOpeningElement),e}},IfcRelationship=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRelationship(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcReparametrisedCompositeCurveSegment=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Transition=i,this.SameSense=s,this.ParentCurve=r,this.ParamLength=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcReparametrisedCompositeCurveSegment(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Transition),e.push(this.SameSense),e.push(this.ParentCurve),e.push(this.ParamLength),e}},IfcRepresentation=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ContextOfItems=i,this.RepresentationIdentifier=s,this.RepresentationType=r,this.Items=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRepresentation(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},IfcRepresentationContext=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.ContextIdentifier=i,this.ContextType=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcRepresentationContext(e,t,r,o)}ToTape(){let e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e}},IfcRepresentationItem=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcRepresentationItem(e,t)}ToTape(){return[]}},IfcRepresentationMap=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.MappingOrigin=i,this.MappedRepresentation=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcRepresentationMap(e,t,r,o)}ToTape(){let e=[];return e.push(this.MappingOrigin),e.push(this.MappedRepresentation),e}},IfcResource=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcResource(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e}},IfcResourceApprovalRelationship=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatedResourceObjects=r,this.RelatingApproval=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcResourceApprovalRelationship(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatedResourceObjects),e.push(this.RelatingApproval),e}},IfcResourceConstraintRelationship=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.RelatingConstraint=r,this.RelatedResourceObjects=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcResourceConstraintRelationship(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingConstraint),e.push(this.RelatedResourceObjects),e}},IfcResourceLevelRelationship=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Name=i,this.Description=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcResourceLevelRelationship(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},IfcResourceTime=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r,this.ScheduleWork=o,this.ScheduleUsage=a,this.ScheduleStart=n,this.ScheduleFinish=h,this.ScheduleContour=l,this.LevelingDelay=c,this.IsOverAllocated=u,this.StatusTime=p,this.ActualWork=d,this.ActualUsage=m,this.ActualStart=f,this.ActualFinish=g,this.RemainingWork=_,this.RemainingUsage=y,this.Completion=T}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++],I=i[s++];return new IfcResourceTime(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.ScheduleWork),e.push(this.ScheduleUsage),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.ScheduleContour),e.push(this.LevelingDelay),e.push(this.IsOverAllocated),e.push(this.StatusTime),e.push(this.ActualWork),e.push(this.ActualUsage),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingWork),e.push(this.RemainingUsage),e.push(this.Completion),e}},IfcRevolvedAreaSolid=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s,this.Axis=r,this.Angle=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRevolvedAreaSolid(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Axis),e.push(this.Angle),e}},IfcRevolvedAreaSolidTapered=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s,this.Axis=r,this.Angle=o,this.EndSweptArea=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcRevolvedAreaSolidTapered(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Axis),e.push(this.Angle),e.push(this.EndSweptArea),e}},IfcRightCircularCone=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Position=i,this.Height=s,this.BottomRadius=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcRightCircularCone(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Height),e.push(this.BottomRadius),e}},IfcRightCircularCylinder=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Position=i,this.Height=s,this.Radius=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcRightCircularCylinder(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Height),e.push(this.Radius),e}},IfcRoof=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcRoof(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcRoofType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcRoofType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcRoot=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcRoot(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IfcRoundedRectangleProfileDef=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.XDim=o,this.YDim=a,this.RoundingRadius=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcRoundedRectangleProfileDef(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e.push(this.RoundingRadius),e}},IfcSIUnit=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Dimensions=i,this.UnitType=s,this.Prefix=r,this.Name=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcSIUnit(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Prefix),e.push(this.Name),e}},IfcSanitaryTerminal=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSanitaryTerminal(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSanitaryTerminalType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSanitaryTerminalType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcSchedulingTime=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSchedulingTime(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e}},IfcSeamCurve=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Curve3D=i,this.AssociatedGeometry=s,this.MasterRepresentation=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSeamCurve(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}},IfcSectionProperties=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.SectionType=i,this.StartProfile=s,this.EndProfile=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSectionProperties(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.SectionType),e.push(this.StartProfile),e.push(this.EndProfile),e}},IfcSectionReinforcementProperties=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.LongitudinalStartPosition=i,this.LongitudinalEndPosition=s,this.TransversePosition=r,this.ReinforcementRole=o,this.SectionDefinition=a,this.CrossSectionReinforcementDefinitions=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcSectionReinforcementProperties(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.LongitudinalStartPosition),e.push(this.LongitudinalEndPosition),e.push(this.TransversePosition),e.push(this.ReinforcementRole),e.push(this.SectionDefinition),e.push(this.CrossSectionReinforcementDefinitions),e}},IfcSectionedSolid=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Directrix=i,this.CrossSections=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSectionedSolid(e,t,r,o)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.CrossSections),e}},IfcSectionedSolidHorizontal=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Directrix=i,this.CrossSections=s,this.CrossSectionPositions=r,this.FixedAxisVertical=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcSectionedSolidHorizontal(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.CrossSections),e.push(this.CrossSectionPositions),e.push(this.FixedAxisVertical),e}},IfcSectionedSpine=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.SpineCurve=i,this.CrossSections=s,this.CrossSectionPositions=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSectionedSpine(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.SpineCurve),e.push(this.CrossSections),e.push(this.CrossSectionPositions),e}},IfcSensor=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSensor(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSensorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSensorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcShadingDevice=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcShadingDevice(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcShadingDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcShadingDeviceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcShapeAspect=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.ShapeRepresentations=i,this.Name=s,this.Description=r,this.ProductDefinitional=o,this.PartOfProductDefinitionShape=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcShapeAspect(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.ShapeRepresentations),e.push(this.Name),e.push(this.Description),e.push(this.ProductDefinitional),e.push(this.PartOfProductDefinitionShape),e}},IfcShapeModel=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ContextOfItems=i,this.RepresentationIdentifier=s,this.RepresentationType=r,this.Items=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcShapeModel(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},IfcShapeRepresentation=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ContextOfItems=i,this.RepresentationIdentifier=s,this.RepresentationType=r,this.Items=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcShapeRepresentation(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},IfcShellBasedSurfaceModel=class{constructor(e,t,i){this.expressID=e,this.type=t,this.SbsmBoundary=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcShellBasedSurfaceModel(e,t,r)}ToTape(){let e=[];return e.push(this.SbsmBoundary),e}},IfcSimpleProperty=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Name=i,this.Description=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSimpleProperty(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},IfcSimplePropertyTemplate=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.TemplateType=a,this.PrimaryMeasureType=n,this.SecondaryMeasureType=h,this.Enumerators=l,this.PrimaryUnit=c,this.SecondaryUnit=u,this.Expression=p,this.AccessState=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcSimplePropertyTemplate(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.TemplateType),e.push(this.PrimaryMeasureType),e.push(this.SecondaryMeasureType),e.push(this.Enumerators),e.push(this.PrimaryUnit),e.push(this.SecondaryUnit),e.push(this.Expression),e.push(this.AccessState),e}},IfcSite=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c,this.RefLatitude=u,this.RefLongitude=p,this.RefElevation=d,this.LandTitleNumber=m,this.SiteAddress=f}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++];return new IfcSite(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.RefLatitude),e.push(this.RefLongitude),e.push(this.RefElevation),e.push(this.LandTitleNumber),e.push(this.SiteAddress),e}},IfcSlab=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSlab(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSlabElementedCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSlabElementedCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSlabStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSlabStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSlabType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSlabType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcSlippageConnectionCondition=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.SlippageX=s,this.SlippageY=r,this.SlippageZ=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcSlippageConnectionCondition(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.SlippageX),e.push(this.SlippageY),e.push(this.SlippageZ),e}},IfcSolarDevice=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSolarDevice(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSolarDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSolarDeviceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcSolidModel=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcSolidModel(e,t)}ToTape(){return[]}},IfcSpace=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c,this.PredefinedType=u,this.ElevationWithFlooring=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcSpace(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e.push(this.ElevationWithFlooring),e}},IfcSpaceHeater=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSpaceHeater(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSpaceHeaterType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSpaceHeaterType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcSpaceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.LongName=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcSpaceType(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.LongName),e}},IfcSpatialElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcSpatialElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e}},IfcSpatialElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSpatialElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcSpatialStructureElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.CompositionType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSpatialStructureElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}},IfcSpatialStructureElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSpatialStructureElementType(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},IfcSpatialZone=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.LongName=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSpatialZone(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.PredefinedType),e}},IfcSpatialZoneType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.LongName=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcSpatialZoneType(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.LongName),e}},IfcSphere=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Position=i,this.Radius=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSphere(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},IfcSphericalSurface=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Position=i,this.Radius=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSphericalSurface(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},IfcStackTerminal=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStackTerminal(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcStackTerminalType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStackTerminalType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcStair=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStair(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcStairFlight=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.NumberOfRisers=c,this.NumberOfTreads=u,this.RiserHeight=p,this.TreadLength=d,this.PredefinedType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcStairFlight(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.NumberOfRisers),e.push(this.NumberOfTreads),e.push(this.RiserHeight),e.push(this.TreadLength),e.push(this.PredefinedType),e}},IfcStairFlightType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStairFlightType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcStairType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStairType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcStructuralAction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStructuralAction(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e}},IfcStructuralActivity=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralActivity(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}},IfcStructuralAnalysisModel=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.PredefinedType=n,this.OrientationOf2DPlane=h,this.LoadedBy=l,this.HasResults=c,this.SharedPlacement=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStructuralAnalysisModel(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.OrientationOf2DPlane),e.push(this.LoadedBy),e.push(this.HasResults),e.push(this.SharedPlacement),e}},IfcStructuralConnection=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedCondition=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcStructuralConnection(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e}},IfcStructuralConnectionCondition=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcStructuralConnectionCondition(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcStructuralCurveAction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=u,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcStructuralCurveAction(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},IfcStructuralCurveConnection=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedCondition=l,this.Axis=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralCurveConnection(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e.push(this.Axis),e}},IfcStructuralCurveMember=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.PredefinedType=l,this.Axis=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralCurveMember(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Axis),e}},IfcStructuralCurveMemberVarying=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.PredefinedType=l,this.Axis=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralCurveMemberVarying(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Axis),e}},IfcStructuralCurveReaction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStructuralCurveReaction(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.PredefinedType),e}},IfcStructuralItem=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcStructuralItem(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},IfcStructuralLinearAction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=u,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcStructuralLinearAction(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},IfcStructuralLoad=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcStructuralLoad(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcStructuralLoadCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.PredefinedType=n,this.ActionType=h,this.ActionSource=l,this.Coefficient=c,this.Purpose=u,this.SelfWeightCoefficients=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcStructuralLoadCase(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.ActionType),e.push(this.ActionSource),e.push(this.Coefficient),e.push(this.Purpose),e.push(this.SelfWeightCoefficients),e}},IfcStructuralLoadConfiguration=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Values=s,this.Locations=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcStructuralLoadConfiguration(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Values),e.push(this.Locations),e}},IfcStructuralLoadGroup=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.PredefinedType=n,this.ActionType=h,this.ActionSource=l,this.Coefficient=c,this.Purpose=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStructuralLoadGroup(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.ActionType),e.push(this.ActionSource),e.push(this.Coefficient),e.push(this.Purpose),e}},IfcStructuralLoadLinearForce=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.LinearForceX=s,this.LinearForceY=r,this.LinearForceZ=o,this.LinearMomentX=a,this.LinearMomentY=n,this.LinearMomentZ=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcStructuralLoadLinearForce(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LinearForceX),e.push(this.LinearForceY),e.push(this.LinearForceZ),e.push(this.LinearMomentX),e.push(this.LinearMomentY),e.push(this.LinearMomentZ),e}},IfcStructuralLoadOrResult=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcStructuralLoadOrResult(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcStructuralLoadPlanarForce=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.PlanarForceX=s,this.PlanarForceY=r,this.PlanarForceZ=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcStructuralLoadPlanarForce(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.PlanarForceX),e.push(this.PlanarForceY),e.push(this.PlanarForceZ),e}},IfcStructuralLoadSingleDisplacement=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.DisplacementX=s,this.DisplacementY=r,this.DisplacementZ=o,this.RotationalDisplacementRX=a,this.RotationalDisplacementRY=n,this.RotationalDisplacementRZ=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcStructuralLoadSingleDisplacement(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DisplacementX),e.push(this.DisplacementY),e.push(this.DisplacementZ),e.push(this.RotationalDisplacementRX),e.push(this.RotationalDisplacementRY),e.push(this.RotationalDisplacementRZ),e}},IfcStructuralLoadSingleDisplacementDistortion=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Name=i,this.DisplacementX=s,this.DisplacementY=r,this.DisplacementZ=o,this.RotationalDisplacementRX=a,this.RotationalDisplacementRY=n,this.RotationalDisplacementRZ=h,this.Distortion=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcStructuralLoadSingleDisplacementDistortion(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DisplacementX),e.push(this.DisplacementY),e.push(this.DisplacementZ),e.push(this.RotationalDisplacementRX),e.push(this.RotationalDisplacementRY),e.push(this.RotationalDisplacementRZ),e.push(this.Distortion),e}},IfcStructuralLoadSingleForce=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.Name=i,this.ForceX=s,this.ForceY=r,this.ForceZ=o,this.MomentX=a,this.MomentY=n,this.MomentZ=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcStructuralLoadSingleForce(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.ForceX),e.push(this.ForceY),e.push(this.ForceZ),e.push(this.MomentX),e.push(this.MomentY),e.push(this.MomentZ),e}},IfcStructuralLoadSingleForceWarping=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Name=i,this.ForceX=s,this.ForceY=r,this.ForceZ=o,this.MomentX=a,this.MomentY=n,this.MomentZ=h,this.WarpingMoment=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcStructuralLoadSingleForceWarping(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.ForceX),e.push(this.ForceY),e.push(this.ForceZ),e.push(this.MomentX),e.push(this.MomentY),e.push(this.MomentZ),e.push(this.WarpingMoment),e}},IfcStructuralLoadStatic=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Name=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcStructuralLoadStatic(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},IfcStructuralLoadTemperature=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.DeltaTConstant=s,this.DeltaTY=r,this.DeltaTZ=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcStructuralLoadTemperature(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DeltaTConstant),e.push(this.DeltaTY),e.push(this.DeltaTZ),e}},IfcStructuralMember=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcStructuralMember(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},IfcStructuralPlanarAction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=u,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcStructuralPlanarAction(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},IfcStructuralPointAction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStructuralPointAction(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e}},IfcStructuralPointConnection=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedCondition=l,this.ConditionCoordinateSystem=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralPointConnection(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e.push(this.ConditionCoordinateSystem),e}},IfcStructuralPointReaction=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralPointReaction(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}},IfcStructuralReaction=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralReaction(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}},IfcStructuralResultGroup=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.TheoryType=n,this.ResultForLoadGroup=h,this.IsLinear=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcStructuralResultGroup(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheoryType),e.push(this.ResultForLoadGroup),e.push(this.IsLinear),e}},IfcStructuralSurfaceAction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=u,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcStructuralSurfaceAction(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},IfcStructuralSurfaceConnection=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedCondition=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcStructuralSurfaceConnection(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e}},IfcStructuralSurfaceMember=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.PredefinedType=l,this.Thickness=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralSurfaceMember(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Thickness),e}},IfcStructuralSurfaceMemberVarying=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.PredefinedType=l,this.Thickness=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcStructuralSurfaceMemberVarying(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Thickness),e}},IfcStructuralSurfaceReaction=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcStructuralSurfaceReaction(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.PredefinedType),e}},IfcStyleModel=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ContextOfItems=i,this.RepresentationIdentifier=s,this.RepresentationType=r,this.Items=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcStyleModel(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},IfcStyledItem=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Item=i,this.Styles=s,this.Name=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcStyledItem(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Item),e.push(this.Styles),e.push(this.Name),e}},IfcStyledRepresentation=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ContextOfItems=i,this.RepresentationIdentifier=s,this.RepresentationType=r,this.Items=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcStyledRepresentation(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},IfcSubContractResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=u,this.PredefinedType=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcSubContractResource(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcSubContractResourceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcSubContractResourceType(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},IfcSubedge=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.EdgeStart=i,this.EdgeEnd=s,this.ParentEdge=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSubedge(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.ParentEdge),e}},IfcSurface=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcSurface(e,t)}ToTape(){return[]}},IfcSurfaceCurve=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Curve3D=i,this.AssociatedGeometry=s,this.MasterRepresentation=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSurfaceCurve(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}},IfcSurfaceCurveSweptAreaSolid=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s,this.Directrix=r,this.StartParam=o,this.EndParam=a,this.ReferenceSurface=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcSurfaceCurveSweptAreaSolid(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Directrix),e.push(this.StartParam),e.push(this.EndParam),e.push(this.ReferenceSurface),e}},IfcSurfaceFeature=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSurfaceFeature(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSurfaceOfLinearExtrusion=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.SweptCurve=i,this.Position=s,this.ExtrudedDirection=r,this.Depth=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcSurfaceOfLinearExtrusion(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.SweptCurve),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e}},IfcSurfaceOfRevolution=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.SweptCurve=i,this.Position=s,this.AxisPosition=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSurfaceOfRevolution(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.SweptCurve),e.push(this.Position),e.push(this.AxisPosition),e}},IfcSurfaceReinforcementArea=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.Name=i,this.SurfaceReinforcement1=s,this.SurfaceReinforcement2=r,this.ShearReinforcement=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcSurfaceReinforcementArea(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.SurfaceReinforcement1),e.push(this.SurfaceReinforcement2),e.push(this.ShearReinforcement),e}},IfcSurfaceStyle=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Side=s,this.Styles=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcSurfaceStyle(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Side),e.push(this.Styles),e}},IfcSurfaceStyleLighting=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.DiffuseTransmissionColour=i,this.DiffuseReflectionColour=s,this.TransmissionColour=r,this.ReflectanceColour=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcSurfaceStyleLighting(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.DiffuseTransmissionColour),e.push(this.DiffuseReflectionColour),e.push(this.TransmissionColour),e.push(this.ReflectanceColour),e}},IfcSurfaceStyleRefraction=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.RefractionIndex=i,this.DispersionFactor=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSurfaceStyleRefraction(e,t,r,o)}ToTape(){let e=[];return e.push(this.RefractionIndex),e.push(this.DispersionFactor),e}},IfcSurfaceStyleRendering=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.SurfaceColour=i,this.Transparency=s,this.DiffuseColour=r,this.TransmissionColour=o,this.DiffuseTransmissionColour=a,this.ReflectionColour=n,this.SpecularColour=h,this.SpecularHighlight=l,this.ReflectanceMethod=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSurfaceStyleRendering(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.SurfaceColour),e.push(this.Transparency),e.push(this.DiffuseColour),e.push(this.TransmissionColour),e.push(this.DiffuseTransmissionColour),e.push(this.ReflectionColour),e.push(this.SpecularColour),e.push(this.SpecularHighlight),e.push(this.ReflectanceMethod),e}},IfcSurfaceStyleShading=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.SurfaceColour=i,this.Transparency=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSurfaceStyleShading(e,t,r,o)}ToTape(){let e=[];return e.push(this.SurfaceColour),e.push(this.Transparency),e}},IfcSurfaceStyleWithTextures=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Textures=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcSurfaceStyleWithTextures(e,t,r)}ToTape(){let e=[];return e.push(this.Textures),e}},IfcSurfaceTexture=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.RepeatS=i,this.RepeatT=s,this.Mode=r,this.TextureTransform=o,this.Parameter=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcSurfaceTexture(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e}},IfcSweptAreaSolid=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.SweptArea=i,this.Position=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSweptAreaSolid(e,t,r,o)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e}},IfcSweptDiskSolid=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Directrix=i,this.Radius=s,this.InnerRadius=r,this.StartParam=o,this.EndParam=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcSweptDiskSolid(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.Radius),e.push(this.InnerRadius),e.push(this.StartParam),e.push(this.EndParam),e}},IfcSweptDiskSolidPolygonal=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Directrix=i,this.Radius=s,this.InnerRadius=r,this.StartParam=o,this.EndParam=a,this.FilletRadius=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcSweptDiskSolidPolygonal(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.Radius),e.push(this.InnerRadius),e.push(this.StartParam),e.push(this.EndParam),e.push(this.FilletRadius),e}},IfcSweptSurface=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.SweptCurve=i,this.Position=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcSweptSurface(e,t,r,o)}ToTape(){let e=[];return e.push(this.SweptCurve),e.push(this.Position),e}},IfcSwitchingDevice=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSwitchingDevice(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSwitchingDeviceType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSwitchingDeviceType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcSystem=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcSystem(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}},IfcSystemFurnitureElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcSystemFurnitureElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcSystemFurnitureElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcSystemFurnitureElementType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Depth=o,this.FlangeWidth=a,this.WebThickness=n,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=c,this.WebEdgeRadius=u,this.WebSlope=p,this.FlangeSlope=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcTShapeProfileDef(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.FlangeEdgeRadius),e.push(this.WebEdgeRadius),e.push(this.WebSlope),e.push(this.FlangeSlope),e}},IfcTable=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Name=i,this.Rows=s,this.Columns=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcTable(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Rows),e.push(this.Columns),e}},IfcTableColumn=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Identifier=i,this.Name=s,this.Description=r,this.Unit=o,this.ReferencePath=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcTableColumn(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Identifier),e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.ReferencePath),e}},IfcTableRow=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.RowCells=i,this.IsHeading=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcTableRow(e,t,r,o)}ToTape(){let e=[];return e.push(this.RowCells),e.push(this.IsHeading),e}},IfcTank=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTank(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcTankType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTankType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTask=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.LongDescription=h,this.Status=l,this.WorkMethod=c,this.IsMilestone=u,this.Priority=p,this.TaskTime=d,this.PredefinedType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcTask(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Status),e.push(this.WorkMethod),e.push(this.IsMilestone),e.push(this.Priority),e.push(this.TaskTime),e.push(this.PredefinedType),e}},IfcTaskTime=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r,this.DurationType=o,this.ScheduleDuration=a,this.ScheduleStart=n,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=c,this.LateStart=u,this.LateFinish=p,this.FreeFloat=d,this.TotalFloat=m,this.IsCritical=f,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=T,this.RemainingTime=v,this.Completion=I}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++],I=i[s++],E=i[s++],P=i[s++];return new IfcTaskTime(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I,E,P)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.DurationType),e.push(this.ScheduleDuration),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.EarlyStart),e.push(this.EarlyFinish),e.push(this.LateStart),e.push(this.LateFinish),e.push(this.FreeFloat),e.push(this.TotalFloat),e.push(this.IsCritical),e.push(this.StatusTime),e.push(this.ActualDuration),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingTime),e.push(this.Completion),e}},IfcTaskTimeRecurring=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I,E){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r,this.DurationType=o,this.ScheduleDuration=a,this.ScheduleStart=n,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=c,this.LateStart=u,this.LateFinish=p,this.FreeFloat=d,this.TotalFloat=m,this.IsCritical=f,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=T,this.RemainingTime=v,this.Completion=I,this.Recurrence=E}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++],I=i[s++],E=i[s++],P=i[s++],b=i[s++];return new IfcTaskTimeRecurring(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v,I,E,P,b)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.DurationType),e.push(this.ScheduleDuration),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.EarlyStart),e.push(this.EarlyFinish),e.push(this.LateStart),e.push(this.LateFinish),e.push(this.FreeFloat),e.push(this.TotalFloat),e.push(this.IsCritical),e.push(this.StatusTime),e.push(this.ActualDuration),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingTime),e.push(this.Completion),e.push(this.Recurrence),e}},IfcTaskType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ProcessType=c,this.PredefinedType=u,this.WorkMethod=p}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++];return new IfcTaskType(e,t,r,o,a,n,h,l,c,u,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e.push(this.WorkMethod),e}},IfcTelecomAddress=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.Purpose=i,this.Description=s,this.UserDefinedPurpose=r,this.TelephoneNumbers=o,this.FacsimileNumbers=a,this.PagerNumber=n,this.ElectronicMailAddresses=h,this.WWWHomePageURL=l,this.MessagingIDs=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTelecomAddress(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e.push(this.TelephoneNumbers),e.push(this.FacsimileNumbers),e.push(this.PagerNumber),e.push(this.ElectronicMailAddresses),e.push(this.WWWHomePageURL),e.push(this.MessagingIDs),e}},IfcTendon=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.PredefinedType=u,this.NominalDiameter=p,this.CrossSectionArea=d,this.TensionForce=m,this.PreStress=f,this.FrictionCoefficient=g,this.AnchorageSlip=_,this.MinCurvatureRadius=y}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++],v=i[s++];return new IfcTendon(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T,v)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.TensionForce),e.push(this.PreStress),e.push(this.FrictionCoefficient),e.push(this.AnchorageSlip),e.push(this.MinCurvatureRadius),e}},IfcTendonAnchor=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTendonAnchor(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e}},IfcTendonAnchorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTendonAnchorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTendonConduit=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTendonConduit(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e}},IfcTendonConduitType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTendonConduitType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTendonType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.NominalDiameter=p,this.CrossSectionArea=d,this.SheathDiameter=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcTendonType(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.SheathDiameter),e}},IfcTessellatedFaceSet=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Coordinates=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcTessellatedFaceSet(e,t,r)}ToTape(){let e=[];return e.push(this.Coordinates),e}},IfcTessellatedItem=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcTessellatedItem(e,t)}ToTape(){return[]}},IfcTextLiteral=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Literal=i,this.Placement=s,this.Path=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcTextLiteral(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Literal),e.push(this.Placement),e.push(this.Path),e}},IfcTextLiteralWithExtent=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Literal=i,this.Placement=s,this.Path=r,this.Extent=o,this.BoxAlignment=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcTextLiteralWithExtent(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Literal),e.push(this.Placement),e.push(this.Path),e.push(this.Extent),e.push(this.BoxAlignment),e}},IfcTextStyle=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Name=i,this.TextCharacterAppearance=s,this.TextStyle=r,this.TextFontStyle=o,this.ModelOrDraughting=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcTextStyle(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TextCharacterAppearance),e.push(this.TextStyle),e.push(this.TextFontStyle),e.push(this.ModelOrDraughting),e}},IfcTextStyleFontModel=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Name=i,this.FontFamily=s,this.FontStyle=r,this.FontVariant=o,this.FontWeight=a,this.FontSize=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcTextStyleFontModel(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.FontFamily),e.push(this.FontStyle),e.push(this.FontVariant),e.push(this.FontWeight),e.push(this.FontSize),e}},IfcTextStyleForDefinedFont=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Colour=i,this.BackgroundColour=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcTextStyleForDefinedFont(e,t,r,o)}ToTape(){let e=[];return e.push(this.Colour),e.push(this.BackgroundColour),e}},IfcTextStyleTextModel=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.TextIndent=i,this.TextAlign=s,this.TextDecoration=r,this.LetterSpacing=o,this.WordSpacing=a,this.TextTransform=n,this.LineHeight=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcTextStyleTextModel(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.TextIndent),e.push(this.TextAlign),e.push(this.TextDecoration),e.push(this.LetterSpacing),e.push(this.WordSpacing),e.push(this.TextTransform),e.push(this.LineHeight),e}},IfcTextureCoordinate=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Maps=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcTextureCoordinate(e,t,r)}ToTape(){let e=[];return e.push(this.Maps),e}},IfcTextureCoordinateGenerator=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Maps=i,this.Mode=s,this.Parameter=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcTextureCoordinateGenerator(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.Mode),e.push(this.Parameter),e}},IfcTextureMap=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Maps=i,this.Vertices=s,this.MappedTo=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcTextureMap(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.Vertices),e.push(this.MappedTo),e}},IfcTextureVertex=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Coordinates=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcTextureVertex(e,t,r)}ToTape(){let e=[];return e.push(this.Coordinates),e}},IfcTextureVertexList=class{constructor(e,t,i){this.expressID=e,this.type=t,this.TexCoordsList=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcTextureVertexList(e,t,r)}ToTape(){let e=[];return e.push(this.TexCoordsList),e}},IfcTimePeriod=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.StartTime=i,this.EndTime=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcTimePeriod(e,t,r,o)}ToTape(){let e=[];return e.push(this.StartTime),e.push(this.EndTime),e}},IfcTimeSeries=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.Name=i,this.Description=s,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=a,this.DataOrigin=n,this.UserDefinedDataOrigin=h,this.Unit=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcTimeSeries(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e}},IfcTimeSeriesValue=class{constructor(e,t,i){this.expressID=e,this.type=t,this.ListValues=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcTimeSeriesValue(e,t,r)}ToTape(){let e=[];return e.push(this.ListValues),e}},IfcTopologicalRepresentationItem=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcTopologicalRepresentationItem(e,t)}ToTape(){return[]}},IfcTopologyRepresentation=class{constructor(e,t,i,s,r,o){this.expressID=e,this.type=t,this.ContextOfItems=i,this.RepresentationIdentifier=s,this.RepresentationType=r,this.Items=o}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++];return new IfcTopologyRepresentation(e,t,r,o,a,n)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},IfcToroidalSurface=class{constructor(e,t,i,s,r){this.expressID=e,this.type=t,this.Position=i,this.MajorRadius=s,this.MinorRadius=r}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++];return new IfcToroidalSurface(e,t,r,o,a)}ToTape(){let e=[];return e.push(this.Position),e.push(this.MajorRadius),e.push(this.MinorRadius),e}},IfcTransformer=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTransformer(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcTransformerType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTransformerType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTransitionCurveSegment2D=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.StartPoint=i,this.StartDirection=s,this.SegmentLength=r,this.StartRadius=o,this.EndRadius=a,this.IsStartRadiusCCW=n,this.IsEndRadiusCCW=h,this.TransitionCurveType=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcTransitionCurveSegment2D(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e.push(this.StartRadius),e.push(this.EndRadius),e.push(this.IsStartRadiusCCW),e.push(this.IsEndRadiusCCW),e.push(this.TransitionCurveType),e}},IfcTransportElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTransportElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcTransportElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTransportElementType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTrapeziumProfileDef=class{constructor(e,t,i,s,r,o,a,n,h){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.BottomXDim=o,this.TopXDim=a,this.YDim=n,this.TopXOffset=h}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++];return new IfcTrapeziumProfileDef(e,t,r,o,a,n,h,l,c)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.BottomXDim),e.push(this.TopXDim),e.push(this.YDim),e.push(this.TopXOffset),e}},IfcTriangulatedFaceSet=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.Coordinates=i,this.Normals=s,this.Closed=r,this.CoordIndex=o,this.PnIndex=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcTriangulatedFaceSet(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.Coordinates),e.push(this.Normals),e.push(this.Closed),e.push(this.CoordIndex),e.push(this.PnIndex),e}},IfcTriangulatedIrregularNetwork=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Coordinates=i,this.Normals=s,this.Closed=r,this.CoordIndex=o,this.PnIndex=a,this.Flags=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcTriangulatedIrregularNetwork(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Coordinates),e.push(this.Normals),e.push(this.Closed),e.push(this.CoordIndex),e.push(this.PnIndex),e.push(this.Flags),e}},IfcTrimmedCurve=class{constructor(e,t,i,s,r,o,a){this.expressID=e,this.type=t,this.BasisCurve=i,this.Trim1=s,this.Trim2=r,this.SenseAgreement=o,this.MasterRepresentation=a}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++];return new IfcTrimmedCurve(e,t,r,o,a,n,h)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.Trim1),e.push(this.Trim2),e.push(this.SenseAgreement),e.push(this.MasterRepresentation),e}},IfcTubeBundle=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTubeBundle(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcTubeBundleType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcTubeBundleType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcTypeObject=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcTypeObject(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e}},IfcTypeProcess=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ProcessType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTypeProcess(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e}},IfcTypeProduct=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcTypeProduct(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e}},IfcTypeResource=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.Identification=h,this.LongDescription=l,this.ResourceType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcTypeResource(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e}},IfcUShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Depth=o,this.FlangeWidth=a,this.WebThickness=n,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=c,this.FlangeSlope=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcUShapeProfileDef(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e.push(this.FlangeSlope),e}},IfcUnitAssignment=class{constructor(e,t,i){this.expressID=e,this.type=t,this.Units=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcUnitAssignment(e,t,r)}ToTape(){let e=[];return e.push(this.Units),e}},IfcUnitaryControlElement=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcUnitaryControlElement(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcUnitaryControlElementType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcUnitaryControlElementType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcUnitaryEquipment=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcUnitaryEquipment(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcUnitaryEquipmentType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcUnitaryEquipmentType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcValve=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcValve(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcValveType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcValveType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcVector=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.Orientation=i,this.Magnitude=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcVector(e,t,r,o)}ToTape(){let e=[];return e.push(this.Orientation),e.push(this.Magnitude),e}},IfcVertex=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,i){return new IfcVertex(e,t)}ToTape(){return[]}},IfcVertexLoop=class{constructor(e,t,i){this.expressID=e,this.type=t,this.LoopVertex=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcVertexLoop(e,t,r)}ToTape(){let e=[];return e.push(this.LoopVertex),e}},IfcVertexPoint=class{constructor(e,t,i){this.expressID=e,this.type=t,this.VertexGeometry=i}static FromTape(e,t,i){let s=0,r=i[s++];return new IfcVertexPoint(e,t,r)}ToTape(){let e=[];return e.push(this.VertexGeometry),e}},IfcVibrationDamper=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcVibrationDamper(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcVibrationDamperType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcVibrationDamperType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcVibrationIsolator=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcVibrationIsolator(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcVibrationIsolatorType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcVibrationIsolatorType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcVirtualElement=class{constructor(e,t,i,s,r,o,a,n,h,l){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++];return new IfcVirtualElement(e,t,r,o,a,n,h,l,c,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},IfcVirtualGridIntersection=class{constructor(e,t,i,s){this.expressID=e,this.type=t,this.IntersectingAxes=i,this.OffsetDistances=s}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++];return new IfcVirtualGridIntersection(e,t,r,o)}ToTape(){let e=[];return e.push(this.IntersectingAxes),e.push(this.OffsetDistances),e}},IfcVoidingFeature=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcVoidingFeature(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcWall=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcWall(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcWallElementedCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcWallElementedCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcWallStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcWallStandardCase(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcWallType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcWallType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcWasteTerminal=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcWasteTerminal(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IfcWasteTerminalType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++];return new IfcWasteTerminalType(e,t,r,o,a,n,h,l,c,u,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IfcWindow=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=u,this.PredefinedType=p,this.PartitioningType=d,this.UserDefinedPartitioningType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcWindow(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.UserDefinedPartitioningType),e}},IfcWindowLiningProperties=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f,g,_){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.LiningDepth=a,this.LiningThickness=n,this.TransomThickness=h,this.MullionThickness=l,this.FirstTransomOffset=c,this.SecondTransomOffset=u,this.FirstMullionOffset=p,this.SecondMullionOffset=d,this.ShapeAspectStyle=m,this.LiningOffset=f,this.LiningToPanelOffsetX=g,this.LiningToPanelOffsetY=_}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++],y=i[s++],T=i[s++];return new IfcWindowLiningProperties(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_,y,T)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.LiningDepth),e.push(this.LiningThickness),e.push(this.TransomThickness),e.push(this.MullionThickness),e.push(this.FirstTransomOffset),e.push(this.SecondTransomOffset),e.push(this.FirstMullionOffset),e.push(this.SecondMullionOffset),e.push(this.ShapeAspectStyle),e.push(this.LiningOffset),e.push(this.LiningToPanelOffsetX),e.push(this.LiningToPanelOffsetY),e}},IfcWindowPanelProperties=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.OperationType=a,this.PanelPosition=n,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcWindowPanelProperties(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.OperationType),e.push(this.PanelPosition),e.push(this.FrameDepth),e.push(this.FrameThickness),e.push(this.ShapeAspectStyle),e}},IfcWindowStandardCase=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.ObjectPlacement=n,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=u,this.PredefinedType=p,this.PartitioningType=d,this.UserDefinedPartitioningType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcWindowStandardCase(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.UserDefinedPartitioningType),e}},IfcWindowStyle=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ConstructionType=c,this.OperationType=u,this.ParameterTakesPrecedence=p,this.Sizeable=d}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++];return new IfcWindowStyle(e,t,r,o,a,n,h,l,c,u,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ConstructionType),e.push(this.OperationType),e.push(this.ParameterTakesPrecedence),e.push(this.Sizeable),e}},IfcWindowType=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=n,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=u,this.PartitioningType=p,this.ParameterTakesPrecedence=d,this.UserDefinedPartitioningType=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcWindowType(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.ParameterTakesPrecedence),e.push(this.UserDefinedPartitioningType),e}},IfcWorkCalendar=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.WorkingTimes=h,this.ExceptionTimes=l,this.PredefinedType=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcWorkCalendar(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.WorkingTimes),e.push(this.ExceptionTimes),e.push(this.PredefinedType),e}},IfcWorkControl=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.CreationDate=h,this.Creators=l,this.Purpose=c,this.Duration=u,this.TotalFloat=p,this.StartTime=d,this.FinishTime=m}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++];return new IfcWorkControl(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e}},IfcWorkPlan=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.CreationDate=h,this.Creators=l,this.Purpose=c,this.Duration=u,this.TotalFloat=p,this.StartTime=d,this.FinishTime=m,this.PredefinedType=f}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++];return new IfcWorkPlan(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e.push(this.PredefinedType),e}},IfcWorkSchedule=class{constructor(e,t,i,s,r,o,a,n,h,l,c,u,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.Identification=n,this.CreationDate=h,this.Creators=l,this.Purpose=c,this.Duration=u,this.TotalFloat=p,this.StartTime=d,this.FinishTime=m,this.PredefinedType=f}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++],d=i[s++],m=i[s++],f=i[s++],g=i[s++],_=i[s++];return new IfcWorkSchedule(e,t,r,o,a,n,h,l,c,u,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e.push(this.PredefinedType),e}},IfcWorkTime=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.Name=i,this.DataOrigin=s,this.UserDefinedDataOrigin=r,this.RecurrencePattern=o,this.Start=a,this.Finish=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcWorkTime(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.RecurrencePattern),e.push(this.Start),e.push(this.Finish),e}},IfcZShapeProfileDef=class{constructor(e,t,i,s,r,o,a,n,h,l,c){this.expressID=e,this.type=t,this.ProfileType=i,this.ProfileName=s,this.Position=r,this.Depth=o,this.FlangeWidth=a,this.WebThickness=n,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=c}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++],c=i[s++],u=i[s++],p=i[s++];return new IfcZShapeProfileDef(e,t,r,o,a,n,h,l,c,u,p)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e}},IfcZone=class{constructor(e,t,i,s,r,o,a,n){this.expressID=e,this.type=t,this.GlobalId=i,this.OwnerHistory=s,this.Name=r,this.Description=o,this.ObjectType=a,this.LongName=n}static FromTape(e,t,i){let s=0,r=i[s++],o=i[s++],a=i[s++],n=i[s++],h=i[s++],l=i[s++];return new IfcZone(e,t,r,o,a,n,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e}},IfcElements2={103090709:"IFCPROJECT",4097777520:"IFCSITE",4031249490:"IFCBUILDING",3124254112:"IFCBUILDINGSTOREY",3856911033:"IFCSPACE",1674181508:"IFCANNOTATION",25142252:"IFCCONTROLLER",32344328:"IFCBOILER",76236018:"IFCLAMP",90941305:"IFCPUMP",177149247:"IFCAIRTERMINALBOX",182646315:"IFCFLOWINSTRUMENT",263784265:"IFCFURNISHINGELEMENT",264262732:"IFCELECTRICGENERATOR",277319702:"IFCAUDIOVISUALAPPLIANCE",310824031:"IFCPIPEFITTING",331165859:"IFCSTAIR",342316401:"IFCDUCTFITTING",377706215:"IFCMECHANICALFASTENER",395920057:"IFCDOOR",402227799:"IFCELECTRICMOTOR",413509423:"IFCSYSTEMFURNITUREELEMENT",484807127:"IFCEVAPORATOR",486154966:"IFCWINDOWSTANDARDCASE",629592764:"IFCLIGHTFIXTURE",630975310:"IFCUNITARYCONTROLELEMENT",635142910:"IFCCABLECARRIERFITTING",639361253:"IFCCOIL",647756555:"IFCFASTENER",707683696:"IFCFLOWSTORAGEDEVICE",738039164:"IFCPROTECTIVEDEVICE",753842376:"IFCBEAM",812556717:"IFCTANK",819412036:"IFCFILTER",843113511:"IFCCOLUMN",862014818:"IFCELECTRICDISTRIBUTIONBOARD",900683007:"IFCFOOTING",905975707:"IFCCOLUMNSTANDARDCASE",926996030:"IFCVOIDINGFEATURE",979691226:"IFCREINFORCINGBAR",987401354:"IFCFLOWSEGMENT",1003880860:"IFCELECTRICTIMECONTROL",1051757585:"IFCCABLEFITTING",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1073191201:"IFCMEMBER",1095909175:"IFCBUILDINGELEMENTPROXY",1156407060:"IFCPLATESTANDARDCASE",1162798199:"IFCSWITCHINGDEVICE",1329646415:"IFCSHADINGDEVICE",1335981549:"IFCDISCRETEACCESSORY",1360408905:"IFCDUCTSILENCER",1404847402:"IFCSTACKTERMINAL",1426591983:"IFCFIRESUPPRESSIONTERMINAL",1437502449:"IFCMEDICALDEVICE",1509553395:"IFCFURNITURE",1529196076:"IFCSLAB",1620046519:"IFCTRANSPORTELEMENT",1634111441:"IFCAIRTERMINAL",1658829314:"IFCENERGYCONVERSIONDEVICE",1677625105:"IFCCIVILELEMENT",1687234759:"IFCPILE",1904799276:"IFCELECTRICAPPLIANCE",1911478936:"IFCMEMBERSTANDARDCASE",1945004755:"IFCDISTRIBUTIONELEMENT",1973544240:"IFCCOVERING",1999602285:"IFCSPACEHEATER",2016517767:"IFCROOF",2056796094:"IFCAIRTOAIRHEATRECOVERY",2058353004:"IFCFLOWCONTROLLER",2068733104:"IFCHUMIDIFIER",2176052936:"IFCJUNCTIONBOX",2188021234:"IFCFLOWMETER",2223149337:"IFCFLOWTERMINAL",2262370178:"IFCRAILING",2272882330:"IFCCONDENSER",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",2320036040:"IFCREINFORCINGMESH",2347447852:"IFCTENDONANCHOR",2391383451:"IFCVIBRATIONISOLATOR",2391406946:"IFCWALL",2474470126:"IFCMOTORCONNECTION",2769231204:"IFCVIRTUALELEMENT",2814081492:"IFCENGINE",2906023776:"IFCBEAMSTANDARDCASE",2938176219:"IFCBURNER",2979338954:"IFCBUILDINGELEMENTPART",3024970846:"IFCRAMP",3026737570:"IFCTUBEBUNDLE",3027962421:"IFCSLABSTANDARDCASE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3053780830:"IFCSANITARYTERMINAL",3079942009:"IFCOPENINGSTANDARDCASE",3087945054:"IFCALARM",3101698114:"IFCSURFACEFEATURE",3127900445:"IFCSLABELEMENTEDCASE",3132237377:"IFCFLOWMOVINGDEVICE",3171933400:"IFCPLATE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",3242481149:"IFCDOORSTANDARDCASE",3283111854:"IFCRAMPFLIGHT",3296154744:"IFCCHIMNEY",3304561284:"IFCWINDOW",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3319311131:"IFCHEATEXCHANGER",3415622556:"IFCFAN",3420628829:"IFCSOLARDEVICE",3493046030:"IFCGEOGRAPHICELEMENT",3495092785:"IFCCURTAINWALL",3508470533:"IFCFLOWTREATMENTDEVICE",3512223829:"IFCWALLSTANDARDCASE",3518393246:"IFCDUCTSEGMENT",3571504051:"IFCCOMPRESSOR",3588315303:"IFCOPENINGELEMENT",3612865200:"IFCPIPESEGMENT",3640358203:"IFCCOOLINGTOWER",3651124850:"IFCPROJECTIONELEMENT",3694346114:"IFCOUTLET",3747195512:"IFCEVAPORATIVECOOLER",3758799889:"IFCCABLECARRIERSEGMENT",3824725483:"IFCTENDON",3825984169:"IFCTRANSFORMER",3902619387:"IFCCHILLER",4074379575:"IFCDAMPER",4086658281:"IFCSENSOR",4123344466:"IFCELEMENTASSEMBLY",4136498852:"IFCCOOLEDBEAM",4156078855:"IFCWALLELEMENTEDCASE",4175244083:"IFCINTERCEPTOR",4207607924:"IFCVALVE",4217484030:"IFCCABLESEGMENT",4237592921:"IFCWASTETERMINAL",4252922144:"IFCSTAIRFLIGHT",4278956645:"IFCFLOWFITTING",4288193352:"IFCACTUATOR",4292641817:"IFCUNITARYEQUIPMENT",3009204131:"IFCGRID"},PropsNames={aggregates:{name:IFCRELAGGREGATES,relating:"RelatingObject",related:"RelatedObjects",key:"children"},spatial:{name:IFCRELCONTAINEDINSPATIALSTRUCTURE,relating:"RelatingStructure",related:"RelatedElements",key:"children"},psets:{name:IFCRELDEFINESBYPROPERTIES,relating:"RelatingPropertyDefinition",related:"RelatedObjects",key:"hasPsets"},materials:{name:IFCRELASSOCIATESMATERIAL,relating:"RelatingMaterial",related:"RelatedObjects",key:"hasMaterial"},type:{name:IFCRELDEFINESBYTYPE,relating:"RelatingType",related:"RelatedObjects",key:"hasType"}},Properties=class{constructor(e){this.api=e}getItemProperties(e,t,i=!1){return __async(this,null,(function*(){return this.api.GetLine(e,t,i)}))}getPropertySets(e,t,i=!1){return __async(this,null,(function*(){return yield this.getProperty(e,t,i,PropsNames.psets)}))}getTypeProperties(e,t,i=!1){return __async(this,null,(function*(){return yield this.getProperty(e,t,i,PropsNames.type)}))}getMaterialsProperties(e,t,i=!1){return __async(this,null,(function*(){return yield this.getProperty(e,t,i,PropsNames.materials)}))}getSpatialStructure(e,t){return __async(this,null,(function*(){yield this.getAllTypesOfModel(e);const i=yield this.getSpatialTreeChunks(e),s=(yield this.api.GetLineIDsWithType(e,IFCPROJECT)).get(0),r=Properties.newIfcProject(s);return yield this.getSpatialNode(e,r,i,t),this.cleanupTypes(),r}))}getAllItemsOfType(e,t,i){return __async(this,null,(function*(){let s=[];const r=yield this.api.GetLineIDsWithType(e,t);for(let e=0;e<r.size();e++)s.push(r.get(e));if(!i)return s;const o=[];for(let t=0;t<s.length;t++)o.push(yield this.api.GetLine(e,s[t]));return o}))}getProperty(e,t,i=!1,s){return __async(this,null,(function*(){const r=yield this.getAllRelatedItemsOfType(e,t,s),o=[];for(let t=0;t<r.length;t++)o.push(yield this.api.GetLine(e,r[t],i));return o}))}getChunks(e,t,i){return __async(this,null,(function*(){const s=yield this.api.GetLineIDsWithType(e,i.name);for(let r=0;r<s.size();r++){const o=yield this.api.GetLine(e,s.get(r),!1);this.saveChunk(t,i,o)}}))}static isRelated(e,t,i){const s=t[i.related];if(Array.isArray(s)){return s.map((e=>e.value)).includes(e)}return s.value===e}static newIfcProject(e){return{expressID:e,type:"IFCPROJECT",children:[]}}getSpatialNode(e,t,i,s){return __async(this,null,(function*(){yield this.getChildren(e,t,i,PropsNames.aggregates,s),yield this.getChildren(e,t,i,PropsNames.spatial,s)}))}getChildren(e,t,i,s,r){return __async(this,null,(function*(){const o=i[t.expressID];if(null==o)return;const a=s.key,n=[];for(let t=0;t<o.length;t++){const s=o[t];let a=this.newNode(s);if(r){const t=yield this.getItemProperties(e,a.expressID);a=__spreadValues(__spreadValues({},t),a)}yield this.getSpatialNode(e,a,i,r),n.push(a)}t[a]=n}))}newNode(e){return{expressID:e,type:this.getNodeType(e),children:[]}}getNodeType(e){const t=this.types[e];return IfcElements2[t]}getSpatialTreeChunks(e){return __async(this,null,(function*(){const t={};return yield this.getChunks(e,t,PropsNames.aggregates),yield this.getChunks(e,t,PropsNames.spatial),t}))}saveChunk(e,t,i){const s=i[t.relating].value,r=i[t.related].map((e=>e.value));null==e[s]?e[s]=r:e[s]=e[s].concat(r)}getRelated(e,t,i){const s=e[t.relating];Array.isArray(s)?s.forEach((e=>i.push(e.value))):i.push(s.value)}getAllRelatedItemsOfType(e,t,i){return __async(this,null,(function*(){const s=yield this.api.GetLineIDsWithType(e,i.name),r=[];for(let o=0;o<s.size();o++){const a=yield this.api.GetLine(e,s.get(o));Properties.isRelated(t,a,i)&&this.getRelated(a,i,r)}return r}))}cleanupTypes(){this.types={}}getAllTypesOfModel(e){return __async(this,null,(function*(){const t={},i=Object.keys(IfcElements2).map((e=>parseInt(e)));for(let s=0;s<i.length;s++){const r=i[s],o=yield this.api.GetLineIDsWithType(e,r),a=o.size();for(let e=0;e<a;e++)t[o.get(e)]=r}this.types=t}))}};WebIFCWasm="undefined"!=typeof self&&self.crossOriginIsolated?require_web_ifc_mt():require_web_ifc();var IfcAPI2=class{constructor(){this.wasmModule=void 0,this.fs=void 0,this.wasmPath="",this.ifcGuidMap=new Map,this.properties=new Properties(this)}Init(e){return __async(this,null,(function*(){if(WebIFCWasm){let t=(e,t)=>e.endsWith(".wasm")?t+this.wasmPath+e:t+e;this.wasmModule=yield WebIFCWasm({noInitialRun:!0,locateFile:e||t}),this.fs=this.wasmModule.FS}else console.error("Could not find wasm module at './web-ifc' from web-ifc-api.ts")}))}OpenModel(e,t){let i=__spreadValues({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},t),s=0;return this.wasmModule.OpenModel(i,((t,i)=>{let r=Math.min(e.byteLength-s,i),o=this.wasmModule.HEAPU8.subarray(t,t+i),a=e.subarray(s,s+r);return o.set(a),s+=r,r}))}CreateModel(e){let t=__spreadValues({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},e);return this.wasmModule.CreateModel(t)}ExportFileAsIFC(e){this.wasmModule.ExportFileAsIFC(e);let t=this.fs.readFile("/export.ifc");return this.wasmModule.FS_unlink("/export.ifc"),t}GetGeometry(e,t){return this.wasmModule.GetGeometry(e,t)}GetLine(e,t,i=!1){let s=this.GetRawLineData(e,t),r=FromRawLineData[s.type](s);return i&&this.FlattenLine(e,r),r}GetAndClearErrors(e){return this.wasmModule.GetAndClearErrors(e)}WriteLine(e,t){Object.keys(t).forEach((i=>{let s=t[i];if(s&&void 0!==s.expressID)this.WriteLine(e,s),t[i]={type:5,value:s.expressID};else if(Array.isArray(s)&&s.length>0)for(let r=0;r<s.length;r++)void 0!==s[r].expressID&&(this.WriteLine(e,s[r]),t[i][r]={type:5,value:s[r].expressID})}));let i={ID:t.expressID,type:t.type,arguments:t.ToTape()};this.WriteRawLineData(e,i)}FlattenLine(e,t){Object.keys(t).forEach((i=>{let s=t[i];if(s&&5===s.type)t[i]=this.GetLine(e,s.value,!0);else if(Array.isArray(s)&&s.length>0&&5===s[0].type)for(let r=0;r<s.length;r++)t[i][r]=this.GetLine(e,s[r].value,!0)}))}GetRawLineData(e,t){return this.wasmModule.GetLine(e,t)}WriteRawLineData(e,t){return this.wasmModule.WriteLine(e,t.ID,t.type,t.arguments)}GetLineIDsWithType(e,t){return this.wasmModule.GetLineIDsWithType(e,t)}GetAllLines(e){return this.wasmModule.GetAllLines(e)}SetGeometryTransformation(e,t){16==t.length?this.wasmModule.SetGeometryTransformation(e,t):console.log(`Bad transformation matrix size: ${t.length}`)}GetCoordinationMatrix(e){return this.wasmModule.GetCoordinationMatrix(e)}GetVertexArray(e,t){return this.getSubArray(this.wasmModule.HEAPF32,e,t)}GetIndexArray(e,t){return this.getSubArray(this.wasmModule.HEAPU32,e,t)}getSubArray(e,t,i){return e.subarray(t/4,t/4+i).slice(0)}CloseModel(e){this.ifcGuidMap.delete(e),this.wasmModule.CloseModel(e)}StreamAllMeshes(e,t){this.wasmModule.StreamAllMeshes(e,t)}StreamAllMeshesWithTypes(e,t,i){this.wasmModule.StreamAllMeshesWithTypes(e,t,i)}IsModelOpen(e){return this.wasmModule.IsModelOpen(e)}LoadAllGeometry(e){return this.wasmModule.LoadAllGeometry(e)}GetFlatMesh(e,t){return this.wasmModule.GetFlatMesh(e,t)}CreateIfcGuidToExpressIdMapping(e){const t=new Map;for(let i=0;i<IfcElements.length;i++){const s=IfcElements[i],r=this.GetLineIDsWithType(e,s),o=r.size();for(let i=0;i<o;i++){const s=r.get(i),o=this.GetLine(e,s).GlobalId.value;t.set(s,o),t.set(o,s)}}this.ifcGuidMap.set(e,t)}SetWasmPath(e){this.wasmPath=e}};class WebIFCDefaultDataSource{constructor(){}getIFC(e,t,i){var s=()=>{};t=t||s,i=i||s;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),i=new Uint8Array(e);for(var a=0;a<o.length;a++)i[a]=o.charCodeAt(a);t(e)}catch(e){i(e)}}else{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i("getXKT error : "+s.response))},s.send(null)}}}class LocaleService{constructor(e={}){this._eventSubIDMap=null,this._eventSubEvents=null,this._eventSubs=null,this._events=null,this._locale="en",this._messages={},this._locales=[],this._locale="en",this.messages=e.messages,this.locale=e.locale}set messages(e){this._messages=e||{},this._locales=Object.keys(this._messages),this.fire("updated",this)}loadMessages(e={}){for(let t in e)this._messages[t]=e[t];this.messages=this._messages}clearMessages(){this.messages={}}get locales(){return this._locales}set locale(e){e=e||"de",this._locale!==e&&(this._locale=e,this.fire("updated",e))}get locale(){return this._locale}translate(e,t){const i=this._messages[this._locale];if(!i)return null;const s=resolvePath$1(e,i);return s?t?vsprintf(s,t):s:null}translatePlurals(e,t,i){const s=this._messages[this._locale];if(!s)return null;let r=resolvePath$1(e,s);return r=0===(t=parseInt(""+t,10))?r.zero:t>1?r.other:r.one,r?(r=vsprintf(r,[t]),i&&(r=vsprintf(r,i)),r):null}fire(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={}),!0!==i&&(this._events[e]=t||!0);const s=this._eventSubs[e];if(s)for(const e in s)if(s.hasOwnProperty(e)){s[e].callback(t)}}on(e,t){this._events||(this._events={}),this._eventSubIDMap||(this._eventSubIDMap=new Map$1),this._eventSubEvents||(this._eventSubEvents={}),this._eventSubs||(this._eventSubs={});let i=this._eventSubs[e];i||(i={},this._eventSubs[e]=i);const s=this._eventSubIDMap.addItem();i[s]={callback:t},this._eventSubEvents[s]=e;const r=this._events[e];return void 0!==r&&t(r),s}off(e){if(null==e)return;if(!this._eventSubEvents)return;const t=this._eventSubEvents[e];if(t){delete this._eventSubEvents[e];const i=this._eventSubs[t];i&&delete i[e],this._eventSubIDMap.removeItem(e)}}}function resolvePath$1(e,t){if(t[e])return t[e];const i=e.split(".");let s=t;for(let e=0,t=i.length;s&&e<t;e++){s=s[i[e]]}return s}function vsprintf(e,t=[]){return e.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(e,i){return"{{"===e?"{":"}}"===e?"}":t[i]}))}class Curve extends Component{constructor(e,t={}){super(e,t),this.t=t.t}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get tangent(){return this.getTangent(this._t)}get length(){var e=this._getLengths();return e[e.length-1]}getTangent(e){var t=1e-4;void 0===e&&(e=this._t);var i=e-t,s=e+t;i<0&&(i=0),s>1&&(s=1);var r=this.getPoint(i),o=this.getPoint(s),a=math.subVec3(o,r,[]);return math.normalizeVec3(a,[])}getPointAt(e){var t=this.getUToTMapping(e);return this.getPoint(t)}getPoints(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i}_getLengths(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,s=[],r=this.getPoint(0),o=0;for(s.push(0),i=1;i<=e;i++)t=this.getPoint(i/e),o+=math.lenVec3(math.subVec3(t,r,[])),s.push(o),r=t;return this.cacheArcLengths=s,s}_updateArcLengths(){this.needsUpdate=!0,this._getLengths()}getUToTMapping(e,t){var i,s=this._getLengths(),r=0,o=s.length;i=t||e*s[o-1];for(var a,n=0,h=o-1;n<=h;)if((a=s[r=Math.floor(n+(h-n)/2)]-i)<0)n=r+1;else{if(!(a>0)){h=r;break}h=r-1}if(s[r=h]===i)return r/(o-1);var l=s[r];return(r+(i-l)/(s[r+1]-l))/(o-1)}}class SplineCurve extends Curve{constructor(e,t={}){super(e,t),this.points=t.points,this.t=t.t}set points(e){this._points=e||[]}get points(){return this._points}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=this.points;if(!(t.length<3)){var i=(t.length-1)*e,s=Math.floor(i),r=i-s,o=t[0===s?s:s-1],a=t[s],n=t[s>t.length-2?t.length-1:s+1],h=t[s>t.length-3?t.length-1:s+2],l=math.vec3();return l[0]=math.catmullRomInterpolate(o[0],a[0],n[0],h[0],r),l[1]=math.catmullRomInterpolate(o[1],a[1],n[1],h[1],r),l[2]=math.catmullRomInterpolate(o[2],a[2],n[2],h[2],r),l}this.error("Can't sample point from SplineCurve - not enough points on curve - returning [0,0,0].")}getJSON(){return{points:points,t:this._t}}}const tempVec3a$4=math.vec3();class CameraPath extends Component{get type(){return"CameraPath"}constructor(e,t={}){super(e,t),this._frames=[],this._eyeCurve=new SplineCurve(this),this._lookCurve=new SplineCurve(this),this._upCurve=new SplineCurve(this),t.frames&&(this.addFrames(t.frames),this.smoothFrameTimes(1))}get frames(){return this._frames}get eyeCurve(){return this._eyeCurve}get lookCurve(){return this._lookCurve}get upCurve(){return this._upCurve}saveFrame(e){const t=this.scene.camera;this.addFrame(e,t.eye,t.look,t.up)}addFrame(e,t,i,s){const r={t:e,eye:t.slice(0),look:i.slice(0),up:s.slice(0)};this._frames.push(r),this._eyeCurve.points.push(r.eye),this._lookCurve.points.push(r.look),this._upCurve.points.push(r.up)}addFrames(e){let t;for(let i=0,s=e.length;i<s;i++)t=e[i],this.addFrame(t.t||0,t.eye,t.look,t.up)}loadFrame(e){const t=this.scene.camera;e=(e/=this._frames[this._frames.length-1].t-this._frames[0].t)<0?0:e>1?1:e,t.eye=this._eyeCurve.getPoint(e,tempVec3a$4),t.look=this._lookCurve.getPoint(e,tempVec3a$4),t.up=this._upCurve.getPoint(e,tempVec3a$4)}sampleFrame(e,t,i,s){e=e<0?0:e>1?1:e,this._eyeCurve.getPoint(e,t),this._lookCurve.getPoint(e,i),this._upCurve.getPoint(e,s)}smoothFrameTimes(e){if(0===this._frames.length)return;const t=math.vec3();var i=0;this._frames[0].t=0;const s=[];for(let e=1,o=this._frames.length;e<o;e++){var r=math.lenVec3(math.subVec3(this._frames[e].eye,this._frames[e-1].eye,t));s[e]=r,i+=r}for(let t=1,r=this._frames.length;t<r;t++){const r=s[t]/i*e;this._frames[t].t=this._frames[t-1].t+r}}clearFrames(){this._frames=[],this._eyeCurve.points=[],this._lookCurve.points=[],this._upCurve.points=[]}}const tempVec3$2=math.vec3(),newLook=math.vec3(),newEye=math.vec3(),newUp=math.vec3(),newLookEyeVec=math.vec3();class CameraFlightAnimation extends Component{get type(){return"CameraFlightAnimation"}constructor(e,t={}){super(e,t),this._look1=math.vec3(),this._eye1=math.vec3(),this._up1=math.vec3(),this._look2=math.vec3(),this._eye2=math.vec3(),this._up2=math.vec3(),this._orthoScale1=1,this._orthoScale2=1,this._flying=!1,this._flyEyeLookUp=!1,this._flyingEye=!1,this._flyingLook=!1,this._callback=null,this._callbackScope=null,this._time1=null,this._time2=null,this.easing=!1!==t.easing,this.duration=t.duration,this.fit=t.fit,this.fitFOV=t.fitFOV,this.trail=t.trail}flyTo(e,t,i){e=e||this.scene,this._flying&&this.stop(),this._flying=!1,this._flyingEye=!1,this._flyingLook=!1,this._flyingEyeLookUp=!1,this._callback=t,this._callbackScope=i;const s=this.scene.camera,r=!!e.projection&&e.projection!==s.projection;let o,a,n,h,l;if(this._eye1[0]=s.eye[0],this._eye1[1]=s.eye[1],this._eye1[2]=s.eye[2],this._look1[0]=s.look[0],this._look1[1]=s.look[1],this._look1[2]=s.look[2],this._up1[0]=s.up[0],this._up1[1]=s.up[1],this._up1[2]=s.up[2],this._orthoScale1=s.ortho.scale,this._orthoScale2=e.orthoScale||this._orthoScale1,e.aabb)o=e.aabb;else if(6===e.length)o=e;else if(e.eye&&e.look||e.up)a=e.eye,n=e.look,h=e.up;else if(e.eye)a=e.eye;else if(e.look)n=e.look;else{let s=e;if((utils.isNumeric(s)||utils.isString(s))&&(l=s,s=this.scene.components[l],!s))return this.error("Component not found: "+utils.inQuotes(l)),void(t&&(i?t.call(i):t()));r||(o=s.aabb||this.scene.aabb)}const c=e.poi;if(o){if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])return;if(o[3]===o[0]&&o[4]===o[1]&&o[5]===o[2])return;o=o.slice();const t=math.getAABB3Center(o);this._look2=c||t;const i=math.subVec3(this._eye1,this._look1,tempVec3$2),s=math.normalizeVec3(i),r=c?math.getAABB3DiagPoint(o,c):math.getAABB3Diag(o),a=e.fitFOV||this._fitFOV,n=Math.abs(r/Math.tan(a*math.DEGTORAD));this._orthoScale2=1.1*r,this._eye2[0]=this._look2[0]+s[0]*n,this._eye2[1]=this._look2[1]+s[1]*n,this._eye2[2]=this._look2[2]+s[2]*n,this._up2[0]=this._up1[0],this._up2[1]=this._up1[1],this._up2[2]=this._up1[2],this._flyingEyeLookUp=!0}else(a||n||h)&&(this._flyingEyeLookUp=!!a&&!!n&&!!h,this._flyingEye=!!a&&!n,this._flyingLook=!!n&&!a,a&&(this._eye2[0]=a[0],this._eye2[1]=a[1],this._eye2[2]=a[2]),n&&(this._look2[0]=n[0],this._look2[1]=n[1],this._look2[2]=n[2]),h&&(this._up2[0]=h[0],this._up2[1]=h[1],this._up2[2]=h[2]));r?("ortho"===e.projection&&"ortho"!==s.projection&&(this._projection2="ortho",this._projMatrix1=s.projMatrix.slice(),this._projMatrix2=s.ortho.matrix.slice(),s.projection="customProjection"),"perspective"===e.projection&&"perspective"!==s.projection&&(this._projection2="perspective",this._projMatrix1=s.projMatrix.slice(),this._projMatrix2=s.perspective.matrix.slice(),s.projection="customProjection")):this._projection2=null,this.fire("started",e,!0),this._time1=Date.now(),this._time2=this._time1+(e.duration?1e3*e.duration:this._duration),this._flying=!0,core.scheduleTask(this._update,this)}jumpTo(e){this._jumpTo(e)}_jumpTo(e){this._flying&&this.stop();const t=this.scene.camera;var i,s,r,o,a;if(e.aabb)i=e.aabb;else if(6===e.length)i=e;else if(e.eye||e.look||e.up)r=e.eye,o=e.look,a=e.up;else{let t=e;if((utils.isNumeric(t)||utils.isString(t))&&(s=t,t=this.scene.components[s],!t))return void this.error("Component not found: "+utils.inQuotes(s));i=t.aabb||this.scene.aabb}const n=e.poi;if(i){if(i[3]<=i[0]||i[4]<=i[1]||i[5]<=i[2])return;var h=n?math.getAABB3DiagPoint(i,n):math.getAABB3Diag(i);let s;o=n||math.getAABB3Center(i,o),this._trail?math.subVec3(t.look,o,newLookEyeVec):math.subVec3(t.eye,t.look,newLookEyeVec),math.normalizeVec3(newLookEyeVec);s=(void 0!==e.fit?e.fit:this._fit)?Math.abs(h/Math.tan((e.fitFOV||this._fitFOV)*math.DEGTORAD)):math.lenVec3(math.subVec3(t.eye,t.look,tempVec3$2)),math.mulVec3Scalar(newLookEyeVec,s),t.eye=math.addVec3(o,newLookEyeVec,tempVec3$2),t.look=o,this.scene.camera.ortho.scale=1.1*h}else(r||o||a)&&(r&&(t.eye=r),o&&(t.look=o),a&&(t.up=a));e.projection&&(t.projection=e.projection)}_update(){if(!this._flying)return;let e=(Date.now()-this._time1)/(this._time2-this._time1);const t=e>=1;e>1&&(e=1);const i=this.easing?CameraFlightAnimation._ease(e,0,1,1):e,s=this.scene.camera;if(this._flyingEye||this._flyingLook?this._flyingEye?(math.subVec3(s.eye,s.look,newLookEyeVec),s.eye=math.lerpVec3(i,0,1,this._eye1,this._eye2,newEye),s.look=math.subVec3(newEye,newLookEyeVec,newLook)):this._flyingLook&&(s.look=math.lerpVec3(i,0,1,this._look1,this._look2,newLook),s.up=math.lerpVec3(i,0,1,this._up1,this._up2,newUp)):this._flyingEyeLookUp&&(s.eye=math.lerpVec3(i,0,1,this._eye1,this._eye2,newEye),s.look=math.lerpVec3(i,0,1,this._look1,this._look2,newLook),s.up=math.lerpVec3(i,0,1,this._up1,this._up2,newUp)),this._projection2){const t="ortho"===this._projection2?CameraFlightAnimation._easeOutExpo(e,0,1,1):CameraFlightAnimation._easeInCubic(e,0,1,1);s.customProjection.matrix=math.lerpMat4(t,0,1,this._projMatrix1,this._projMatrix2)}else s.ortho.scale=this._orthoScale1+e*(this._orthoScale2-this._orthoScale1);if(t)return s.ortho.scale=this._orthoScale2,void this.stop();core.scheduleTask(this._update,this)}static _ease(e,t,i,s){return-i*(e/=s)*(e-2)+t}static _easeInCubic(e,t,i,s){return i*(e/=s)*e*e+t}static _easeOutExpo(e,t,i,s){return i*(1-Math.pow(2,-10*e/s))+t}stop(){if(!this._flying)return;this._flying=!1,this._time1=null,this._time2=null,this._projection2&&(this.scene.camera.projection=this._projection2);const e=this._callback;e&&(this._callback=null,this._callbackScope?e.call(this._callbackScope):e()),this.fire("stopped",!0,!0)}cancel(){this._flying&&(this._flying=!1,this._time1=null,this._time2=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}set duration(e){this._duration=e?1e3*e:500,this.stop()}get duration(){return this._duration/1e3}set fit(e){this._fit=!1!==e}get fit(){return this._fit}set fitFOV(e){this._fitFOV=e||45}get fitFOV(){return this._fitFOV}set trail(e){this._trail=!!e}get trail(){return this._trail}destroy(){this.stop(),super.destroy()}}class CameraPathAnimation extends Component{get type(){return"CameraPathAnimation"}constructor(e,t={}){super(e,t),this._cameraFlightAnimation=new CameraFlightAnimation(this),this._t=0,this.state=CameraPathAnimation.SCRUBBING,this._playingFromT=0,this._playingToT=0,this._playingRate=t.playingRate||1,this._playingDir=1,this._lastTime=null,this.cameraPath=t.cameraPath,this._tick=this.scene.on("tick",this._updateT,this)}_updateT(){const e=this._cameraPath;if(!e)return;let t,i;const s=performance.now(),r=this._lastTime?.001*(s-this._lastTime):0;if(this._lastTime=s,0!==r)switch(this.state){case CameraPathAnimation.SCRUBBING:return;case CameraPathAnimation.PLAYING:if(this._t+=this._playingRate*r,t=this._cameraPath.frames.length,0===t||this._playingDir<0&&this._t<=0||this._playingDir>0&&this._t>=this._cameraPath.frames[t-1].t)return this.state=CameraPathAnimation.SCRUBBING,this._t=this._cameraPath.frames[t-1].t,void this.fire("stopped");e.loadFrame(this._t);break;case CameraPathAnimation.PLAYING_TO:i=this._t+this._playingRate*r*this._playingDir,(this._playingDir<0&&i<=this._playingToT||this._playingDir>0&&i>=this._playingToT)&&(i=this._playingToT,this.state=CameraPathAnimation.SCRUBBING,this.fire("stopped")),this._t=i,e.loadFrame(this._t)}}_ease(e,t,i,s){return-i*(e/=s)*(e-2)+t}set cameraPath(e){this._cameraPath=e}get cameraPath(){return this._cameraPath}set rate(e){this._playingRate=e}get rate(){return this._playingRate}play(){this._cameraPath&&(this._lastTime=null,this.state=CameraPathAnimation.PLAYING)}playToT(e){this._cameraPath&&(this._playingFromT=this._t,this._playingToT=e,this._playingDir=this._playingToT-this._playingFromT<0?-1:1,this._lastTime=null,this.state=CameraPathAnimation.PLAYING_TO)}playToFrame(e){const t=this._cameraPath;if(!t)return;const i=t.frames[e];i?this.playToT(i.t):this.error("playToFrame - frame index out of range: "+e)}flyToFrame(e,t){const i=this._cameraPath;if(!i)return;const s=i.frames[e];s?(this.state=CameraPathAnimation.SCRUBBING,this._cameraFlightAnimation.flyTo(s,t)):this.error("flyToFrame - frame index out of range: "+e)}scrubToT(e){const t=this._cameraPath;if(!t)return;this.scene.camera&&(this._t=e,t.loadFrame(this._t),this.state=CameraPathAnimation.SCRUBBING)}scrubToFrame(e){const t=this._cameraPath;if(!t)return;if(!this.scene.camera)return;t.frames[e]?(t.loadFrame(this._t),this.state=CameraPathAnimation.SCRUBBING):this.error("playToFrame - frame index out of range: "+e)}stop(){this.state=CameraPathAnimation.SCRUBBING,this.fire("stopped")}destroy(){super.destroy(),this.scene.off(this._tick)}}CameraPathAnimation.STOPPED=0,CameraPathAnimation.SCRUBBING=1,CameraPathAnimation.PLAYING=2,CameraPathAnimation.PLAYING_TO=3;var K3D={};function load3DSGeometry(e,t={}){return new Promise((function(i,s){t.src||(console.error("load3DSGeometry: Parameter expected: src"),s());var r=e.canvas.spinner;r.processes++,utils.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("load3DSGeometry: no data loaded"),r.processes--,s());var o=K3D.parse.from3DS(e).edit.objects[0].mesh,a=o.vertices,n=o.uvt,h=o.indices;r.processes--,i(utils.apply(t,{primitive:"triangles",positions:a,normals:null,uv:n,indices:h}))}),(function(e){console.error("load3DSGeometry: "+e),r.processes--,s()}))}))}function loadOBJGeometry(e,t={}){return new Promise((function(i,s){t.src||(console.error("loadOBJGeometry: Parameter expected: src"),s());var r=e.canvas.spinner;r.processes++,utils.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("loadOBJGeometry: no data loaded"),r.processes--,s());for(var o=K3D.parse.fromOBJ(e),a=K3D.edit.unwrap(o.i_verts,o.c_verts,3),n=K3D.edit.unwrap(o.i_norms,o.c_norms,3),h=K3D.edit.unwrap(o.i_uvt,o.c_uvt,2),l=new Int32Array(o.i_verts.length),c=0;c<o.i_verts.length;c++)l[c]=c;r.processes--,i(utils.apply(t,{primitive:"triangles",positions:a,normals:n.length>0?n:null,autoNormals:0===n.length,uv:h,indices:l}))}),(function(e){console.error("loadOBJGeometry: "+e),r.processes--,s()}))}))}function buildBoxLinesGeometry(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let i=e.ySize||1;i<0&&(console.error("negative ySize not allowed - will invert"),i*=-1);let s=e.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);const r=e.center,o=r?r[0]:0,a=r?r[1]:0,n=r?r[2]:0,h=-t+o,l=-i+a,c=-s+n,u=t+o,p=i+a,d=s+n;return utils.apply(e,{primitive:"lines",positions:[h,l,c,h,l,d,h,p,c,h,p,d,u,l,c,u,l,d,u,p,c,u,p,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})}function buildGridGeometry(e={}){let t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);let i=e.divisions||1;i<0&&(console.error("negative divisions not allowed - will invert"),i*=-1),i<1&&(i=1),t=t||10,i=i||10;const s=t/i,r=t/2,o=[],a=[];let n=0;for(let e=0,t=-r;e<=i;e++,t+=s)o.push(-r),o.push(0),o.push(t),o.push(r),o.push(0),o.push(t),o.push(t),o.push(0),o.push(-r),o.push(t),o.push(0),o.push(r),a.push(n++),a.push(n++),a.push(n++),a.push(n++);return utils.apply(e,{primitive:"lines",positions:o,indices:a})}function buildPlaneGeometry(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);let s=e.xSegments||1;s<0&&(console.error("negative xSegments not allowed - will invert"),s*=-1),s<1&&(s=1);let r=e.xSegments||1;r<0&&(console.error("negative zSegments not allowed - will invert"),r*=-1),r<1&&(r=1);const o=e.center,a=o?o[0]:0,n=o?o[1]:0,h=o?o[2]:0,l=t/2,c=i/2,u=Math.floor(s)||1,p=Math.floor(r)||1,d=u+1,m=p+1,f=t/u,g=i/p,_=new Float32Array(d*m*3),y=new Float32Array(d*m*3),T=new Float32Array(d*m*2);let v,I,E,P,b,D,w,C=0,R=0;for(v=0;v<m;v++){const e=v*g-c;for(I=0;I<d;I++)E=I*f-l,_[C]=E+a,_[C+1]=n,_[C+2]=-e+h,y[C+2]=-1,T[R]=I/u,T[R+1]=(p-v)/p,C+=3,R+=2}C=0;const F=new(_.length/3>65535?Uint32Array:Uint16Array)(u*p*6);for(v=0;v<p;v++)for(I=0;I<u;I++)P=I+d*v,b=I+d*(v+1),D=I+1+d*(v+1),w=I+1+d*v,F[C]=w,F[C+1]=b,F[C+2]=P,F[C+3]=w,F[C+4]=D,F[C+5]=b,C+=6;return utils.apply(e,{positions:_,normals:y,uv:T,indices:F})}K3D.load=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){t(e.target.response)},i.send()},K3D.save=function(e,t){var i="data:application/octet-stream;base64,"+btoa(K3D.parse._buffToStr(e));window.location.href=i},K3D.clone=function(e){return JSON.parse(JSON.stringify(e))},K3D.bin={},K3D.bin.f=new Float32Array(1),K3D.bin.fb=new Uint8Array(K3D.bin.f.buffer),K3D.bin.rf=function(e,t){for(var i=K3D.bin.f,s=K3D.bin.fb,r=0;r<4;r++)s[r]=e[t+r];return i[0]},K3D.bin.rsl=function(e,t){return e[t]|e[t+1]<<8},K3D.bin.ril=function(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},K3D.bin.rASCII0=function(e,t){for(var i="";0!=e[t];)i+=String.fromCharCode(e[t++]);return i},K3D.bin.wf=function(e,t,i){new Float32Array(e.buffer,t,1)[0]=i},K3D.bin.wsl=function(e,t,i){e[t]=i,e[t+1]=i>>8},K3D.bin.wil=function(e,t,i){e[t]=i,e[t+1]=i>>8,e[t+2]=i>>16,e[t+3]},K3D.parse={},K3D.parse._buffToStr=function(e){for(var t=new Uint8Array(e),i="",s=0;s<t.length;s++)i=i.concat(String.fromCharCode(t[s]));return i},K3D.parse._strToBuff=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return t},K3D.parse._readLine=function(e,t){for(var i="";10!=e[t];)i+=String.fromCharCode(e[t++]);return i},K3D.parse.fromJSON=function(e){return JSON.parse(K3D.parse._buffToStr(e))},K3D.parse.toJSON=function(e){var t=JSON.stringify(e);return K3D.parse._strToBuff(t)},K3D.parse.fromOBJ=function(e){for(var t={groups:{},c_verts:[],c_uvt:[],c_norms:[],i_verts:[],i_uvt:[],i_norms:[]},i={from:0,to:0},s=0,r=new Uint8Array(e);s<r.length;){var o=K3D.parse._readLine(r,s);s+=o.length+1;var a=(o=(o=o.replace(/ +(?= )/g,"")).replace(/(^\s+|\s+$)/g,"")).split(" ");if("g"==a[0]&&(i.to=t.i_verts.length,null==t.groups[a[1]]&&(t.groups[a[1]]={from:t.i_verts.length,to:0}),i=t.groups[a[1]]),"v"==a[0]){var n=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);t.c_verts.push(n,h,l)}if("vt"==a[0]){n=parseFloat(a[1]),h=1-parseFloat(a[2]);t.c_uvt.push(n,h)}if("vn"==a[0]){n=parseFloat(a[1]),h=parseFloat(a[2]),l=parseFloat(a[3]);t.c_norms.push(n,h,l)}if("f"==a[0]){var c=a[1].split("/"),u=a[2].split("/"),p=a[3].split("/"),d=parseInt(c[0])-1,m=parseInt(u[0])-1,f=parseInt(p[0])-1,g=parseInt(c[1])-1,_=parseInt(u[1])-1,y=parseInt(p[1])-1,T=parseInt(c[2])-1,v=parseInt(u[2])-1,I=parseInt(p[2])-1,E=t.c_verts.length/3,P=t.c_uvt.length/2,b=t.c_norms.length/3;if(d<0&&(d=E+d+1),m<0&&(m=E+m+1),f<0&&(f=E+f+1),g<0&&(g=P+g+1),_<0&&(_=P+_+1),y<0&&(y=P+y+1),T<0&&(T=b+T+1),v<0&&(v=b+v+1),I<0&&(I=b+I+1),t.i_verts.push(d,m,f),t.i_uvt.push(g,_,y),t.i_norms.push(T,v,I),5==a.length){var D=a[4].split("/"),w=parseInt(D[0])-1,C=parseInt(D[1])-1,R=parseInt(D[2])-1;w<0&&(w=E+w+1),C<0&&(C=P+C+1),R<0&&(R=b+R+1),t.i_verts.push(d,f,w),t.i_uvt.push(g,y,C),t.i_norms.push(T,I,R)}}}return i.to=t.i_verts.length,t},K3D.parse.fromMD2=function(e){e=new Uint8Array(e);var t={},i={};i.ident=K3D.bin.ril(e,0),i.version=K3D.bin.ril(e,4),i.skinwidth=K3D.bin.ril(e,8),i.skinheight=K3D.bin.ril(e,12),i.framesize=K3D.bin.ril(e,16),i.num_skins=K3D.bin.ril(e,20),i.num_vertices=K3D.bin.ril(e,24),i.num_st=K3D.bin.ril(e,28),i.num_tris=K3D.bin.ril(e,32),i.num_glcmds=K3D.bin.ril(e,36),i.num_frames=K3D.bin.ril(e,40),i.offset_skins=K3D.bin.ril(e,44),i.offset_st=K3D.bin.ril(e,48),i.offset_tris=K3D.bin.ril(e,52),i.offset_frames=K3D.bin.ril(e,56),i.offset_glcmds=K3D.bin.ril(e,60),i.offset_end=K3D.bin.ril(e,64);var s=i.offset_st;t.c_uvt=[];for(var r=0;r<i.num_st;r++){var o=K3D.bin.rsl(e,s)/i.skinwidth,a=K3D.bin.rsl(e,s+2)/i.skinheight;t.c_uvt.push(o,a),s+=4}s=i.offset_tris;var n=[],h=[];t.i_verts=n,t.i_uvt=h;for(r=0;r<i.num_tris;r++)n.push(K3D.bin.rsl(e,s),K3D.bin.rsl(e,s+2),K3D.bin.rsl(e,s+4)),h.push(K3D.bin.rsl(e,s+6),K3D.bin.rsl(e,s+8),K3D.bin.rsl(e,s+10)),s+=12;s=i.offset_skins;t.skins=[];for(r=0;r<i.num_skins;r++)t.skins.push(K3D.bin.rASCII0(e,s)),s+=64;s=i.offset_frames;t.frames=[];var l=K3D.parse.fromMD2._normals;for(r=0;r<i.num_frames;r++){var c={},u=K3D.bin.rf(e,s),p=K3D.bin.rf(e,s+4),d=K3D.bin.rf(e,s+8);s+=12;var m=K3D.bin.rf(e,s),f=K3D.bin.rf(e,s+4),g=K3D.bin.rf(e,s+8);s+=12,c.name=K3D.bin.rASCII0(e,s),s+=16,c.verts=[],c.norms=[];for(var _=0;_<i.num_vertices;_++)c.verts.push(e[s]*u+m,e[s+1]*p+f,e[s+2]*d+g),c.norms.push(l[3*e[s+3]],l[3*e[s+3]+1],l[3*e[s+3]+2]),s+=4;t.frames.push(c)}return t},K3D.parse.fromMD2._normals=[-.525731,0,.850651,-.442863,.238856,.864188,-.295242,0,.955423,-.309017,.5,.809017,-.16246,.262866,.951056,0,0,1,0,.850651,.525731,-.147621,.716567,.681718,.147621,.716567,.681718,0,.525731,.850651,.309017,.5,.809017,.525731,0,.850651,.295242,0,.955423,.442863,.238856,.864188,.16246,.262866,.951056,-.681718,.147621,.716567,-.809017,.309017,.5,-.587785,.425325,.688191,-.850651,.525731,0,-.864188,.442863,.238856,-.716567,.681718,.147621,-.688191,.587785,.425325,-.5,.809017,.309017,-.238856,.864188,.442863,-.425325,.688191,.587785,-.716567,.681718,-.147621,-.5,.809017,-.309017,-.525731,.850651,0,0,.850651,-.525731,-.238856,.864188,-.442863,0,.955423,-.295242,-.262866,.951056,-.16246,0,1,0,0,.955423,.295242,-.262866,.951056,.16246,.238856,.864188,.442863,.262866,.951056,.16246,.5,.809017,.309017,.238856,.864188,-.442863,.262866,.951056,-.16246,.5,.809017,-.309017,.850651,.525731,0,.716567,.681718,.147621,.716567,.681718,-.147621,.525731,.850651,0,.425325,.688191,.587785,.864188,.442863,.238856,.688191,.587785,.425325,.809017,.309017,.5,.681718,.147621,.716567,.587785,.425325,.688191,.955423,.295242,0,1,0,0,.951056,.16246,.262866,.850651,-.525731,0,.955423,-.295242,0,.864188,-.442863,.238856,.951056,-.16246,.262866,.809017,-.309017,.5,.681718,-.147621,.716567,.850651,0,.525731,.864188,.442863,-.238856,.809017,.309017,-.5,.951056,.16246,-.262866,.525731,0,-.850651,.681718,.147621,-.716567,.681718,-.147621,-.716567,.850651,0,-.525731,.809017,-.309017,-.5,.864188,-.442863,-.238856,.951056,-.16246,-.262866,.147621,.716567,-.681718,.309017,.5,-.809017,.425325,.688191,-.587785,.442863,.238856,-.864188,.587785,.425325,-.688191,.688191,.587785,-.425325,-.147621,.716567,-.681718,-.309017,.5,-.809017,0,.525731,-.850651,-.525731,0,-.850651,-.442863,.238856,-.864188,-.295242,0,-.955423,-.16246,.262866,-.951056,0,0,-1,.295242,0,-.955423,.16246,.262866,-.951056,-.442863,-.238856,-.864188,-.309017,-.5,-.809017,-.16246,-.262866,-.951056,0,-.850651,-.525731,-.147621,-.716567,-.681718,.147621,-.716567,-.681718,0,-.525731,-.850651,.309017,-.5,-.809017,.442863,-.238856,-.864188,.16246,-.262866,-.951056,.238856,-.864188,-.442863,.5,-.809017,-.309017,.425325,-.688191,-.587785,.716567,-.681718,-.147621,.688191,-.587785,-.425325,.587785,-.425325,-.688191,0,-.955423,-.295242,0,-1,0,.262866,-.951056,-.16246,0,-.850651,.525731,0,-.955423,.295242,.238856,-.864188,.442863,.262866,-.951056,.16246,.5,-.809017,.309017,.716567,-.681718,.147621,.525731,-.850651,0,-.238856,-.864188,-.442863,-.5,-.809017,-.309017,-.262866,-.951056,-.16246,-.850651,-.525731,0,-.716567,-.681718,-.147621,-.716567,-.681718,.147621,-.525731,-.850651,0,-.5,-.809017,.309017,-.238856,-.864188,.442863,-.262866,-.951056,.16246,-.864188,-.442863,.238856,-.809017,-.309017,.5,-.688191,-.587785,.425325,-.681718,-.147621,.716567,-.442863,-.238856,.864188,-.587785,-.425325,.688191,-.309017,-.5,.809017,-.147621,-.716567,.681718,-.425325,-.688191,.587785,-.16246,-.262866,.951056,.442863,-.238856,.864188,.16246,-.262866,.951056,.309017,-.5,.809017,.147621,-.716567,.681718,0,-.525731,.850651,.425325,-.688191,.587785,.587785,-.425325,.688191,.688191,-.587785,.425325,-.955423,.295242,0,-.951056,.16246,.262866,-1,0,0,-.850651,0,.525731,-.955423,-.295242,0,-.951056,-.16246,.262866,-.864188,.442863,-.238856,-.951056,.16246,-.262866,-.809017,.309017,-.5,-.864188,-.442863,-.238856,-.951056,-.16246,-.262866,-.809017,-.309017,-.5,-.681718,.147621,-.716567,-.681718,-.147621,-.716567,-.850651,0,-.525731,-.688191,.587785,-.425325,-.587785,.425325,-.688191,-.425325,.688191,-.587785,-.425325,-.688191,-.587785,-.587785,-.425325,-.688191,-.688191,-.587785,-.425325],K3D.parse.fromCollada=function(e){var t=K3D.parse._buffToStr(e),i=(new DOMParser).parseFromString(t,"text/xml"),s={},r=(i=i.childNodes[0]).getElementsByTagName("asset")[0],o=i.getElementsByTagName("library_geometries")[0],a=i.getElementsByTagName("library_images")[0],n=i.getElementsByTagName("library_materials")[0],h=i.getElementsByTagName("library_effects")[0];return r&&(s.asset=K3D.parse.fromCollada._asset(r)),o&&(s.geometries=K3D.parse.fromCollada._libGeometries(o)),a&&(s.images=K3D.parse.fromCollada._libImages(a)),n&&(s.materials=K3D.parse.fromCollada._libMaterials(n)),h&&(s.effects=K3D.parse.fromCollada._libEffects(h)),s},K3D.parse.fromCollada._asset=function(e){return{created:e.getElementsByTagName("created")[0].textContent,modified:e.getElementsByTagName("modified")[0].textContent,up_axis:e.getElementsByTagName("up_axis")[0].textContent}},K3D.parse.fromCollada._libGeometries=function(e){e=e.getElementsByTagName("geometry");for(var t=[],i=0;i<e.length;i++){var s=e[i],r=K3D.parse.fromCollada._getMesh(s.getElementsByTagName("mesh")[0]);t.push(r)}return t},K3D.parse.fromCollada._getMesh=function(e){for(var t={},i=e.getElementsByTagName("source"),s=t.sources={},r=0;r<i.length;r++){for(var o=i[r].getElementsByTagName("float_array")[0].textContent.split(" "),a=o.length-(""==o[o.length-1]?1:0),n=new Array(a),h=0;h<a;h++)n[h]=parseFloat(o[h]);s[i[r].getAttribute("id")]=n}t.triangles=[];var l=e.getElementsByTagName("triangles");if(null==l)return t;for(r=0;r<l.length;r++){var c={},u=l[r];c.material=u.getAttribute("material");var p=u.getElementsByTagName("input"),d=[];for(h=0;h<p.length;h++){var m=p[h];n=[];d[parseInt(m.getAttribute("offset"))]=n;var f=m.getAttribute("semantic");c["s_"+f]="VERTEX"==f?e.getElementsByTagName("vertices")[0].getElementsByTagName("input")[0].getAttribute("source").substring(1):m.getAttribute("source").substring(1),c["i_"+f]=n,s[c["s_"+f]]}var g=u.getElementsByTagName("p")[0].textContent.split(" "),_=3*Math.floor(g.length/3);for(h=0;h<_;h++)d[h%p.length].push(parseInt(g[h]));t.triangles.push(c)}return t},K3D.parse.fromCollada._libImages=function(e){e=e.getElementsByTagName("image");for(var t={},i=0;i<e.length;i++)t[e[i].getAttribute("id")]=e[i].getElementsByTagName("init_from")[0].textContent;return t},K3D.parse.fromCollada._libMaterials=function(e){e=e.getElementsByTagName("material");for(var t={},i=0;i<e.length;i++)t[e[i].getAttribute("name")]=e[i].getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1);return t},K3D.parse.fromCollada._libEffects=function(e){e=e.getElementsByTagName("effect");for(var t={},i=0;i<e.length;i++){for(var s={},r=e[i].getElementsByTagName("newparam"),o=0;o<r.length;o++){var a=r[o].getElementsByTagName("surface")[0];a&&(s.surface=a.getElementsByTagName("init_from")[0].textContent)}t[e[i].getAttribute("id")]=s}return t},K3D.parse.from3DS=function(e){e=new Uint8Array(e);var t={};if(19789!=K3D.bin.rsl(e,0))return null;for(var i=K3D.bin.ril(e,2),s=6;s<i;){var r=K3D.bin.rsl(e,s),o=K3D.bin.ril(e,s+2);15677==r&&(t.edit=K3D.parse.from3DS._edit3ds(e,s,o)),45056==r&&(t.keyf=K3D.parse.from3DS._keyf3ds(e,s,o)),s+=o}return t},K3D.parse.from3DS._edit3ds=function(e,t,i){for(var s={},r=t+6;r<t+i;){var o=K3D.bin.rsl(e,r),a=K3D.bin.ril(e,r+2);16384==o&&(null==s.objects&&(s.objects=[]),s.objects.push(K3D.parse.from3DS._edit_object(e,r,a))),r+=a}return s},K3D.parse.from3DS._keyf3ds=function(e,t,i){for(var s={},r=t+6;r<t+i;){var o=K3D.bin.rsl(e,r),a=K3D.bin.ril(e,r+2);45058==o&&(null==s.desc&&(s.desc=[]),s.desc.push(K3D.parse.from3DS._keyf_objdes(e,r,a))),r+=a}return s},K3D.parse.from3DS._keyf_objdes=function(e,t,i){for(var s={},r=t+6;r<t+i;){var o=K3D.bin.rsl(e,r),a=K3D.bin.ril(e,r+2);45072==o&&(s.hierarchy=K3D.parse.from3DS._keyf_objhierarch(e,r,a)),45073==o&&(s.dummy_name=K3D.bin.rASCII0(e,r+6)),r+=a}return s},K3D.parse.from3DS._keyf_objhierarch=function(e,t,i){var s={},r=t+6;return s.name=K3D.bin.rASCII0(e,r),r+=s.name.length+1,s.hierarchy=K3D.bin.rsl(e,r+4),s},K3D.parse.from3DS._edit_object=function(e,t,i){var s={},r=t+6;for(s.name=K3D.bin.rASCII0(e,r),r+=s.name.length+1;r<t+i;){var o=K3D.bin.rsl(e,r),a=K3D.bin.ril(e,r+2);16640==o&&(s.mesh=K3D.parse.from3DS._obj_trimesh(e,r,a)),r+=a}return s},K3D.parse.from3DS._obj_trimesh=function(e,t,i){for(var s={},r=t+6;r<t+i;){var o=K3D.bin.rsl(e,r),a=K3D.bin.ril(e,r+2);16656==o&&(s.vertices=K3D.parse.from3DS._tri_vertexl(e,r,a)),16672==o&&(s.indices=K3D.parse.from3DS._tri_facel1(e,r,a)),16704==o&&(s.uvt=K3D.parse.from3DS._tri_mappingcoors(e,r,a)),16736==o&&(s.local=K3D.parse.from3DS._tri_local(e,r,a)),r+=a}return s},K3D.parse.from3DS._tri_vertexl=function(e,t,i){var s=[],r=t+6,o=K3D.bin.rsl(e,r);r+=2;for(var a=0;a<o;a++)s.push(K3D.bin.rf(e,r)),s.push(K3D.bin.rf(e,r+4)),s.push(K3D.bin.rf(e,r+8)),r+=12;return s},K3D.parse.from3DS._tri_facel1=function(e,t,i){var s=[],r=t+6,o=K3D.bin.rsl(e,r);r+=2;for(var a=0;a<o;a++)s.push(K3D.bin.rsl(e,r)),s.push(K3D.bin.rsl(e,r+2)),s.push(K3D.bin.rsl(e,r+4)),r+=8;return s},K3D.parse.from3DS._tri_mappingcoors=function(e,t,i){var s=[],r=t+6,o=K3D.bin.rsl(e,r);r+=2;for(var a=0;a<o;a++)s.push(K3D.bin.rf(e,r)),s.push(1-K3D.bin.rf(e,r+4)),r+=8;return s},K3D.parse.from3DS._tri_local=function(e,t,i){var s={},r=t+6;return s.X=[K3D.bin.rf(e,r),K3D.bin.rf(e,r+4),K3D.bin.rf(e,r+8)],r+=12,s.Y=[K3D.bin.rf(e,r),K3D.bin.rf(e,r+4),K3D.bin.rf(e,r+8)],r+=12,s.Z=[K3D.bin.rf(e,r),K3D.bin.rf(e,r+4),K3D.bin.rf(e,r+8)],r+=12,s.C=[K3D.bin.rf(e,r),K3D.bin.rf(e,r+4),K3D.bin.rf(e,r+8)],r+=12,s},K3D.parse.fromBIV=function(e){e=new Uint8Array(e);var t={},i={};return i.id=K3D.bin.ril(e,0),i.verS=K3D.bin.ril(e,4),i.texS=K3D.bin.ril(e,8),i.indS=K3D.bin.ril(e,12),i.verO=K3D.bin.ril(e,16),i.verL=K3D.bin.ril(e,20),i.texO=K3D.bin.ril(e,24),i.texL=K3D.bin.ril(e,28),i.indO=K3D.bin.ril(e,32),i.indL=K3D.bin.ril(e,36),0!=i.verO&&(t.vertices=K3D.parse.fromBIV._readFloats(e,i.verO,i.verL)),0!=i.texO&&(t.uvt=K3D.parse.fromBIV._readFloats(e,i.texO,i.texL)),0!=i.indO&&(t.indices=K3D.parse.fromBIV._readInts(e,i.indO,i.indL,i.indS)),t},K3D.parse.toBIV=function(e){for(var t=0,i=0;i<e.indices.length;i++)t=Math.max(t,e.indices[i]);var s=32;t<=65535&&(s=16);var r=40;e.vertices&&(r+=4*e.vertices.length),e.uvt&&(r+=4*e.uvt.length),e.indices&&(r+=e.indices.length*s/8);var o=new Uint8Array(r);K3D.bin.wil(o,0,1769365870),K3D.bin.wil(o,4,32),K3D.bin.wil(o,8,32),K3D.bin.wil(o,12,s);var a=40;return e.vertices&&(K3D.bin.wil(o,16,a),K3D.bin.wil(o,20,4*e.vertices.length),K3D.parse.fromBIV._writeFloats(o,a,e.vertices),a+=4*e.vertices.length),e.uvt&&(K3D.bin.wil(o,24,a),K3D.bin.wil(o,28,4*e.uvt.length),K3D.parse.fromBIV._writeFloats(o,a,e.uvt),a+=4*e.uvt.length),e.indices&&(K3D.bin.wil(o,32,a),K3D.bin.wil(o,36,4*e.indices.length),K3D.parse.fromBIV._writeInts(o,a,e.indices,s)),o.buffer},K3D.parse.fromBIV._readFloats=function(e,t,i){for(var s=[],r=0;r<i/4;r++)s.push(K3D.bin.rf(e,t+4*r));return s},K3D.parse.fromBIV._writeFloats=function(e,t,i){for(var s=0;s<i.length;s++)K3D.bin.wf(e,t+4*s,i[s])},K3D.parse.fromBIV._readInts=function(e,t,i,s){for(var r=[],o=0;o<i/4;o++)16==s&&r.push(K3D.bin.rsl(e,t+2*o)),32==s&&r.push(K3D.bin.ril(e,t+4*o));return r},K3D.parse.fromBIV._writeInts=function(e,t,i,s){for(var r=0;r<i.length;r++)16==s&&K3D.bin.wsl(e,t+2*r,i[r]),32==s&&K3D.bin.wil(e,t+4*r,i[r])},K3D.gen={},K3D.gen.Plane=function(e,t,i,s){i||(i=1),s||(s=1);for(var r={verts:[],inds:[],uvt:[]},o=e+1,a=t+1,n=0;n<a;n++)for(var h=0;h<o;h++){var l=h*(2/e)-1,c=n*(2/t)-1;r.verts.push(l,c,0),r.uvt.push(i*h/e,s*n/t),n<t&&h<e&&r.inds.push(n*o+h,n*o+h+1,(n+1)*o+h,n*o+h+1,(n+1)*o+h,(n+1)*o+h+1)}return r},K3D.gen.Cube=function(){return{verts:[-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],inds:[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11,12,13,14,13,14,15,16,17,18,17,18,19,20,21,22,21,22,23],uvt:[1/4,1/4,.5,1/4,1/4,.5,.5,.5,1,1/4,3/4,1/4,1,.5,3/4,.5,0,1/4,1/4,1/4,0,.5,1/4,.5,3/4,1/4,.5,1/4,3/4,.5,.5,.5,1/4,1/4,.5,1/4,1/4,0,.5,0,1/4,.5,.5,.5,1/4,3/4,.5,3/4]}},K3D.gen.Sphere=function(e,t){for(var i={verts:[],inds:[],uvt:[]},s=e+1,r=t+1,o=0;o<r;o++)for(var a=0;a<s;a++){var n=-Math.PI/2+o*Math.PI/t,h=2*a*Math.PI/e,l=Math.cos(n)*Math.cos(h),c=Math.sin(n),u=Math.cos(n)*Math.sin(h);i.verts.push(l,c,u),i.uvt.push(a/e,o/t),o<t&&a<e&&i.inds.push(s*o+a,s*o+a+1,s*(o+1)+a,s*o+a+1,s*(o+1)+a,s*(o+1)+a+1)}return i},K3D.mat={},K3D.mat.scale=function(e,t,i){return[e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1]},K3D.mat.translate=function(e,t,i){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1]},K3D.mat.rotateDeg=function(e,t,i){var s=Math.PI/180;return K3D.mat.rotate(e*s,t*s,i*s)},K3D.mat.rotate=function(e,t,i){var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=e,o=t,a=i,n=Math.cos(r),h=Math.cos(o),l=Math.cos(a),c=Math.sin(r),u=Math.sin(o),p=Math.sin(a);return s[0]=h*l,s[1]=-h*p,s[2]=u,s[4]=n*p+c*u*l,s[5]=n*l-c*u*p,s[6]=-c*h,s[8]=c*p-n*u*l,s[9]=c*l+n*u*p,s[10]=n*h,s},K3D.edit={},K3D.edit.interpolate=function(e,t,i,s){for(var r=0;r<e.length;r++)i[r]=e[r]+s*(t[r]-e[r])},K3D.edit.transform=function(e,t){for(var i=0;i<e.length;i+=3){var s=e[i],r=e[i+1],o=e[i+2];e[i+0]=t[0]*s+t[4]*r+t[8]*o+t[12],e[i+1]=t[1]*s+t[5]*r+t[9]*o+t[13],e[i+2]=t[2]*s+t[6]*r+t[10]*o+t[14]}},K3D.edit.unwrap=function(e,t,i){for(var s=new Array(Math.floor(e.length/3)*i),r=0;r<e.length;r++)for(var o=0;o<i;o++)s[r*i+o]=t[e[r]*i+o];return s},K3D.edit.remap=function(e,t,i,s){for(var r=new Array(i.length),o=0;o<e.length;o++)for(var a=0;a<s;a++)r[t[o]*s+a]=i[e[o]*s+a];return r},K3D.utils={},K3D.utils.getAABB=function(e){var t,i,s,r,o,a;r=o=a=-(t=i=s=999999999);for(var n=0;n<e.length;n+=3){var h=e[n+0],l=e[n+1],c=e[n+2];h<t&&(t=h),h>r&&(r=h),l<i&&(i=l),l>o&&(o=l),c<s&&(s=c),l>a&&(a=c)}return{min:{x:t,y:i,z:s},max:{x:r,y:o,z:a}}};const tempVec3$1=math.vec3(),tempVec3b$4=math.vec3();math.vec3();const zeroVec=math.vec3([0,-1,0]),tempQuat=math.vec4([0,0,0,1]);class ImagePlane extends Component{constructor(e,t={}){super(e,t),this._src=null,this._image=null,this._pos=math.vec3(),this._origin=math.vec3(),this._rtcPos=math.vec3(),this._dir=math.vec3(),this._size=1,this._imageSize=math.vec2(),this._texture=new Texture(this),this._plane=new Mesh(this,{geometry:new ReadableGeometry(this,buildPlaneGeometry({center:[0,0,0],xSize:1,zSize:1,xSegments:10,zSegments:10})),material:new PhongMaterial(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:this._texture,emissiveMap:this._texture,backfaces:!0}),clippable:t.clippable}),this._grid=new Mesh(this,{geometry:new ReadableGeometry(this,buildGridGeometry({size:1,divisions:10})),material:new PhongMaterial(this,{diffuse:[0,0,0],ambient:[0,0,0],emissive:[.2,.8,.2]}),position:[0,.001,0],clippable:t.clippable}),this._node=new Node$1(this,{rotation:[0,0,0],position:[0,0,0],scale:[1,1,1],clippable:!1,children:[this._plane,this._grid]}),this._gridVisible=!1,this.visible=!0,this.gridVisible=t.gridVisible,this.position=t.position,this.rotation=t.rotation,this.dir=t.dir,this.size=t.size,this.collidable=t.collidable,this.clippable=t.clippable,this.pickable=t.pickable,this.opacity=t.opacity,t.image?this.image=t.image:this.src=t.src}set visible(e){this._plane.visible=e,this._grid.visible=this._gridVisible&&e}get visible(){return this._plane.visible}set gridVisible(e){e=!1!==e,this._gridVisible=e,this._grid.visible=this._gridVisible&&this.visible}get gridVisible(){return this._gridVisible}set image(e){this._image=e,this._image&&(this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(e){if(this._src=e,this._src){this._image=null;const e=new Image;e.onload=()=>{this._texture.image=e,this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage()},e.src=this._src}}get src(){return this._src}set position(e){this._pos.set(e||[0,0,0]),worldToRTCPos(this._pos,this._origin,this._rtcPos),this._node.origin=this._origin,this._node.position=this._rtcPos}get position(){return this._pos}set rotation(e){this._node.rotation=e}get rotation(){return this._node.rotation}set size(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set dir(e){if(this._dir.set(e||[0,0,-1]),e){const t=this.scene.center,i=[-this._dir[0],-this._dir[1],-this._dir[2]];math.subVec3(t,this.position,tempVec3$1);const s=-math.dotVec3(i,tempVec3$1);math.normalizeVec3(i),math.mulVec3Scalar(i,s,tempVec3b$4),math.vec3PairToQuaternion(zeroVec,e,tempQuat),this._node.quaternion=tempQuat}}get dir(){return this._dir}set collidable(e){this._node.collidable=!1!==e}get collidable(){return this._node.collidable}set clippable(e){this._node.clippable=!1!==e}get clippable(){return this._node.clippable}set pickable(e){this._node.pickable=!1!==e}get pickable(){return this._node.pickable}set opacity(e){this._node.opacity=e}get opacity(){return this._node.opacity}destroy(){super.destroy()}_updatePlaneSizeFromImage(){const e=this._size,t=this._imageSize[0],i=this._imageSize[1],s=i/t;this._node.scale=t>i?[e,1,e*s]:[e*s,1,e]}}class PointLight extends Light{get type(){return"PointLight"}constructor(e,t={}){super(e,t);const i=this;this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const s=this.scene.camera,r=this.scene.canvas;this._onCameraViewMatrix=s.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=s.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=r.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new RenderState({type:"point",pos:math.vec3([1,1,1]),color:math.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:t.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(i._shadowViewMatrixDirty){i._shadowViewMatrix||(i._shadowViewMatrix=math.identityMat4());const e=i._state.pos,t=s.look,r=s.up;math.lookAtMat4v(e,t,r,i._shadowViewMatrix),i._shadowViewMatrixDirty=!1}return i._shadowViewMatrix},getShadowProjMatrix:()=>{if(i._shadowProjMatrixDirty){i._shadowProjMatrix||(i._shadowProjMatrix=math.identityMat4());const e=i.scene.canvas.canvas;math.perspectiveMat4(Math.PI/180*70,e.clientWidth/e.clientHeight,.1,500,i._shadowProjMatrix),i._shadowProjMatrixDirty=!1}return i._shadowProjMatrix},getShadowRenderBuf:()=>(i._shadowRenderBuf||(i._shadowRenderBuf=new RenderBuffer(i.scene.canvas.canvas,i.scene.canvas.gl,{size:[1024,1024]})),i._shadowRenderBuf)}),this.pos=t.pos,this.color=t.color,this.intensity=t.intensity,this.constantAttenuation=t.constantAttenuation,this.linearAttenuation=t.linearAttenuation,this.quadraticAttenuation=t.quadraticAttenuation,this.castsShadow=t.castsShadow,this.scene._lightCreated(this)}set pos(e){this._state.pos.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get pos(){return this._state.pos}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}get intensity(){return this._state.intensity}set constantAttenuation(e){this._state.attenuation[0]=e||0,this.glRedraw()}get constantAttenuation(){return this._state.attenuation[0]}set linearAttenuation(e){this._state.attenuation[1]=e||0,this.glRedraw()}get linearAttenuation(){return this._state.attenuation[1]}set quadraticAttenuation(e){this._state.attenuation[2]=e||0,this.glRedraw()}get quadraticAttenuation(){return this._state.attenuation[2]}set castsShadow(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}function ensureImageSizePowerOfTwo(e){if(!isPowerOfTwo(e.width)||!isPowerOfTwo(e.height)){const t=document.createElement("canvas");t.width=nextHighestPowerOfTwo(e.width),t.height=nextHighestPowerOfTwo(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function isPowerOfTwo(e){return 0==(e&e-1)}function nextHighestPowerOfTwo(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}class CubeTexture extends Component{get type(){return"CubeTexture"}constructor(e,t={}){super(e,t);const i=this.scene.canvas.gl;this._state=new RenderState({texture:new Texture2D(i,i.TEXTURE_CUBE_MAP),flipY:this._checkFlipY(t.minFilter),encoding:this._checkEncoding(t.encoding),minFilter:"linearMipmapLinear",magFilter:"linear",wrapS:"clampToEdge",wrapT:"clampToEdge",mipmaps:!0}),this._src=t.src,this._images=[],this._loadSrc(t.src),stats.memory.textures++}_checkFlipY(e){return!!e}_checkEncoding(e){return"linear"!==(e=e||"linear")&&"sRGB"!==e&&"gamma"!==e&&(this.error("Unsupported value for 'encoding': '"+e+"' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),e="linear"),e}_webglContextRestored(){this.scene.canvas.gl,this._state.texture=null,this._src&&this._loadSrc(this._src)}_loadSrc(e){const t=this,i=this.scene.canvas.gl;this._images=[];let s=!1,r=0;for(let o=0;o<e.length;o++){const a=new Image;a.onload=function(){let e=a;const n=o;return function(){if(!s&&(e=ensureImageSizePowerOfTwo(e),t._images[n]=e,r++,6===r)){let e=t._state.texture;e||(e=new Texture2D(i,i.TEXTURE_CUBE_MAP),t._state.texture=e),e.setImage(t._images,t._state),e.setProps(t._state),t.fire("loaded",t._src,!1),t.glRedraw()}}}(),a.onerror=function(){s=!0},a.src=e[o]}}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),stats.memory.textures--,this._state.destroy()}}class ReflectionMap extends CubeTexture{get type(){return"ReflectionMap"}constructor(e,t={}){super(e,t),this.scene._lightsState.addReflectionMap(this._state),this.scene._reflectionMapCreated(this)}destroy(){super.destroy(),this.scene._reflectionMapDestroyed(this)}}class LightMap extends CubeTexture{get type(){return"LightMap"}constructor(e,t={}){super(e,t),this.scene._lightMapCreated(this)}destroy(){super.destroy(),this.scene._lightMapDestroyed(this)}}class Fresnel extends Component{get type(){return"Fresnel"}constructor(e,t={}){super(e,t),this._state=new RenderState({edgeColor:math.vec3([0,0,0]),centerColor:math.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1}),this.edgeColor=t.edgeColor,this.centerColor=t.centerColor,this.edgeBias=t.edgeBias,this.centerBias=t.centerBias,this.power=t.power}set edgeColor(e){this._state.edgeColor.set(e||[0,0,0]),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set centerColor(e){this._state.centerColor.set(e||[1,1,1]),this.glRedraw()}get centerColor(){return this._state.centerColor}set edgeBias(e){this._state.edgeBias=e||0,this.glRedraw()}get edgeBias(){return this._state.edgeBias}set centerBias(e){this._state.centerBias=null!=e?e:1,this.glRedraw()}get centerBias(){return this._state.centerBias}set power(e){this._state.power=null!=e?e:1,this.glRedraw()}get power(){return this._state.power}destroy(){super.destroy(),this._state.destroy()}}class SpriteMarker extends Marker{constructor(e,t={}){super(e,{entity:t.entity,occludable:t.occludable,worldPos:t.worldPos}),this._occluded=!1,this._visible=!0,this._src=null,this._image=null,this._pos=math.vec3(),this._origin=math.vec3(),this._rtcPos=math.vec3(),this._dir=math.vec3(),this._size=1,this._imageSize=math.vec2(),this._texture=new Texture(this,{src:t.src}),this._geometry=new ReadableGeometry(this,{primitive:"triangles",positions:[3,3,0,-3,3,0,-3,-3,0,3,-3,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,-1,0,-1,0,0,1,0],indices:[0,1,2,0,2,3]}),this._mesh=new Mesh(this,{geometry:this._geometry,material:new PhongMaterial(this,{ambient:[.9,.3,.9],shininess:30,diffuseMap:this._texture,backfaces:!0}),scale:[1,1,1],position:t.worldPos,rotation:[90,0,0],billboard:"spherical",occluder:!1}),this.visible=!0,this.collidable=t.collidable,this.clippable=t.clippable,this.pickable=t.pickable,this.opacity=t.opacity,this.size=t.size,t.image?this.image=t.image:this.src=t.src}_setVisible(e){this._occluded=!e,this._mesh.visible=this._visible&&!this._occluded,super._setVisible(e)}set visible(e){this._visible=null==e||e,this._mesh.visible=this._visible&&!this._occluded}get visible(){return this._visible}set image(e){this._image=e,this._image&&(this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(e){if(this._src=e,this._src){this._image=null;const e=new Image;e.onload=()=>{this._texture.image=e,this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage()},e.src=this._src}}get src(){return this._src}set size(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set collidable(e){this._mesh.collidable=!1!==e}get collidable(){return this._mesh.collidable}set clippable(e){this._mesh.clippable=!1!==e}get clippable(){return this._mesh.clippable}set pickable(e){this._mesh.pickable=!1!==e}get pickable(){return this._mesh.pickable}set opacity(e){this._mesh.opacity=e}get opacity(){return this._mesh.opacity}_updatePlaneSizeFromImage(){const e=.5*this._size,t=this._imageSize[0],i=this._imageSize[1],s=i/t;this._geometry.positions=t>i?[e,e*s,0,-e,e*s,0,-e,-e*s,0,e,-e*s,0]:[e/s,e,0,-e/s,e,0,-e/s,-e,0,e/s,-e,0]}}const color=math.vec3();class ModelMemento{constructor(e){if(this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsOpacity=[],this.numObjects=0,e){const t=e.metaScene.scene;this.saveObjects(t,e)}}saveObjects(e,t,i){const s=t.rootMetaObject;if(!s)return;const r=s.getObjectIDsInSubtree();this.numObjects=0,this._mask=i?utils.apply(i,{}):null;const o=e.objects,a=!i||i.visible,n=!i||i.edges,h=!i||i.xrayed,l=!i||i.highlighted,c=!i||i.selected,u=!i||i.clippable,p=!i||i.pickable,d=!i||i.colorize,m=!i||i.opacity;for(var f=0,g=r.length;f<g;f++){const e=o[r[f]];if(e){if(a&&(this.objectsVisible[f]=e.visible),n&&(this.objectsEdges[f]=e.edges),h&&(this.objectsXrayed[f]=e.xrayed),l&&(this.objectsHighlighted[f]=e.highlighted),c&&(this.objectsSelected[f]=e.selected),u&&(this.objectsClippable[f]=e.clippable),p&&(this.objectsPickable[f]=e.pickable),d){const t=e.colorize;this.objectsColorize[3*f+0]=t[0],this.objectsColorize[3*f+1]=t[1],this.objectsColorize[3*f+2]=t[2]}m&&(this.objectsOpacity[f]=e.opacity),this.numObjects++}}}restoreObjects(e,t){const i=t.rootMetaObject;if(!i)return;const s=i.getObjectIDsInSubtree(),r=this._mask,o=!r||r.visible,a=!r||r.edges,n=!r||r.xrayed,h=!r||r.highlighted,l=!r||r.selected,c=!r||r.clippable,u=!r||r.pickable,p=!r||r.colorize,d=!r||r.opacity,m=e.objects;for(var f=0,g=s.length;f<g;f++){const e=m[s[f]];e&&(o&&(e.visible=this.objectsVisible[f]),a&&(e.edges=this.objectsEdges[f]),n&&(e.xrayed=this.objectsXrayed[f]),h&&(e.highlighted=this.objectsHighlighted[f]),l&&(e.selected=this.objectsSelected[f]),c&&(e.clippable=this.objectsClippable[f]),u&&(e.pickable=this.objectsPickable[f]),p&&(color[0]=this.objectsColorize[3*f+0],color[1]=this.objectsColorize[3*f+1],color[2]=this.objectsColorize[3*f+2],e.colorize=color),d&&(e.opacity=this.objectsOpacity[f]))}}}class CubicBezierCurve extends Curve{constructor(e,t={}){super(e,t),this.v0=t.v0,this.v1=t.v1,this.v2=t.v2,this.v3=t.v3,this.t=t.t}set v0(e){this._v0=e||math.vec3([0,0,0])}get v0(){return this._v0}set v1(e){this._v1=e||math.vec3([0,0,0])}get v1(){return this._v1}set v2(e){this._v2=e||math.vec3([0,0,0])}get v2(){return this._v2}set v3(e){this.fire("v3",this._v3=e||math.vec3([0,0,0]))}get v3(){return this._v3}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=math.vec3();return t[0]=math.b3(e,this._v0[0],this._v1[0],this._v2[0],this._v3[0]),t[1]=math.b3(e,this._v0[1],this._v1[1],this._v2[1],this._v3[1]),t[2]=math.b3(e,this._v0[2],this._v1[2],this._v2[2],this._v3[2]),t}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,v3:this._v3,t:this._t}}}class Path extends Curve{constructor(e,t={}){super(e,t),this._cachedLengths=[],this._dirty=!0,this._curves=[],this._t=0,this._dirtySubs=[],this._destroyedSubs=[],this.curves=t.curves||[],this.t=t.t}addCurve(e){this._curves.push(e),this._dirty=!0}set curves(e){var t,i,s;for(e=e||[],i=0,s=this._curves.length;i<s;i++)(t=this._curves[i]).off(this._dirtySubs[i]),t.off(this._destroyedSubs[i]);this._curves=[],this._dirtySubs=[],this._destroyedSubs=[];var r=this;function o(){r._dirty=!0}function a(){var e=this.id;for(i=0,s=r._curves.length;i<s;i++)if(r._curves[i].id===e)return r._curves=r._curves.slice(i,i+1),r._dirtySubs=r._dirtySubs.slice(i,i+1),r._destroyedSubs=r._destroyedSubs.slice(i,i+1),void(r._dirty=!0)}for(i=0,s=e.length;i<s;i++){if(t=e[i],utils.isNumeric(t)||utils.isString(t)){var n=t;if(!(t=this.scene.components[n])){this.error("Component not found: "+_inQuotes(n));continue}}var h=t.type;"xeokit.SplineCurve"===h||"xeokit.Path"===h||"xeokit.CubicBezierCurve"===h||"xeokit.QuadraticBezierCurve"===h?(this._curves.push(t),this._dirtySubs.push(t.on("dirty",o)),this._destroyedSubs.push(t.once("destroyed",a))):this.error("Component "+_inQuotes(t.id)+" is not a xeokit.SplineCurve, xeokit.Path or xeokit.QuadraticBezierCurve")}this._dirty=!0}get curves(){return this._curves}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}get length(){var e=this._getCurveLengths();return e[e.length-1]}getPoint(e){for(var t,i=e*this.length,s=this._getCurveLengths(),r=0;r<s.length;){if(s[r]>=i){var o=1-(s[r]-i)/(t=this._curves[r]).length;return t.getPointAt(o)}r++}return null}_getCurveLengths(){if(!this._dirty)return this._cachedLengths;var e,t=[],i=0,s=this._curves.length;for(e=0;e<s;e++)i+=this._curves[e].length,t.push(i);return this._cachedLengths=t,this._dirty=!1,t}_getJSON(){for(var e=[],t=0,i=this._curves.length;t<i;t++)e.push(this._curves[t].id);return{curves:e,t:this._t}}destroy(){var e,t,i;for(super.destroy(),e=0,t=this._curves.length;e<t;e++)(i=this._curves[e]).off(this._dirtySubs[e]),i.off(this._destroyedSubs[e])}}class QuadraticBezierCurve extends Curve{constructor(e,t={}){super(e,t),this.v0=t.v0,this.v1=t.v1,this.v2=t.v2,this.t=t.t}set v0(e){this._v0=e||math.vec3([0,0,0])}get v0(){return this._v0}set v1(e){this._v1=e||math.vec3([0,0,0])}get v1(){return this._v1}set v2(e){this._v2=e||math.vec3([0,0,0])}get v2(){return this._v2}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=math.vec3();return t[0]=math.b2(e,this._v0[0],this._v1[0],this._v2[0]),t[1]=math.b2(e,this._v0[1],this._v1[1],this._v2[1]),t[2]=math.b2(e,this._v0[2],this._v1[2],this._v2[2]),t}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,t:this._t}}}const screenPos=math.vec4(),viewPos=math.vec4(),tempVec3a$3=math.vec3(),tempVec3b$3=math.vec3(),tempVec3c$3=math.vec3(),tempVec4a$1=math.vec4(),tempVec4b$1=math.vec4(),tempVec4c$1=math.vec4();class PanController{constructor(e){this._scene=e}dollyToCanvasPos(e,t,i){let s=!1;const r=this._scene.camera;if(e){const t=math.subVec3(e,r.eye,tempVec3a$3);s=math.lenVec3(t)<i}if("perspective"===r.projection){r.ortho.scale=r.ortho.scale-i;const s=this._unproject(t,tempVec4a$1),o=math.subVec3(s,r.eye,tempVec4c$1),a=math.mulVec3Scalar(math.normalizeVec3(o),-i,[]);if(r.eye=[r.eye[0]-a[0],r.eye[1]-a[1],r.eye[2]-a[2]],r.look=[r.look[0]-a[0],r.look[1]-a[1],r.look[2]-a[2]],e){const t=math.subVec3(e,r.eye,tempVec3a$3),i=math.lenVec3(t),s=math.mulVec3Scalar(math.normalizeVec3(math.subVec3(r.look,r.eye,tempVec3b$3)),i);r.look=[r.eye[0]+s[0],r.eye[1]+s[1],r.eye[2]+s[2]]}}else if("ortho"===r.projection){const e=this._unproject(t,tempVec4a$1);r.ortho.scale=r.ortho.scale-i,r.ortho._update();const s=this._unproject(t,tempVec4b$1),o=math.subVec3(s,e,tempVec4c$1),a=math.mulVec3Scalar(math.normalizeVec3(math.subVec3(r.look,r.eye,tempVec3a$3)),-i,tempVec3b$3),n=math.addVec3(o,a,tempVec3c$3);r.eye=[r.eye[0]-n[0],r.eye[1]-n[1],r.eye[2]-n[2]],r.look=[r.look[0]-n[0],r.look[1]-n[1],r.look[2]-n[2]]}return s}_unproject(e,t){const i=this._scene.camera,s=i.project.transposedMatrix,r=s.subarray(8,12),o=s.subarray(12),a=[0,0,-1,1],n=math.dotVec4(a,r)/math.dotVec4(a,o);return i.project.unproject(e,n,screenPos,viewPos,t),t}destroy(){}}const tempVec3a$2=math.vec3(),tempVec3b$2=math.vec3(),tempVec3c$2=math.vec3(),tempVec4a=math.vec4(),tempVec4b=math.vec4(),tempVec4c=math.vec4();class PivotController{constructor(e,t){this._scene=e,this._configs=t,this._pivotWorldPos=math.vec3(),this._cameraOffset=math.vec3(),this._azimuth=0,this._polar=0,this._radius=0,this._pivotPosSet=!1,this._pivoting=!1,this._shown=!1,this._pivotViewPos=math.vec4(),this._pivotProjPos=math.vec4(),this._pivotCanvasPos=math.vec2(),this._cameraDirty=!0,this._onViewMatrix=this._scene.camera.on("viewMatrix",(()=>{this._cameraDirty=!0})),this._onProjMatrix=this._scene.camera.on("projMatrix",(()=>{this._cameraDirty=!0})),this._onTick=this._scene.on("tick",(()=>{this.updatePivotElement()}))}updatePivotElement(){const e=this._scene.camera,t=this._scene.canvas;if(this._pivoting&&this._cameraDirty){math.transformPoint3(e.viewMatrix,this.getPivotPos(),this._pivotViewPos),this._pivotViewPos[3]=1,math.transformPoint4(e.projMatrix,this._pivotViewPos,this._pivotProjPos);const i=t.boundary,s=i[2],r=i[3];this._pivotCanvasPos[0]=Math.floor((1+this._pivotProjPos[0]/this._pivotProjPos[3])*s/2),this._pivotCanvasPos[1]=Math.floor((1-this._pivotProjPos[1]/this._pivotProjPos[3])*r/2);const o=t.canvas.getBoundingClientRect();this._pivotElement&&(this._pivotElement.style.left=Math.floor(o.left+this._pivotCanvasPos[0])-this._pivotElement.clientWidth/2+window.scrollX+"px",this._pivotElement.style.top=Math.floor(o.top+this._pivotCanvasPos[1])-this._pivotElement.clientHeight/2+window.scrollY+"px"),this._cameraDirty=!1}}setPivotElement(e){this._pivotElement=e}startPivot(){if(this._cameraLookingDownwards())return this._pivoting=!1,!1;const e=this._scene.camera;let t=math.lookAtMat4v(e.eye,e.look,e.worldUp);math.transformPoint3(t,this.getPivotPos(),this._cameraOffset);const i=this.getPivotPos();this._cameraOffset[2]+=math.distVec3(e.eye,i),t=math.inverseMat4(t);const s=math.transformVec3(t,this._cameraOffset),r=math.vec3();if(math.subVec3(e.eye,i,r),math.addVec3(r,s),e.zUp){const e=r[1];r[1]=r[2],r[2]=e}this._radius=math.lenVec3(r),this._polar=Math.acos(r[1]/this._radius),this._azimuth=Math.atan2(r[0],r[2]),this._pivoting=!0}_cameraLookingDownwards(){const e=this._scene.camera,t=math.normalizeVec3(math.subVec3(e.look,e.eye,tempVec3a$2)),i=math.cross3Vec3(t,e.worldUp,tempVec3b$2);return math.sqLenVec3(i)<=1e-4}getPivoting(){return this._pivoting}setPivotPos(e){this._pivotWorldPos.set(e),this._pivotPosSet=!0}setCanvasPivotPos(e){const t=this._scene.camera,i=Math.abs(math.distVec3(this._scene.center,t.eye)),s=t.project.transposedMatrix,r=s.subarray(8,12),o=s.subarray(12),a=[0,0,-1,1],n=math.dotVec4(a,r)/math.dotVec4(a,o),h=tempVec4a;t.project.unproject(e,n,tempVec4b,tempVec4c,h);const l=math.normalizeVec3(math.subVec3(h,t.eye,tempVec3a$2)),c=math.addVec3(t.eye,math.mulVec3Scalar(l,i,tempVec3b$2),tempVec3c$2);this.setPivotPos(c)}getPivotPos(){return this._pivotPosSet?this._pivotWorldPos:this._scene.camera.look}continuePivot(e,t){if(!this._pivoting)return;if(0===e&&0===t)return;const i=this._scene.camera;var s=-e;const r=-t;1===i.worldUp[2]&&(s=-s),this._azimuth+=.01*-s,this._polar+=.01*r,this._polar=math.clamp(this._polar,.001,Math.PI-.001);const o=[this._radius*Math.sin(this._polar)*Math.sin(this._azimuth),this._radius*Math.cos(this._polar),this._radius*Math.sin(this._polar)*Math.cos(this._azimuth)];if(1===i.worldUp[2]){const e=o[1];o[1]=o[2],o[2]=e}const a=math.lenVec3(math.subVec3(i.look,i.eye,math.vec3())),n=this.getPivotPos();math.addVec3(o,n);let h=math.lookAtMat4v(o,n,i.worldUp);h=math.inverseMat4(h);const l=math.transformVec3(h,this._cameraOffset);h[12]-=l[0],h[13]-=l[1],h[14]-=l[2];const c=[h[8],h[9],h[10]];i.eye=[h[12],h[13],h[14]],math.subVec3(i.eye,math.mulVec3Scalar(c,a),i.look),i.up=[h[4],h[5],h[6]],this.showPivot()}showPivot(){this._shown||(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this.updatePivotElement(),this._pivotElement.style.visibility="visible",this._shown=!0,this._hideTimeout=window.setTimeout((()=>{this.hidePivot()}),1e3)))}hidePivot(){this._shown&&(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this._pivotElement.style.visibility="hidden"),this._shown=!1)}endPivot(){this._pivoting=!1}destroy(){this._scene.camera.off(this._onViewMatrix),this._scene.camera.off(this._onProjMatrix),this._scene.off(this._onTick)}}class PickController{constructor(e,t){this._scene=e.scene,this._cameraControl=e,this._scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},this._configs=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=math.vec2(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,this._lastPickedEntityId=null,this._needFireEvents=!1}update(){if(!this._configs.pointerEnabled)return;if(!this.schedulePickEntity&&!this.schedulePickSurface)return;this.picked=!1,this.pickedSurface=!1,this._needFireEvents=!1;const e=this._cameraControl.hasSubs("hoverSurface");if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){const t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,this._needFireEvents=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){const e=this.pickResult.canvasPos;if(e[0]===this.pickCursorPos[0]&&e[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickSurface?(this.pickResult=this._scene.pick({pickSurface:!0,pickSurfaceNormal:!1,canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!0,this._needFireEvents=!0)):(this.pickResult=this._scene.pick({canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!0)),this.schedulePickEntity=!1,this.schedulePickSurface=!1}fireEvents(){if(this._needFireEvents){if(this.picked&&this.pickResult&&this.pickResult.entity){const e=this.pickResult.entity.id;this._lastPickedEntityId!==e&&(void 0!==this._lastPickedEntityId&&this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._cameraControl.fire("hoverEnter",this.pickResult,!0),this._lastPickedEntityId=e),this._cameraControl.fire("hover",this.pickResult,!0),this.pickResult.worldPos&&(this.pickedSurface=!0,this._cameraControl.fire("hoverSurface",this.pickResult,!0))}else void 0!==this._lastPickedEntityId&&(this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),this._cameraControl.fire("hoverOff",{canvasPos:this.pickCursorPos},!0);this.pickResult=null,this._needFireEvents=!1}}destroy(){}}const canvasPos=math.vec2(),getCanvasPosFromEvent$3=function(e,t){if(e){let i=e.target,s=0,r=0;for(;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class MousePanRotateDollyHandler{constructor(e,t,i,s,r){this._scene=e;const o=t.pickController;let a,n,h,l=0,c=0,u=0,p=0,d=!1;const m=math.vec3();let f=!0;const g=this._scene.canvas.canvas,_=[];function y(e=!0){g.style.cursor="move",l=s.pointerCanvasPos[0],c=s.pointerCanvasPos[1],u=s.pointerCanvasPos[0],p=s.pointerCanvasPos[1],e&&(o.pickCursorPos=s.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(d=!0,m.set(o.pickResult.worldPos)):d=!1)}document.addEventListener("keydown",this._documentKeyDownHandler=t=>{if(!i.active||!i.pointerEnabled||!e.input.keyboardEnabled)return;const s=t.keyCode;_[s]=!0}),document.addEventListener("keyup",this._documentKeyUpHandler=t=>{if(!i.active||!i.pointerEnabled||!e.input.keyboardEnabled)return;const s=t.keyCode;_[s]=!1}),g.addEventListener("mousedown",this._mouseDownHandler=t=>{if(i.active&&i.pointerEnabled)switch(t.which){case 1:_[e.input.KEY_SHIFT]||i.planView?(a=!0,y()):(a=!0,y(!1));break;case 2:n=!0,y();break;case 3:h=!0,i.panRightClick&&y()}}),document.addEventListener("mousemove",this._documentMouseMoveHandler=()=>{if(!i.active||!i.pointerEnabled)return;if(!a&&!n&&!h)return;const t=e.canvas.boundary,o=t[2]-t[0],u=t[3]-t[1],p=s.pointerCanvasPos[0],f=s.pointerCanvasPos[1];if(_[e.input.KEY_SHIFT]||i.planView||!i.panRightClick&&n||i.panRightClick&&h){const t=p-l,i=f-c,s=e.camera;if("perspective"===s.projection){const o=Math.abs(d?math.lenVec3(math.subVec3(m,e.camera.eye,[])):e.camera.eyeLookDist)*Math.tan(s.perspective.fov/2*Math.PI/180);r.panDeltaX+=1.5*t*o/u,r.panDeltaY+=1.5*i*o/u}else r.panDeltaX+=.5*s.ortho.scale*(t/u),r.panDeltaY+=.5*s.ortho.scale*(i/u)}else!a||n||h||i.planView||(i.firstPerson?(r.rotateDeltaY-=(p-l)/o*i.dragRotationRate/2,r.rotateDeltaX+=(f-c)/u*(i.dragRotationRate/4)):(r.rotateDeltaY-=(p-l)/o*(1.5*i.dragRotationRate),r.rotateDeltaX+=(f-c)/u*(1.5*i.dragRotationRate)));l=p,c=f}),g.addEventListener("mousemove",this._canvasMouseMoveHandler=e=>{i.active&&i.pointerEnabled&&s.mouseover&&(f=!0)}),document.addEventListener("mouseup",this._documentMouseUpHandler=e=>{if(i.active&&i.pointerEnabled)switch(e.which){case 1:case 2:case 3:a=!1,n=!1,h=!1}}),g.addEventListener("mouseup",this._mouseUpHandler=e=>{if(i.active&&i.pointerEnabled){if(3===e.which){getCanvasPosFromEvent$3(e,canvasPos);const i=canvasPos[0],s=canvasPos[1];Math.abs(i-u)<3&&Math.abs(s-p)<3&&t.cameraControl.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:canvasPos,event:e},!0)}g.style.removeProperty("cursor")}}),g.addEventListener("mouseenter",this._mouseEnterHandler=()=>{i.active&&i.pointerEnabled});const T=1/60;let v=null;g.addEventListener("wheel",this._mouseWheelHandler=e=>{if(!i.active||!i.pointerEnabled)return;const t=performance.now()/1e3;var o=null!==v?t-v:0;v=t,o>.05&&(o=.05),o<T&&(o=T);const a=Math.max(-1,Math.min(1,40*-e.deltaY));if(0===a)return;const n=a/Math.abs(a);r.dollyDelta+=-n*o*i.mouseWheelDollyRate,f&&(s.followPointerDirty=!0,f=!1)},{passive:!0})}reset(){}destroy(){const e=this._scene.canvas.canvas;document.removeEventListener("keydown",this._documentKeyDownHandler),document.removeEventListener("keyup",this._documentKeyUpHandler),e.removeEventListener("mousedown",this._mouseDownHandler),document.removeEventListener("mousemove",this._documentMouseMoveHandler),e.removeEventListener("mousemove",this._canvasMouseMoveHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("wheel",this._mouseWheelHandler)}}const center=math.vec3(),tempVec3a$1=math.vec3(),tempVec3b$1=math.vec3(),tempVec3c$1=math.vec3(),tempVec3d=math.vec3(),tempCameraTarget={eye:math.vec3(),look:math.vec3(),up:math.vec3()};class KeyboardAxisViewHandler{constructor(e,t,i,s){this._scene=e;const r=t.cameraControl,o=e.camera;this._onSceneKeyDown=e.input.on("keydown",(()=>{if(!i.active||!i.pointerEnabled||!e.input.keyboardEnabled)return;if(!s.mouseover)return;const a=r._isKeyDownForAction(r.AXIS_VIEW_RIGHT),n=r._isKeyDownForAction(r.AXIS_VIEW_BACK),h=r._isKeyDownForAction(r.AXIS_VIEW_LEFT),l=r._isKeyDownForAction(r.AXIS_VIEW_FRONT),c=r._isKeyDownForAction(r.AXIS_VIEW_TOP),u=r._isKeyDownForAction(r.AXIS_VIEW_BOTTOM);if(!(a||n||h||l||c||u))return;const p=e.aabb,d=math.getAABB3Diag(p);math.getAABB3Center(p,center);const m=Math.abs(d/Math.tan(t.cameraFlight.fitFOV*math.DEGTORAD)),f=1.1*d;tempCameraTarget.orthoScale=f,a?(tempCameraTarget.eye.set(math.addVec3(center,math.mulVec3Scalar(o.worldRight,m,tempVec3a$1),tempVec3d)),tempCameraTarget.look.set(center),tempCameraTarget.up.set(o.worldUp)):n?(tempCameraTarget.eye.set(math.addVec3(center,math.mulVec3Scalar(o.worldForward,m,tempVec3a$1),tempVec3d)),tempCameraTarget.look.set(center),tempCameraTarget.up.set(o.worldUp)):h?(tempCameraTarget.eye.set(math.addVec3(center,math.mulVec3Scalar(o.worldRight,-m,tempVec3a$1),tempVec3d)),tempCameraTarget.look.set(center),tempCameraTarget.up.set(o.worldUp)):l?(tempCameraTarget.eye.set(math.addVec3(center,math.mulVec3Scalar(o.worldForward,-m,tempVec3a$1),tempVec3d)),tempCameraTarget.look.set(center),tempCameraTarget.up.set(o.worldUp)):c?(tempCameraTarget.eye.set(math.addVec3(center,math.mulVec3Scalar(o.worldUp,m,tempVec3a$1),tempVec3d)),tempCameraTarget.look.set(center),tempCameraTarget.up.set(math.normalizeVec3(math.mulVec3Scalar(o.worldForward,1,tempVec3b$1),tempVec3c$1))):u&&(tempCameraTarget.eye.set(math.addVec3(center,math.mulVec3Scalar(o.worldUp,-m,tempVec3a$1),tempVec3d)),tempCameraTarget.look.set(center),tempCameraTarget.up.set(math.normalizeVec3(math.mulVec3Scalar(o.worldForward,-1,tempVec3b$1)))),!i.firstPerson&&i.followPointer&&t.pivotController.setPivotPos(center),t.cameraFlight.duration>0?t.cameraFlight.flyTo(tempCameraTarget,(()=>{t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot()})):(t.cameraFlight.jumpTo(tempCameraTarget),t.pivotController.getPivoting()&&i.followPointer&&t.pivotController.showPivot())}))}reset(){}destroy(){this._scene.input.off(this._onSceneKeyDown)}}class MousePickHandler{constructor(e,t,i,s,r){this._scene=e;const o=t.pickController,a=t.pivotController,n=t.cameraControl;this._clicks=0,this._timeout=null,this._lastPickedEntityId=null;let h=!1,l=!1;const c=this._scene.canvas.canvas,u=i=>{let s;i&&i.worldPos&&(s=i.worldPos);const r=i&&i.entity?i.entity.aabb:e.aabb;if(s){const i=e.camera;math.subVec3(i.eye,i.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};c.addEventListener("mousemove",this._canvasMouseMoveHandler=t=>{if(!i.active||!i.pointerEnabled)return;if(h||l)return;const r=n.hasSubs("hover"),a=n.hasSubs("hoverOut"),c=n.hasSubs("hoverOff"),u=n.hasSubs("hoverSurface");if(r||a||c||u)if(o.pickCursorPos=s.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=u,o.update(),o.pickResult){const t=o.pickResult.entity.id;this._lastPickedEntityId!==t&&(void 0!==this._lastPickedEntityId&&n.fire("hoverOut",{entity:e.objects[this._lastPickedEntityId]},!0),n.fire("hoverEnter",o.pickResult,!0),this._lastPickedEntityId=t),n.fire("hover",o.pickResult,!0),o.pickResult.worldPos&&n.fire("hoverSurface",o.pickResult,!0)}else void 0!==this._lastPickedEntityId&&(n.fire("hoverOut",{entity:e.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),n.fire("hoverOff",{canvasPos:o.pickCursorPos},!0)}),c.addEventListener("mousedown",this._canvasMouseDownHandler=t=>{1===t.which&&(h=!0),3===t.which&&(l=!0);if(1===t.which&&i.active&&i.pointerEnabled&&(s.mouseDownClientX=t.clientX,s.mouseDownClientY=t.clientY,s.mouseDownCursorX=s.pointerCanvasPos[0],s.mouseDownCursorY=s.pointerCanvasPos[1],!i.firstPerson&&i.followPointer&&(o.pickCursorPos=s.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),1===t.which))){const t=o.pickResult;t&&t.worldPos?(a.setPivotPos(t.worldPos),a.startPivot()):(i.smartPivot?a.setCanvasPivotPos(s.pointerCanvasPos):a.setPivotPos(e.camera.look),a.startPivot())}}),document.addEventListener("mouseup",this._documentMouseUpHandler=e=>{1===e.which&&(h=!1),3===e.which&&(l=!1)}),c.addEventListener("mouseup",this._canvasMouseUpHandler=r=>{if(!i.active||!i.pointerEnabled)return;if(!(1===r.which))return;if(a.hidePivot(),Math.abs(r.clientX-s.mouseDownClientX)>3||Math.abs(r.clientY-s.mouseDownClientY)>3)return;const h=n.hasSubs("picked"),l=n.hasSubs("pickedNothing"),c=n.hasSubs("pickedSurface"),p=n.hasSubs("doublePicked"),d=n.hasSubs("doublePickedSurface"),m=n.hasSubs("doublePickedNothing");if(!(i.doublePickFlyTo||p||d||m))return(h||l||c)&&(o.pickCursorPos=s.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=c,o.update(),o.pickResult?(n.fire("picked",o.pickResult,!0),o.pickedSurface&&n.fire("pickedSurface",o.pickResult,!0)):n.fire("pickedNothing",{canvasPos:s.pointerCanvasPos},!0)),void(this._clicks=0);if(this._clicks++,1===this._clicks)this._timeout=setTimeout((()=>{o.pickCursorPos=s.pointerCanvasPos,o.schedulePickEntity=i.doublePickFlyTo,o.schedulePickSurface=c,o.update(),o.pickResult?(n.fire("picked",o.pickResult,!0),o.pickedSurface&&(n.fire("pickedSurface",o.pickResult,!0),!i.firstPerson&&i.followPointer&&(t.pivotController.setPivotPos(o.pickResult.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):n.fire("pickedNothing",{canvasPos:s.pointerCanvasPos},!0),this._clicks=0}),250);else{if(null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),o.pickCursorPos=s.pointerCanvasPos,o.schedulePickEntity=i.doublePickFlyTo||p||d,o.schedulePickSurface=o.schedulePickEntity&&d,o.update(),o.pickResult){if(n.fire("doublePicked",o.pickResult,!0),o.pickedSurface&&n.fire("doublePickedSurface",o.pickResult,!0),i.doublePickFlyTo&&(u(o.pickResult),!i.firstPerson&&i.followPointer)){const e=o.pickResult.entity.aabb,i=math.getAABB3Center(e);t.pivotController.setPivotPos(i),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(n.fire("doublePickedNothing",{canvasPos:s.pointerCanvasPos},!0),i.doublePickFlyTo&&(u(),!i.firstPerson&&i.followPointer)){const i=e.aabb,s=math.getAABB3Center(i);t.pivotController.setPivotPos(s),t.pivotController.startPivot()&&t.pivotController.showPivot()}this._clicks=0}},!1)}reset(){this._clicks=0,this._lastPickedEntityId=null,this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("mousemove",this._canvasMouseMoveHandler),e.removeEventListener("mousedown",this._canvasMouseDownHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._canvasMouseUpHandler),this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}}class KeyboardPanRotateDollyHandler{constructor(e,t,i,s,r){this._scene=e;const o=e.input,a=[],n=e.canvas.canvas;let h=!0;this._onSceneMouseMove=o.on("mousemove",(()=>{h=!0})),this._onSceneKeyDown=o.on("keydown",(t=>{i.active&&i.pointerEnabled&&e.input.keyboardEnabled&&s.mouseover&&(a[t]=!0,t===o.KEY_SHIFT&&(n.style.cursor="move"))})),this._onSceneKeyUp=o.on("keyup",(t=>{i.active&&i.pointerEnabled&&e.input.keyboardEnabled&&s.mouseover&&(a[t]=!1,t===o.KEY_SHIFT&&(n.style.cursor=null))})),this._onTick=e.on("tick",(n=>{if(!i.active||!i.pointerEnabled||!e.input.keyboardEnabled)return;if(!s.mouseover)return;const l=t.cameraControl,c=n.deltaTime/1e3;if(!i.planView){const e=l._isKeyDownForAction(l.ROTATE_Y_POS,a),s=l._isKeyDownForAction(l.ROTATE_Y_NEG,a),o=l._isKeyDownForAction(l.ROTATE_X_POS,a),n=l._isKeyDownForAction(l.ROTATE_X_NEG,a),h=c*i.keyboardRotationRate;(e||s||o||n)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),e?r.rotateDeltaY+=h:s&&(r.rotateDeltaY-=h),o?r.rotateDeltaX+=h:n&&(r.rotateDeltaX-=h),!i.firstPerson&&i.followPointer&&t.pivotController.startPivot())}if(!a[o.KEY_CTRL]&&!a[o.KEY_ALT]){const e=l._isKeyDownForAction(l.DOLLY_BACKWARDS,a),o=l._isKeyDownForAction(l.DOLLY_FORWARDS,a);if(e||o){const a=c*i.keyboardDollyRate;!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),o?r.dollyDelta-=a:e&&(r.dollyDelta+=a),h&&(s.followPointerDirty=!0,h=!1)}}const u=l._isKeyDownForAction(l.PAN_FORWARDS,a),p=l._isKeyDownForAction(l.PAN_BACKWARDS,a),d=l._isKeyDownForAction(l.PAN_LEFT,a),m=l._isKeyDownForAction(l.PAN_RIGHT,a),f=l._isKeyDownForAction(l.PAN_UP,a),g=l._isKeyDownForAction(l.PAN_DOWN,a),_=(a[o.KEY_ALT]?.3:1)*c*i.keyboardPanRate;(u||p||d||m||f||g)&&(!i.firstPerson&&i.followPointer&&t.pivotController.startPivot(),g?r.panDeltaY+=_:f&&(r.panDeltaY+=-_),m?r.panDeltaX+=-_:d&&(r.panDeltaX+=_),p?r.panDeltaZ+=_:u&&(r.panDeltaZ+=-_))}))}reset(){}destroy(){this._scene.off(this._onTick),this._scene.input.off(this._onSceneMouseMove),this._scene.input.off(this._onSceneKeyDown),this._scene.input.off(this._onSceneKeyUp)}}const SCALE_DOLLY_EACH_FRAME=1,EPSILON=.001,tempVec3=math.vec3();class CameraUpdater{constructor(e,t,i,s,r){this._scene=e;const o=e.camera,a=t.pickController,n=t.pivotController,h=t.panController;let l=1,c=1,u=null;this._onTick=e.on("tick",(()=>{if(!i.active||!i.pointerEnabled)return;let t="default";if(Math.abs(r.dollyDelta)<.001&&(r.dollyDelta=0),Math.abs(r.rotateDeltaX)<.001&&(r.rotateDeltaX=0),Math.abs(r.rotateDeltaY)<.001&&(r.rotateDeltaY=0),0===r.rotateDeltaX&&0===r.rotateDeltaY||(r.dollyDelta=0),i.followPointer&&--l<=0&&(l=1,0!==r.dollyDelta)){if(0===r.rotateDeltaY&&0===r.rotateDeltaX&&i.followPointer&&s.followPointerDirty&&(a.pickCursorPos=s.pointerCanvasPos,a.schedulePickSurface=!0,a.update(),a.pickResult&&a.pickResult.worldPos?u=a.pickResult.worldPos:(c=1,u=null),s.followPointerDirty=!1),u){const t=Math.abs(math.lenVec3(math.subVec3(u,e.camera.eye,tempVec3)));c=t/i.dollyProximityThreshold}c<i.dollyMinSpeed&&(c=i.dollyMinSpeed)}const p=r.dollyDelta*c;if(0===r.rotateDeltaY&&0===r.rotateDeltaX||(!i.firstPerson&&i.followPointer&&n.getPivoting()?(n.continuePivot(r.rotateDeltaY,r.rotateDeltaX),n.showPivot()):(0!==r.rotateDeltaX&&(i.firstPerson?o.pitch(-r.rotateDeltaX):o.orbitPitch(r.rotateDeltaX)),0!==r.rotateDeltaY&&(i.firstPerson?o.yaw(r.rotateDeltaY):o.orbitYaw(r.rotateDeltaY))),r.rotateDeltaX*=i.rotationInertia,r.rotateDeltaY*=i.rotationInertia,t="grabbing"),Math.abs(r.panDeltaX)<.001&&(r.panDeltaX=0),Math.abs(r.panDeltaY)<.001&&(r.panDeltaY=0),Math.abs(r.panDeltaZ)<.001&&(r.panDeltaZ=0),0!==r.panDeltaX||0!==r.panDeltaY||0!==r.panDeltaZ){const e=math.vec3();let s,a;if(e[0]=r.panDeltaX,e[1]=r.panDeltaY,e[2]=r.panDeltaZ,i.constrainVertical){o.xUp?(s=o.eye[0],a=o.look[0]):o.yUp?(s=o.eye[1],a=o.look[1]):o.zUp&&(s=o.eye[2],a=o.look[2]),o.pan(e);const t=o.eye,i=o.look;o.xUp?(t[0]=s,i[0]=a):o.yUp?(t[1]=s,i[1]=a):o.zUp&&(t[2]=s,i[2]=a),o.eye=t,o.look=i}else o.pan(e);t="grabbing"}if(r.panDeltaX*=i.panInertia,r.panDeltaY*=i.panInertia,r.panDeltaZ*=i.panInertia,0!==p){if(t=p<0?"zoom-in":"zoom-out",i.firstPerson){let e,t;if(i.constrainVertical&&(o.xUp?(e=o.eye[0],t=o.look[0]):o.yUp?(e=o.eye[1],t=o.look[1]):o.zUp&&(e=o.eye[2],t=o.look[2])),i.followPointer){h.dollyToCanvasPos(u,s.pointerCanvasPos,-p)&&(s.followPointerDirty=!0)}else o.pan([0,0,p]),o.ortho.scale=o.ortho.scale-p;if(i.constrainVertical){const i=o.eye,s=o.look;o.xUp?(i[0]=e,s[0]=t):o.yUp?(i[1]=e,s[1]=t):o.zUp&&(i[2]=e,s[2]=t),o.eye=i,o.look=s}}else if(i.planView)if(i.followPointer){h.dollyToCanvasPos(u,s.pointerCanvasPos,-p)&&(s.followPointerDirty=!0)}else o.ortho.scale=o.ortho.scale+p,o.zoom(p);else if(i.followPointer){h.dollyToCanvasPos(u,s.pointerCanvasPos,-p)&&(s.followPointerDirty=!0)}else o.ortho.scale=o.ortho.scale+p,o.zoom(p);r.dollyDelta*=i.dollyInertia}a.fireEvents(),document.body.style.cursor=t}))}destroy(){this._scene.off(this._onTick)}}class MouseMiscHandler{constructor(e,t,i,s,r){this._scene=e;const o=this._scene.canvas.canvas;o.addEventListener("mouseenter",this._mouseEnterHandler=()=>{s.mouseover=!0}),o.addEventListener("mouseleave",this._mouseLeaveHandler=()=>{s.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",this._mouseMoveHandler=e=>{getCanvasPosFromEvent$2(e,o,s.pointerCanvasPos)}),o.addEventListener("mousedown",this._mouseDownHandler=e=>{i.active&&i.pointerEnabled&&(getCanvasPosFromEvent$2(e,o,s.pointerCanvasPos),s.mouseover=!0)}),o.addEventListener("mouseup",this._mouseUpHandler=e=>{i.active&&i.pointerEnabled})}reset(){}destroy(){const e=this._scene.canvas.canvas;document.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("mouseleave",this._mouseLeaveHandler),e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler)}}function getCanvasPosFromEvent$2(e,t,i){if(e){const{x:s,y:r}=t.getBoundingClientRect();i[0]=e.clientX-s,i[1]=e.clientY-r}else e=window.event,i[0]=e.x,i[1]=e.y;return i}const getCanvasPosFromEvent$1=function(e,t){if(e){let i=e.target,s=0,r=0;for(;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class TouchPanRotateAndDollyHandler{constructor(e,t,i,s,r){this._scene=e;const o=t.pickController,a=t.pivotController,n=math.vec2(),h=math.vec2(),l=math.vec2(),c=math.vec2(),u=[],p=this._scene.canvas.canvas;let d=0,m=!1;this._onTick=e.on("tick",(()=>{m=!1})),p.addEventListener("touchstart",this._canvasTouchStartHandler=t=>{if(!i.active||!i.pointerEnabled)return;t.preventDefault();const r=t.touches,h=t.changedTouches;for(s.touchStartTime=Date.now(),1===r.length&&1===h.length&&(s.touchStartTime,getCanvasPosFromEvent$1(r[0],n),i.followPointer&&(o.pickCursorPos=n,o.schedulePickSurface=!0,o.update(),i.planView||(o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(a.setPivotPos(o.pickResult.worldPos),!i.firstPerson&&a.startPivot()&&a.showPivot()):(i.smartPivot?a.setCanvasPivotPos(s.pointerCanvasPos):a.setPivotPos(e.camera.look),!i.firstPerson&&a.startPivot()&&a.showPivot()))));u.length<r.length;)u.push(math.vec2());for(let e=0,t=r.length;e<t;++e)getCanvasPosFromEvent$1(r[e],u[e]);d=r.length}),p.addEventListener("touchmove",this._canvasTouchMoveHandler=t=>{if(!i.active||!i.pointerEnabled)return;if(t.stopPropagation(),t.preventDefault(),m)return;m=!0;const a=e.canvas.boundary,n=a[2]-a[0],p=a[3]-a[1],f=t.touches;if(t.touches.length===d){if(1===d){getCanvasPosFromEvent$1(f[0],h),math.subVec2(h,u[0],c);const t=c[0],o=c[1];if(null!==s.longTouchTimeout&&(Math.abs(t)>i.longTapRadius||Math.abs(o)>i.longTapRadius)&&(clearTimeout(s.longTouchTimeout),s.longTouchTimeout=null),i.planView){const s=e.camera;if("perspective"===s.projection){const a=Math.abs(e.camera.eyeLookDist)*Math.tan(s.perspective.fov/2*Math.PI/180);r.panDeltaX+=t*a/p*i.touchPanRate,r.panDeltaY+=o*a/p*i.touchPanRate}else r.panDeltaX+=.5*s.ortho.scale*(t/p)*i.touchPanRate,r.panDeltaY+=.5*s.ortho.scale*(o/p)*i.touchPanRate}else r.rotateDeltaY-=t/n*(1*i.dragRotationRate),r.rotateDeltaX+=o/p*(1.5*i.dragRotationRate)}else if(2===d){const t=f[0],a=f[1];getCanvasPosFromEvent$1(t,h),getCanvasPosFromEvent$1(a,l);const n=math.geometricMeanVec2(u[0],u[1]),c=math.geometricMeanVec2(h,l),d=math.vec2();math.subVec2(n,c,d);const m=d[0],g=d[1],_=e.camera,y=math.distVec2([t.pageX,t.pageY],[a.pageX,a.pageY]),T=(math.distVec2(u[0],u[1])-y)*i.touchDollyRate;if(r.dollyDelta=T,Math.abs(T)<1)if("perspective"===_.projection){const t=o.pickResult?o.pickResult.worldPos:e.center,s=Math.abs(math.lenVec3(math.subVec3(t,e.camera.eye,[])))*Math.tan(_.perspective.fov/2*Math.PI/180);r.panDeltaX-=m*s/p*i.touchPanRate,r.panDeltaY-=g*s/p*i.touchPanRate}else r.panDeltaX-=.5*_.ortho.scale*(m/p)*i.touchPanRate,r.panDeltaY-=.5*_.ortho.scale*(g/p)*i.touchPanRate;s.pointerCanvasPos=c}for(let e=0;e<d;++e)getCanvasPosFromEvent$1(f[e],u[e])}})}reset(){}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchmove",this._canvasTouchMoveHandler),this._scene.off(this._onTick)}}const TAP_INTERVAL=150,DBL_TAP_INTERVAL=325,TAP_DISTANCE_THRESHOLD=4,getCanvasPosFromEvent=function(e,t){if(e){let i=e.target,s=0,r=0;for(;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class TouchPickHandler{constructor(e,t,i,s,r){this._scene=e;const o=t.pickController,a=t.cameraControl;let n;const h=[],l=new Float32Array(2);let c=-1,u=-1;const p=this._scene.canvas.canvas,d=i=>{let s;i&&i.worldPos&&(s=i.worldPos);const r=i?i.entity.aabb:e.aabb;if(s){const i=e.camera;math.subVec3(i.eye,i.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};p.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{if(!i.active||!i.pointerEnabled)return;null!==s.longTouchTimeout&&(clearTimeout(s.longTouchTimeout),s.longTouchTimeout=null);const r=e.touches,o=e.changedTouches;if(n=Date.now(),1===r.length&&1===o.length){c=n,getCanvasPosFromEvent(r[0],l);const o=l[0],a=l[1],h=r[0].pageX,u=r[0].pageY;s.longTouchTimeout=setTimeout((()=>{t.cameraControl.fire("rightClick",{pagePos:[Math.round(h),Math.round(u)],canvasPos:[Math.round(o),Math.round(a)],event:e},!0),s.longTouchTimeout=null}),i.longTapTimeout)}else c=-1;for(;h.length<r.length;)h.push(new Float32Array(2));for(let e=0,t=r.length;e<t;++e)getCanvasPosFromEvent(r[e],h[e]);h.length=r.length},{passive:!0}),p.addEventListener("touchend",this._canvasTouchEndHandler=e=>{if(!i.active||!i.pointerEnabled)return;const t=Date.now(),r=e.touches,n=e.changedTouches,p=a.hasSubs("pickedSurface");null!==s.longTouchTimeout&&(clearTimeout(s.longTouchTimeout),s.longTouchTimeout=null),0===r.length&&1===n.length&&c>-1&&t-c<150&&(u>-1&&c-u<325?(getCanvasPosFromEvent(n[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=p,o.update(),o.pickResult?(a.fire("doublePicked",o.pickResult),o.pickedSurface&&a.fire("doublePickedSurface",o.pickResult),i.doublePickFlyTo&&d(o.pickResult)):(a.fire("doublePickedNothing"),i.doublePickFlyTo&&d()),u=-1):math.distVec2(h[0],l)<4&&(getCanvasPosFromEvent(n[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=p,o.update(),o.pickResult?(a.fire("picked",o.pickResult),o.pickedSurface&&a.fire("pickedSurface",o.pickResult)):a.fire("pickedNothing"),u=t),c=-1),h.length=r.length;for(let e=0,t=r.length;e<t;++e)h[e][0]=r[e].pageX,h[e][1]=r[e].pageY;e.stopPropagation()},{passive:!0})}reset(){}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)}}class CameraControl extends Component{constructor(e,t={}){super(e,t),this.PAN_LEFT=0,this.PAN_RIGHT=1,this.PAN_UP=2,this.PAN_DOWN=3,this.PAN_FORWARDS=4,this.PAN_BACKWARDS=5,this.ROTATE_X_POS=6,this.ROTATE_X_NEG=7,this.ROTATE_Y_POS=8,this.ROTATE_Y_NEG=9,this.DOLLY_FORWARDS=10,this.DOLLY_BACKWARDS=11,this.AXIS_VIEW_RIGHT=12,this.AXIS_VIEW_BACK=13,this.AXIS_VIEW_LEFT=14,this.AXIS_VIEW_FRONT=15,this.AXIS_VIEW_TOP=16,this.AXIS_VIEW_BOTTOM=17,this._keyMap={},this.scene.canvas.canvas.oncontextmenu=e=>{e.preventDefault()},this._configs={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04},this._states={pointerCanvasPos:math.vec2(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:math.vec2(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null},this._updates={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0};const i=this.scene;this._controllers={cameraControl:this,pickController:new PickController(this,this._configs),pivotController:new PivotController(i,this._configs),panController:new PanController(i),cameraFlight:new CameraFlightAnimation(this,{duration:.5})},this._handlers=[new MouseMiscHandler(this.scene,this._controllers,this._configs,this._states,this._updates),new TouchPanRotateAndDollyHandler(this.scene,this._controllers,this._configs,this._states,this._updates),new MousePanRotateDollyHandler(this.scene,this._controllers,this._configs,this._states,this._updates),new KeyboardAxisViewHandler(this.scene,this._controllers,this._configs,this._states,this._updates),new MousePickHandler(this.scene,this._controllers,this._configs,this._states,this._updates),new TouchPickHandler(this.scene,this._controllers,this._configs,this._states,this._updates),new KeyboardPanRotateDollyHandler(this.scene,this._controllers,this._configs,this._states,this._updates)],this._cameraUpdater=new CameraUpdater(this.scene,this._controllers,this._configs,this._states,this._updates),this.navMode=t.navMode,t.planView&&(this.planView=t.planView),this.constrainVertical=t.constrainVertical,t.keyboardLayout?this.keyboardLayout=t.keyboardLayout:this.keyMap=t.keyMap,this.doublePickFlyTo=t.doublePickFlyTo,this.panRightClick=t.panRightClick,this.active=t.active,this.followPointer=t.followPointer,this.rotationInertia=t.rotationInertia,this.keyboardPanRate=t.keyboardPanRate,this.touchPanRate=t.touchPanRate,this.keyboardRotationRate=t.keyboardRotationRate,this.dragRotationRate=t.dragRotationRate,this.touchDollyRate=t.touchDollyRate,this.dollyInertia=t.dollyInertia,this.dollyProximityThreshold=t.dollyProximityThreshold,this.dollyMinSpeed=t.dollyMinSpeed,this.panInertia=t.panInertia,this.pointerEnabled=!0,this.keyboardDollyRate=t.keyboardDollyRate,this.mouseWheelDollyRate=t.mouseWheelDollyRate}set keyMap(e){if(e=e||"qwerty",utils.isString(e)){const t=this.scene.input,i={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":i[this.PAN_LEFT]=[t.KEY_A],i[this.PAN_RIGHT]=[t.KEY_D],i[this.PAN_UP]=[t.KEY_Z],i[this.PAN_DOWN]=[t.KEY_X],i[this.PAN_BACKWARDS]=[],i[this.PAN_FORWARDS]=[],i[this.DOLLY_FORWARDS]=[t.KEY_W,t.KEY_ADD],i[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],i[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],i[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],i[this.ROTATE_Y_POS]=[t.KEY_Q,t.KEY_LEFT_ARROW],i[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],i[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],i[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],i[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],i[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],i[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],i[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6];break;case"azerty":i[this.PAN_LEFT]=[t.KEY_Q],i[this.PAN_RIGHT]=[t.KEY_D],i[this.PAN_UP]=[t.KEY_W],i[this.PAN_DOWN]=[t.KEY_X],i[this.PAN_BACKWARDS]=[],i[this.PAN_FORWARDS]=[],i[this.DOLLY_FORWARDS]=[t.KEY_Z,t.KEY_ADD],i[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],i[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],i[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],i[this.ROTATE_Y_POS]=[t.KEY_A,t.KEY_LEFT_ARROW],i[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],i[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],i[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],i[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],i[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],i[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],i[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6]}this._keyMap=i}else{const t=e;this._keyMap=t}}get keyMap(){return this._keyMap}_isKeyDownForAction(e,t){const i=this._keyMap[e];if(!i)return!1;t||(t=this.scene.input.keyDown);for(let e=0,s=i.length;e<s;e++){if(t[i[e]])return!0}return!1}set pivotElement(e){this._controllers.pivotController.setPivotElement(e)}set active(e){this._configs.active=!1!==e}get active(){return this._configs.active}set navMode(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),this._configs.firstPerson="firstPerson"===e,this._configs.planView="planView"===e,(this._configs.firstPerson||this._configs.planView)&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this._configs.navMode=e}get navMode(){return this._configs.navMode}set pointerEnabled(e){this._reset(),this._configs.pointerEnabled=!!e}_reset(){for(let e=0,t=this._handlers.length;e<t;e++){const t=this._handlers[e];t.reset&&t.reset()}this._updates.panDeltaX=0,this._updates.panDeltaY=0,this._updates.rotateDeltaX=0,this._updates.rotateDeltaY=0,this._updates.dolyDelta=0}get pointerEnabled(){return this._configs.pointerEnabled}set followPointer(e){this._configs.followPointer=!1!==e}get followPointer(){return this._configs.followPointer}set pivotPos(e){this._controllers.pivotController.setPivotPos(e)}get pivotPos(){return this._controllers.pivotController.getPivotPos()}set dollyToPointer(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}get dollyToPointer(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer}set panToPointer(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}get panToPointer(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1}set planView(e){this._configs.planView=!!e,this._configs.firstPerson=!1,this._configs.planView&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}get planView(){return this.warn("planView property is deprecated - replaced with navMode"),this._configs.planView}set firstPerson(e){this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson=!!e,this._configs.planView=!1,this._configs.firstPerson&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot())}get firstPerson(){return this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson}set constrainVertical(e){this._configs.constrainVertical=!!e}get constrainVertical(){return this._configs.constrainVertical}set doublePickFlyTo(e){this._configs.doublePickFlyTo=!1!==e}get doublePickFlyTo(){return this._configs.doublePickFlyTo}set panRightClick(e){this._configs.panRightClick=!1!==e}get panRightClick(){return this._configs.panRightClick}set rotationInertia(e){this._configs.rotationInertia=null!=e?e:0}get rotationInertia(){return this._configs.rotationInertia}set keyboardPanRate(e){this._configs.keyboardPanRate=null!=e?e:5}set touchPanRate(e){this._configs.touchPanRate=null!=e?e:1}get touchPanRate(){return this._configs.touchPanRate}get keyboardPanRate(){return this._configs.keyboardPanRate}set keyboardRotationRate(e){this._configs.keyboardRotationRate=null!=e?e:90}get keyboardRotationRate(){return this._configs.keyboardRotationRate}set dragRotationRate(e){this._configs.dragRotationRate=null!=e?e:360}get dragRotationRate(){return this._configs.dragRotationRate}set keyboardDollyRate(e){this._configs.keyboardDollyRate=null!=e?e:15}get keyboardDollyRate(){return this._configs.keyboardDollyRate}set touchDollyRate(e){this._configs.touchDollyRate=null!=e?e:.2}get touchDollyRate(){return this._configs.touchDollyRate}set mouseWheelDollyRate(e){this._configs.mouseWheelDollyRate=null!=e?e:100}get mouseWheelDollyRate(){return this._configs.mouseWheelDollyRate}set dollyInertia(e){this._configs.dollyInertia=null!=e?e:0}get dollyInertia(){return this._configs.dollyInertia}set dollyProximityThreshold(e){this._configs.dollyProximityThreshold=null!=e?e:35}get dollyProximityThreshold(){return this._configs.dollyProximityThreshold}set dollyMinSpeed(e){this._configs.dollyMinSpeed=null!=e?e:.04}get dollyMinSpeed(){return this._configs.dollyMinSpeed}set panInertia(e){this._configs.panInertia=null!=e?e:.5}get panInertia(){return this._configs.panInertia}set keyboardLayout(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),this._configs.keyboardLayout=e,this.keyMap=this._configs.keyboardLayout}get keyboardLayout(){return this._configs.keyboardLayout}set smartPivot(e){this._configs.smartPivot=!1!==e}get smartPivot(){return this._configs.smartPivot}destroy(){this._destroyHandlers(),this._destroyControllers(),this._cameraUpdater.destroy(),super.destroy()}_destroyHandlers(){for(let e=0,t=this._handlers.length;e<t;e++){const t=this._handlers[e];t.destroy&&t.destroy()}}_destroyControllers(){for(let e=0,t=this._controllers.length;e<t;e++){const t=this._controllers[e];t.destroy&&t.destroy()}}}class MetaModel{constructor(e,t,i,s,r,o,a,n,h,l){this.id=t,this.projectId=i,this.revisionId=s,this.author=r,this.createdAt=o,this.creatingApplication=a,this.schema=n,this.metaScene=e,this.propertySets=h,this.rootMetaObject=l}getJSON(){const e=[];!function t(i){const s={id:i.id,extId:i.extId,type:i.type,name:i.name};i.parent&&(s.parent=i.parent.id),e.push(s);const r=i.children;if(r)for(let e=0,i=r.length;e<i;e++)t(r[e])}(this.rootMetaObject);return{id:this.id,projectId:this.projectId,revisionId:this.revisionId,metaObjects:e}}}class MetaObject{constructor(e,t,i,s,r,o,a,n,h){this.metaModel=e,this.id=t,this.originalSystemId=i,this.name=s,this.type=r,this.propertySets=o,null!=a&&(this.parent=a),null!=n&&(this.children=n),null!=h&&(this.external=h)}getObjectIDsInSubtree(){const e=[];return function t(i){if(!i)return;e.push(i.id);const s=i.children;if(s)for(var r=0,o=s.length;r<o;r++)t(s[r])}(this),e}withMetaObjectsInSubtree(e){!function t(i){if(!i)return;e(i);const s=i.children;if(s)for(var r=0,o=s.length;r<o;r++)t(s[r])}(this)}getObjectIDsInSubtreeByType(e){const t={};for(var i=0,s=e.length;i<s;i++)t[e[i]]=e[i];const r=[];return function e(i){if(!i)return;t[i.type]&&r.push(i.id);const s=i.children;if(s)for(var o=0,a=s.length;o<a;o++)e(s[o])}(this),r}getJSON(){var e={id:this.id,type:this.type,name:this.name};return this.parent&&(e.parent=this.parent.id),e}}class Property{constructor(e,t,i,s,r){this.name=e,this.type=i,this.value=t,this.valueType=s,this.description=r}}class PropertySet{constructor(e,t,i,s,r){if(this.id=e,this.originalSystemId=t,this.name=i,this.type=s,this.properties=[],r)for(let e=0,t=r.length;e<t;e++){const t=r[e];this.properties.push(new Property(t.name,t.value,t.type,t.valueType,t.description))}}}class MetaScene{constructor(e,t){this.viewer=e,this.scene=t,this.metaModels={},this.propertySets={},this.metaObjects={},this.metaObjectsByType={},this._typeCounts={},this._eventSubs={}}on(e,t){let i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}fire(e,t){const i=this._eventSubs[e];if(i)for(let e=0,s=i.length;e<s;e++)i[e](t)}off(e){}createMetaModel(e,t,i={}){const s=t.projectId||"none",r=t.revisionId||"none",o=t.propertySets||[],a=t.metaObjects||[],n=t.author,h=t.createdAt,l=t.creatingApplication,c=t.schema,u=new MetaModel(this,e,s,r,n,h,l,c,[],null);this.metaModels[e]=u;for(let e=0,t=o.length;e<t;e++){const t=o[e],i=t.id,s=new PropertySet(i,t.originalSystemId,t.name,t.type,t.properties);u.propertySets[i]=s,this.propertySets[i]=s}const p=[];for(let e=0,t=a.length;e<t;e++){const t=a[e];void 0!==t.parent&&null!==t.parent||p.push(t)}if(0===p.length){this.scene.error("Cyclic containment hierarchy found in metamodel - will flatten the hierarchy and insert fake 'Model' root");const t={id:e+".fakeRoot",name:e,type:"Model",parent:null};for(let e=0,i=a.length;e<i;e++)a[e].parent=t.id;a.push(t)}if(p.length>1){this.scene.error("Multiple containment hierarchy root found in metamodel - will insert fake 'Model' root");const t={id:e+".fakeRoot",name:e,type:"Model",parent:null};a.push(t);for(let e=0,i=p.length;e<i;e++)p[e].parent=t.id}for(let t=0,s=a.length;t<s;t++){const s=a[t],r=s.type,o=i.globalizeObjectIds?math.globalizeObjectId(e,s.id):s.id,n=s.id,h=s.name,l=[];if(s.propertySetIds&&s.propertySetIds.length>0)for(let e=0,t=s.propertySetIds.length;e<t;e++){const t=s.propertySetIds[e],i=u.propertySets[t];i&&l.push(i)}const c=null,p=null,d=s.external,m=new MetaObject(u,o,n,h,r,l,c,p,d);this.metaObjects[o]=m,(this.metaObjectsByType[r]||(this.metaObjectsByType[r]={}))[o]=m,void 0===this._typeCounts[r]?this._typeCounts[r]=1:this._typeCounts[r]++}for(let t=0,s=a.length;t<s;t++){const s=a[t],r=i.globalizeObjectIds?math.globalizeObjectId(e,s.id):s.id,o=this.metaObjects[r];if(o)if(void 0===s.parent||null===s.parent)u.rootMetaObject=o;else if(s.parent){const t=i.globalizeObjectIds?math.globalizeObjectId(e,s.parent):s.parent;let r=this.metaObjects[t];r&&(o.parent=r,r.children=r.children||[],r.children.push(o))}}return this.fire("metaModelCreated",e),u}destroyMetaModel(e){const t=this.metaModels[e];t&&(this._removeMetaModel(t),this.fire("metaModelDestroyed",e))}_removeMetaModel(e){const t=this.metaObjects,i=this.metaObjectsByType;let s=e=>{delete t[e.id];const r=i[e.type];r&&r[e.id]&&(delete r[e.id],0==--this._typeCounts[e.type]&&(delete this._typeCounts[e.type],delete i[e.type]));const o=e.children;if(o)for(let e=0,t=o.length;e<t;e++){const t=o[e];s(t)}};s(e.rootMetaObject);for(let t in e.propertySets)e.propertySets.hasOwnProperty(t)&&delete this.propertySets[t];delete this.metaModels[e.id]}getObjectIDsByType(e){const t=this.metaObjectsByType[e];return t?Object.keys(t):[]}getObjectIDsInSubtree(e,t,i){const s=[],r=this.metaObjects[e],o=t&&t.length>0?arrayToMap(t):null,a=i&&i.length>0?arrayToMap(i):null;return function e(t){if(!t)return;var i=!0;(a&&a[t.type]||o&&!o[t.type])&&(i=!1),i&&s.push(t.id);const r=t.children;if(r)for(var n=0,h=r.length;n<h;n++)e(r[n])}(r),s}withMetaObjectsInSubtree(e,t){const i=this.metaObjects[e];i&&i.withMetaObjectsInSubtree(t)}}function arrayToMap(e){const t={};for(var i=0,s=e.length;i<s;i++)t[e[i]]=!0;return t}class Viewer{constructor(e){this.language="en",this.localeService=e.localeService||new LocaleService,this.scene=new Scene(this,{canvasId:e.canvasId,canvasElement:e.canvasElement,keyboardEventsElement:e.keyboardEventsElement,webgl2:!1,contextAttr:{preserveDrawingBuffer:!1!==e.preserveDrawingBuffer,premultipliedAlpha:!!e.premultipliedAlpha,antialias:!1!==e.antialias},spinnerElementId:e.spinnerElementId,transparent:!1!==e.transparent,gammaInput:!0,gammaOutput:!1,backgroundColor:e.backgroundColor,backgroundColorFromAmbientLight:e.backgroundColorFromAmbientLight,ticksPerRender:1,ticksPerOcclusionTest:20,units:e.units,scale:e.scale,origin:e.origin,saoEnabled:e.saoEnabled,alphaDepthMask:!1!==e.alphaDepthMask,entityOffsetsEnabled:!!e.entityOffsetsEnabled,pickSurfacePrecisionEnabled:!!e.pickSurfacePrecisionEnabled,logarithmicDepthBufferEnabled:!!e.logarithmicDepthBufferEnabled,pbrEnabled:!!e.pbrEnabled,colorTextureEnabled:!1!==e.colorTextureEnabled}),this.metaScene=new MetaScene(this,this.scene),this.id=e.id||this.scene.id,this.camera=this.scene.camera,this.cameraFlight=new CameraFlightAnimation(this.scene,{duration:.5}),this.cameraControl=new CameraControl(this.scene,{doublePickFlyTo:!0}),this._plugins=[],this._eventSubs={}}on(e,t){let i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}fire(e,t){const i=this._eventSubs[e];if(i)for(let e=0,s=i.length;e<s;e++)i[e](t)}off(e){}log(e){console.log(`[xeokit viewer ${this.id}]: ${e}`)}error(e){console.error(`[xeokit viewer ${this.id}]: ${e}`)}addPlugin(e){this._plugins.push(e)}removePlugin(e){for(let t=0,i=this._plugins.length;t<i;t++){const i=this._plugins[t];if(i===e)return i.clear&&i.clear(),void this._plugins.splice(t,1)}}sendToPlugins(e,t){for(let i=0,s=this._plugins.length;i<s;i++){const s=this._plugins[i];s.send&&s.send(e,t)}}clear(){throw'Viewer#clear() no longer implemented - use \'#sendToPlugins("clear") instead'}resetView(){throw"Viewer#resetView() no longer implemented - use CameraMemento & ObjectsMemento classes instead"}beginSnapshot(){this._snapshotBegun||(this.scene._renderer.beginSnapshot(),this._snapshotBegun=!0)}getSnapshot(e={}){const t=!this._snapshotBegun;this._snapshotBegun||this.beginSnapshot(),e.includeGizmos||this.sendToPlugins("snapshotStarting");const i=void 0!==e.width&&void 0!==e.height,s=this.scene.canvas.canvas,r=s.clientWidth,o=s.clientHeight,a=s.style.width,n=s.style.height,h=e.width?Math.floor(e.width):s.width,l=e.height?Math.floor(e.height):s.height;i&&(s.style.width=h+"px",s.style.height=l+"px"),this.scene._renderer.renderSnapshot();const c=this.scene._renderer.readSnapshot(e);return i&&(s.style.width=a,s.style.height=n,s.width=r,s.height=o,this.scene.glRedraw()),e.includeGizmos||this.sendToPlugins("snapshotFinished"),t&&this.endSnapshot(),c}endSnapshot(){this._snapshotBegun&&(this.scene._renderer.endSnapshot(),this.scene._renderer.render({force:!0}),this._snapshotBegun=!1)}destroy(){const e=this._plugins.slice();for(let t=0,i=e.length;t<i;t++){e[t].destroy()}this.scene.destroy()}}class Configs{constructor(){}set doublePrecisionEnabled(e){math.setDoublePrecisionEnabled(e)}get doublePrecisionEnabled(){return math.getDoublePrecisionEnabled()}}class WebIFCLoaderPlugin extends Plugin{constructor(e,t={}){super("ifcLoader",e,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults,this.includeTypes=t.includeTypes,this.excludeTypes=t.excludeTypes,this.excludeUnclassifiedObjects=t.excludeUnclassifiedObjects,this._ifcAPI=new IfcAPI2,t.wasmPath&&this._ifcAPI.SetWasmPath(t.wasmPath),this._ifcAPI.Init().then((()=>{this.fire("initialized",!0,!1)})).catch((e=>{this.error(e)}))}get supportedVersions(){return["2x3","4"]}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new WebIFCDefaultDataSource}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||IFCObjectDefaults}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new PerformanceModel(this.viewer.scene,utils.apply(e,{isModel:!0}));if(!e.src&&!e.ifc)return this.error("load() param expected: src or IFC"),t;const i={autoNormals:!0};if(!1!==e.loadMetadata){const t=e.includeTypes||this._includeTypes,s=e.excludeTypes||this._excludeTypes,r=e.objectDefaults||this._objectDefaults;if(t){i.includeTypesMap={};for(let e=0,s=t.length;e<s;e++)i.includeTypesMap[t[e]]=!0}if(s){i.excludeTypesMap={};for(let e=0,t=s.length;e<t;e++)i.excludeTypesMap[s[e]]=!0}r&&(i.objectDefaults=r),i.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,i.globalizeObjectIds=void 0!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds}return this.on("initialized",(()=>{e.src?this._loadModel(e.src,e,i,t):this._parseModel(e.ifc,e,i,t)})),t}_loadModel(e,t,i,s){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getIFC(t.src,(e=>{this._parseModel(e,t,i,s),r.processes--}),(e=>{r.processes--,this.error(e),s.fire("error",e)}))}_parseModel(e,t,i,s){if(s.destroyed)return;const r=t.stats||{};r.sourceFormat="IFC",r.schemaVersion="",r.title="",r.author="",r.created="",r.numMetaObjects=0,r.numPropertySets=0,r.numObjects=0,r.numGeometries=0,r.numTriangles=0,r.numVertices=0,i.wasmPath&&this._ifcAPI.SetWasmPath(i.wasmPath);const o=new Uint8Array(e),a=this._ifcAPI.OpenModel(o),n=this._ifcAPI.GetLineIDsWithType(a,IFCPROJECT).get(0),h=!1!==t.loadMetadata,l={modelID:a,performanceModel:s,loadMetadata:h,metadata:h?{id:"",projectId:""+n,author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[],propertySets:[]}:null,metaObjects:{},options:i,log:function(e){},nextId:0,stats:r};if(h){if(i.includeTypes){l.includeTypes={};for(let e=0,t=i.includeTypes.length;e<t;e++)l.includeTypes[i.includeTypes[e]]=!0}if(i.excludeTypes){l.excludeTypes={};for(let e=0,t=i.excludeTypes.length;e<t;e++)l.excludeTypes[i.excludeTypes[e]]=!0}this._parseMetaObjects(l),this._parsePropertySets(l)}if(this._parseGeometry(l),s.finalize(),h){const e=s.id;this.viewer.metaScene.createMetaModel(e,l.metadata,i)}s.scene.once("tick",(()=>{s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))}))}_parseMetaObjects(e){const t=this._ifcAPI.GetLineIDsWithType(e.modelID,IFCPROJECT).get(0),i=this._ifcAPI.GetLine(e.modelID,t);this._parseSpatialChildren(e,i)}_parseSpatialChildren(e,t,i){const s=t.__proto__.constructor.name;if(e.includeTypes&&!e.includeTypes[s])return;if(e.excludeTypes&&e.excludeTypes[s])return;this._createMetaObject(e,t,i);const r=t.GlobalId.value;this._parseRelatedItemsOfType(e,t.expressID,"RelatingObject","RelatedObjects",IFCRELAGGREGATES,r),this._parseRelatedItemsOfType(e,t.expressID,"RelatingStructure","RelatedElements",IFCRELCONTAINEDINSPATIALSTRUCTURE,r)}_createMetaObject(e,t,i){const s=t.GlobalId.value,r=t.__proto__.constructor.name,o={id:s,name:r,type:t.Name&&""!==t.Name.value?t.Name.value:r,parent:i};e.metadata.metaObjects.push(o),e.metaObjects[s]=o,e.stats.numMetaObjects++}_parseRelatedItemsOfType(e,t,i,s,r,o){const a=this._ifcAPI.GetLineIDsWithType(e.modelID,r);for(let r=0;r<a.size();r++){const n=a.get(r),h=this._ifcAPI.GetLine(e.modelID,n),l=h[i];let c=!1;if(Array.isArray(l)){c=l.map((e=>e.value)).includes(t)}else c=l.value===t;if(c){const t=h[s];if(Array.isArray(t))t.forEach((t=>{const i=this._ifcAPI.GetLine(e.modelID,t.value);this._parseSpatialChildren(e,i,o)}));else{const i=this._ifcAPI.GetLine(e.modelID,t.value);this._parseSpatialChildren(e,i,o)}}}}_parsePropertySets(e){const t=this._ifcAPI.GetLineIDsWithType(e.modelID,IFCRELDEFINESBYPROPERTIES);for(let i=0;i<t.size();i++){let s=t.get(i),r=this._ifcAPI.GetLine(e.modelID,s,!0);if(r){const t=r.RelatingPropertyDefinition;if(!t)continue;const i=t.GlobalId.value,s=t.HasProperties;if(s&&s.length>0){const o="Default",a=t.Name.value,n=[];for(let e=0,t=s.length;e<t;e++){const t=s[e],i=t.Name,r=t.NominalValue;if(i&&r){const e={name:i.value,type:r.type,value:r.value,valueType:r.valueType};t.Description?e.description=t.Description.value:r.description&&(e.description=r.description),n.push(e)}}const h={id:i,type:o,name:a,properties:n};e.metadata.propertySets.push(h),e.stats.numPropertySets++;const l=r.RelatedObjects;if(!l||0===l.length)for(let t=0,s=l.length;t<s;t++){const s=l[t].GlobalId.value,r=e.metaObjects[s];r&&(r.propertySetIds||(r.propertySetIds=[]),r.propertySetIds.push(i))}}}}}_parseGeometry(e){this._ifcAPI.StreamAllMeshes(e.modelID,(t=>{const i=t.expressID,s=t.geometries,r=[],o=this._ifcAPI.GetLine(e.modelID,i).GlobalId.value;if(e.loadMetadata){const t=o,i=e.metaObjects[t];if(e.includeTypes&&(!i||!e.includeTypes[i.type]))return;if(e.excludeTypes&&(!i||e.excludeTypes[i.type]))return}const a=math.mat4(),n=math.vec3();for(let t=0,i=s.size();t<i;t++){const i=s.get(t),o=this._ifcAPI.GetGeometry(e.modelID,i.geometryExpressID),h=this._ifcAPI.GetVertexArray(o.GetVertexData(),o.GetVertexDataSize()),l=this._ifcAPI.GetIndexArray(o.GetIndexData(),o.GetIndexDataSize()),c=new Float64Array(h.length/2),u=new Float32Array(h.length/2);for(let e=0,t=0,i=h.length/6;e<i;e++,t+=3)c[t+0]=h[6*e+0],c[t+1]=h[6*e+1],c[t+2]=h[6*e+2];a.set(i.flatTransformation),math.transformPositions3(a,c);const p=worldToRTCPositions(c,c,n);if(!e.options.autoNormals)for(let e=0,t=0,i=h.length/6;e<i;e++,t+=3)u[t+0]=h[6*e+3],u[t+1]=h[6*e+4],u[t+2]=h[6*e+5];e.stats.numGeometries++,e.stats.numVertices+=c.length/3,e.stats.numTriangles+=l.length/3;const d="mesh"+e.nextId++;e.performanceModel.createMesh({id:d,primitive:"triangles",origin:p?n:null,positions:c,normals:e.options.autoNormals?null:u,indices:l,color:[i.color.x,i.color.y,i.color.z],opacity:i.color.w}),r.push(d)}const h=e.options.globalizeObjectIds?math.globalizeObjectId(e.performanceModel.id,o):o;e.performanceModel.createEntity({id:h,meshIds:r,isObject:!0}),e.stats.numObjects++}))}}class LASDefaultDataSource{constructor(){}getLAS(e,t,i){var s=()=>{};t=t||s,i=i||s;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),i=new Uint8Array(e);for(var a=0;a<o.length;a++)i[a]=o.charCodeAt(a);t(e)}catch(e){i(e)}}else{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i("getXKT error : "+s.response))},s.send(null)}}}function assert$2(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const globals$1={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},global_=globals$1.global||globals$1.self||globals$1.window||{},isBrowser$2="object"!=typeof process||"[object process]"!==String(process)||process.browser,matches$1="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);matches$1&&parseFloat(matches$1[1]);const VERSION$2="3.0.13";function assert$1(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"object"!=typeof process||"[object process]"!==String(process)||process.browser;const isMobile="undefined"!=typeof window&&void 0!==window.orientation,matches="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}matches&&parseFloat(matches[1]);class WorkerJob{constructor(e,t){_defineProperty(this,"name",void 0),_defineProperty(this,"workerThread",void 0),_defineProperty(this,"isRunning",void 0),_defineProperty(this,"result",void 0),_defineProperty(this,"_resolve",void 0),_defineProperty(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){assert$1(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){assert$1(this.isRunning),this.isRunning=!1,this._reject(e)}}const workerURLCache=new Map;function getLoadableWorkerURL(e){assert$1(e.source&&!e.url||!e.source&&e.url);let t=workerURLCache.get(e.source||e.url);return t||(e.url&&(t=getLoadableWorkerURLFromURL(e.url),workerURLCache.set(e.url,t)),e.source&&(t=getLoadableWorkerURLFromSource(e.source),workerURLCache.set(e.source,t))),assert$1(t),t}function getLoadableWorkerURLFromURL(e){if(!e.startsWith("http"))return e;return getLoadableWorkerURLFromSource(buildScriptSource(e))}function getLoadableWorkerURLFromSource(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function buildScriptSource(e){return"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")}function getTransferList(e,t=!0,i){const s=i||new Set;if(e){if(isTransferable(e))s.add(e);else if(isTransferable(e.buffer))s.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const i in e)getTransferList(e[i],t,s)}else;return void 0===i?Array.from(s):[]}function isTransferable(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const NOOP=()=>{};class WorkerThread{static isSupported(){return"undefined"!=typeof Worker}constructor(e){_defineProperty(this,"name",void 0),_defineProperty(this,"source",void 0),_defineProperty(this,"url",void 0),_defineProperty(this,"terminated",!1),_defineProperty(this,"worker",void 0),_defineProperty(this,"onMessage",void 0),_defineProperty(this,"onError",void 0),_defineProperty(this,"_loadableURL","");const{name:t,source:i,url:s}=e;assert$1(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=NOOP,this.onError=e=>console.log(e),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=NOOP,this.onError=NOOP,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||getTransferList(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}}class WorkerPool{constructor(e){_defineProperty(this,"name","unnamed"),_defineProperty(this,"source",void 0),_defineProperty(this,"url",void 0),_defineProperty(this,"maxConcurrency",1),_defineProperty(this,"maxMobileConcurrency",1),_defineProperty(this,"onDebug",(()=>{})),_defineProperty(this,"reuseWorkers",!0),_defineProperty(this,"props",{}),_defineProperty(this,"jobQueue",[]),_defineProperty(this,"idleQueue",[]),_defineProperty(this,"count",0),_defineProperty(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,i)=>e.done(i)),i=((e,t)=>e.error(t))){const s=new Promise((s=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:s}),this)));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new WorkerJob(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class WorkerFarm{static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){_defineProperty(this,"props",void 0),_defineProperty(this,"workerPools",new Map),this.props={...DEFAULT_PROPS},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let r=this.workerPools.get(t);return r||(r=new WorkerPool({name:t,source:i,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}_defineProperty(WorkerFarm,"_workerFarm",void 0);const NPM_TAG="latest";function getWorkerURL(e,t={}){const i=t[e.id]||{},s="".concat(e.id,"-worker.js");let r=i.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r="modules/".concat(e.module,"/dist/").concat(s)),!r){let t=e.version;"latest"===t&&(t=NPM_TAG);const i=t?"@".concat(t):"";r="https://unpkg.com/@loaders.gl/".concat(e.module).concat(i,"/dist/").concat(s)}return assert$1(r),r}function validateWorkerVersion(e,t="3.0.13"){assert$1(e,"no worker provided");const i=e.version;return!(!t||!i)}var makeNodeStream={},node=Object.freeze({__proto__:null,default:makeNodeStream});function canParseWithWorker(e,t){return!!WorkerFarm.isSupported()&&(e.worker&&(null==t?void 0:t.worker))}async function parseWithWorker(e,t,i,s,r){const o=e.id,a=getWorkerURL(e,i),n=WorkerFarm.getWorkerFarm(i).getWorkerPool({name:o,url:a});i=JSON.parse(JSON.stringify(i));const h=await n.startJob("process-on-worker",onMessage.bind(null,r));h.postMessage("process",{input:t,options:i});const l=await h.result;return await l.result}async function onMessage(e,t,i,s){switch(i){case"done":t.done(s);break;case"error":t.error(s.error);break;case"process":const{id:r,input:o,options:a}=s;try{const i=await e(o,a);t.postMessage("done",{id:r,result:i})}catch(e){const i=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:i})}break;default:console.warn("parse-with-worker unknown message ".concat(i))}}function isBuffer$1(e){return e&&"object"==typeof e&&e.isBuffer}function bufferToArrayBuffer(e){return e}function toArrayBuffer(e){if(isBuffer$1(e)&&(e=bufferToArrayBuffer(e)),e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function compareArrayBuffers(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<s.length;++e)if(s[e]!==r[e])return!1;return!0}function concatenateArrayBuffers(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),i=t.reduce(((e,t)=>e+t.byteLength),0),s=new Uint8Array(i);let r=0;for(const e of t)s.set(e,r),r+=e.byteLength;return s.buffer}async function concatenateArrayBuffersAsync(e){const t=[];for await(const i of e)t.push(i);return concatenateArrayBuffers(...t)}let pathPrefix="";const fileAliases={};function resolvePath(e){for(const t in fileAliases)if(e.startsWith(t)){const i=fileAliases[t];e=e.replace(t,i)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat(pathPrefix).concat(e)),e}const isBoolean=e=>"boolean"==typeof e,isFunction=e=>"function"==typeof e,isObject=e=>null!==e&&"object"==typeof e,isPureObject=e=>isObject(e)&&e.constructor==={}.constructor,isIterable=e=>e&&"function"==typeof e[Symbol.iterator],isAsyncIterable=e=>e&&"function"==typeof e[Symbol.asyncIterator],isResponse=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,isBlob=e=>"undefined"!=typeof Blob&&e instanceof Blob,isReadableDOMStream=e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||isObject(e)&&isFunction(e.tee)&&isFunction(e.cancel)&&isFunction(e.getReader),isBuffer=e=>e&&"object"==typeof e&&e.isBuffer,isReadableNodeStream=e=>isObject(e)&&isFunction(e.read)&&isFunction(e.pipe)&&isBoolean(e.readable),isReadableStream=e=>isReadableDOMStream(e)||isReadableNodeStream(e),DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function parseMIMEType(e){const t=MIME_TYPE_PATTERN.exec(e);return t?t[1]:e}function parseMIMETypeFromURL(e){const t=DATA_URL_PATTERN.exec(e);return t?t[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function getResourceUrlAndType(e){if(isResponse(e)){const t=stripQueryString(e.url||"");return{url:t,type:parseMIMEType(e.headers.get("content-type")||"")||parseMIMETypeFromURL(t)}}return isBlob(e)?{url:stripQueryString(e.name||""),type:e.type||""}:"string"==typeof e?{url:stripQueryString(e),type:parseMIMETypeFromURL(e)}:{url:"",type:""}}function getResourceContentLength(e){return isResponse(e)?e.headers["content-length"]||-1:isBlob(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function stripQueryString(e){return e.replace(QUERY_STRING_PATTERN,"")}async function makeResponse(e){if(isResponse(e))return e;const t={},i=getResourceContentLength(e);i>=0&&(t["content-length"]=String(i));const{url:s,type:r}=getResourceUrlAndType(e);r&&(t["content-type"]=r);const o=await getInitialDataUrl(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const a=new Response(e,{headers:t});return Object.defineProperty(a,"url",{value:s}),a}async function checkResponse(e){if(!e.ok){const t=await getResponseError(e);throw new Error(t)}}async function getResponseError(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const i=e.headers.get("Content-Type");let s=e.statusText;i.includes("application/json")&&(s+=" ".concat(await e.text())),t+=s,t=t.length>60?"".concat(t.slice(60),"..."):t}catch(e){}return t}async function getInitialDataUrl(e){if("string"==typeof e)return"data:,".concat(e.slice(0,5));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const i=new FileReader;i.onload=t=>{var i;return e(null==t||null===(i=t.target)||void 0===i?void 0:i.result)},i.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const t=arrayBufferToBase64(e.slice(0,5));return"data:base64,".concat(t)}return null}function arrayBufferToBase64(e){let t="";const i=new Uint8Array(e);for(let e=0;e<i.byteLength;e++)t+=String.fromCharCode(i[e]);return btoa(t)}async function fetchFile(e,t){if("string"==typeof e){e=resolvePath(e);let i=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(i=t.fetch),await fetch(e,i)}return await makeResponse(e)}function isElectron(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=e||t;return!!(i&&i.indexOf("Electron")>=0)}function isBrowser$1(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||isElectron()}const globals={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},window_=globals.window||globals.self||globals.global,process_=globals.process||{},VERSION$1="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",isBrowser=isBrowser$1();function getStorage(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch(e){return null}}class LocalStorage{constructor(e,t,i="sessionStorage"){this.storage=getStorage(i),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function formatTime(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}function leftPad(e,t=8){const i=Math.max(t-e.length,0);return"".concat(" ".repeat(i)).concat(e)}function formatImage(e,t,i,s=600){const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(i=Math.min(i,s/e.width));const o=e.width*i,a=e.height*i,n=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(r,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),n]}const COLOR={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function getColor(e){return"string"==typeof e?COLOR[e.toUpperCase()]||COLOR.WHITE:e}function addColor(e,t,i){return isBrowser||"string"!=typeof e||(t&&(t=getColor(t),e="[".concat(t,"m").concat(e,"[39m")),i&&(t=getColor(i),e="[".concat(i+10,"m").concat(e,"[49m"))),e}function autobind(e,t=["constructor"]){const i=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(i);for(const i of s)"function"==typeof e[i]&&(t.find((e=>i===e))||(e[i]=e[i].bind(e)))}function assert(e,t){if(!e)throw new Error(t||"Assertion failed")}function getHiResTimestamp(){let e;if(isBrowser&&window_.performance)e=window_.performance.now();else if(process_.hrtime){const t=process_.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const originalConsole={debug:isBrowser&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_SETTINGS={enabled:!0,level:0};function noop(){}const cache={},ONCE={once:!0};function getTableHeader(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}class Log{constructor({id:e}={id:""}){this.id=e,this.VERSION=VERSION$1,this._startTs=getHiResTimestamp(),this._deltaTs=getHiResTimestamp(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new LocalStorage("__probe-".concat(this.id,"__"),DEFAULT_SETTINGS),this.userData={},this.timeStamp("".concat(this.id," started")),autobind(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){assert(e,t)}warn(e){return this._getLogFunction(0,e,originalConsole.warn,arguments,ONCE)}error(e){return this._getLogFunction(0,e,originalConsole.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,originalConsole.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,originalConsole.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||noop,i&&[i],{tag:getTableHeader(t)}):noop}image({logLevel:e,priority:t,image:i,message:s="",scale:r=1}){return this._shouldLog(e||t)?isBrowser?logImageInBrowser({image:i,message:s,scale:r}):logImageInNode({image:i,message:s,scale:r}):noop}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||noop)}group(e,t,i={collapsed:!1}){i=normalizeArguments({logLevel:e,message:t,opts:i});const{collapsed:s}=i;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||noop)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(e)}_getLogFunction(e,t,i,s=[],r){if(this._shouldLog(e)){r=normalizeArguments({logLevel:e,message:t,args:s,opts:r}),assert(i=i||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=getHiResTimestamp();const o=r.tag||r.message;if(r.once){if(cache[o])return noop;cache[o]=getHiResTimestamp()}return t=decorateMessage(this.id,r.message,r),i.bind(console,t,...r.args)}return noop}}function normalizeLogLevel(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return assert(Number.isFinite(t)&&t>=0),t}function normalizeArguments(e){const{logLevel:t,message:i}=e;e.logLevel=normalizeLogLevel(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==i;);switch(e.args=s,typeof t){case"string":case"function":void 0!==i&&s.unshift(i),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return assert("string"===r||"object"===r),Object.assign(e,e.opts)}function decorateMessage(e,t,i){if("string"==typeof t){const s=i.time?leftPad(formatTime(i.total)):"";t=addColor(t=i.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),i.color,i.background)}return t}function logImageInNode({image:e,message:t="",scale:i=1}){let s=null;try{s=module.require("asciify-image")}catch(e){}return s?()=>s(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then((e=>console.log(e))):noop}function logImageInBrowser({image:e,message:t="",scale:i=1}){if("string"==typeof e){const s=new Image;return s.onload=()=>{const e=formatImage(s,t,i);console.log(...e)},s.src=e,noop}const s=e.nodeName||"";if("img"===s.toLowerCase())return console.log(...formatImage(e,t,i)),noop;if("canvas"===s.toLowerCase()){const s=new Image;return s.onload=()=>console.log(...formatImage(s,t,i)),s.src=e.toDataURL(),noop}return noop}Log.VERSION=VERSION$1;const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{constructor(){_defineProperty(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){global_.loaders=global_.loaders||{};const{loaders:e}=global_;return e._state=e._state||{},e._state}const getGlobalLoaderOptions=()=>{const e=getGlobalLoaderState();return e.globalOptions=e.globalOptions||{...DEFAULT_LOADER_OPTIONS},e.globalOptions};function normalizeOptions(e,t,i,s){return i=i||[],validateOptions(e,i=Array.isArray(i)?i:[i]),normalizeOptionsInternal(t,e,s)}function getFetchFunction(e,t){const i=getGlobalLoaderOptions(),s=e||i;return"function"==typeof s.fetch?s.fetch:isObject(s.fetch)?e=>fetchFile(e,s):null!=t&&t.fetch?null==t?void 0:t.fetch:fetchFile}function validateOptions(e,t){validateOptionsObject(e,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,t);for(const i of t){const s=e&&e[i.id]||{},r=i.options&&i.options[i.id]||{},o=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};validateOptionsObject(s,i.id,r,o,t)}}function validateOptionsObject(e,t,i,s,r){const o=t||"Top level",a=t?"".concat(t,"."):"";for(const n in e){const h=!t&&isObject(e[n]),l="baseUri"===n&&!t,c="workerUrl"===n&&t;if(!(n in i)&&!l&&!c)if(n in s)probeLog.warn("".concat(o," loader option '").concat(a).concat(n,"' no longer supported, use '").concat(s[n],"'"))();else if(!h){const e=findSimilarOption(n,r);probeLog.warn("".concat(o," loader option '").concat(a).concat(n,"' not recognized. ").concat(e))()}}}function findSimilarOption(e,t){const i=e.toLowerCase();let s="";for(const r of t)for(const t in r.options){if(e===t)return"Did you mean '".concat(r.id,".").concat(t,"'?");const o=t.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(s=s||"Did you mean '".concat(r.id,".").concat(t,"'?"))}return s}function normalizeOptionsInternal(e,t,i){const s={...e.options||{}};return addUrlOptions(s,i),null===s.log&&(s.log=new NullLog),mergeNestedFields(s,getGlobalLoaderOptions()),mergeNestedFields(s,t),s}function mergeNestedFields(e,t){for(const i in t)if(i in t){const s=t[i];isPureObject(s)&&isPureObject(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function addUrlOptions(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function isLoaderObject(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function normalizeLoader(e){var t,i;let s;return assert$2(e,"null loader"),assert$2(isLoaderObject(e),"invalid loader"),Array.isArray(e)&&(s=e[1],e=e[0],e={...e,options:{...e.options,...s}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(i=e)&&void 0!==i&&i.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const getGlobalLoaderRegistry=()=>{const e=getGlobalLoaderState();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(e,t=[],i,s){if(!validHTTPResponse(e))return null;let r=selectLoaderSync(e,t,{...i,nothrow:!0},s);if(r)return r;if(isBlob(e)&&(r=selectLoaderSync(e=await e.slice(0,10).arrayBuffer(),t,i,s)),!(r||null!=i&&i.nothrow))throw new Error(getNoValidLoaderMessage(e));return r}function selectLoaderSync(e,t=[],i,s){if(!validHTTPResponse(e))return null;if(t&&!Array.isArray(t))return normalizeLoader(t);let r=[];t&&(r=r.concat(t)),null!=i&&i.ignoreRegisteredLoaders||r.push(...getRegisteredLoaders()),normalizeLoaders(r);const o=selectLoaderInternal(e,r,i,s);if(!(o||null!=i&&i.nothrow))throw new Error(getNoValidLoaderMessage(e));return o}function selectLoaderInternal(e,t,i,s){const{url:r,type:o}=getResourceUrlAndType(e),a=r||(null==s?void 0:s.url);let n=null;return null!=i&&i.mimeType&&(n=findLoaderByMIMEType(t,null==i?void 0:i.mimeType)),n=n||findLoaderByUrl(t,a),n=n||findLoaderByMIMEType(t,o),n=n||findLoaderByInitialBytes(t,e),n=n||findLoaderByMIMEType(t,null==i?void 0:i.fallbackMimeType),n}function validHTTPResponse(e){return!(e instanceof Response&&204===e.status)}function getNoValidLoaderMessage(e){const{url:t,type:i}=getResourceUrlAndType(e);let s="No valid loader found";return e&&(s+=' data: "'.concat(getFirstCharacters(e),'", contentType: "').concat(i,'"')),t&&(s+=" url: ".concat(t)),s}function normalizeLoaders(e){for(const t of e)normalizeLoader(t)}function findLoaderByUrl(e,t){const i=t&&EXT_PATTERN.exec(t),s=i&&i[1];return s?findLoaderByExtension(e,s):null}function findLoaderByExtension(e,t){t=t.toLowerCase();for(const i of e)for(const e of i.extensions)if(e.toLowerCase()===t)return i;return null}function findLoaderByMIMEType(e,t){for(const i of e){if(i.mimeTypes&&i.mimeTypes.includes(t))return i;if(t==="application/x.".concat(i.id))return i}return null}function findLoaderByInitialBytes(e,t){if(!t)return null;for(const i of e)if("string"==typeof t){if(testDataAgainstText(t,i))return i}else if(ArrayBuffer.isView(t)){if(testDataAgainstBinary(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer){if(testDataAgainstBinary(t,0,i))return i}return null}function testDataAgainstText(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function testDataAgainstBinary(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some((s=>testBinary(e,t,i,s)))}function testBinary(e,t,i,s){if(s instanceof ArrayBuffer)return compareArrayBuffers(s,e,s.byteLength);switch(typeof s){case"function":return s(e,i);case"string":return s===getMagicString(e,t,s.length);default:return!1}}function getFirstCharacters(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return getMagicString(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return getMagicString(e,0,t)}return""}function getMagicString(e,t,i){if(e.byteLength<t+i)return"";const s=new DataView(e);let r="";for(let e=0;e<i;e++)r+=String.fromCharCode(s.getUint8(t+e));return r}const DEFAULT_CHUNK_SIZE$2=262144;function*makeStringIterator(e,t){const i=(null==t?void 0:t.chunkSize)||262144;let s=0;const r=new TextEncoder;for(;s<e.length;){const t=Math.min(e.length-s,i),o=e.slice(s,s+t);s+=t,yield r.encode(o)}}const DEFAULT_CHUNK_SIZE$1=262144;function*makeArrayBufferIterator(e,t={}){const{chunkSize:i=DEFAULT_CHUNK_SIZE$1}=t;let s=0;for(;s<e.byteLength;){const t=Math.min(e.byteLength-s,i),r=new ArrayBuffer(t),o=new Uint8Array(e,s,t);new Uint8Array(r).set(o),s+=t,yield r}}const DEFAULT_CHUNK_SIZE=1048576;async function*makeBlobIterator(e,t){const i=(null==t?void 0:t.chunkSize)||1048576;let s=0;for(;s<e.size;){const t=s+i,r=await e.slice(s,t).arrayBuffer();s=t,yield r}}function makeStreamIterator(e,t){return isBrowser$2?makeBrowserStreamIterator(e,t):makeNodeStreamIterator(e)}async function*makeBrowserStreamIterator(e,t){const i=e.getReader();let s;try{for(;;){const e=s||i.read();null!=t&&t._streamReadAhead&&(s=i.read());const{done:r,value:o}=await e;if(r)return;yield toArrayBuffer(o)}}catch(e){i.releaseLock()}}async function*makeNodeStreamIterator(e,t){for await(const t of e)yield toArrayBuffer(t)}function makeIterator(e,t){if("string"==typeof e)return makeStringIterator(e,t);if(e instanceof ArrayBuffer)return makeArrayBufferIterator(e,t);if(isBlob(e))return makeBlobIterator(e,t);if(isReadableStream(e))return makeStreamIterator(e,t);if(isResponse(e)){return makeStreamIterator(e.body,t)}throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(e,t,i){if(t.text&&"string"==typeof e)return e;var s;if((s=e)&&"object"==typeof s&&s.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const i=e;if(t.text&&!t.binary){return new TextDecoder("utf8").decode(i)}return i}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary){return new TextDecoder("utf8").decode(e)}let i=e.buffer;const s=e.byteLength||e.length;return 0===e.byteOffset&&s===i.byteLength||(i=i.slice(e.byteOffset,e.byteOffset+s)),i}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(e,t,i){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||s)return getArrayBufferOrStringFromDataSync(e,t);if(isBlob(e)&&(e=await makeResponse(e)),isResponse(e)){const i=e;return await checkResponse(i),t.binary?await i.arrayBuffer():await i.text()}if(isReadableStream(e)&&(e=makeIterator(e,i)),(r=e)&&"function"==typeof r[Symbol.iterator]||isAsyncIterable(e))return concatenateArrayBuffersAsync(e);var r;throw new Error(ERR_DATA)}function getLoaderContext(e,t,i=null){if(i)return i;const s={fetch:getFetchFunction(t,e),...e};return Array.isArray(s.loaders)||(s.loaders=null),s}function getLoadersFromContext(e,t){if(!t&&e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...e]:e}return i&&i.length?i:null}async function parse(e,t,i,s){assert$1(!s||"object"==typeof s),!t||Array.isArray(t)||isLoaderObject(t)||(s=void 0,i=t,t=void 0),e=await e,i=i||{};const{url:r}=getResourceUrlAndType(e),o=getLoadersFromContext(t,s),a=await selectLoader(e,o,i);return a?(s=getLoaderContext({url:r,parse:parse,loaders:o},i=normalizeOptions(i,a,o,r),s),await parseWithLoader(a,e,i,s)):null}async function parseWithLoader(e,t,i,s){if(validateWorkerVersion(e),t=await getArrayBufferOrStringFromData(t,e,i),e.parseTextSync&&"string"==typeof t)return i.dataType="text",e.parseTextSync(t,i,s,e);if(canParseWithWorker(e,i))return await parseWithWorker(e,t,i,s,parse);if(e.parseText&&"string"==typeof t)return await e.parseText(t,i,s,e);if(e.parse)return await e.parse(t,i,s,e);throw assert$1(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}const VERSION="3.0.13",DEFAULT_LAS_OPTIONS={las:{fp64:!1,skip:1,colorDepth:8}},LASLoader={name:"LAS",id:"las",module:"las",version:VERSION,worker:!0,extensions:["las","laz"],mimeTypes:["application/octet-stream"],text:!0,binary:!0,tests:["LAS"],options:DEFAULT_LAS_OPTIONS};class LASLoaderPlugin extends Plugin{constructor(e,t={}){super("lasLoader",e,t),this.dataSource=t.dataSource,this.skip=t.skip,this.fp64=t.fp64,this.colorDepth=t.colorDepth}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new LASDefaultDataSource}get skip(){return this._skip}set skip(e){this._skip=e||1}get fp64(){return this._fp64}set fp64(e){this._fp64=!!e}get colorDepth(){return this._colorDepth}set colorDepth(e){this._colorDepth=!!e}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new PerformanceModel(this.viewer.scene,utils.apply(e,{isModel:!0}));if(!e.src&&!e.las)return this.error("load() param expected: src or las"),t;const i={skip:this._skip,fp64:this._fp64,colorDepth:this._colorDepth};if(e.src)this._loadModel(e.src,e,i,t);else{const s=this.viewer.scene.canvas.spinner;s.processes++,this._parseModel(e.las,e,i,t).then((()=>{s.processes--}),(e=>{s.processes--,this.error(e),t.fire("error",e)}))}return t}_loadModel(e,t,i,s){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getLAS(t.src,(e=>{this._parseModel(e,t,i,s).then((()=>{r.processes--}),(e=>{r.processes--,this.error(e),s.fire("error",e)}))}),(e=>{r.processes--,this.error(e),s.fire("error",e)}))}_parseModel(e,t,i,s){function r(e){const i=e.value;if(t.rotateX&&i)for(let e=0,t=i.length;e<t;e+=3){const t=i[e+1];i[e+1]=i[e+2],i[e+2]=t}return i}function o(e,t){const i=e.value,s=e.size,r=t.value,o=4*r.length,a=new Uint8Array(o);for(let e=0,t=0,o=0,n=r.length;e<n;e++,o+=s,t+=4)a[t+0]=i[o+0],a[t+1]=i[o+1],a[t+2]=i[o+2],a[t+3]=Math.round(r[e]/65536*255);return a}function a(e){const t=e.intensity,i=4*t.length,s=new Uint8Array(i);for(let e=0,i=0,r=t.length;e<r;e++,i+=4)s[i+0]=0,s[i+1]=0,s[i+2]=0,s[i+3]=Math.round(t[e]/65536*255);return s}return new Promise(((n,h)=>{if(s.destroyed)return void h();const l=t.stats||{};l.sourceFormat="LAS",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;try{parse(e,LASLoader,i).then((e=>{const l=e.loaderData.header.pointsFormatId,c=e.attributes;if(!c.POSITION)return s.finalize(),void h("No positions found in file");let u,p;switch(l){case 0:u=r(c.POSITION),p=a(c.intensity);break;case 1:if(!c.intensity)return s.finalize(),void h("No positions found in file");u=r(c.POSITION),p=a(c.intensity);break;case 2:case 3:if(!c.intensity)return s.finalize(),void h("No positions found in file");u=r(c.POSITION),p=o(c.COLOR_0,c.intensity)}s.createMesh({id:"pointsMesh",primitive:"points",positions:u,colorsCompressed:p});const d=math.createUUID();if(s.createEntity({id:d,meshIds:["pointsMesh"],isObject:!0}),s.finalize(),!1!==t.loadMetadata){const e=math.createUUID(),t={projectId:"",author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[{id:e,name:"Model",type:"Model"},{id:d,name:"PointCloud (LAS)",type:"PointCloud",parent:e}],propertySets:[]},r=s.id;this.viewer.metaScene.createMetaModel(r,t,i)}s.scene.once("tick",(()=>{s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))})),n()}))}catch(e){s.finalize(),h(e)}}))}}class CityJSONDefaultDataSource{constructor(){}getCityJSON(e,t,i){utils.loadJSON(e,(e=>{t(e)}),(function(e){i(e)}))}}function earcut(e,t,i){i=i||2;var s,r,o,a,n,h,l,c=t&&t.length,u=c?t[0]*i:e.length,p=linkedList(e,0,u,i,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=eliminateHoles(e,t,p,i)),e.length>80*i){s=o=e[0],r=a=e[1];for(var m=i;m<u;m+=i)(n=e[m])<s&&(s=n),(h=e[m+1])<r&&(r=h),n>o&&(o=n),h>a&&(a=h);l=0!==(l=Math.max(o-s,a-r))?1/l:0}return earcutLinked(p,d,i,s,r,l),d}function linkedList(e,t,i,s,r){var o,a;if(r===signedArea(e,t,i,s)>0)for(o=t;o<i;o+=s)a=insertNode(o,e[o],e[o+1],a);else for(o=i-s;o>=t;o-=s)a=insertNode(o,e[o],e[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,t){if(!e)return e;t||(t=e);var i,s=e;do{if(i=!1,s.steiner||!equals(s,s.next)&&0!==area(s.prev,s,s.next))s=s.next;else{if(removeNode(s),(s=t=s.prev)===s.next)break;i=!0}}while(i||s!==t);return t}function earcutLinked(e,t,i,s,r,o,a){if(e){!a&&o&&indexCurve(e,s,r,o);for(var n,h,l=e;e.prev!==e.next;)if(n=e.prev,h=e.next,o?isEarHashed(e,s,r,o):isEar(e))t.push(n.i/i),t.push(e.i/i),t.push(h.i/i),removeNode(e),e=h.next,l=h.next;else if((e=h)===l){a?1===a?earcutLinked(e=cureLocalIntersections(filterPoints(e),t,i),t,i,s,r,o,2):2===a&&splitEarcut(e,t,i,s,r,o):earcutLinked(filterPoints(e),t,i,s,r,o,1);break}}}function isEar(e){var t=e.prev,i=e,s=e.next;if(area(t,i,s)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(pointInTriangle(t.x,t.y,i.x,i.y,s.x,s.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(e,t,i,s){var r=e.prev,o=e,a=e.next;if(area(r,o,a)>=0)return!1;for(var n=r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,h=r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,l=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,c=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,u=zOrder(n,h,t,i,s),p=zOrder(l,c,t,i,s),d=e.prevZ,m=e.nextZ;d&&d.z>=u&&m&&m.z<=p;){if(d!==e.prev&&d!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==e.prev&&m!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,a.x,a.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=u;){if(d!==e.prev&&d!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=p;){if(m!==e.prev&&m!==e.next&&pointInTriangle(r.x,r.y,o.x,o.y,a.x,a.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function cureLocalIntersections(e,t,i){var s=e;do{var r=s.prev,o=s.next.next;!equals(r,o)&&intersects(r,s,s.next,o)&&locallyInside(r,o)&&locallyInside(o,r)&&(t.push(r.i/i),t.push(s.i/i),t.push(o.i/i),removeNode(s),removeNode(s.next),s=e=o),s=s.next}while(s!==e);return filterPoints(s)}function splitEarcut(e,t,i,s,r,o){var a=e;do{for(var n=a.next.next;n!==a.prev;){if(a.i!==n.i&&isValidDiagonal(a,n)){var h=splitPolygon(a,n);return a=filterPoints(a,a.next),h=filterPoints(h,h.next),earcutLinked(a,t,i,s,r,o),void earcutLinked(h,t,i,s,r,o)}n=n.next}a=a.next}while(a!==e)}function eliminateHoles(e,t,i,s){var r,o,a,n=[];for(r=0,o=t.length;r<o;r++)(a=linkedList(e,t[r]*s,r<o-1?t[r+1]*s:e.length,s,!1))===a.next&&(a.steiner=!0),n.push(getLeftmost(a));for(n.sort(compareX),r=0;r<n.length;r++)eliminateHole(n[r],i),i=filterPoints(i,i.next);return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t)){var i=splitPolygon(t,e);filterPoints(t,t.next),filterPoints(i,i.next)}}function findHoleBridge(e,t){var i,s=t,r=e.x,o=e.y,a=-1/0;do{if(o<=s.y&&o>=s.next.y&&s.next.y!==s.y){var n=s.x+(o-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(n<=r&&n>a){if(a=n,n===r){if(o===s.y)return s;if(o===s.next.y)return s.next}i=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!i)return null;if(r===a)return i;var h,l=i,c=i.x,u=i.y,p=1/0;s=i;do{r>=s.x&&s.x>=c&&r!==s.x&&pointInTriangle(o<u?r:a,o,c,u,o<u?a:r,o,s.x,s.y)&&(h=Math.abs(o-s.y)/(r-s.x),locallyInside(s,e)&&(h<p||h===p&&(s.x>i.x||s.x===i.x&&sectorContainsSector(i,s)))&&(i=s,p=h)),s=s.next}while(s!==l);return i}function sectorContainsSector(e,t){return area(e.prev,e,t.prev)<0&&area(t.next,e,e.next)<0}function indexCurve(e,t,i,s){var r=e;do{null===r.z&&(r.z=zOrder(r.x,r.y,t,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,sortLinked(r)}function sortLinked(e){var t,i,s,r,o,a,n,h,l=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,s=i,n=0,t=0;t<l&&(n++,s=s.nextZ);t++);for(h=l;n>0||h>0&&s;)0!==n&&(0===h||!s||i.z<=s.z)?(r=i,i=i.nextZ,n--):(r=s,s=s.nextZ,h--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=s}o.nextZ=null,l*=2}while(a>1);return e}function zOrder(e,t,i,s,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function pointInTriangle(e,t,i,s,r,o,a,n){return(r-a)*(t-n)-(e-a)*(o-n)>=0&&(e-a)*(s-n)-(i-a)*(t-n)>=0&&(i-a)*(o-n)-(r-a)*(s-n)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&(locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)&&(area(e.prev,e,t.prev)||area(e,t.prev,t))||equals(e,t)&&area(e.prev,e,e.next)>0&&area(t.prev,t,t.next)>0)}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,s){var r=sign(area(e,t,i)),o=sign(area(e,t,s)),a=sign(area(i,s,e)),n=sign(area(i,s,t));return r!==o&&a!==n||(!(0!==r||!onSegment(e,i,t))||(!(0!==o||!onSegment(e,s,t))||(!(0!==a||!onSegment(i,e,s))||!(0!==n||!onSegment(i,t,s)))))}function onSegment(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function sign(e){return e>0?1:e<0?-1:0}function intersectsPolygon(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var i=e,s=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}function splitPolygon(e,t){var i=new Node(e.i,e.x,e.y),s=new Node(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,o.next=s,s.prev=o,s}function insertNode(e,t,i,s){var r=new Node(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,i,s){for(var r=0,o=t,a=i-s;o<i;o+=s)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}earcut.deviation=function(e,t,i,s){var r=t&&t.length,o=r?t[0]*i:e.length,a=Math.abs(signedArea(e,0,o,i));if(r)for(var n=0,h=t.length;n<h;n++){var l=t[n]*i,c=n<h-1?t[n+1]*i:e.length;a-=Math.abs(signedArea(e,l,c,i))}var u=0;for(n=0;n<s.length;n+=3){var p=s[n]*i,d=s[n+1]*i,m=s[n+2]*i;u+=Math.abs((e[p]-e[m])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[m+1]-e[p+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},earcut.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[r][o][a]);r>0&&(s+=e[r-1].length,i.holes.push(s))}return i};const tempVec2a=math.vec2(),tempVec3a=math.vec3(),tempVec3b=math.vec3(),tempVec3c=math.vec3();class CityJSONLoaderPlugin extends Plugin{constructor(e,t={}){super("cityJSONLoader",e,t),this.dataSource=t.dataSource}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new CityJSONDefaultDataSource}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new PerformanceModel(this.viewer.scene,utils.apply(e,{isModel:!0}));if(!e.src&&!e.cityJSON)return this.error("load() param expected: src or cityJSON"),t;const i={};if(e.src)this._loadModel(e.src,e,i,t);else{const s=this.viewer.scene.canvas.spinner;s.processes++,this._parseModel(e.cityJSON,e,i,t),s.processes--}return t}_loadModel(e,t,i,s){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getCityJSON(t.src,(e=>{this._parseModel(e,t,i,s),r.processes--}),(e=>{r.processes--,this.error(e),s.fire("error",e)}))}_parseModel(e,t,i,s){if(s.destroyed)return;const r=e.transform?this._transformVertices(e.vertices,e.transform,i.rotateX):e.vertices,o=t.stats||{};o.sourceFormat=e.type||"CityJSON",o.schemaVersion=e.version||"",o.title="",o.author="",o.created="",o.numMetaObjects=0,o.numPropertySets=0,o.numObjects=0,o.numGeometries=0,o.numTriangles=0,o.numVertices=0;const a=!1!==t.loadMetadata,n=a?{id:math.createUUID(),name:"Model",type:"Model"}:null,h=a?{id:"",projectId:"",author:"",createdAt:"",schema:e.version||"",creatingApplication:"",metaObjects:[n],propertySets:[]}:null,l={data:e,vertices:r,performanceModel:s,loadMetadata:a,metadata:h,rootMetaObject:n,nextId:0,stats:o};if(this._parseCityJSON(l),s.finalize(),a){const e=s.id;this.viewer.metaScene.createMetaModel(e,l.metadata,i)}s.scene.once("tick",(()=>{s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))}))}_transformVertices(e,t,i){const s=[],r=t.scale||math.vec3([1,1,1]),o=t.translate||math.vec3([0,0,0]);for(let t=0,a=0;t<e.length;t++,a+=3){const a=e[t][0]*r[0]+o[0],n=e[t][1]*r[1]+o[1],h=e[t][2]*r[2]+o[2];i?s.push([a,h,n]):s.push([a,n,h])}return s}_parseCityJSON(e){const t=e.data.CityObjects;for(const i in t)if(t.hasOwnProperty(i)){const s=t[i];this._parseCityObject(e,s,i)}}_parseCityObject(e,t,i){const s=e.performanceModel,r=e.data;if(e.loadMetadata){const s=i,r=t.type,o=r+" : "+i,a=t.parents?t.parents[0]:e.rootMetaObject.id;e.metadata.metaObjects.push({id:s,name:o,type:r,parent:a})}if(e.stats.numMetaObjects++,!(t.geometry&&t.geometry.length>0))return;const o=[];for(let i=0,s=t.geometry.length;i<s;i++){const s=t.geometry[i];let a,n;const h=r.appearance;if(h){const e=h.materials;if(e){const t=s.material;if(t){const s=Object.keys(t);if(s.length>0){const r=t[s[0]];if(void 0!==r.value)a=e[r.value];else{const t=r.values;if(t){n=[];for(let s=0,r=t.length;s<r;s++){const s=e[t[i]];n.push(s)}}}}}}}n?this._parseGeometrySurfacesWithOwnMaterials(e,s,n,o):this._parseGeometrySurfacesWithSharedMaterial(e,s,a,o)}o.length>0&&(s.createEntity({id:i,meshIds:o,isObject:!0}),e.stats.numObjects++)}_parseGeometrySurfacesWithOwnMaterials(e,t,i,s){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":const r=t.boundaries;this._parseSurfacesWithOwnMaterials(e,i,r,s);break;case"Solid":const o=t.boundaries;for(let t=0;t<o.length;t++){const r=o[t];this._parseSurfacesWithOwnMaterials(e,i,r,s)}break;case"MultiSolid":case"CompositeSolid":const a=t.boundaries;for(let t=0;t<a.length;t++)for(let r=0;r<a[t].length;r++){const o=a[t][r];this._parseSurfacesWithOwnMaterials(e,i,o,s)}}}_parseSurfacesWithOwnMaterials(e,t,i,s){const r=e.vertices,o=e.performanceModel;for(let a=0;a<i.length;a++){const n=i[a],h=t[a]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],c=[],u=[],p={positions:[],indices:[]};for(let t=0;t<n.length;t++){l.length>0&&c.push(l.length);const i=this._extractLocalIndices(e,n[t],u,p);l.push(...i)}if(3===l.length)p.indices.push(l[0]),p.indices.push(l[1]),p.indices.push(l[2]);else if(l.length>3){const e=[];for(let t=0;t<l.length;t++)e.push({x:r[u[l[t]]][0],y:r[u[l[t]]][1],z:r[u[l[t]]][2]});const t=this._getNormalOfPositions(e,math.vec3());let i=[];for(let s=0;s<e.length;s++)this._to2D(e[s],t,tempVec2a),i.unshift(tempVec2a[0]),i.unshift(tempVec2a[1]);const s=earcut(i,c,2);for(let e=0;e<s.length;e+=3)p.indices.unshift(l[s[e]]),p.indices.unshift(l[s[e+1]]),p.indices.unshift(l[s[e+2]])}const d=""+e.nextId++;o.createMesh({id:d,primitive:"triangles",positions:p.positions,indices:p.indices,color:h&&h.diffuseColor?h.diffuseColor:[.8,.8,.8],opacity:h&&void 0!==h.transparency?1-h.transparency:1}),s.push(d),e.stats.numGeometries++,e.stats.numVertices+=p.positions.length/3,e.stats.numTriangles+=p.indices.length/3}}_parseGeometrySurfacesWithSharedMaterial(e,t,i,s){const r=e.performanceModel,o=[],a={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":const i=t.boundaries;this._parseSurfacesWithSharedMaterial(e,i,o,a);break;case"Solid":const s=t.boundaries;for(let t=0;t<s.length;t++){const i=s[t];this._parseSurfacesWithSharedMaterial(e,i,o,a)}break;case"MultiSolid":case"CompositeSolid":const r=t.boundaries;for(let t=0;t<r.length;t++)for(let i=0;i<r[t].length;i++){const s=r[t][i];this._parseSurfacesWithSharedMaterial(e,s,o,a)}}if(a.positions.length>0&&a.indices.length>0){const t=""+e.nextId++;r.createMesh({id:t,primitive:"triangles",positions:a.positions,indices:a.indices,color:i&&i.diffuseColor?i.diffuseColor:[.8,.8,.8],opacity:1}),s.push(t),e.stats.numGeometries++,e.stats.numVertices+=a.positions.length/3,e.stats.numTriangles+=a.indices.length/3}}_parseSurfacesWithSharedMaterial(e,t,i,s){const r=e.vertices;for(let o=0;o<t.length;o++){let a=[],n=[];for(let r=0;r<t[o].length;r++){a.length>0&&n.push(a.length);const h=this._extractLocalIndices(e,t[o][r],i,s);a.push(...h)}if(3===a.length)s.indices.push(a[0]),s.indices.push(a[1]),s.indices.push(a[2]);else if(a.length>3){let e=[];for(let t=0;t<a.length;t++)e.push({x:r[i[a[t]]][0],y:r[i[a[t]]][1],z:r[i[a[t]]][2]});const t=this._getNormalOfPositions(e,math.vec3());let o=[];for(let i=0;i<e.length;i++)this._to2D(e[i],t,tempVec2a),o.unshift(tempVec2a[0]),o.unshift(tempVec2a[1]);const h=earcut(o,n,2);for(let e=0;e<h.length;e+=3)s.indices.unshift(a[h[e]]),s.indices.unshift(a[h[e+1]]),s.indices.unshift(a[h[e+2]])}}}_extractLocalIndices(e,t,i,s){const r=e.vertices,o=[];for(let e=0,a=t.length;e<a;e++){const a=t[e];if(i.includes(a)){const e=i.indexOf(a);o.push(e)}else s.positions.push(r[a][0]),s.positions.push(r[a][1]),s.positions.push(r[a][2]),o.push(i.length),i.push(a)}return o}_getNormalOfPositions(e,t){for(let i=0;i<e.length;i++){let s=i+1;s===e.length&&(s=0),t[0]+=(e[i].y-e[s].y)*(e[i].z+e[s].z),t[1]+=(e[i].z-e[s].z)*(e[i].x+e[s].x),t[2]+=(e[i].x-e[s].x)*(e[i].y+e[s].y)}return math.normalizeVec3(t)}_to2D(e,t,i){const s=tempVec3a,r=tempVec3b,o=tempVec3c;s[0]=e.x,s[1]=e.y,s[2]=e.z,r[0]=t.x,r[1]=t.y,r[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1;math.lenVec3(math.subVec3(o,r))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);const a=math.dotVec3(o,r),n=math.mulVec3Scalar(r,a,math.vec3());o[0]-=n[0],o[1]-=n[1],o[2]-=n[2],math.normalizeVec3(o);const h=math.cross3Vec3(r,o,math.vec3()),l=math.dotVec3(s,o),c=math.dotVec3(s,h);i[0]=l,i[1]=c}}export{AmbientLight,AngleMeasurementsPlugin,AnnotationsPlugin,AxisGizmoPlugin,BCFViewpointsPlugin,CameraMemento,CameraPath,CameraPathAnimation,CityJSONLoaderPlugin,Component,Configs,ContextMenu,CubicBezierCurve,Curve,DirLight,DistanceMeasurementsPlugin,EdgeMaterial,EmphasisMaterial,FastNavPlugin,Fresnel,GLTFDefaultDataSource,GLTFLoaderPlugin,ImagePlane,LASLoaderPlugin,LambertMaterial,LightMap,LocaleService,Map$1 as Map,Marker,Mesh,MetallicMaterial,ModelMemento,NavCubePlugin,Node$1 as Node,OBJLoaderPlugin,ObjectsMemento,Path,PerformanceModel,PhongMaterial,Plugin,PointLight,QuadraticBezierCurve,Queue,ReadableGeometry,ReflectionMap,STLDefaultDataSource,STLLoaderPlugin,SectionPlane,SectionPlanesPlugin,Skybox,SkyboxesPlugin,SpecularMaterial,SplineCurve,SpriteMarker,StoreyViewsPlugin,Texture,TreeViewPlugin,VBOGeometry,ViewCullPlugin,Viewer,WebIFCLoaderPlugin,XKTDefaultDataSource,XKTLoaderPlugin,XML3DLoaderPlugin,buildBoxGeometry,buildBoxLinesGeometry,buildCylinderGeometry,buildGridGeometry,buildPlaneGeometry,buildSphereGeometry,buildTorusGeometry,buildVectorTextGeometry,load3DSGeometry,loadOBJGeometry,math,stats,utils};
 //# sourceMappingURL=/sm/d52c964de4e57994db478205521643c0e0f1b0fff5fda5dd68f589897bd3ae44.map